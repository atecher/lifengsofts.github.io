<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="React,React Native,NodeJS,Node," />





  <link rel="alternate" href="/atom.xml" title="任苹蜻的博客" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="效果图开发流程主界面Tab切换1.先完成主界面的三个tab切换，我们这里使用TabBarIOS
来到官方的TabBarIOS文档直接将实例代码的拷贝到项目
12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656">
<meta property="og:type" content="article">
<meta property="og:title" content="使用ReactNative开发狗狗说应用流程">
<meta property="og:url" content="http://i.woblog.cn/2016/12/03/dev-gougou-say/index.html">
<meta property="og:site_name" content="任苹蜻的博客">
<meta property="og:description" content="效果图开发流程主界面Tab切换1.先完成主界面的三个tab切换，我们这里使用TabBarIOS
来到官方的TabBarIOS文档直接将实例代码的拷贝到项目
12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656">
<meta property="og:image" content="http://7qnc6h.com1.z0.glb.clouddn.com/%E5%AF%B9%E8%A7%92%E7%BA%BF.png">
<meta property="og:image" content="http://7qnc6h.com1.z0.glb.clouddn.com/%E7%82%B9.png">
<meta property="og:image" content="http://7qnc6h.com1.z0.glb.clouddn.com/%E5%83%8F%E7%B4%A0.png">
<meta property="og:image" content="http://7qnc6h.com1.z0.glb.clouddn.com/ppi.png">
<meta property="og:image" content="http://7qnc6h.com1.z0.glb.clouddn.com/iphone6-screen.png">
<meta property="og:image" content="http://7qnc6h.com1.z0.glb.clouddn.com/iphone-screen.png">
<meta property="og:updated_time" content="2017-03-19T14:22:37.668Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用ReactNative开发狗狗说应用流程">
<meta name="twitter:description" content="效果图开发流程主界面Tab切换1.先完成主界面的三个tab切换，我们这里使用TabBarIOS
来到官方的TabBarIOS文档直接将实例代码的拷贝到项目
12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656">
<meta name="twitter:image" content="http://7qnc6h.com1.z0.glb.clouddn.com/%E5%AF%B9%E8%A7%92%E7%BA%BF.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  <title> 使用ReactNative开发狗狗说应用流程 | 任苹蜻的博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?48746acb55f702790215ece2fb3a3be5";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">任苹蜻的博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-heartbeat fa-fw"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                使用ReactNative开发狗狗说应用流程
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-03T10:58:58+00:00" content="2016-12-03">
              2016-12-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/React-Native/" itemprop="url" rel="index">
                    <span itemprop="name">React Native</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/03/dev-gougou-say/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/03/dev-gougou-say/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><h1 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h1><h2 id="主界面Tab切换"><a href="#主界面Tab切换" class="headerlink" title="主界面Tab切换"></a>主界面Tab切换</h2><p>1.先完成主界面的三个tab切换，我们这里使用TabBarIOS</p>
<p><a href="http://facebook.github.io/react-native/releases/0.22/docs/tabbarios.html#content" target="_blank" rel="external">来到官方的TabBarIOS文档</a>直接将实例代码的拷贝到项目</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> base64Icon = <span class="string">'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAABLCAQAAACSR7JhAAADtUlEQVR4Ac3YA2Bj6QLH0XPT1Fzbtm29tW3btm3bfLZtv7e2ObZnms7d8Uw098tuetPzrxv8wiISrtVudrG2JXQZ4VOv+qUfmqCGGl1mqLhoA52oZlb0mrjsnhKpgeUNEs91Z0pd1kvihA3ULGVHiQO2narKSHKkEMulm9VgUyE60s1aWoMQUbpZOWE+kaqs4eLEjdIlZTcFZB0ndc1+lhB1lZrIuk5P2aib1NBpZaL+JaOGIt0ls47SKzLC7CqrlGF6RZ09HGoNy1lYl2aRSWL5GuzqWU1KafRdoRp0iOQEiDzgZPnG6DbldcomadViflnl/cL93tOoVbsOLVM2jylvdWjXolWX1hmfZbGR/wjypDjFLSZIRov09BgYmtUqPQPlQrPapecLgTIy0jMgPKtTeob2zWtrGH3xvjUkPCtNg/tm1rjwrMa+mdUkPd3hWbH0jArPGiU9ufCsNNWFZ40wpwn+62/66R2RUtoso1OB34tnLOcy7YB1fUdc9e0q3yru8PGM773vXsuZ5YIZX+5xmHwHGVvlrGPN6ZSiP1smOsMMde40wKv2VmwPPVXNut4sVpUreZiLBHi0qln/VQeI/LTMYXpsJtFiclUN+5HVZazim+Ky+7sAvxWnvjXrJFneVtLWLyPJu9K3cXLWeOlbMTlrIelbMDlrLenrjEQOtIF+fuI9xRp9ZBFp6+b6WT8RrxEpdK64BuvHgDk+vUy+b5hYk6zfyfs051gRoNO1usU12WWRWL73/MMEy9pMi9qIrR4ZpV16Rrvduxazmy1FSvuFXRkqTnE7m2kdb5U8xGjLw/spRr1uTov4uOgQE+0N/DvFrG/Jt7i/FzwxbA9kDanhf2w+t4V97G8lrT7wc08aA2QNUkuTfW/KimT01wdlfK4yEw030VfT0RtZbzjeMprNq8m8tnSTASrTLti64oBNdpmMQm0eEwvfPwRbUBywG5TzjPCsdwk3IeAXjQblLCoXnDVeoAz6SfJNk5TTzytCNZk/POtTSV40NwOFWzw86wNJRpubpXsn60NJFlHeqlYRbslqZm2jnEZ3qcSKgm0kTli3zZVS7y/iivZTweYXJ26Y+RTbV1zh3hYkgyFGSTKPfRVbRqWWVReaxYeSLarYv1Qqsmh1s95S7G+eEWK0f3jYKTbV6bOwepjfhtafsvUsqrQvrGC8YhmnO9cSCk3yuY984F1vesdHYhWJ5FvASlacshUsajFt2mUM9pqzvKGcyNJW0arTKN1GGGzQlH0tXwLDgQTurS8eIQAAAABJRU5ErkJggg=='</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">var</span> say = React.createClass( &#123;</div><div class="line">  <span class="attr">statics</span>: &#123;</div><div class="line">    <span class="attr">title</span>: <span class="string">'&lt;TabBarIOS&gt;'</span>,</div><div class="line">    <span class="attr">description</span>: <span class="string">'Tab-based navigation.'</span>,</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">displayName</span>: <span class="string">'TabBarExample'</span>,</div><div class="line"></div><div class="line">  <span class="attr">getInitialState</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">selectedTab</span>: <span class="string">'redTab'</span>,</div><div class="line">      <span class="attr">notifCount</span>: <span class="number">0</span>,</div><div class="line">      <span class="attr">presses</span>: <span class="number">0</span>,</div><div class="line">    &#125;;</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">_renderContent</span>: <span class="function"><span class="keyword">function</span>(<span class="params">color: string, pageText: string, num?: number</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;[styles.tabContent,</span> &#123;<span class="attr">backgroundColor:</span> <span class="attr">color</span>&#125;]&#125;&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.tabText&#125;</span>&gt;</span>&#123;pageText&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.tabText&#125;</span>&gt;</span>&#123;num&#125; re-renders of the &#123;pageText&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">render</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;TabBarIOS</div><div class="line">        tintColor="#ee735c"&gt;</div><div class="line">        &lt;TabBarIOS.Item</div><div class="line">          title="视频"</div><div class="line">          icon=&#123;&#123;uri: base64Icon, scale: 3&#125;&#125;</div><div class="line">          selected=&#123;this.state.selectedTab === 'blueTab'&#125;</div><div class="line">          onPress=&#123;() =&gt; &#123;</div><div class="line">            this.setState(&#123;</div><div class="line">              selectedTab: 'blueTab',</div><div class="line">            &#125;);</div><div class="line">          &#125;&#125;&gt;</div><div class="line">          &#123;this._renderContent('#414A8C', 'Blue Tab')&#125;</div><div class="line">        &lt;/TabBarIOS.Item&gt;</div><div class="line">        &lt;TabBarIOS.Item</div><div class="line">          systemIcon="history"</div><div class="line">          badge=&#123;this.state.notifCount &gt; 0 ? this.state.notifCount : undefined&#125;</div><div class="line">          selected=&#123;this.state.selectedTab === 'redTab'&#125;</div><div class="line">          onPress=&#123;() =&gt; &#123;</div><div class="line">            this.setState(&#123;</div><div class="line">              selectedTab: 'redTab',</div><div class="line">              notifCount: this.state.notifCount + 1,</div><div class="line">            &#125;);</div><div class="line">          &#125;&#125;&gt;</div><div class="line">          &#123;this._renderContent('#783E33', 'Red Tab', this.state.notifCount)&#125;</div><div class="line">        &lt;/TabBarIOS.Item&gt;</div><div class="line">        &lt;TabBarIOS.Item</div><div class="line">          icon=&#123;require('./flux.png')&#125;</div><div class="line">          title="More"</div><div class="line">          selected=&#123;this.state.selectedTab === 'greenTab'&#125;</div><div class="line">          onPress=&#123;() =&gt; &#123;</div><div class="line">            this.setState(&#123;</div><div class="line">              selectedTab: 'greenTab',</div><div class="line">              presses: this.state.presses + 1</div><div class="line">            &#125;);</div><div class="line">          &#125;&#125;&gt;</div><div class="line">          &#123;this._renderContent('#21551C', 'Green Tab', this.state.presses)&#125;</div><div class="line">        &lt;/TabBarIOS.Item&gt;</div><div class="line">      &lt;/TabBarIOS&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>同时在项目根目录添加一个flux.png图片，因为上面的代码引用到了，添加他只是为了能够将项目跑起来，后面会替换掉他，现在运行就能看的效果了。</p>
<h2 id="替换Tab图标"><a href="#替换Tab图标" class="headerlink" title="替换Tab图标"></a>替换Tab图标</h2><p>我们这里使用一个react-native-vector-icons库，它自带了很多的图标，安装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i react-native-vector-icons@<span class="number">2.0</span><span class="number">.2</span>  --save</div></pre></td></tr></table></figure>
<p>直接安装完还是不能直接使用的，作用就是将一些库连接到工程，包括字体和图标。这里使用rnpm</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">npm i rnpm@<span class="number">1.7</span><span class="number">.0</span> -g</div><div class="line"></div><div class="line"><span class="comment">//连接</span></div><div class="line">rnpm link react-native-vector-icons</div></pre></td></tr></table></figure>
<p>现在就可以来到<a href="http://ionicons.com选择喜欢的图标了，选择后单击图标就可以得到名称。然后在代码中引入" target="_blank" rel="external">http://ionicons.com选择喜欢的图标了，选择后单击图标就可以得到名称。然后在代码中引入</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Icon = <span class="built_in">require</span>(<span class="string">'react-native-vector-icons/Ionicons'</span>)</div><div class="line"></div><div class="line"><span class="comment">//将自带的tab替换为Icon.TabBarItem，他是react-native-vector-icons提供的，能更好的配合这个图标</span></div><div class="line">&lt;Icon.TabBarItem</div><div class="line">  title=<span class="string">"Blue Tab"</span></div><div class="line">  iconName=<span class="string">'ios-videocam-outline'</span></div><div class="line">  selectedIconName=<span class="string">'ios-videocam'</span></div><div class="line">  selected=&#123;<span class="keyword">this</span>.state.selectedTab === <span class="string">'blueTab'</span>&#125;</div><div class="line">  onPress=&#123;() =&gt; &#123;</div><div class="line">    <span class="keyword">this</span>.setState(&#123;</div><div class="line">      <span class="attr">selectedTab</span>: <span class="string">'blueTab'</span>,</div><div class="line">    &#125;);</div><div class="line">  &#125;&#125;&gt;</div><div class="line">  &#123;<span class="keyword">this</span>._renderContent(<span class="string">'#414A8C'</span>, <span class="string">'Blue Tab'</span>)&#125;</div><div class="line">&lt;<span class="regexp">/Icon.TabBarItem&gt;</span></div></pre></td></tr></table></figure>
<p>特别注意icon变成了iconName，selected变为了selectedIconName，完整的tab代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> say = React.createClass( &#123;</div><div class="line">  <span class="attr">getInitialState</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">selectedTab</span>: <span class="string">'videoTab'</span></div><div class="line">    &#125;;</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">_renderContent</span>: <span class="function"><span class="keyword">function</span>(<span class="params">color: string, pageText: string, num?: number</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;[styles.tabContent,</span> &#123;<span class="attr">backgroundColor:</span> <span class="attr">color</span>&#125;]&#125;&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.tabText&#125;</span>&gt;</span>&#123;pageText&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.tabText&#125;</span>&gt;</span>&#123;num&#125; re-renders of the &#123;pageText&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">render</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;TabBarIOS</div><div class="line">        tintColor="#ee735c"&gt;</div><div class="line">        &lt;Icon.TabBarItem</div><div class="line">          title="视频"</div><div class="line">          iconName='ios-videocam-outline'</div><div class="line">          selectedIconName='ios-videocam'</div><div class="line">          selected=&#123;this.state.selectedTab === 'videoTab'&#125;</div><div class="line">          onPress=&#123;() =&gt; &#123;</div><div class="line">            this.setState(&#123;</div><div class="line">              selectedTab: 'videoTab',</div><div class="line">            &#125;);</div><div class="line">          &#125;&#125;&gt;</div><div class="line">          &#123;this._renderContent('#414A8C', 'Blue Tab')&#125;</div><div class="line">        &lt;/Icon.TabBarItem&gt;</div><div class="line">        &lt;Icon.TabBarItem</div><div class="line">          title="录制"</div><div class="line">          iconName='ios-recording-outline'</div><div class="line">          selectedIconName='ios-recording'</div><div class="line">          selected=&#123;this.state.selectedTab === 'recordTab'&#125;</div><div class="line">          onPress=&#123;() =&gt; &#123;</div><div class="line">            this.setState(&#123;</div><div class="line">              selectedTab: 'recordTab'</div><div class="line">            &#125;);</div><div class="line">          &#125;&#125;&gt;</div><div class="line">          &#123;this._renderContent('#783E33', 'Red Tab', this.state.notifCount)&#125;</div><div class="line">        &lt;/Icon.TabBarItem&gt;</div><div class="line">        &lt;Icon.TabBarItem</div><div class="line">          title="更多"</div><div class="line">          iconName='ios-more-outline'</div><div class="line">          selectedIconName='ios-more'</div><div class="line">          selected=&#123;this.state.selectedTab === 'moreTab'&#125;</div><div class="line">          onPress=&#123;() =&gt; &#123;</div><div class="line">            this.setState(&#123;</div><div class="line">              selectedTab: 'moreTab'</div><div class="line">            &#125;);</div><div class="line">          &#125;&#125;&gt;</div><div class="line">          &#123;this._renderContent('#21551C', 'Green Tab', this.state.presses)&#125;</div><div class="line">        &lt;/Icon.TabBarItem&gt;</div><div class="line">      &lt;/TabBarIOS&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="写tab对应的页面"><a href="#写tab对应的页面" class="headerlink" title="写tab对应的页面"></a>写tab对应的页面</h2><p>接下来我们需要将内容更换为三个子组件，分别对应三个tab页面。</p>
<p>首先先写三个组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> List=React.createClass(&#123;</div><div class="line">  <span class="attr">render</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span>&gt;</span>视频列表<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> Edit=React.createClass(&#123;</div><div class="line">  <span class="attr">render</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span>&gt;</span>制作页面<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> Account=React.createClass(&#123;</div><div class="line">  <span class="attr">render</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span>&gt;</span>账户页面<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>然后在tab中分别加入三个组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;Icon.TabBarItem</div><div class="line">  title=<span class="string">"视频"</span></div><div class="line">  iconName=<span class="string">'ios-videocam-outline'</span></div><div class="line">  selectedIconName=<span class="string">'ios-videocam'</span></div><div class="line">  selected=&#123;<span class="keyword">this</span>.state.selectedTab === <span class="string">'list'</span>&#125;</div><div class="line">  onPress=&#123;() =&gt; &#123;</div><div class="line">    <span class="keyword">this</span>.setState(&#123;</div><div class="line">      <span class="attr">selectedTab</span>: <span class="string">'list'</span>,</div><div class="line">    &#125;);</div><div class="line">  &#125;&#125;&gt;</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">List</span>/&gt;</span></span> <span class="comment">//在这里我们替换成了上面定义的组件</span></div><div class="line">&lt;<span class="regexp">/Icon.TabBarItem&gt;</span></div></pre></td></tr></table></figure>
<h3 id="将组件拿到对应的目录下"><a href="#将组件拿到对应的目录下" class="headerlink" title="将组件拿到对应的目录下"></a>将组件拿到对应的目录下</h3><p>上面的组件还是放到一个文件中的，导致的问题是，多个页面逻辑都混到一个页面了，修改和删除代码都不是很方法，所以采用的方法时将每个组件都放到相应的目录，然后在入口文件导入他。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> React = <span class="built_in">require</span>(<span class="string">'react-native'</span>)</div><div class="line"><span class="keyword">var</span> &#123;</div><div class="line">  StyleSheet,</div><div class="line">  Text,</div><div class="line">  View,</div><div class="line">&#125; = React;</div><div class="line"></div><div class="line"><span class="keyword">var</span> Icon = <span class="built_in">require</span>(<span class="string">'react-native-vector-icons/Ionicons'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> List=React.createClass(&#123;</div><div class="line">  <span class="attr">render</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span>&gt;</span>视频列表<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> styles = StyleSheet.create(&#123;</div><div class="line">  <span class="attr">container</span>: &#123;</div><div class="line">    <span class="attr">flex</span>: <span class="number">1</span>,</div><div class="line">    <span class="attr">justifyContent</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">alignItems</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">backgroundColor</span>: <span class="string">'#F5FCFF'</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">welcome</span>: &#123;</div><div class="line">    <span class="attr">fontSize</span>: <span class="number">20</span>,</div><div class="line">    <span class="attr">textAlign</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">margin</span>: <span class="number">10</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">instructions</span>: &#123;</div><div class="line">    <span class="attr">textAlign</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">color</span>: <span class="string">'#333333'</span>,</div><div class="line">    <span class="attr">marginBottom</span>: <span class="number">5</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports=List</div></pre></td></tr></table></figure>
<p>在入口文件中导入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//自定义模块</span></div><div class="line"><span class="keyword">var</span> List=<span class="built_in">require</span>(<span class="string">'./app/list/index'</span>)</div><div class="line"><span class="keyword">var</span> Edit=<span class="built_in">require</span>(<span class="string">'./app/edit/index'</span>)</div><div class="line"><span class="keyword">var</span> Account=<span class="built_in">require</span>(<span class="string">'./app/account/index'</span>)</div></pre></td></tr></table></figure>
<h2 id="创建模拟数据"><a href="#创建模拟数据" class="headerlink" title="创建模拟数据"></a>创建模拟数据</h2><p>我们这里使用rap和mockjs。</p>
<p>先去rap官网创建一个项目。<a href="http://rap.taobao.org/org/index.do，配置完生成规则后，可以使用下面地址获取规则或真实数据" target="_blank" rel="external">http://rap.taobao.org/org/index.do，配置完生成规则后，可以使用下面地址获取规则或真实数据</a></p>
<p><a href="http://rap.taobao.org/mockjsdata/11015/api/video?accessToken=111" target="_blank" rel="external">http://rap.taobao.org/mockjsdata/11015/api/video?accessToken=111</a></p>
<p><a href="http://rap.taobao.org/mockjs/11015/api/video?accessToken=111" target="_blank" rel="external">http://rap.taobao.org/mockjs/11015/api/video?accessToken=111</a></p>
<p>如果是规则，则需要使用mockjs解析，官网为：<a href="http://mockjs.com/" target="_blank" rel="external">http://mockjs.com/</a></p>
<p>你可以在控制台下输入Mock.mock(mock规则数据试试)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Mock.mock(&#123;<span class="string">"data|10"</span>:[&#123;<span class="string">"_id"</span>:<span class="string">"@ID"</span>,<span class="string">"video"</span>:<span class="string">"http:\/\/v2.mukewang.com\/cef3e514-8203-4c67-877f-79f7763553cf\/L.mp4?auth_key=1480760293-0-0-a693983f9d989e19a2c1c19f52d1e169"</span>,<span class="string">"thumb"</span>:<span class="string">"@IMG(1200x600,@color())"</span>&#125;],<span class="string">"success"</span>:<span class="literal">true</span>&#125;)</div><div class="line"></div><div class="line"><span class="comment">//会输出10条测试数据</span></div></pre></td></tr></table></figure>
<p>我们也可以直接在该页面的控制台下输入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> d = Mock.mock(&#123;<span class="string">"data|10"</span>:[&#123;<span class="string">"_id"</span>:<span class="string">"@ID"</span>,<span class="string">"video"</span>:<span class="string">"http:\/\/v2.mukewang.com\/cef3e514-8203-4c67-877f-79f7763553cf\/L.mp4?auth_key=1480760293-0-0-a693983f9d989e19a2c1c19f52d1e169"</span>,<span class="string">"thumb"</span>:<span class="string">"@IMG(1200x600,@color())"</span>&#125;],<span class="string">"success"</span>:<span class="literal">true</span>&#125;);d.data.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;$(<span class="string">"#examples"</span>).append(<span class="string">'&lt;h3&gt;'</span>+item._id+<span class="string">'&lt;/h3&gt;&lt;img src="'</span>+item.thumb+<span class="string">'"/&gt;'</span>)&#125;)</div></pre></td></tr></table></figure>
<p>就可以看到该页面最后又很多的图片和id数组。</p>
<h2 id="视频页面"><a href="#视频页面" class="headerlink" title="视频页面"></a>视频页面</h2><h3 id="添加视频页面标题"><a href="#添加视频页面标题" class="headerlink" title="添加视频页面标题"></a>添加视频页面标题</h3><p>在List下面的index.js文件中添加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;View style=&#123;styles.container&#125;&gt;</div><div class="line">	<span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.header&#125;</span>&gt;</span></span></div><div class="line">    	<span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.headerTitle&#125;</span>&gt;</span>列表页面<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">&lt;<span class="regexp">/View&gt;</span></div></pre></td></tr></table></figure>
<p>然后修改样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> styles = StyleSheet.create(&#123;</div><div class="line">  <span class="attr">container</span>: &#123;</div><div class="line">    <span class="attr">flex</span>: <span class="number">1</span>, </div><div class="line">    <span class="attr">backgroundColor</span>: <span class="string">'#F5FCFF'</span>,</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">header</span>:&#123;</div><div class="line">    <span class="attr">paddingTop</span>:<span class="number">25</span>,</div><div class="line">    <span class="attr">paddingBottom</span>:<span class="number">12</span>,</div><div class="line">    <span class="attr">backgroundColor</span>:<span class="string">'#ee735c'</span></div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">headerTitle</span>:&#123;</div><div class="line">    <span class="attr">color</span>:<span class="string">'white'</span>,</div><div class="line">    <span class="attr">fontSize</span>:<span class="number">16</span>,</div><div class="line">    <span class="attr">textAlign</span>:<span class="string">'center'</span>,</div><div class="line">    <span class="attr">fontWeight</span>:<span class="string">'600'</span></div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="添加视频列表"><a href="#添加视频列表" class="headerlink" title="添加视频列表"></a>添加视频列表</h3><p>添加一个ListView，首先要导出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;ListView</div><div class="line">  dataSource=&#123;<span class="keyword">this</span>.state.dataSource&#125;</div><div class="line">  renderRow=&#123;<span class="keyword">this</span>.renderRow&#125;</div><div class="line">  enableEmptySections=&#123;<span class="literal">true</span>&#125;</div><div class="line">/&gt;</div></pre></td></tr></table></figure>
<p>在定义一个renderRow方法，用来渲染每一个条目，相当于Android中Adapter的getView</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">renderRow(row)&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>完整代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> List=React.createClass(&#123;</div><div class="line"></div><div class="line">  <span class="attr">getInitialState</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> ds = <span class="keyword">new</span> ListView.DataSource(&#123;<span class="attr">rowHasChanged</span>: <span class="function">(<span class="params">r1, r2</span>) =&gt;</span> r1 !== r2&#125;);</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">dataSource</span>: ds.cloneWithRows([]),</div><div class="line">    &#125;;</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  renderRow(row)&#123;</div><div class="line"></div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">render</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">      	<span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.header&#125;</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.headerTitle&#125;</span>&gt;</span>列表页面<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      	<span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">ListView</span></span></div><div class="line">          <span class="attr">dataSource</span>=<span class="string">&#123;this.state.dataSource&#125;</span></div><div class="line">          <span class="attr">renderRow</span>=<span class="string">&#123;this.renderRow&#125;</span></div><div class="line">          <span class="attr">enableEmptySections</span>=<span class="string">&#123;true&#125;</span></div><div class="line">        /&gt;</div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>我们实现了一下renderRow方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">renderRow(row)&#123;</div><div class="line">	<span class="keyword">return</span>(</div><div class="line">	  &lt;TouchableHighlight&gt;</div><div class="line">	    &lt;View style=&#123;styles.item&#125;&gt;</div><div class="line">	      &#123;/* 标题 */&#125;</div><div class="line">	      &lt;Text style=&#123;styles.title&#125;&gt;&#123;row.title&#125;&lt;/Text&gt;</div><div class="line">	      </div><div class="line">	      &#123;/* 图片 */&#125;</div><div class="line">	      &lt;Image</div><div class="line">	        source=&#123;&#123;uri:row.thumb&#125;&#125;</div><div class="line">	        style=&#123;styles.thumb&#125;</div><div class="line">	      &gt;</div><div class="line">	        &lt;Icon</div><div class="line">	          name='ios-play'</div><div class="line">	          size=&#123;28&#125;</div><div class="line">	          style=&#123;styles.play&#125; /&gt;</div><div class="line">	      &lt;/Image&gt;  </div><div class="line"></div><div class="line">	      &#123;/* 底部按钮 */&#125;</div><div class="line">	      &lt;View style=&#123;styles.itemFooterContainer&#125;&gt;</div><div class="line">	        &lt;View style=&#123;styles.handleBox&#125;&gt;</div><div class="line">	          &lt;Icon </div><div class="line">	            name='ios-heart-outline'</div><div class="line">	            size=&#123;28&#125;</div><div class="line">	            style=&#123;styles.up&#125;  /&gt;</div><div class="line">	          &lt;Text style=&#123;styles.handleText&#125;&gt;喜欢&lt;/Text&gt;</div><div class="line">	        &lt;/View&gt;</div><div class="line">	        &lt;View style=&#123;styles.handleBox&#125;&gt;</div><div class="line">	          &lt;Icon </div><div class="line">	            name='ios-chatboxes-outline'</div><div class="line">	            size=&#123;28&#125;</div><div class="line">	            style=&#123;styles.commonIcon&#125;  /&gt;</div><div class="line">	          &lt;Text style=&#123;styles.handleText&#125;&gt;评论&lt;/Text&gt;</div><div class="line">	        &lt;/View&gt;</div><div class="line">	      &lt;/View&gt;</div><div class="line">	    &lt;/View&gt;</div><div class="line">	  &lt;/TouchableHighlight&gt;</div><div class="line">	)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在定义一些样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">item:&#123;</div><div class="line">    <span class="attr">width</span>:width,</div><div class="line">    <span class="attr">marginBottom</span>:<span class="number">10</span>,</div><div class="line">    <span class="attr">backgroundColor</span>:<span class="string">'#fff'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">thumb</span>:&#123;</div><div class="line">    <span class="attr">width</span>:width,</div><div class="line">    <span class="attr">height</span>:width*<span class="number">0.56</span>,</div><div class="line">    <span class="attr">resizeMode</span>:<span class="string">'cover'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">title</span>:&#123;</div><div class="line">    <span class="attr">padding</span>:<span class="number">10</span>,</div><div class="line">    <span class="attr">fontSize</span>:<span class="number">18</span>,</div><div class="line">    <span class="attr">color</span>:<span class="string">'#333'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">itemFooterContainer</span>:&#123;</div><div class="line">    <span class="attr">flexDirection</span>:<span class="string">'row'</span>,</div><div class="line">    <span class="attr">justifyContent</span>:<span class="string">'space-between'</span>,</div><div class="line">    <span class="attr">backgroundColor</span>:<span class="string">'#eee'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">handleBox</span>:&#123;</div><div class="line">    <span class="attr">padding</span>:<span class="number">10</span>,</div><div class="line">    <span class="attr">flexDirection</span>:<span class="string">'row'</span>,</div><div class="line">    <span class="attr">width</span>:width/<span class="number">2</span><span class="number">-0.5</span>,</div><div class="line">    <span class="attr">justifyContent</span>:<span class="string">'center'</span>,</div><div class="line">    <span class="attr">backgroundColor</span>:<span class="string">'#fff'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">play</span>:&#123;</div><div class="line">    <span class="attr">position</span>:<span class="string">'absolute'</span>,</div><div class="line">    <span class="attr">bottom</span>:<span class="number">14</span>,</div><div class="line">    <span class="attr">right</span>:<span class="number">14</span>,</div><div class="line">    <span class="attr">width</span>:<span class="number">46</span>,</div><div class="line">    <span class="attr">height</span>:<span class="number">46</span>,</div><div class="line">    <span class="attr">paddingTop</span>:<span class="number">9</span>,</div><div class="line">    <span class="attr">paddingLeft</span>:<span class="number">18</span>,</div><div class="line">    <span class="attr">backgroundColor</span>:<span class="string">'transparent'</span>,</div><div class="line">    <span class="attr">borderColor</span>:<span class="string">'#fff'</span>,</div><div class="line">    <span class="attr">borderWidth</span>:<span class="number">1</span>,</div><div class="line">    <span class="attr">borderRadius</span>:<span class="number">23</span>,</div><div class="line">    <span class="attr">color</span>:<span class="string">'#ed7b66'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">handleText</span>:&#123;</div><div class="line">    <span class="attr">paddingLeft</span>:<span class="number">12</span>,</div><div class="line">    <span class="attr">fontSize</span>:<span class="number">18</span>,</div><div class="line">    <span class="attr">color</span>:<span class="string">'#333'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">up</span>:&#123;</div><div class="line">    <span class="attr">fontSize</span>:<span class="number">22</span>,</div><div class="line">    <span class="attr">color</span>:<span class="string">'#333'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">commonIcon</span>:&#123;</div><div class="line">    <span class="attr">fontSize</span>:<span class="number">22</span>,</div><div class="line">    <span class="attr">color</span>:<span class="string">'#333'</span></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>样式中我们使用了屏幕的宽度，可以通过</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//导入Dimensions</span></div><div class="line"></div><div class="line"><span class="comment">// 当前屏幕宽度</span></div><div class="line"><span class="keyword">var</span> width=Dimensions.get(<span class="string">'window'</span>).width</div></pre></td></tr></table></figure>
<p>然后初始化一些假数据，然列表能显示出来</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">getInitialState: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> ds = <span class="keyword">new</span> ListView.DataSource(&#123;<span class="attr">rowHasChanged</span>: <span class="function">(<span class="params">r1, r2</span>) =&gt;</span> r1 !== r2&#125;);</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">	  <span class="attr">dataSource</span>: ds.cloneWithRows([</div><div class="line">	        &#123;</div><div class="line">	            <span class="string">"_id"</span>:<span class="string">"350000197307022063"</span>,<span class="string">"thumb"</span>:<span class="string">"http://dummyimage.com/1280x720/e5488e"</span>,<span class="string">"title"</span>:<span class="string">"测试内容95hw"</span>,<span class="string">"video"</span>:<span class="string">"http://v2.mukewang.com/cef3e514-8203-4c67-877f-79f7763553cf/L.mp4?auth_key=1480760293-0-0-a693983f9d989e19a2c1c19f52d1e169"</span></div><div class="line">	        &#125;</div><div class="line">	        ,</div><div class="line">	        &#123;</div><div class="line">	            <span class="string">"_id"</span>:<span class="string">"330000201112047039"</span>,<span class="string">"thumb"</span>:<span class="string">"http://dummyimage.com/1280x720/91d5da"</span>,<span class="string">"title"</span>:<span class="string">"测试内容95hw"</span>,<span class="string">"video"</span>:<span class="string">"http://v2.mukewang.com/cef3e514-8203-4c67-877f-79f7763553cf/L.mp4?auth_key=1480760293-0-0-a693983f9d989e19a2c1c19f52d1e169"</span></div><div class="line">	        &#125;</div><div class="line">	  ]),</div><div class="line">	&#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="获取网络数据"><a href="#获取网络数据" class="headerlink" title="获取网络数据"></a>获取网络数据</h2><p>Fetch,WebSocket,XMLHttpRequest</p>
<p>官方网络文档：<a href="http://facebook.github.io/react-native/releases/0.22/docs/network.html#content" target="_blank" rel="external">http://facebook.github.io/react-native/releases/0.22/docs/network.html#content</a></p>
<p>我们这里使用fetch</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">componentDidMount()&#123;</div><div class="line">	<span class="keyword">this</span>._fetchData()</div><div class="line">&#125;,</div><div class="line"></div><div class="line">_fetchData()&#123;</div><div class="line">	fetch(<span class="string">'http://rap.taobao.org/mockjs/11015/api/video'</span>)</div><div class="line">	  .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</div><div class="line">	  .then(<span class="function">(<span class="params">responseText</span>) =&gt;</span> &#123;</div><div class="line">	    <span class="built_in">console</span>.log(responseText);</div><div class="line">	  &#125;)</div><div class="line">	  .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">	    <span class="built_in">console</span>.warn(error);</div><div class="line">	  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但是现在还是获取的mock规则，我们需要借助mockjs生成真是的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i mockjs --save</div></pre></td></tr></table></figure>
<p>然后将生成的规则使用Mock解析，就可以得到真是数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> data=Mock.mock(response)</div></pre></td></tr></table></figure>
<blockquote>
<p>注意：这里有个小插曲就是要删除mock.js中的dataImage方法，我们用不到canvas，所以要删掉他。</p>
</blockquote>
<p>获取完网络数据后还需要判断是否请求成功，然后将数据替换到datasource中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">_fetchData()&#123;</div><div class="line">fetch(<span class="string">'http://rap.taobao.org/mockjs/11015/api/video'</span>)</div><div class="line">  .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</div><div class="line">  .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">var</span> data=Mock.mock(response)</div><div class="line">    <span class="built_in">console</span>.log(data)</div><div class="line">    <span class="keyword">if</span> (data.success) &#123;</div><div class="line">      <span class="keyword">this</span>.setState(&#123;</div><div class="line">        <span class="attr">dataSource</span>:<span class="keyword">this</span>.state.dataSource.cloneWithRows(data.data)</div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">  .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.warn(error);</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="重构网络模块"><a href="#重构网络模块" class="headerlink" title="重构网络模块"></a>重构网络模块</h3><p>这样写不好是因为几乎我们每个页面都要用到网络请求，通常的情况下是将网络请求封装成一个类，所以这里我们将网络请求封装到request.js中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> queryString=<span class="built_in">require</span>(<span class="string">'query-string'</span>)</div><div class="line"><span class="keyword">var</span> _=<span class="built_in">require</span>(<span class="string">'lodash'</span>)</div><div class="line"><span class="keyword">var</span> config=<span class="built_in">require</span>(<span class="string">'./config'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> Mock=<span class="built_in">require</span>(<span class="string">'mockjs'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> request=&#123;&#125;</div><div class="line"></div><div class="line"></div><div class="line">request.get=<span class="function"><span class="keyword">function</span> (<span class="params">url,params</span>) </span>&#123;</div><div class="line"><span class="keyword">if</span> (params) &#123;</div><div class="line">	url+=<span class="string">'?'</span>+queryString.stringify(params)</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> fetch(url)</div><div class="line">		.then(<span class="function">(<span class="params">response</span>)=&gt;</span>response.json())</div><div class="line">		.then(<span class="function">(<span class="params">response</span>)=&gt;</span>Mock.mock(response))</div><div class="line">&#125;</div><div class="line"></div><div class="line">request.post=<span class="function"><span class="keyword">function</span> (<span class="params">url,body</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> options = _.extend(config.header,&#123;</div><div class="line">		<span class="attr">body</span>:<span class="built_in">JSON</span>.stringify(body)</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	<span class="keyword">return</span> fetch(url,options)</div><div class="line">			.then(<span class="function">(<span class="params">response</span>)=&gt;</span>response.json())</div><div class="line">			.then(<span class="function">(<span class="params">response</span>)=&gt;</span>Mock.mock(response))</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports=request</div></pre></td></tr></table></figure>
<p>我暴露了get,post方法，其中config是一个配置文件，包括网络的根请求地址和一些接口地址</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports=&#123;</div><div class="line">	<span class="attr">header</span>: &#123;</div><div class="line">	  <span class="attr">method</span>: <span class="string">'POST'</span>,</div><div class="line">	  <span class="attr">headers</span>: &#123;</div><div class="line">	    <span class="string">'Accept'</span>: <span class="string">'application/json'</span>,</div><div class="line">	    <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</div><div class="line">	  &#125;</div><div class="line">	&#125;,</div><div class="line">	<span class="attr">api</span>:&#123;</div><div class="line">		<span class="attr">base</span>:<span class="string">'http://rap.taobao.org/mockjs/11015/'</span>,</div><div class="line">		<span class="comment">// base:'http://rap.taobao.org/mockjsdata/11015/',</span></div><div class="line">		videoList:<span class="string">'api/video'</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中我们用到了query-string，lodash需要手动安装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm i query-string --save</div><div class="line">npm i lodash --save</div></pre></td></tr></table></figure>
<p>这样我们首页的请求就可以改写为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">_fetchData()&#123;</div><div class="line">  request.get(config.api.base+config.api.videoList,&#123;</div><div class="line">    <span class="attr">accessToken</span>:<span class="string">'abbbb'</span></div><div class="line">  &#125;)</div><div class="line">    .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</div><div class="line">      <span class="built_in">console</span>.log(data)</div><div class="line">      <span class="keyword">if</span> (data.success) &#123;</div><div class="line">        <span class="keyword">this</span>.setState(&#123;</div><div class="line">          <span class="attr">dataSource</span>:<span class="keyword">this</span>.state.dataSource.cloneWithRows(data.data)</div><div class="line">        &#125;)</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">    .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">      <span class="built_in">console</span>.warn(error);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样就方便快捷多了,<a href="https://git.oschina.net/lfsoft/ReactDog/commit/dd5f859537c13fdceeaec245d077e70221ea743f" target="_blank" rel="external">代码变更地址为</a></p>
<h2 id="上拉加载更多"><a href="#上拉加载更多" class="headerlink" title="上拉加载更多"></a>上拉加载更多</h2><p>我们要在listview中添加一个onEndReached方法监测是否滑到了底部</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">onEndReached=&#123;<span class="keyword">this</span>._fetchMoreData&#125;</div></pre></td></tr></table></figure>
<p>然后实现_fetchMoreData方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">_fetchMoreData()&#123;</div><div class="line">	<span class="keyword">if</span> (!<span class="keyword">this</span>._hasMore() || <span class="keyword">this</span>.state.isLoading) &#123;</div><div class="line">	  <span class="comment">//如果没有更多数据了，或者正在加载中，直接返回</span></div><div class="line">	  <span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">var</span> page = cacheReuslts.nextPage</div><div class="line"></div><div class="line">	<span class="keyword">this</span>._fetchData(page)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当然回来的数据还是得和原来的数据追加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">_fetchData(page)&#123;</div><div class="line">	<span class="keyword">var</span> that = <span class="keyword">this</span></div><div class="line"></div><div class="line">	<span class="keyword">this</span>.setState(&#123;</div><div class="line">	  <span class="attr">isLoading</span>:<span class="literal">true</span></div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	request.get(config.api.base+config.api.videoList,&#123;</div><div class="line">	  <span class="attr">accessToken</span>:<span class="string">'abbbb'</span>,</div><div class="line">	  <span class="attr">page</span>:page</div><div class="line">	&#125;)</div><div class="line">	  .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</div><div class="line">	    <span class="built_in">console</span>.log(data)</div><div class="line">	    <span class="keyword">if</span> (data.success) &#123;</div><div class="line"></div><div class="line">	      <span class="keyword">var</span> items = cacheReuslts.items.slice()</div><div class="line"></div><div class="line">	      items=items.concat(data.data)</div><div class="line"></div><div class="line">	      cacheReuslts.items=items</div><div class="line">	      cacheReuslts.total=data.total</div><div class="line"></div><div class="line">	      <span class="built_in">console</span>.log(cacheReuslts.items.length)</div><div class="line"></div><div class="line">	      <span class="comment">//这里是为了有显示loading</span></div><div class="line">	      setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	        that.setState(&#123;</div><div class="line">	          <span class="attr">isLoading</span>:<span class="literal">false</span>,</div><div class="line">	          <span class="attr">dataSource</span>:that.state.dataSource.cloneWithRows(cacheReuslts.items)</div><div class="line">	        &#125;)</div><div class="line">	      &#125;,<span class="number">2000</span>)</div><div class="line"></div><div class="line">	      </div><div class="line">	    &#125;</div><div class="line">	  &#125;)</div><div class="line">	  .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">	    <span class="keyword">this</span>.setState(&#123;</div><div class="line">	        <span class="attr">isLoading</span>:<span class="literal">false</span></div><div class="line">	      &#125;)</div><div class="line">	    <span class="built_in">console</span>.warn(error);</div><div class="line">	  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="下拉刷新"><a href="#下拉刷新" class="headerlink" title="下拉刷新"></a>下拉刷新</h2><p>使用refreshControl</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">refreshControl=&#123;</div><div class="line">	&lt;RefreshControl</div><div class="line">	  refreshing=&#123;<span class="keyword">this</span>.state.isRefreshing&#125;</div><div class="line">	  onRefresh=&#123;<span class="keyword">this</span>._onRefresh&#125;</div><div class="line">	  tintColor=<span class="string">"#ff6600"</span></div><div class="line">	  title=<span class="string">"拼命加载中..."</span></div><div class="line">	  colors=&#123;[<span class="string">'#ff0000'</span>, <span class="string">'#00ff00'</span>, <span class="string">'#0000ff'</span>]&#125;</div><div class="line">	  progressBackgroundColor=<span class="string">"#ffff00"</span> /&gt;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后实现_onRefresh方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">_onRefresh()&#123;</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.state.isRefreshing) &#123;</div><div class="line">	  <span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">this</span>._fetchData(<span class="number">0</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同时还得在fetchData方法里面通过判断page是否等于0来更改是刷新还是加载更多。</p>
<h2 id="列表页点赞"><a href="#列表页点赞" class="headerlink" title="列表页点赞"></a>列表页点赞</h2><p>这个功能分两部分，第一部分是在View中根据是否点赞显示不同的图标</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;View style=&#123;styles.handleBox&#125;&gt;</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Icon</span> </span></span></div><div class="line">    <span class="attr">name</span>=<span class="string">&#123;this.state.up</span> ? '<span class="attr">ios-heart</span>' <span class="attr">:</span> '<span class="attr">ios-heart-outline</span>'&#125;</div><div class="line">    <span class="attr">size</span>=<span class="string">&#123;28&#125;</span></div><div class="line">    <span class="attr">onPress</span>=<span class="string">&#123;this._up&#125;</span></div><div class="line">    <span class="attr">style</span>=<span class="string">&#123;[styles.up</span> ,<span class="attr">this.state.up</span> ? <span class="attr">null</span> <span class="attr">:</span> <span class="attr">styles.down</span> ]&#125;  /&gt;</div><div class="line">  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.handleText&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this._up&#125;</span>&gt;</span>喜欢<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">View</span>&gt;</span></div></pre></td></tr></table></figure>
<p>第二部分是当点击了按钮，发送点赞请求</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">_up()&#123;</div><div class="line">	<span class="keyword">var</span> that=<span class="keyword">this</span></div><div class="line"></div><div class="line">	<span class="keyword">var</span> up = !<span class="keyword">this</span>.state.up</div><div class="line">	<span class="keyword">var</span> row=<span class="keyword">this</span>.state.row</div><div class="line">	<span class="keyword">var</span> url=config.api.base+config.api.up</div><div class="line"></div><div class="line">	<span class="keyword">var</span> body=&#123;</div><div class="line">	  <span class="attr">id</span>:row._id,</div><div class="line">	  <span class="attr">up</span>:up,</div><div class="line">	  <span class="attr">accessToken</span>:<span class="string">'ab'</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'up'</span>)</div><div class="line"></div><div class="line">	request.post(url,body)</div><div class="line">	.then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">	  <span class="keyword">if</span> (data &amp;&amp; data.success) &#123;</div><div class="line">	    that.setState(&#123;</div><div class="line">	      <span class="attr">up</span>:up</div><div class="line">	    &#125;)</div><div class="line">	  &#125; <span class="keyword">else</span>&#123;</div><div class="line">	    AlertIOS.alert(<span class="string">'点赞失败，请稍后重试'</span>)</div><div class="line">	  &#125;</div><div class="line">	&#125;)</div><div class="line">	.catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">	  <span class="built_in">console</span>.log(err)</div><div class="line">	  AlertIOS.alert(<span class="string">'点赞失败，请稍后重试'</span>)</div><div class="line">	&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>请求回来了我们还得判断是否响应成功，然后改变状态，让界面刷新</p>
<h2 id="添加进入视频详情页面"><a href="#添加进入视频详情页面" class="headerlink" title="添加进入视频详情页面"></a>添加进入视频详情页面</h2><p>在这之前我们先要使用导航器包装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;Navigator</div><div class="line">	initialRoute=&#123;&#123;</div><div class="line">	  <span class="attr">name</span>:<span class="string">'list'</span>,</div><div class="line">	  <span class="attr">component</span>:List</div><div class="line">	&#125;&#125;</div><div class="line">	configureScene=&#123;(route)=&gt;&#123;</div><div class="line">	  <span class="keyword">return</span> Navigator.SceneConfigs.FloatFromRight</div><div class="line">	&#125;&#125;</div><div class="line">	renderScene=&#123;(route,navigator)=&gt;&#123;</div><div class="line">	  <span class="keyword">var</span> Component=route.component</div><div class="line">	  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...route.params</span>&#125; <span class="attr">navigator</span>=<span class="string">&#123;navigator&#125;</span> /&gt;</span></span></div><div class="line">	&#125;&#125; /&gt;</div></pre></td></tr></table></figure>
<p>这样我们就可以在List组件里面通过navigator属性拿到外面的Navigator实例，从而进入一个页面。</p>
<p>然后在TouchableHighlight控件上添加一个onPress方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">_loadDetailPage(row)&#123;</div><div class="line">	<span class="keyword">this</span>.props.navigator.push(&#123;</div><div class="line">	  <span class="attr">name</span>:<span class="string">'detail'</span>,</div><div class="line">	  <span class="attr">component</span>:Detail</div><div class="line">	&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样我们就能跳转到详情页面了，现在需要实现返回到列表</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">_back()&#123;</div><div class="line">	<span class="keyword">this</span>.props.navigator.pop()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>还要将外面的id传入详情页，我们就可以拿着id去请求详情页数据了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">_loadDetailPage(row)&#123;</div><div class="line">	<span class="keyword">this</span>.props.navigator.push(&#123;</div><div class="line">	  <span class="attr">name</span>:<span class="string">'detail'</span>,</div><div class="line">	  <span class="attr">component</span>:Detail,</div><div class="line">	  <span class="attr">params</span>:&#123;</div><div class="line">	    <span class="attr">_id</span>:row._id</div><div class="line">	  &#125;</div><div class="line">	&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在详情界面就可以拿到这个id</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">render:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> _id = <span class="keyword">this</span>.props._id</div><div class="line"></div><div class="line">	<span class="keyword">return</span> (</div><div class="line">	  <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">	    <span class="tag">&lt;<span class="name">Text</span> <span class="attr">onPress</span>=<span class="string">&#123;this._back&#125;</span>&gt;</span>详情页面&#123;_id&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">	)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>那这个params是怎么传递过来了的呢，起始就是在我们包装List的时候的使用了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Component &#123;...route.params&#125; navigator=&#123;navigator&#125; /&gt;</div></pre></td></tr></table></figure>
<p>…的作用就是讲params中的所有属性展开依次传递给Component，所有我们在组件内部就能通过props拿到</p>
<h2 id="详情页播放视频"><a href="#详情页播放视频" class="headerlink" title="详情页播放视频"></a>详情页播放视频</h2><p>这里使用一个第三方库</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">npm i react-native-video --save</div><div class="line"></div><div class="line"><span class="comment">//安装完后还需要链接，我这里链接又报错，所以只能手动链接</span></div><div class="line">rnpm link react-native-video</div></pre></td></tr></table></figure>
<p>链接完成后，在详情界面写上Video组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;Video</div><div class="line">    style=&#123;styles.video&#125;</div><div class="line">    ref=<span class="string">'videoPlayer'</span></div><div class="line">    source=&#123;&#123;<span class="attr">uri</span>:data.video&#125;&#125;</div><div class="line">    style=&#123;styles.video&#125;</div><div class="line">    volume=&#123;<span class="number">3</span>&#125;</div><div class="line">    paused=&#123;<span class="literal">false</span>&#125;</div><div class="line">    rate=&#123;<span class="keyword">this</span>.state.rate&#125;</div><div class="line">    muted=&#123;<span class="keyword">this</span>.state.muted&#125;</div><div class="line">    resizeMode=&#123;<span class="keyword">this</span>.state.resizeMode&#125;</div><div class="line">    repeat=&#123;<span class="keyword">this</span>.state.repeat&#125;</div><div class="line"></div><div class="line">    onLoadStart=&#123;<span class="keyword">this</span>._onLoadStart&#125;</div><div class="line">    onLoad=&#123;<span class="keyword">this</span>._onLoad&#125;</div><div class="line">    onProgress=&#123;<span class="keyword">this</span>._onProgress&#125;</div><div class="line">    onEnd=&#123;<span class="keyword">this</span>._onEnd&#125;</div><div class="line">    onError=&#123;<span class="keyword">this</span>._onError&#125; /&gt;</div></pre></td></tr></table></figure>
<h2 id="播放和暂停"><a href="#播放和暂停" class="headerlink" title="播放和暂停"></a>播放和暂停</h2><p>只需要控制Video组件的paused属性就行了</p>
<h2 id="添加返回和标题栏"><a href="#添加返回和标题栏" class="headerlink" title="添加返回和标题栏"></a>添加返回和标题栏</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;View style=&#123;styles.header&#125;&gt;</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">TouchableOpacity</span> <span class="attr">style</span>=<span class="string">&#123;styles.backBox&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this._pop&#125;</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">name</span>=<span class="string">'ios-arrow-back'</span> <span class="attr">style</span>=<span class="string">&#123;styles.backIcon&#125;</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.backText&#125;</span> &gt;</span>返回<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">TouchableOpacity</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.headerTitle&#125;</span> <span class="attr">numberOflines</span>=<span class="string">&#123;1&#125;</span>&gt;</span></div><div class="line">    视频详情页</div><div class="line">  <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">View</span>&gt;</span></div></pre></td></tr></table></figure>
<p>对应的样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">header:&#123;</div><div class="line">    <span class="attr">flexDirection</span>:<span class="string">'row'</span>,</div><div class="line">    <span class="attr">justifyContent</span>:<span class="string">'center'</span>,</div><div class="line">    <span class="attr">alignItems</span>:<span class="string">'center'</span>,</div><div class="line">    <span class="attr">width</span>:width,</div><div class="line">    <span class="attr">height</span>:<span class="number">64</span>,</div><div class="line">    <span class="attr">paddingTop</span>:<span class="number">20</span>,</div><div class="line">    <span class="attr">paddingLeft</span>:<span class="number">10</span>,</div><div class="line">    <span class="attr">paddingRight</span>:<span class="number">10</span>,</div><div class="line">    <span class="attr">borderBottomWidth</span>:<span class="number">1</span>,</div><div class="line">    <span class="attr">borderColor</span>:<span class="string">'rgba(0,0,0,0.1)'</span>,</div><div class="line">    <span class="attr">backgroundColor</span>:<span class="string">'#fff'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">backBox</span>:&#123;</div><div class="line">    <span class="attr">position</span>:<span class="string">'absolute'</span>,</div><div class="line">    <span class="attr">left</span>:<span class="number">12</span>,</div><div class="line">    <span class="attr">top</span>:<span class="number">32</span>,</div><div class="line">    <span class="attr">width</span>:<span class="number">50</span>,</div><div class="line">    <span class="attr">flexDirection</span>:<span class="string">'row'</span>,</div><div class="line">    <span class="attr">alignItems</span>:<span class="string">'center'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">headerTitle</span>:&#123;</div><div class="line">    <span class="attr">width</span>:width<span class="number">-120</span>,</div><div class="line">    <span class="attr">textAlign</span>:<span class="string">'center'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">backIcon</span>:&#123;</div><div class="line">    <span class="attr">color</span>:<span class="string">'#999'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">backText</span>:&#123;</div><div class="line">    <span class="attr">color</span>:<span class="string">'#999'</span></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">_pop()&#123;</div><div class="line">	<span class="keyword">this</span>.props.navigator.pop()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="视频制作者信息"><a href="#视频制作者信息" class="headerlink" title="视频制作者信息"></a>视频制作者信息</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;View style=&#123;styles.infoBox&#125; &gt;</div><div class="line">	<span class="xml"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">style</span>=<span class="string">&#123;styles.avatar&#125;</span> <span class="attr">source</span>=<span class="string">&#123;&#123;uri:data.author.avatar&#125;&#125;</span> /&gt;</span></span></div><div class="line">	<span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.descBox&#125;</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.nickname&#125;</span> &gt;</span> &#123;data.author.nickname&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.title&#125;</span> &gt;</span> &#123;data.title&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">View</span>&gt;</span></div></pre></td></tr></table></figure>
<p>样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">infoBox:&#123;</div><div class="line">    <span class="attr">width</span>:width,</div><div class="line">    <span class="attr">flexDirection</span>:<span class="string">'row'</span>,</div><div class="line">    <span class="attr">justifyContent</span>:<span class="string">'center'</span>,</div><div class="line">    <span class="attr">marginTop</span>:<span class="number">20</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">avatar</span>:&#123;</div><div class="line">    <span class="attr">width</span>:<span class="number">60</span>,</div><div class="line">    <span class="attr">height</span>:<span class="number">60</span>,</div><div class="line">    <span class="attr">marginRight</span>:<span class="number">10</span>,</div><div class="line">    <span class="attr">marginLeft</span>:<span class="number">10</span>,</div><div class="line">    <span class="attr">borderRadius</span>:<span class="number">30</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">descBox</span>:&#123;</div><div class="line">    <span class="attr">flex</span>:<span class="number">1</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">nickname</span>:&#123;</div><div class="line">    <span class="attr">fontSize</span>:<span class="number">18</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">title</span>:&#123;</div><div class="line">    <span class="attr">marginTop</span>:<span class="number">8</span>,</div><div class="line">    <span class="attr">fontSize</span>:<span class="number">16</span>,</div><div class="line">    <span class="attr">color</span>:<span class="string">'#666'</span></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="显示视频信息"><a href="#显示视频信息" class="headerlink" title="显示视频信息"></a>显示视频信息</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;View style=&#123;styles.infoBox&#125; &gt;</div><div class="line">	<span class="xml"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">style</span>=<span class="string">&#123;styles.avatar&#125;</span> <span class="attr">source</span>=<span class="string">&#123;&#123;uri:data.author.avatar&#125;&#125;</span> /&gt;</span></span></div><div class="line">	<span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.descBox&#125;</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.nickname&#125;</span> &gt;</span> &#123;data.author.nickname&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.title&#125;</span> &gt;</span> &#123;data.title&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">View</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="显示评论内容"><a href="#显示评论内容" class="headerlink" title="显示评论内容"></a>显示评论内容</h2><h3 id="小插曲"><a href="#小插曲" class="headerlink" title="小插曲"></a>小插曲</h3><p>1.像这种布局</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;View key=&#123;row._id&#125; style=&#123;styles.replyBox&#125; &gt;</div><div class="line">	<span class="xml"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">style</span>=<span class="string">&#123;styles.replyAvatar&#125;</span> <span class="attr">source</span>=<span class="string">&#123;&#123;uri:row.replyBy.avatar&#125;&#125;</span> /&gt;</span></span></div><div class="line">	<span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.reply&#125;</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.replyNickname&#125;</span> &gt;</span> &#123;row.replyBy.nickname&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.replyContent&#125;</span> &gt;</span> &#123;row.content&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">View</span>&gt;</span></div></pre></td></tr></table></figure>
<p>replyBox的样式一定要设置宽度，不然整个页面有可能一部分显示到了左边屏幕外面了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">replyBox:&#123;</div><div class="line">	<span class="attr">width</span>:width,</div><div class="line">	<span class="attr">flexDirection</span>:<span class="string">'row'</span>,</div><div class="line">	<span class="attr">justifyContent</span>:<span class="string">'flex-start'</span>,</div><div class="line">	<span class="attr">marginTop</span>:<span class="number">10</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.如果将ScrollView放到了VideoBox布局里面，将导致listview无法滚动，需要将他拿到和videoBox平级的布局中</p>
<h3 id="优化评论布局"><a href="#优化评论布局" class="headerlink" title="优化评论布局"></a>优化评论布局</h3><p>由于我们要显示视频信息和评论内容，所以用了ScrollView嵌套ListView</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">&lt;ScrollView</div><div class="line">      showVerticalScrollIndicator=&#123;<span class="literal">false</span>&#125;</div><div class="line">      enableEmptySections=&#123;<span class="literal">true</span>&#125;</div><div class="line">      automaticallyAdjustContentInsets=&#123;<span class="literal">false</span>&#125;</div><div class="line">      style=&#123;styles.scrollView&#125; &gt;</div><div class="line"></div><div class="line">      &lt;View style=&#123;styles.infoBox&#125; &gt;</div><div class="line">        &lt;Image style=&#123;styles.avatar&#125; source=&#123;&#123;uri:data.author.avatar&#125;&#125; /&gt;</div><div class="line">        &lt;View style=&#123;styles.descBox&#125;&gt;</div><div class="line">          &lt;Text style=&#123;styles.nickname&#125; &gt; &#123;data.author.nickname&#125; &lt;/Text&gt;</div><div class="line">          &lt;Text style=&#123;styles.title&#125; &gt; &#123;data.title&#125; &lt;/Text&gt;</div><div class="line">        &lt;/View&gt;</div><div class="line">      &lt;/View&gt;</div><div class="line"></div><div class="line">      &lt;ListView</div><div class="line">        dataSource=&#123;this.state.dataSource&#125;</div><div class="line">        renderRow=&#123;this._renderRow&#125;</div><div class="line">        onEndReached=&#123;this._fetchMoreData&#125;</div><div class="line">        renderFooter=&#123;this._renderFooter&#125;</div><div class="line">        onEndReachedThreshold=&#123;20&#125;</div><div class="line">        showVerticalScrollIndicator=&#123;false&#125;</div><div class="line">        enableEmptySections=&#123;true&#125;</div><div class="line">        automaticallyAdjustContentInsets=&#123;false&#125;</div><div class="line">        refreshControl=&#123;</div><div class="line">          &lt;RefreshControl</div><div class="line">            refreshing=&#123;this.state.isRefreshing&#125;</div><div class="line">            onRefresh=&#123;this._onRefresh&#125;</div><div class="line">            tintColor="#ff6600"</div><div class="line">            title="拼命加载中..."</div><div class="line">            colors=&#123;['#ff0000', '#00ff00', '#0000ff']&#125;</div><div class="line">            progressBackgroundColor="#ffff00" /&gt;</div><div class="line">        &#125;</div><div class="line">      /&gt;</div><div class="line">&lt;/ScrollView&gt;</div></pre></td></tr></table></figure>
<p>显示需要去除ScrollView，这里使用renderHeader={this._renderHeader}，用法和renderFooter差不多,先返回布局</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">_renderHeader()&#123;</div><div class="line">	<span class="keyword">var</span> data=<span class="keyword">this</span>.state.data</div><div class="line"></div><div class="line">	<span class="keyword">return</span>(</div><div class="line">	  <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.infoBox&#125;</span> &gt;</span></span></div><div class="line">	    <span class="tag">&lt;<span class="name">Image</span> <span class="attr">style</span>=<span class="string">&#123;styles.avatar&#125;</span> <span class="attr">source</span>=<span class="string">&#123;&#123;uri:data.author.avatar&#125;&#125;</span> /&gt;</span></div><div class="line">	    <span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.descBox&#125;</span>&gt;</span></div><div class="line">	      <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.nickname&#125;</span> &gt;</span> &#123;data.author.nickname&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	      <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.title&#125;</span> &gt;</span> &#123;data.title&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	    <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">	)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后删除scrollview相关的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;ListView</div><div class="line">	dataSource=&#123;<span class="keyword">this</span>.state.dataSource&#125;</div><div class="line">	renderRow=&#123;<span class="keyword">this</span>._renderRow&#125;</div><div class="line">	onEndReached=&#123;<span class="keyword">this</span>._fetchMoreData&#125;</div><div class="line">	renderHeader=&#123;<span class="keyword">this</span>._renderHeader&#125;</div><div class="line">	renderFooter=&#123;<span class="keyword">this</span>._renderFooter&#125;</div><div class="line">	onEndReachedThreshold=&#123;<span class="number">20</span>&#125;</div><div class="line">	showVerticalScrollIndicator=&#123;<span class="literal">false</span>&#125;</div><div class="line">	enableEmptySections=&#123;<span class="literal">true</span>&#125;</div><div class="line">	automaticallyAdjustContentInsets=&#123;<span class="literal">false</span>&#125;</div><div class="line">	refreshControl=&#123;</div><div class="line">	  &lt;RefreshControl</div><div class="line">	    refreshing=&#123;<span class="keyword">this</span>.state.isRefreshing&#125;</div><div class="line">	    onRefresh=&#123;<span class="keyword">this</span>._onRefresh&#125;</div><div class="line">	    tintColor=<span class="string">"#ff6600"</span></div><div class="line">	    title=<span class="string">"拼命加载中..."</span></div><div class="line">	    colors=&#123;[<span class="string">'#ff0000'</span>, <span class="string">'#00ff00'</span>, <span class="string">'#0000ff'</span>]&#125;</div><div class="line">	    progressBackgroundColor=<span class="string">"#ffff00"</span> /&gt;</div><div class="line">	&#125;</div><div class="line">/&gt;</div></pre></td></tr></table></figure>
<h2 id="添加评论"><a href="#添加评论" class="headerlink" title="添加评论"></a>添加评论</h2><p>我们在视频页面添加了一个引导用户评论的输入框，但这个框起始只是一个点击层而已，目的是用户点击弹出一个浮层，在浮层里面评论</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">_renderHeader()&#123;</div><div class="line">  <span class="keyword">var</span> data=<span class="keyword">this</span>.state.data</div><div class="line"></div><div class="line">    <span class="keyword">return</span>(</div><div class="line">      &lt;View state=&#123;styles.listHeader&#125;&gt;</div><div class="line">        &lt;View style=&#123;styles.infoBox&#125; &gt;</div><div class="line">          &lt;Image style=&#123;styles.avatar&#125; source=&#123;&#123;uri:data.author.avatar&#125;&#125; /&gt;</div><div class="line">          &lt;View style=&#123;styles.descBox&#125;&gt;</div><div class="line">            &lt;Text style=&#123;styles.nickname&#125; &gt; &#123;data.author.nickname&#125; &lt;/Text&gt;</div><div class="line">            &lt;Text style=&#123;styles.title&#125; &gt; &#123;data.title&#125; &lt;/Text&gt;</div><div class="line">          &lt;/View&gt;</div><div class="line">        &lt;/View&gt;</div><div class="line"></div><div class="line">        &lt;View style=&#123;styles.commentBox&#125;&gt;</div><div class="line">          &lt;View style=&#123;styles.comment&#125;&gt;</div><div class="line">            &lt;TextInput</div><div class="line">              placeholder='敢不敢评论一个呀'</div><div class="line">              style=&#123;styles.content&#125;</div><div class="line">              multiline=&#123;true&#125;</div><div class="line">              onFocus=&#123;this._onFocus&#125; /&gt;</div><div class="line">          &lt;/View&gt;</div><div class="line">        &lt;/View&gt;</div><div class="line"></div><div class="line">        &lt;View style=&#123;styles.commentArea&#125;&gt;</div><div class="line">          &lt;Text style=&#123;styles.commentTitle&#125;&gt;热门评论&lt;/Text&gt;</div><div class="line">        &lt;/View&gt;</div><div class="line">      &lt;/View&gt;</div><div class="line">      </div><div class="line">    )</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="提交组件"><a href="#提交组件" class="headerlink" title="提交组件"></a>提交组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i react-native-button --save</div></pre></td></tr></table></figure>
<p>不需要链接,先导入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//这种导入方式报错</span></div><div class="line"><span class="comment">//var Button=require('react-native-button')</span></div><div class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">'react-native-button'</span>;</div></pre></td></tr></table></figure>
<p>添加组件到布局</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Button style=&#123;styles.submit&#125; onPress=&#123;<span class="keyword">this</span>._submit&#125; &gt;评论&lt;<span class="regexp">/Button&gt;</span></div></pre></td></tr></table></figure>
<p>添加一个_submit方法，在这里处理评论逻辑</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">_submit()&#123;</div><div class="line">    <span class="keyword">var</span> that = <span class="keyword">this</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.state.content) &#123;</div><div class="line">      <span class="keyword">return</span> AlertIOS.alert(<span class="string">'请输入评论内容！'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.isSending) &#123;</div><div class="line">      <span class="keyword">return</span> AlertIOS.alert(<span class="string">'正在拼命评论中...'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//正在发送</span></div><div class="line">    <span class="keyword">this</span>.setState(&#123;</div><div class="line">      <span class="attr">isSending</span>:<span class="literal">true</span></div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> body=&#123;</div><div class="line">        <span class="attr">accessToken</span>:<span class="string">'a'</span>,</div><div class="line">        <span class="attr">videoId</span>:<span class="string">'123'</span>,</div><div class="line">        <span class="attr">content</span>:<span class="keyword">this</span>.state.content</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">var</span> url = config.api.base+config.api.comment</div><div class="line"></div><div class="line">      request.post(url,body)</div><div class="line">      .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (data&amp;&amp;data.success) &#123;</div><div class="line">          <span class="keyword">var</span> items=cacheReuslts.items.slice()</div><div class="line"></div><div class="line">          <span class="keyword">var</span> cotnent=that.state.content</div><div class="line">          items=[&#123;</div><div class="line">            <span class="attr">content</span>:cotnent,</div><div class="line">            <span class="attr">replyBy</span>:&#123;</div><div class="line">              <span class="attr">avatar</span>:<span class="string">'https://dummyimage.com/640x640/b108ca'</span>,</div><div class="line">              <span class="attr">nickname</span>:<span class="string">'你猜猜我是谁'</span></div><div class="line">            &#125;</div><div class="line">          &#125;].concat(items)</div><div class="line"></div><div class="line">          cacheReuslts.items=items</div><div class="line">          cacheReuslts.total=cacheReuslts.total+<span class="number">1</span></div><div class="line"></div><div class="line">          that.setState(&#123;</div><div class="line">            <span class="attr">content</span>:<span class="string">''</span>,</div><div class="line">            <span class="attr">isSending</span>:<span class="literal">false</span>,</div><div class="line">            <span class="attr">dataSource</span>:that.state.dataSource.cloneWithRows(cacheReuslts.items)</div><div class="line">          &#125;)</div><div class="line"></div><div class="line">          that._setModalVisible(<span class="literal">false</span>)</div><div class="line"></div><div class="line">        &#125;</div><div class="line">      &#125;)</div><div class="line">      .catch(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(err)</div><div class="line">        that.setState(&#123;</div><div class="line">          <span class="attr">isSending</span>:<span class="literal">false</span></div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        that._setModalVisible(<span class="literal">false</span>)</div><div class="line"></div><div class="line">        AlertIOS.alert(<span class="string">'留言失败，稍后重试！'</span>)</div><div class="line"></div><div class="line">      &#125;)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="验证码倒计时"><a href="#验证码倒计时" class="headerlink" title="验证码倒计时"></a>验证码倒计时</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i react-native-sk-countdown --save</div></pre></td></tr></table></figure>
<p>我们在手机号旁边添加一个倒计时控件，先判断是否发送了验证码，在显示验证码输入框和倒计时按钮。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">&#123;	</div><div class="line">	</div><div class="line">	<span class="keyword">this</span>.state.codeSent</div><div class="line">	? &lt;View style=&#123;styles.verifyCodeBox&#125; &gt;</div><div class="line">		&lt;TextInput</div><div class="line">			placeholderTextColor='#444'</div><div class="line">			style=&#123;styles.inputField&#125;</div><div class="line">			placeHolder='请输入验证码'</div><div class="line">			autoCaptialize=&#123;'none'&#125;</div><div class="line">			autoCorrect=&#123;false&#125;</div><div class="line">			keyboradType=&#123;'number-pad'&#125;</div><div class="line">			onChangeText=&#123;(text)=&gt;&#123;</div><div class="line">				this.setState(&#123;</div><div class="line">					verifyCode:text</div><div class="line">				&#125;)</div><div class="line">			&#125;&#125; /&gt;</div><div class="line"></div><div class="line">		&#123;</div><div class="line">			this.state.countingDone</div><div class="line">			? &lt;Button </div><div class="line">				style=&#123;styles.countBtn&#125;</div><div class="line">				onPress=&#123;this._sendVerifyCode&#125;&gt; 获取验证码&lt;/Button&gt;</div><div class="line">  		:  &lt;CountDown</div><div class="line">  				style=&#123;styles.countBtn&#125;</div><div class="line">  			  countType='seconds' // 计时类型：seconds / date</div><div class="line">  			  auto=&#123;true&#125; // 自动开始</div><div class="line">  			  afterEnd=&#123;this._countingDone&#125; // 结束回调</div><div class="line">  			  timeLeft=&#123;60&#125; // 正向计时 时间起点为0秒</div><div class="line">  			  step=&#123;-1&#125; // 计时步长，以秒为单位，正数则为正计时，负数为倒计时</div><div class="line">  			  startText='获取验证码' // 开始的文本</div><div class="line">  			  endText='获取验证码' // 结束的文本</div><div class="line">  			  intervalText=&#123;(sec) =&gt; sec + '秒重新获取'&#125; /&gt;</div><div class="line">	</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		&lt;/View&gt;</div><div class="line">		: null</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同时验证码倒计时完成了，在显示重新获取验证码按钮。</p>
<h2 id="启动切换到登陆或首页逻辑"><a href="#启动切换到登陆或首页逻辑" class="headerlink" title="启动切换到登陆或首页逻辑"></a>启动切换到登陆或首页逻辑</h2><p>首先我们先在index.ios.js文件中获取是否有用户状态，如果有显示主界面，如果没有显示登陆界面</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">componentDidMount()&#123;</div><div class="line">	<span class="keyword">this</span>._getAppStatus()</div><div class="line">&#125;,</div><div class="line"></div><div class="line">_getAppStatus()&#123;</div><div class="line">	<span class="keyword">var</span> that = <span class="keyword">this</span></div><div class="line"></div><div class="line">	AsyncStorage.getItem(<span class="string">'user'</span>)</div><div class="line">	  .then(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</div><div class="line">	    <span class="keyword">var</span> user</div><div class="line">	    <span class="keyword">var</span> newStatus=&#123;&#125;</div><div class="line"></div><div class="line">	    <span class="keyword">if</span> (data) &#123;</div><div class="line">	      newStatus.user=user</div><div class="line">	      newStatus.logined=<span class="literal">true</span></div><div class="line">	    &#125; <span class="keyword">else</span>&#123;</div><div class="line">	      newStatus.logined=<span class="literal">false</span></div><div class="line">	    &#125;</div><div class="line"></div><div class="line">	    that.setState(newStatus)</div><div class="line">	  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后我们判断是否登陆，并渲染相应的界面</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span> (!<span class="keyword">this</span>.state.logined) &#123;</div><div class="line">	  <span class="keyword">return</span> &lt;Login afterLogin=&#123;this._afterLogin&#125;/&gt;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	return (</div><div class="line">	  &lt;TabBarIOS</div><div class="line">	    tintColor="#ee735c"&gt;</div><div class="line">	    &lt;Icon.TabBarItem</div><div class="line">	      title="视频"</div><div class="line">	      iconName='ios-videocam-outline'</div><div class="line">	      selectedIconName='ios-videocam'</div><div class="line">	      selected=&#123;this.state.selectedTab === 'list'&#125;</div><div class="line">	      onPress=&#123;() =&gt; &#123;</div><div class="line">	        this.setState(&#123;</div><div class="line">	          selectedTab: 'list',</div><div class="line">	        &#125;);</div><div class="line">	      &#125;&#125;&gt;</div><div class="line"></div><div class="line">	      &lt;Navigator</div><div class="line">	        initialRoute=&#123;&#123;</div><div class="line">	          name:'list',</div><div class="line">	          component:List</div><div class="line">	        &#125;&#125;</div><div class="line">	        configureScene=&#123;(route)=&gt;&#123;</div><div class="line">	          return Navigator.SceneConfigs.FloatFromRight</div><div class="line">	        &#125;&#125;</div><div class="line">	        renderScene=&#123;(route,navigator)=&gt;&#123;</div><div class="line">	          var Component=route.component</div><div class="line">	          return &lt;Component &#123;...route.params&#125; navigator=&#123;navigator&#125; /&gt;</div><div class="line">	        &#125;&#125; /&gt;</div><div class="line">	    &lt;/Icon.TabBarItem&gt;</div><div class="line">	    &lt;Icon.TabBarItem</div><div class="line">	      title="录制"</div><div class="line">	      iconName='ios-recording-outline'</div><div class="line">	      selectedIconName='ios-recording'</div><div class="line">	      selected=&#123;this.state.selectedTab === 'edit'&#125;</div><div class="line">	      onPress=&#123;() =&gt; &#123;</div><div class="line">	        this.setState(&#123;</div><div class="line">	          selectedTab: 'edit'</div><div class="line">	        &#125;);</div><div class="line">	      &#125;&#125;&gt;</div><div class="line">	      &lt;Edit/&gt;</div><div class="line">	    &lt;/Icon.TabBarItem&gt;</div><div class="line">	    &lt;Icon.TabBarItem</div><div class="line">	      title="更多"</div><div class="line">	      iconName='ios-more-outline'</div><div class="line">	      selectedIconName='ios-more'</div><div class="line">	      selected=&#123;this.state.selectedTab === 'account'&#125;</div><div class="line">	      onPress=&#123;() =&gt; &#123;</div><div class="line">	        this.setState(&#123;</div><div class="line">	          selectedTab: 'account'</div><div class="line">	        &#125;);</div><div class="line">	      &#125;&#125;&gt;</div><div class="line">	      &lt;Account/&gt;</div><div class="line">	    &lt;/Icon.TabBarItem&gt;</div><div class="line">	  &lt;/TabBarIOS&gt;</div><div class="line">	);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="显示用户头像"><a href="#显示用户头像" class="headerlink" title="显示用户头像"></a>显示用户头像</h2><p>首先我们判断用户是否有头像然后显示不同的布局</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  user.avatar</div><div class="line">  ? &lt;TouchableOpacity style=&#123;styles.avatarContainer&#125;&gt;</div><div class="line">      &lt;Image source=&#123;&#123;uri:user.avatar&#125;&#125; style=&#123;styles.avatarContainer&#125;&gt;</div><div class="line">        &lt;View style=&#123;styles.avatarBox&#125; &gt;</div><div class="line">          &lt;Image</div><div class="line">            source=&#123;&#123;uri:user.avatar&#125;&#125;</div><div class="line">            style=&#123;styles.avatar&#125; /&gt;</div><div class="line">        &lt;/View&gt;</div><div class="line">        &lt;Text style=&#123;styles.avatarTip&#125;&gt;添加头像&lt;/Text&gt;</div><div class="line">      &lt;/Image&gt;</div><div class="line">    &lt;/TouchableOpacity&gt;</div><div class="line">  :</div><div class="line">    &lt;View style=&#123;styles.avatarContainer&#125;&gt;</div><div class="line">      &lt;Text style=&#123;styles.avatarTip&#125;&gt;添加头像&lt;/Text&gt;</div><div class="line">      &lt;TouchableOpacity style=&#123;styles.avatarBox&#125; &gt;</div><div class="line">        &lt;Icon</div><div class="line">          name='ios-cloud-upload-outline'</div><div class="line">          style=&#123;styles.plusIcon&#125; /&gt;</div><div class="line">      &lt;/TouchableOpacity&gt;</div><div class="line">    &lt;/View&gt;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="选择图片"><a href="#选择图片" class="headerlink" title="选择图片"></a>选择图片</h3><p>使用一个模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i react-native-image-picker@0.20.0 --save</div></pre></td></tr></table></figure>
<p>链接</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm link react-native-image-picker</div></pre></td></tr></table></figure>
<p>如果你的系统是iOS10,需要添加权限：<a href="http://www.jianshu.com/p/c212cde86877" target="_blank" rel="external">http://www.jianshu.com/p/c212cde86877</a></p>
<p>如果链接完不能用，请手动链接，并导入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ImagePicker = <span class="built_in">require</span>(<span class="string">'react-native-image-picker'</span>);</div></pre></td></tr></table></figure>
<p>然后配置一些设置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> options = &#123;</div><div class="line">  <span class="attr">title</span>: <span class="string">'选择头像'</span>,</div><div class="line">  <span class="attr">cancelButtonTitle</span>:<span class="string">'取消'</span>,</div><div class="line">  <span class="attr">takePhotoButtonTitle</span>:<span class="string">'拍照'</span>,</div><div class="line">  <span class="attr">chooseFromLibraryButtonTitle</span>:<span class="string">'从相册选择'</span>,</div><div class="line">  <span class="attr">quality</span>:<span class="number">0.75</span>,</div><div class="line">  <span class="attr">allowsEditing</span>:<span class="literal">true</span>,</div><div class="line">  <span class="attr">noData</span>:<span class="literal">false</span>,</div><div class="line">  <span class="attr">storageOptions</span>: &#123;</div><div class="line">    <span class="attr">skipBackup</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">path</span>: <span class="string">'images'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后就可以选择图片了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">_pickPhoto()&#123;</div><div class="line">  <span class="keyword">var</span> that=<span class="keyword">this</span></div><div class="line"></div><div class="line">  <span class="built_in">console</span>.log(ImagePicker)</div><div class="line"></div><div class="line">  ImagePicker.showImagePicker(options, (response) =&gt; &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Response = '</span>, response);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (response.didCancel) &#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'User cancelled image picker'</span>);</div><div class="line">      <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> avatarData=<span class="string">'data:image/png;base64,'</span>+response.data</div><div class="line"></div><div class="line">    <span class="keyword">var</span> user=that.state.user</div><div class="line"></div><div class="line">    user.avatar=avatarData</div><div class="line"></div><div class="line">    that.setState(&#123;</div><div class="line">      <span class="attr">user</span>:user</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    <span class="comment">// else if (response.error) &#123;</span></div><div class="line">    <span class="comment">//   console.log('ImagePicker Error: ', response.error);</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">    <span class="comment">// else if (response.customButton) &#123;</span></div><div class="line">    <span class="comment">//   console.log('User tapped custom button: ', response.customButton);</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">    <span class="comment">// else &#123;</span></div><div class="line">    <span class="comment">//   // You can display the image using either data...</span></div><div class="line">    <span class="comment">//   const source = &#123;uri: 'data:image/jpeg;base64,' + response.data, isStatic: true&#125;;</span></div><div class="line"></div><div class="line">    <span class="comment">//   // or a reference to the platform specific asset location</span></div><div class="line">    <span class="comment">//   if (Platform.OS === 'ios') &#123;</span></div><div class="line">    <span class="comment">//     const source = &#123;uri: response.uri.replace('file://', ''), isStatic: true&#125;;</span></div><div class="line">    <span class="comment">//   &#125; else &#123;</span></div><div class="line">    <span class="comment">//     const source = &#123;uri: response.uri, isStatic: true&#125;;</span></div><div class="line">    <span class="comment">//   &#125;</span></div><div class="line"></div><div class="line">    <span class="comment">//   this.setState(&#123;</span></div><div class="line">    <span class="comment">//     avatarSource: source</span></div><div class="line">    <span class="comment">//   &#125;);</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="上传图片到图床"><a href="#上传图片到图床" class="headerlink" title="上传图片到图床"></a>上传图片到图床</h3><p>我们这里选用<a href="https://cloudinary.com，首先选择一个账号，然后将一些配置信息写到程序中" target="_blank" rel="external">https://cloudinary.com，首先选择一个账号，然后将一些配置信息写到程序中</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> CLOUDINARY = &#123;</div><div class="line">  <span class="attr">cloud_name</span>: <span class="string">'dawlcb8jj'</span>,  </div><div class="line">  <span class="attr">api_key</span>: <span class="string">'6368311532331937597'</span>,  </div><div class="line">  <span class="attr">api_secret</span>: <span class="string">'N4rXJImMfxZq03454fSosbZFfOhfHR8'</span>, </div><div class="line">  <span class="attr">base</span>:<span class="string">'http://res.cloudinary.com/daw454lcb8jj'</span>,</div><div class="line">  <span class="attr">image</span>:<span class="string">'https://api.cloudinary.com/v1_1/daw454lcb8jj/image/upload'</span>,</div><div class="line">  <span class="attr">video</span>:<span class="string">'https://api.cloudinary.com/v1_1/daw454lcb8jj/video/upload'</span>,</div><div class="line">  <span class="attr">audio</span>: <span class="string">'https://api.cloudinary.com/v1_1/daw454lcb8jj/raw/upload'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后就是上传逻辑了，首先我们需要将一些参数传递到服务端签名(因为本地签名不安全)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">ImagePicker.showImagePicker(options, (response) =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Response = '</span>, response);</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (response.didCancel) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'User cancelled image picker'</span>);</div><div class="line">    <span class="keyword">return</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> avatarData=<span class="string">'data:image/png;base64,'</span>+response.data</div><div class="line"></div><div class="line">  <span class="comment">//先显示出头像</span></div><div class="line">  <span class="keyword">var</span> user=that.state.user</div><div class="line"></div><div class="line">  user.avatar=avatarData</div><div class="line"></div><div class="line">  that.setState(&#123;</div><div class="line">    <span class="attr">user</span>:user</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  <span class="keyword">var</span> timestamp=<span class="built_in">Date</span>.now()</div><div class="line">  <span class="keyword">var</span> tags=<span class="string">'app,avatar'</span></div><div class="line">  <span class="keyword">var</span> folder=<span class="string">'avatar'</span></div><div class="line">  <span class="keyword">var</span> signatureUrl=config.api.base+config.api.signature</div><div class="line"></div><div class="line">  <span class="keyword">var</span> accessToken=<span class="keyword">this</span>.state.user.accessToken</div><div class="line"></div><div class="line">  request.post(signatureUrl,&#123;</div><div class="line">    <span class="attr">accessToken</span>:accessToken,</div><div class="line">    <span class="attr">timestamp</span>:timestamp,</div><div class="line">    <span class="attr">folder</span>:folder,</div><div class="line">    tags,tags,</div><div class="line">    <span class="attr">type</span>:<span class="string">'avatar'</span></div><div class="line">  &#125;)</div><div class="line">  .catch(<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'upload image fail'</span>)</div><div class="line">    <span class="built_in">console</span>.log(e)</div><div class="line">  &#125;)</div><div class="line">  .then(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</div><div class="line">    <span class="keyword">if</span> (data&amp;&amp;data.success) &#123;</div><div class="line">      <span class="keyword">var</span> signature= <span class="string">'folder='</span>+folder+<span class="string">'&amp;tags='</span>+tags+<span class="string">'&amp;timestamp='</span>+timestamp+CLOUDINARY.api_secret</div><div class="line">      signature=sha1(signature)</div><div class="line"></div><div class="line">      <span class="keyword">var</span> body=<span class="keyword">new</span> FormData()</div><div class="line"></div><div class="line">      body.append(<span class="string">'folder'</span>,folder)</div><div class="line">      body.append(<span class="string">'signature'</span>,signature)</div><div class="line">      body.append(<span class="string">'timestamp'</span>,timestamp)</div><div class="line">      body.append(<span class="string">'tags'</span>,tags)</div><div class="line">      body.append(<span class="string">'api_key'</span>,CLOUDINARY.api_key)</div><div class="line">      body.append(<span class="string">'resource_type'</span>,<span class="string">'image'</span>)</div><div class="line">      body.append(<span class="string">'file'</span>,avatarData)</div><div class="line"></div><div class="line">      <span class="keyword">this</span>._upload(body)</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>然后就上传图片</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">_upload(body)&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'_upload'</span>)</div><div class="line">  <span class="keyword">var</span> that = <span class="keyword">this</span></div><div class="line"></div><div class="line">  <span class="keyword">var</span> xhr=<span class="keyword">new</span> XMLHttpRequest()</div><div class="line">  <span class="keyword">var</span> url=CLOUDINARY.image</div><div class="line"></div><div class="line">  xhr.open(<span class="string">'POST'</span>,url)</div><div class="line">  xhr.onload=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">     <span class="built_in">console</span>.log(<span class="string">'upload image onload'</span>)</div><div class="line">    <span class="keyword">if</span> (xhr.status!==<span class="number">200</span>) &#123;</div><div class="line">      AlertIOS(<span class="string">'请求失败'</span>)</div><div class="line">      <span class="built_in">console</span>.log(xhr.responseText)</div><div class="line">      <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!xhr.responseText) &#123;</div><div class="line">      AlertIOS(<span class="string">'请求失败'</span>)</div><div class="line">      <span class="built_in">console</span>.log(xhr.responseText)</div><div class="line">      <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> response</div><div class="line"></div><div class="line">    <span class="keyword">try</span>&#123;</div><div class="line">      response=<span class="built_in">JSON</span>.parse(xhr.response)</div><div class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</div><div class="line">      <span class="built_in">console</span>.log(e)</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'parse fails'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'upload success'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (response&amp;&amp;response.public_id) &#123;</div><div class="line">      <span class="keyword">var</span> user=that.state.user</div><div class="line"></div><div class="line">      user.avatar=avatar(response.public_id,<span class="string">'image'</span>)</div><div class="line"></div><div class="line">      that.setState(&#123;</div><div class="line">        <span class="attr">user</span>:user</div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  xhr.send(body)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="上传进度"><a href="#上传进度" class="headerlink" title="上传进度"></a>上传进度</h3><p>首先安装一个进度组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i react-native-progress --save</div></pre></td></tr></table></figure>
<h2 id="录音"><a href="#录音" class="headerlink" title="录音"></a>录音</h2><p>使用react-native-audio模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm i react-native-audio@<span class="number">1.2</span><span class="number">.1</span> --save</div><div class="line"><span class="comment">//这里安装1.3.0才不报错</span></div></pre></td></tr></table></figure>
<p>然后链接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm link react-native-audio</div></pre></td></tr></table></figure>
<p>示例代码<a href="https://github.com/jsierles/react-native-audio/blob/master/AudioExample/AudioExample.js" target="_blank" rel="external">https://github.com/jsierles/react-native-audio/blob/master/AudioExample/AudioExample.js</a></p>
<h2 id="app图标"><a href="#app图标" class="headerlink" title="app图标"></a>app图标</h2><h3 id="使用appicontemplate"><a href="#使用appicontemplate" class="headerlink" title="使用appicontemplate"></a>使用appicontemplate</h3><p><a href="https://appicontemplate.com/(打开：https://applypixels.com/)，然后点击ios" target="_blank" rel="external">https://appicontemplate.com/(打开：https://applypixels.com/)，然后点击ios</a> app icon,下载app icon，然后打开app的设计稿，然后点击atn后缀的文件这样就导入了动作文件，然后打打开psd，然后将图标拖动到刚刚打开的psd,在调整好颜色，最后使用动作面板导出图标。</p>
<h3 id="使用makeappcion"><a href="#使用makeappcion" class="headerlink" title="使用makeappcion"></a>使用makeappcion</h3><p><a href="http://makeappicon.com/,使用网页端，上传一个图标，然后输入邮箱，下载附件，里面包括android,ios,watch" target="_blank" rel="external">http://makeappicon.com/,使用网页端，上传一个图标，然后输入邮箱，下载附件，里面包括android,ios,watch</a></p>
<h2 id="更改app名称"><a href="#更改app名称" class="headerlink" title="更改app名称"></a>更改app名称</h2><p>只需要在plist中添加key为CFBundleDisplayName，值为名称就行了，还可以将CFBundleDevelopmentRegion改为zh_CN</p>
<h2 id="更改启动画面"><a href="#更改启动画面" class="headerlink" title="更改启动画面"></a>更改启动画面</h2><p>直接修改LaunchScreen.xib</p>
<h2 id="轮播图"><a href="#轮播图" class="headerlink" title="轮播图"></a>轮播图</h2><p>使用一个第三方组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i react-native-swiper --save</div></pre></td></tr></table></figure>
<h1 id="服务端开发过程"><a href="#服务端开发过程" class="headerlink" title="服务端开发过程"></a>服务端开发过程</h1><h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><p>新建一个目录，然后输入npm init填写一些基本信息，就初始化完了一个项目，然后安装一些依赖</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//初始化项目</span></div><div class="line">npm init</div><div class="line"></div><div class="line"><span class="comment">//安装依赖</span></div><div class="line">npm i koa koa-logger koa-session koa-bodyparser koa-router mongoose sha1 lodash uuid xss bluebird  --save</div></pre></td></tr></table></figure>
<p>speaksasy找不到了</p>
<p>升级到koa2,安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">npm install koa@next</div><div class="line">koa-logger@2</div><div class="line"></div><div class="line">//session还没支持2，所以要koa-convert</div><div class="line">npm i koa-convert --save </div><div class="line">app.use(convert(session(app)));</div><div class="line"></div><div class="line">npm install koa-bodyparser@next --save</div></pre></td></tr></table></figure>
<h2 id="使用koa搭建一个小型服务器"><a href="#使用koa搭建一个小型服务器" class="headerlink" title="使用koa搭建一个小型服务器"></a>使用koa搭建一个小型服务器</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"><span class="keyword">var</span> koa=<span class="built_in">require</span>(<span class="string">'koa'</span>)</div><div class="line"><span class="keyword">var</span> logger=<span class="built_in">require</span>(<span class="string">'koa-logger'</span>)</div><div class="line"><span class="keyword">var</span> session=<span class="built_in">require</span>(<span class="string">'koa-session'</span>)</div><div class="line"><span class="keyword">var</span> bodyParser=<span class="built_in">require</span>(<span class="string">'koa-bodyparser'</span>)</div><div class="line"><span class="keyword">var</span> app=koa()</div><div class="line"></div><div class="line">app.keys=[<span class="string">'say'</span>]</div><div class="line">app.use(logger())</div><div class="line">app.use(session(app))</div><div class="line">app.use(bodyParser())</div><div class="line"></div><div class="line">app.use(<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="keyword">this</span>.href)</div><div class="line">	<span class="built_in">console</span>.log(<span class="keyword">this</span>.method)</div><div class="line"></div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">yield</span> next</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">1234</span>)</div></pre></td></tr></table></figure>
<p>现在访问localhost就可以返回一段成功的json</p>
<h2 id="将路由写到单独的文件"><a href="#将路由写到单独的文件" class="headerlink" title="将路由写到单独的文件"></a>将路由写到单独的文件</h2><p>首先我们在index.js中将引入路由文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"><span class="keyword">var</span> koa=<span class="built_in">require</span>(<span class="string">'koa'</span>)</div><div class="line"><span class="keyword">var</span> logger=<span class="built_in">require</span>(<span class="string">'koa-logger'</span>)</div><div class="line"><span class="keyword">var</span> session=<span class="built_in">require</span>(<span class="string">'koa-session'</span>)</div><div class="line"><span class="keyword">var</span> bodyParser=<span class="built_in">require</span>(<span class="string">'koa-bodyparser'</span>)</div><div class="line"><span class="keyword">var</span> app=koa()</div><div class="line"></div><div class="line">app.keys=[<span class="string">'say'</span>]</div><div class="line">app.use(logger())</div><div class="line">app.use(session(app))</div><div class="line">app.use(bodyParser())</div><div class="line"></div><div class="line"><span class="comment">//引入路由文件</span></div><div class="line"><span class="keyword">var</span> router=<span class="built_in">require</span>(<span class="string">'./config/routes'</span>)()</div><div class="line"></div><div class="line">app</div><div class="line">	.use(router.routes())</div><div class="line">	.use(router.allowedMethods())</div><div class="line"></div><div class="line">app.listen(<span class="number">1234</span>)</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'listening on port 1234'</span>)</div></pre></td></tr></table></figure>
<p>然后新建路由文件</p>
<p>config/routes.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> Router=<span class="built_in">require</span>(<span class="string">'koa-router'</span>)</div><div class="line"><span class="keyword">var</span> User=<span class="built_in">require</span>(<span class="string">'../app/controllers/user'</span>)</div><div class="line"><span class="keyword">var</span> App=<span class="built_in">require</span>(<span class="string">'../app/controllers/app'</span>)</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> router=<span class="keyword">new</span> Router(&#123;</div><div class="line">		<span class="comment">//定义全局api的前缀</span></div><div class="line">		prefix:<span class="string">'/api/1'</span></div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	<span class="comment">//post请求使用User控制器上面的signup方法处理</span></div><div class="line">	<span class="comment">//user</span></div><div class="line">	router.post(<span class="string">'/u/signup'</span>,User.signup)</div><div class="line">	router.post(<span class="string">'/u/verify'</span>,User.verify)</div><div class="line">	router.post(<span class="string">'/u/update'</span>,User.update)</div><div class="line"></div><div class="line">	<span class="comment">//app</span></div><div class="line">	router.post(<span class="string">'/signature'</span>,App.signature)</div><div class="line"></div><div class="line">	<span class="keyword">return</span> router</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在路由文件中我们引入了几个控制器，将相应去请求指定不同的控制器方法调用</p>
<p>user.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line">exports.signup=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.verify=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.update=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>app.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line">exports.signature=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在我们可以随便访问一个api来测试接口是否正常工作</p>
<h2 id="接入mongodb"><a href="#接入mongodb" class="headerlink" title="接入mongodb"></a>接入mongodb</h2><p>首先新建一个model，在这里面定义user的模型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> mongoose=<span class="built_in">require</span>(<span class="string">'mongoose'</span>)</div><div class="line"><span class="keyword">var</span> UserSchema=<span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">	<span class="attr">phoneNumber</span>:&#123;</div><div class="line">		<span class="attr">unique</span>:<span class="literal">true</span>,</div><div class="line">		<span class="attr">type</span>:<span class="built_in">String</span></div><div class="line">	&#125;,</div><div class="line">	<span class="attr">areaCode</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">verifyCode</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">accessToken</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">nickname</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">gender</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">breed</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">age</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">avatar</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">meta</span>:&#123;</div><div class="line">		<span class="attr">createAt</span>:&#123;</div><div class="line">			<span class="attr">type</span>:<span class="built_in">Date</span>,</div><div class="line">			<span class="attr">default</span>:<span class="built_in">Date</span>.now()</div><div class="line">		&#125;,</div><div class="line">		<span class="attr">updateAt</span>:&#123;</div><div class="line">			<span class="attr">type</span>:<span class="built_in">Date</span>,</div><div class="line">			<span class="attr">default</span>:<span class="built_in">Date</span>.now()</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">UserSchema.pre(<span class="string">'save'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span> (!<span class="keyword">this</span>.isNew) &#123;</div><div class="line">		<span class="keyword">this</span>.meta.updateAt=<span class="built_in">Date</span>.now()</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	next()</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//暴露模型</span></div><div class="line"><span class="built_in">module</span>.exports=mongoose.model(<span class="string">'User'</span>,UserSchema)</div></pre></td></tr></table></figure>
<p>然后就可以在Controller里面操作数据库了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> xss=<span class="built_in">require</span>(<span class="string">'xss'</span>)</div><div class="line"><span class="keyword">var</span> mongoose=<span class="built_in">require</span>(<span class="string">'mongoose'</span>)</div><div class="line"><span class="keyword">var</span> User=mongoose.model(<span class="string">'User'</span>)</div><div class="line"></div><div class="line">exports.signup=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="comment">//拿到request里面的phoneNumber</span></div><div class="line">	<span class="comment">// console.log(this.request.body)</span></div><div class="line">	<span class="comment">// var phoneNumber=this.request.body.phoneNumber</span></div><div class="line">	<span class="keyword">var</span> phoneNumber=<span class="keyword">this</span>.query.phoneNumber</div><div class="line"></div><div class="line">	<span class="comment">//根据手机号查找用户，调用exec后就返回的是一个Promise</span></div><div class="line">	<span class="keyword">var</span> user=<span class="keyword">yield</span> User.findOne(&#123;</div><div class="line">		<span class="attr">phoneNumber</span>:phoneNumber</div><div class="line">	&#125;).exec()</div><div class="line"></div><div class="line">	<span class="built_in">console</span>.log(user)</div><div class="line">	<span class="built_in">console</span>.log(phoneNumber)</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (user) &#123;</div><div class="line">		<span class="comment">//更新用户的验证码</span></div><div class="line">		user.verifyCode=<span class="string">'1212'</span></div><div class="line">	&#125; <span class="keyword">else</span>&#123;</div><div class="line">		<span class="comment">//不存在，则新建一个用户</span></div><div class="line">		user = <span class="keyword">new</span> User(&#123;</div><div class="line">			<span class="attr">phoneNumber</span>:xss(phoneNumber)</div><div class="line">		&#125;)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">try</span>&#123;</div><div class="line">		user=<span class="keyword">yield</span> user.save()</div><div class="line">	&#125;<span class="keyword">catch</span>(e)&#123;</div><div class="line">		<span class="keyword">this</span>.body=&#123;</div><div class="line">			<span class="attr">success</span>:<span class="literal">false</span></div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.verify=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.update=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="接入注册短信"><a href="#接入注册短信" class="headerlink" title="接入注册短信"></a>接入注册短信</h2><p>这里使用<a href="https://luosimao.com" target="_blank" rel="external">https://luosimao.com</a></p>
<h2 id="通用验证"><a href="#通用验证" class="headerlink" title="通用验证"></a>通用验证</h2><p>我们知道基本上每个请求都有accessToken，如果是post请求需要有body，像这样的逻辑，如果在每个接口都判断，可以说是很庞大的，这样我们将数据的校验写到app.js的功能中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">exports.hasBody=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> body=<span class="keyword">this</span>.request.body||&#123;&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (<span class="built_in">Object</span>.keys(body).length===<span class="number">0</span>) &#123;</div><div class="line">		<span class="keyword">this</span>.body=&#123;</div><div class="line">			<span class="attr">success</span>:<span class="literal">false</span>,</div><div class="line">			<span class="attr">err</span>:<span class="string">'没有传递body参数'</span></div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">return</span> next</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">yield</span> next</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//全局token判断</span></div><div class="line">exports.hasToken=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="comment">//先获取url中的token</span></div><div class="line">	<span class="keyword">var</span> accessToken=<span class="keyword">this</span>.query.accessToken</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (!accessToken) &#123;</div><div class="line">		accessToken=<span class="keyword">this</span>.request.body.accessToken</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (!accessToken) &#123;</div><div class="line">		<span class="keyword">this</span>.body=&#123;</div><div class="line">			<span class="attr">success</span>:<span class="literal">false</span>,</div><div class="line">			<span class="attr">err</span>:<span class="string">'token不能为空！'</span></div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">return</span> next</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//再查询用户，如果查询不到用户，说明token错误，或者用户没注册</span></div><div class="line">	<span class="keyword">var</span> user=<span class="keyword">yield</span> User.findOne(&#123;</div><div class="line">		<span class="attr">accessToken</span>:accessToken</div><div class="line">	&#125;).exec()</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (!user) &#123;</div><div class="line">		<span class="keyword">this</span>.body=&#123;</div><div class="line">			<span class="attr">success</span>:<span class="literal">false</span>,</div><div class="line">			<span class="attr">err</span>:<span class="string">'token错误！'</span></div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">return</span> next</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">this</span>.session=<span class="keyword">this</span>.session||&#123;&#125;</div><div class="line">	<span class="keyword">this</span>.session.user=user</div><div class="line"></div><div class="line">	<span class="keyword">yield</span> next</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在router中配置，中间件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">router.post(<span class="string">'/u/signup'</span>,App.hasBody,User.signup)</div><div class="line">router.post(<span class="string">'/u/verify'</span>,App.hasBody,User.verify)</div><div class="line"><span class="comment">//登陆才需要token</span></div><div class="line">router.post(<span class="string">'/u/update'</span>,App.hasBody,App.hasToken,User.update)</div></pre></td></tr></table></figure>
<h2 id="接入七牛云"><a href="#接入七牛云" class="headerlink" title="接入七牛云"></a>接入七牛云</h2><p>先创建一个七牛空间，然后在程序里加入qiniu的配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">qiniu:&#123;</div><div class="line">	<span class="string">'AK'</span>:<span class="string">'cMoZ5Ql3sJZ2ZReLyQDjNbIqiaNmAzn54QDzZE_J'</span>,</div><div class="line">	<span class="string">'SK'</span>:<span class="string">'8MCooB-Kb8s9lCAQbhLFwUukmJJiCEn-w483ainh'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>卸载模块，并删除依赖</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm uninstall uuid --save</div></pre></td></tr></table></figure>
<h2 id="接入cloudinary"><a href="#接入cloudinary" class="headerlink" title="接入cloudinary"></a>接入cloudinary</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i cloudinary --save</div></pre></td></tr></table></figure>
<h3 id="将上传到七牛的视频同步到cloudinary"><a href="#将上传到七牛的视频同步到cloudinary" class="headerlink" title="将上传到七牛的视频同步到cloudinary"></a>将上传到七牛的视频同步到cloudinary</h3><p>将视频上传到七牛是因为，访问七牛快，同步到cloudinary是因为他有将视频和音频合成一个视频的功能。</p>
<p>同步的逻辑很简单，就是客户端将视频上传到了七牛，然后将视频信息发送到我们的服务端，并保持，然后异步同步七牛的视频到cloudinary,同步完了，将他返回的信息在存储到我们的服务器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> body=<span class="keyword">this</span>.request.body</div><div class="line"><span class="keyword">var</span> videoData=body.video</div><div class="line"><span class="keyword">var</span> user=<span class="keyword">this</span>.session.user</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'create video'</span>)</div><div class="line"><span class="built_in">console</span>.log(videoData)</div><div class="line"></div><div class="line"><span class="keyword">if</span> (!videoData||!videoData.key) &#123;</div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">false</span>,</div><div class="line">		<span class="attr">err</span>:<span class="string">'视频没有上传成功'</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> next</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//用七牛key查询是否有视频存在</span></div><div class="line"><span class="keyword">var</span> video=<span class="keyword">yield</span> Video.findOne(&#123;</div><div class="line">	<span class="attr">qiniu_key</span>:videoData.key</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">if</span> (!video) &#123;</div><div class="line">	<span class="comment">//创建一个新视频</span></div><div class="line">	video=<span class="keyword">new</span> Video(&#123;</div><div class="line">		<span class="attr">author</span>:user._id,</div><div class="line">		<span class="attr">qiniu_key</span>:videoData.key,</div><div class="line">		<span class="attr">persistentId</span>:videoData.persistentId</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	video=<span class="keyword">yield</span> video.save()</div><div class="line"></div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'new video save'</span>)</div><div class="line">	<span class="built_in">console</span>.log(video)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//将生成的静音视频，同步到cloudinary，然后使用它的音频合成服务</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">var</span> url=config.qiniu.video+video.qiniu_key</div><div class="line">robot.uploadToCloudinary(url)</div><div class="line">	.then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span> (data&amp;&amp;data.public_id) &#123;</div><div class="line">			video.public_id=data.public_id</div><div class="line">			video.detail=data</div><div class="line">			video.save()</div><div class="line">		&#125;</div><div class="line">	&#125;)</div><div class="line"></div><div class="line"><span class="keyword">this</span>.body=&#123;</div><div class="line">	<span class="attr">success</span>:<span class="literal">true</span>,</div><div class="line">	<span class="attr">data</span>:video._id</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在这里就是用了cloudinary的sdk</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">exports.uploadToCloudinary=<span class="function"><span class="keyword">function</span> (<span class="params">url</span>) </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>&#123;</div><div class="line">		cloudinary.uploader.upload(url,<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</div><div class="line">			<span class="keyword">if</span> (result&amp;&amp;result.public_id) &#123;</div><div class="line">				resolve(result)</div><div class="line">			&#125; <span class="keyword">else</span>&#123;</div><div class="line">				reject(result)</div><div class="line">			&#125;</div><div class="line">		&#125;,&#123;</div><div class="line">			<span class="attr">resource_type</span>:<span class="string">'video'</span>,</div><div class="line">			<span class="attr">folder</span>:<span class="string">'video'</span></div><div class="line">		&#125;)</div><div class="line">	&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="屏幕单位"><a href="#屏幕单位" class="headerlink" title="屏幕单位"></a>屏幕单位</h1><p>1英寸(inch)=2.54厘米(cm)</p>
<p>首先我们看iphone6</p>
<h2 id="英寸"><a href="#英寸" class="headerlink" title="英寸"></a>英寸</h2><p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/%E5%AF%B9%E8%A7%92%E7%BA%BF.png" alt=""></p>
<h2 id="点"><a href="#点" class="headerlink" title="点"></a>点</h2><p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/%E7%82%B9.png" alt=""></p>
<h2 id="像素"><a href="#像素" class="headerlink" title="像素"></a>像素</h2><p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/%E5%83%8F%E7%B4%A0.png" alt=""></p>
<h2 id="缩放比ppi"><a href="#缩放比ppi" class="headerlink" title="缩放比ppi"></a>缩放比ppi</h2><p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/ppi.png" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/iphone6-screen.png" alt=""></p>
<h2 id="iphone屏幕尺寸分布"><a href="#iphone屏幕尺寸分布" class="headerlink" title="iphone屏幕尺寸分布"></a>iphone屏幕尺寸分布</h2><p> <img src="http://7qnc6h.com1.z0.glb.clouddn.com/iphone-screen.png" alt=""></p>
<h2 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h2><p>这里的箭头函数相当于java中的函数式编程</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> numberArray=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line"></div><div class="line"><span class="comment">// var newNumberArray=numberArray.map(function(item)&#123;</span></div><div class="line"><span class="comment">//   return item+1</span></div><div class="line"><span class="comment">// &#125;)</span></div><div class="line"></div><div class="line"><span class="comment">//等效于</span></div><div class="line"><span class="keyword">var</span> newNumberArray = numberArray.map(<span class="function"><span class="params">item</span>=&gt;</span>item+<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(newNumberArray)</div></pre></td></tr></table></figure>
<h1 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h1><h2 id="RCTSRWebSocket-m在xcode8-1下报错"><a href="#RCTSRWebSocket-m在xcode8-1下报错" class="headerlink" title="RCTSRWebSocket.m在xcode8.1下报错"></a>RCTSRWebSocket.m在xcode8.1下报错</h2><p><a href="http://www.jianshu.com/p/175e820a1c51" target="_blank" rel="external">http://www.jianshu.com/p/175e820a1c51</a></p>
<h2 id="CodeSign-error-code-signing-is-required-for-product-type-‘Unit-Test-Bundle’-in-SDK-‘iOS-8-1’"><a href="#CodeSign-error-code-signing-is-required-for-product-type-‘Unit-Test-Bundle’-in-SDK-‘iOS-8-1’" class="headerlink" title="CodeSign error: code signing is required for product type ‘Unit Test Bundle’ in SDK ‘iOS 8.1’"></a>CodeSign error: code signing is required for product type ‘Unit Test Bundle’ in SDK ‘iOS 8.1’</h2><p><a href="http://blog.csdn.net/skymingst/article/details/42489097" target="_blank" rel="external">http://blog.csdn.net/skymingst/article/details/42489097</a></p>

      
    </div>
    
    <div>
      
        
<div id="wechat_subscriber" style="display: block； padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/uploads/wechat-qcode.jpg" alt="任苹蜻 wechat" style="width: 200px; max-width: 100%;"/>
    <div>欢迎您扫一扫上面的微信公众号，订阅我的博客！</div>
</div>

      
    </div>

    <div>
      
        
<div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton", disable="enable", onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}", style="cursor: pointer; border: 0; outline: 0; border-radius: 100%; padding: 0; margin: 0; letter-spacing: normal; text-transform: none; text-indent: 0px; text-shadow: none">
    <span onmouseover="this.style.color='rgb(236,96,0)';this.style.background='rgb(204,204,204)'" onMouseOut="this.style.color='#fff';this.style.background='rgb(236,96,0)'" style="display: inline-block; width: 70px; height: 70px; border-radius: 100%; line-height: 81px; color: #fff; font: 400 35px/75px 'microsofty'; background: rgb(236,96,0)">赏</span>
  </button>
  <div id="QR" style="display: none;">
    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/wechat-reward-image.png" alt="任苹蜻 WeChat Pay" style="width: 200px; max-width: 100%; display: inline-block"/>
        <p>微信打赏</p>
      </div>
    
    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/uploads/alipay-reward-image.png" alt="任苹蜻 Alipay" style="width: 200px; max-width: 100%; display: inline-block"/>
        <p>支付宝打赏</p>
      </div>
    
  </div>
</div>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/React/" rel="tag">#React</a>
          
            <a href="/tags/React-Native/" rel="tag">#React Native</a>
          
            <a href="/tags/NodeJS/" rel="tag">#NodeJS</a>
          
            <a href="/tags/Node/" rel="tag">#Node</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/01/android-studio/" rel="next" title="AndroidStudio">
                <i class="fa fa-chevron-left"></i> AndroidStudio
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/01/07/android-http/" rel="prev" title="AndroidHttp">
                AndroidHttp <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2016/12/03/dev-gougou-say/"
     data-title="使用ReactNative开发狗狗说应用流程"
     data-content=""
     data-url="http://i.woblog.cn/2016/12/03/dev-gougou-say/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          

  <p>热评文章</p>
  <div class="ds-top-threads" data-range="weekly" data-num-items="4"></div>


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/12/03/dev-gougou-say/"
           data-title="使用ReactNative开发狗狗说应用流程" data-url="http://i.woblog.cn/2016/12/03/dev-gougou-say/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://tp4.sinaimg.cn/1662907603/180/5755316418/1"
               alt="任苹蜻" />
          <p class="site-author-name" itemprop="name">任苹蜻</p>
          <p class="site-description motion-element" itemprop="description">关注移动开发，大数据，云计算，软件架构（原博客：http://me.woblog.cn/）</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">62</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">29</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">86</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://www.weibo.com/renpingqing1993" target="_blank" title="Weibo">
                  
                    <i class="fa fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/lifengsofts/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/2cb78e578e43/latest_articles" target="_blank" title="Jianshu">
                  
                    <i class="fa fa-Jianshu"></i>
                  
                  Jianshu
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element">
            <div class="links-of-blogroll-title">Links</div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://macshuo.com/" title="MacTalk" target="_blank">MacTalk</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://example.com/" title="Title" target="_blank">Title</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#效果图"><span class="nav-number">1.</span> <span class="nav-text">效果图</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#开发流程"><span class="nav-number">2.</span> <span class="nav-text">开发流程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#主界面Tab切换"><span class="nav-number">2.1.</span> <span class="nav-text">主界面Tab切换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#替换Tab图标"><span class="nav-number">2.2.</span> <span class="nav-text">替换Tab图标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#写tab对应的页面"><span class="nav-number">2.3.</span> <span class="nav-text">写tab对应的页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#将组件拿到对应的目录下"><span class="nav-number">2.3.1.</span> <span class="nav-text">将组件拿到对应的目录下</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建模拟数据"><span class="nav-number">2.4.</span> <span class="nav-text">创建模拟数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#视频页面"><span class="nav-number">2.5.</span> <span class="nav-text">视频页面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#添加视频页面标题"><span class="nav-number">2.5.1.</span> <span class="nav-text">添加视频页面标题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#添加视频列表"><span class="nav-number">2.5.2.</span> <span class="nav-text">添加视频列表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取网络数据"><span class="nav-number">2.6.</span> <span class="nav-text">获取网络数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#重构网络模块"><span class="nav-number">2.6.1.</span> <span class="nav-text">重构网络模块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#上拉加载更多"><span class="nav-number">2.7.</span> <span class="nav-text">上拉加载更多</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#下拉刷新"><span class="nav-number">2.8.</span> <span class="nav-text">下拉刷新</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#列表页点赞"><span class="nav-number">2.9.</span> <span class="nav-text">列表页点赞</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加进入视频详情页面"><span class="nav-number">2.10.</span> <span class="nav-text">添加进入视频详情页面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#详情页播放视频"><span class="nav-number">2.11.</span> <span class="nav-text">详情页播放视频</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#播放和暂停"><span class="nav-number">2.12.</span> <span class="nav-text">播放和暂停</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加返回和标题栏"><span class="nav-number">2.13.</span> <span class="nav-text">添加返回和标题栏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#视频制作者信息"><span class="nav-number">2.14.</span> <span class="nav-text">视频制作者信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#显示视频信息"><span class="nav-number">2.15.</span> <span class="nav-text">显示视频信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#显示评论内容"><span class="nav-number">2.16.</span> <span class="nav-text">显示评论内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#小插曲"><span class="nav-number">2.16.1.</span> <span class="nav-text">小插曲</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#优化评论布局"><span class="nav-number">2.16.2.</span> <span class="nav-text">优化评论布局</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#添加评论"><span class="nav-number">2.17.</span> <span class="nav-text">添加评论</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#提交组件"><span class="nav-number">2.17.1.</span> <span class="nav-text">提交组件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#验证码倒计时"><span class="nav-number">2.18.</span> <span class="nav-text">验证码倒计时</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动切换到登陆或首页逻辑"><span class="nav-number">2.19.</span> <span class="nav-text">启动切换到登陆或首页逻辑</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#显示用户头像"><span class="nav-number">2.20.</span> <span class="nav-text">显示用户头像</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#选择图片"><span class="nav-number">2.20.1.</span> <span class="nav-text">选择图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#上传图片到图床"><span class="nav-number">2.20.2.</span> <span class="nav-text">上传图片到图床</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#上传进度"><span class="nav-number">2.20.3.</span> <span class="nav-text">上传进度</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#录音"><span class="nav-number">2.21.</span> <span class="nav-text">录音</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#app图标"><span class="nav-number">2.22.</span> <span class="nav-text">app图标</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用appicontemplate"><span class="nav-number">2.22.1.</span> <span class="nav-text">使用appicontemplate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用makeappcion"><span class="nav-number">2.22.2.</span> <span class="nav-text">使用makeappcion</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更改app名称"><span class="nav-number">2.23.</span> <span class="nav-text">更改app名称</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更改启动画面"><span class="nav-number">2.24.</span> <span class="nav-text">更改启动画面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#轮播图"><span class="nav-number">2.25.</span> <span class="nav-text">轮播图</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#服务端开发过程"><span class="nav-number">3.</span> <span class="nav-text">服务端开发过程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#初始化项目"><span class="nav-number">3.1.</span> <span class="nav-text">初始化项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用koa搭建一个小型服务器"><span class="nav-number">3.2.</span> <span class="nav-text">使用koa搭建一个小型服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#将路由写到单独的文件"><span class="nav-number">3.3.</span> <span class="nav-text">将路由写到单独的文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#接入mongodb"><span class="nav-number">3.4.</span> <span class="nav-text">接入mongodb</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#接入注册短信"><span class="nav-number">3.5.</span> <span class="nav-text">接入注册短信</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通用验证"><span class="nav-number">3.6.</span> <span class="nav-text">通用验证</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#接入七牛云"><span class="nav-number">3.7.</span> <span class="nav-text">接入七牛云</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#接入cloudinary"><span class="nav-number">3.8.</span> <span class="nav-text">接入cloudinary</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#将上传到七牛的视频同步到cloudinary"><span class="nav-number">3.8.1.</span> <span class="nav-text">将上传到七牛的视频同步到cloudinary</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#屏幕单位"><span class="nav-number">4.</span> <span class="nav-text">屏幕单位</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#英寸"><span class="nav-number">4.1.</span> <span class="nav-text">英寸</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#点"><span class="nav-number">4.2.</span> <span class="nav-text">点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#像素"><span class="nav-number">4.3.</span> <span class="nav-text">像素</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缩放比ppi"><span class="nav-number">4.4.</span> <span class="nav-text">缩放比ppi</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">4.5.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#iphone屏幕尺寸分布"><span class="nav-number">4.6.</span> <span class="nav-text">iphone屏幕尺寸分布</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#箭头函数"><span class="nav-number">4.7.</span> <span class="nav-text">箭头函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#常见错误"><span class="nav-number">5.</span> <span class="nav-text">常见错误</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RCTSRWebSocket-m在xcode8-1下报错"><span class="nav-number">5.1.</span> <span class="nav-text">RCTSRWebSocket.m在xcode8.1下报错</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CodeSign-error-code-signing-is-required-for-product-type-‘Unit-Test-Bundle’-in-SDK-‘iOS-8-1’"><span class="nav-number">5.2.</span> <span class="nav-text">CodeSign error: code signing is required for product type ‘Unit Test Bundle’ in SDK ‘iOS 8.1’</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">任苹蜻</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"iwoblog"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  

  

</body>
</html>
