<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  




<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="MongoDB," />





  <link rel="alternate" href="/atom.xml" title="任苹蜻的博客" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="为什么学mongodb开源，免费，社区技术支持到位
优势无标结构限制
没有任何表结构，每条记录的结构可以完全不同
业务开发方便
SQL数据库需要事先定义表结构在使用

完成的索引支持redis只有key-value，hbase的二级索引还需要自己实现

单键索引，多键索引
数组索引
全文索引
地理位置索引

方便的冗余和扩展
复制集保证数据安全
分片扩展数据规模

良好的支持
完善的文档
齐全的驱">
<meta property="og:type" content="article">
<meta property="og:title" content="MongoDB">
<meta property="og:url" content="http://i.woblog.cn/2016/11/27/mongodb/index.html">
<meta property="og:site_name" content="任苹蜻的博客">
<meta property="og:description" content="为什么学mongodb开源，免费，社区技术支持到位
优势无标结构限制
没有任何表结构，每条记录的结构可以完全不同
业务开发方便
SQL数据库需要事先定义表结构在使用

完成的索引支持redis只有key-value，hbase的二级索引还需要自己实现

单键索引，多键索引
数组索引
全文索引
地理位置索引

方便的冗余和扩展
复制集保证数据安全
分片扩展数据规模

良好的支持
完善的文档
齐全的驱">
<meta property="og:updated_time" content="2017-03-19T14:22:37.668Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MongoDB">
<meta name="twitter:description" content="为什么学mongodb开源，免费，社区技术支持到位
优势无标结构限制
没有任何表结构，每条记录的结构可以完全不同
业务开发方便
SQL数据库需要事先定义表结构在使用

完成的索引支持redis只有key-value，hbase的二级索引还需要自己实现

单键索引，多键索引
数组索引
全文索引
地理位置索引

方便的冗余和扩展
复制集保证数据安全
分片扩展数据规模

良好的支持
完善的文档
齐全的驱">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  <title> MongoDB | 任苹蜻的博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?48746acb55f702790215ece2fb3a3be5";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">任苹蜻的博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-user fa-fw"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-heartbeat fa-fw"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                MongoDB
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-27T00:30:38+00:00" content="2016-11-27">
              2016-11-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/MongoDB/" itemprop="url" rel="index">
                    <span itemprop="name">MongoDB</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/27/mongodb/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/27/mongodb/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="为什么学mongodb"><a href="#为什么学mongodb" class="headerlink" title="为什么学mongodb"></a>为什么学mongodb</h1><p>开源，免费，社区技术支持到位</p>
<h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><h3 id="无标结构限制"><a href="#无标结构限制" class="headerlink" title="无标结构限制"></a>无标结构限制</h3><ol>
<li>没有任何表结构，每条记录的结构可以完全不同</li>
<li>业务开发方便</li>
<li>SQL数据库需要事先定义表结构在使用</li>
</ol>
<h3 id="完成的索引支持"><a href="#完成的索引支持" class="headerlink" title="完成的索引支持"></a>完成的索引支持</h3><p>redis只有key-value，hbase的二级索引还需要自己实现</p>
<ol>
<li>单键索引，多键索引</li>
<li>数组索引</li>
<li>全文索引</li>
<li>地理位置索引</li>
</ol>
<h3 id="方便的冗余和扩展"><a href="#方便的冗余和扩展" class="headerlink" title="方便的冗余和扩展"></a>方便的冗余和扩展</h3><ol>
<li>复制集保证数据安全</li>
<li>分片扩展数据规模</li>
</ol>
<h3 id="良好的支持"><a href="#良好的支持" class="headerlink" title="良好的支持"></a>良好的支持</h3><ol>
<li>完善的文档</li>
<li>齐全的驱动支持</li>
</ol>
<h2 id="相关工具"><a href="#相关工具" class="headerlink" title="相关工具"></a>相关工具</h2><p>MongoDB：64Linux</p>
<p>MongoDB版本：2.6.5</p>
<p>ssh：xshell</p>
<p>文本编辑器：vim,sublime</p>
<h1 id="常用学习网站"><a href="#常用学习网站" class="headerlink" title="常用学习网站"></a>常用学习网站</h1><p>官网：<a href="https://www.mongodb.com/" target="_blank" rel="external">https://www.mongodb.com/</a></p>
<p>github</p>
<p>jira:<a href="https://jira.mongodb.org/secure/Dashboard.jspa" target="_blank" rel="external">https://jira.mongodb.org/secure/Dashboard.jspa</a></p>
<p><a href="https://groups.google.com/forum/#!forum/mongodb-user" target="_blank" rel="external">https://groups.google.com/forum/#!forum/mongodb-user</a></p>
<p>mongodb中文社区：<a href="http://www.mongoing.com/" target="_blank" rel="external">http://www.mongoing.com/</a></p>
<p>mongodb中文文档：<a href="http://docs.mongoing.com/manual-zh/" target="_blank" rel="external">http://docs.mongoing.com/manual-zh/</a></p>
<h1 id="数据库概念"><a href="#数据库概念" class="headerlink" title="数据库概念"></a>数据库概念</h1><p>有组织的存放数据</p>
<p>按照不同的需求进行查询</p>
<h1 id="数据库分类"><a href="#数据库分类" class="headerlink" title="数据库分类"></a>数据库分类</h1><p>SQL数据库：Oracle,Mysql</p>
<p>NoSQl数据库(Not Only SQL)：Redis,MongoDB</p>
<table>
<thead>
<tr>
<th>SQL数据库</th>
<th>NoSQL数据库</th>
</tr>
</thead>
<tbody>
<tr>
<td>实时移植性</td>
<td>有延迟</td>
</tr>
<tr>
<td>实务</td>
<td>默认不支持</td>
</tr>
<tr>
<td>多表联合查询</td>
<td>没有，提供更好的性能</td>
</tr>
</tbody>
</table>
<h1 id="安装Mongodb"><a href="#安装Mongodb" class="headerlink" title="安装Mongodb"></a>安装Mongodb</h1><h2 id="mac"><a href="#mac" class="headerlink" title="mac"></a>mac</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">brew update</div><div class="line">brew install mongodb</div></pre></td></tr></table></figure>
<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><p>mongod：数据库执行程序</p>
<p>mongo：连接mongo数据库的客户端</p>
<p>mongoimport,mongoexport:数据库的导入导出</p>
<p>mongodump，mongorestore:也是导入导出，只是导出的是二进制文件，一般用来做数据的备份和恢复</p>
<p>mongooplog:日志</p>
<p>mongostat:用于查看数据库的状态</p>
<h1 id="搭建一个简单的数据库服务器"><a href="#搭建一个简单的数据库服务器" class="headerlink" title="搭建一个简单的数据库服务器"></a>搭建一个简单的数据库服务器</h1><ol>
<li>创建一个目录，用来存放数据库相关的文件</li>
<li>创建data，用来存放数据库文件</li>
<li>创建log，用来存放数据库日志文件</li>
<li>创建bin，存放数据库可执行文件</li>
<li>创建conf，存放数据库配置文件</li>
</ol>
<h2 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h2><p>mongod.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">port=12345</div><div class="line">dbpath=data</div><div class="line">logpath=log/mongod.log</div><div class="line">fork=true</div></pre></td></tr></table></figure>
<h2 id="启动数据库服务器"><a href="#启动数据库服务器" class="headerlink" title="启动数据库服务器"></a>启动数据库服务器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongod -f conf/mongod.conf</div></pre></td></tr></table></figure>
<p>如果看到如下信息表示服务区已成功开启</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">about to fork child process, waiting until server is ready for connections.</div><div class="line">forked process: 23963</div><div class="line">child process started successfully, parent exiting</div></pre></td></tr></table></figure>
<p>启动成功后可以在data目录查看到一些文件，并且日志文件也已经生成了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tail log/mongod.log</div></pre></td></tr></table></figure>
<h1 id="连接mongo"><a href="#连接mongo" class="headerlink" title="连接mongo"></a>连接mongo</h1><h2 id="使用mongo命令"><a href="#使用mongo命令" class="headerlink" title="使用mongo命令"></a>使用mongo命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongo 127.0.0.1:12345/test</div></pre></td></tr></table></figure>
<p>数据库地址：127.0.0.1</p>
<p>端口：12345</p>
<p>数据库名：test</p>
<h1 id="关闭mongo服务"><a href="#关闭mongo服务" class="headerlink" title="关闭mongo服务"></a>关闭mongo服务</h1><p>直接kill相应的进程，15，或不带参数，不能使用9</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">use admin</div><div class="line">db.shutdownServer()</div></pre></td></tr></table></figure>
<h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><p>show dbs：查看数据库</p>
<p>use 数据库名：选择数据库，切换前不需要数据库一定存在</p>
<p>db.dropDatabase():删除数据库</p>
<p>show collections：显示集合，相当于一张表</p>
<h2 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">db.test_collection.insert(&#123;x:&apos;1&apos;&#125;)</div><div class="line"></div><div class="line">//可以自定指定id,但不能重复，重复将报错</div><div class="line">db.test_collection.insert(&#123;x:&apos;1&apos;,_id:1&#125;)</div><div class="line"></div><div class="line">//默认返回所有</div><div class="line">db.test_collection.find()</div><div class="line"></div><div class="line">//指定条件</div><div class="line">db.test_collection.find(&#123;x:&apos;1&apos;&#125;)</div><div class="line"></div><div class="line">//通过for循环，插入多条数据</div><div class="line">for(i=3;i&lt;100;i++)db.test_collection.insert(&#123;x:i&#125;)</div><div class="line"></div><div class="line">//统计数据条数</div><div class="line">db.test_collection.find().count()</div><div class="line"></div><div class="line">//跳过3条，限制返回2条，按照x升排序</div><div class="line">db.test_collection.find().skip(3).limit(2).sort(&#123;x:1&#125;)</div><div class="line"></div><div class="line">//将x=1的第一条数据更新为x=888,如果这条数据原来还有自定，就会覆盖为只有x字段</div><div class="line">db.test_collection.update(&#123;x:&apos;1&apos;&#125;,&#123;x:&apos;888&apos;&#125;)</div><div class="line"></div><div class="line">//更新指定字段,只更新z字段，其他的字段不变</div><div class="line">db.test_collection.update(&#123;y:100&#125;,&#123;$set:&#123;z:10&#125;&#125;)</div><div class="line"></div><div class="line">//更新一条数据，不存在则创建</div><div class="line">db.test_collection.update(&#123;x:388&#125;,&#123;x:488&#125;,true)</div><div class="line"></div><div class="line">//更新多条数据，只能用来使用set符号</div><div class="line">db.test_collection.update(&#123;a:1&#125;,&#123;$set:&#123;a:2&#125;&#125;,false,true)</div><div class="line"></div><div class="line">//删除，默认删除所有匹配条件的数据</div><div class="line">db.test_collection.remove(&#123;a:2&#125;)</div><div class="line"></div><div class="line">//删除集合</div><div class="line">db.test_collection.drop()</div></pre></td></tr></table></figure>
<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><p>索引可以重复创建，对于已创建的索引重复创建，会直接返回成功。</p>
<h2 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.c1.getIndexes()</div></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">	&#123;</div><div class="line">		&quot;v&quot; : 1,</div><div class="line">		&quot;key&quot; : &#123;</div><div class="line">			&quot;_id&quot; : 1 //索引键</div><div class="line">		&#125;,</div><div class="line">		&quot;name&quot; : &quot;_id_&quot;, //名称</div><div class="line">		&quot;ns&quot; : &quot;test.c1&quot; //数据库.表名</div><div class="line">	&#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<h2 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//键:排序方法，-1降序，1正序</div><div class="line">db.c1.ensureIndex(&#123;a:1&#125;)</div></pre></td></tr></table></figure>
<h2 id="id索引"><a href="#id索引" class="headerlink" title="_id索引"></a>_id索引</h2><p>他是绝大多数集合默认建立的索引。对于新插入的数据，都会自动生成，也是唯一索引。</p>
<h3 id="单键"><a href="#单键" class="headerlink" title="单键"></a>单键</h3><p>是最普通的索引，不会自动创建，比如：这样一条数据{a:1,y:2}，如果建立a的索引，就可以提高以a字段查询的效率。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.c1.ensureIndex(&#123;a:1&#125;)</div></pre></td></tr></table></figure>
<h2 id="多键索引"><a href="#多键索引" class="headerlink" title="多键索引"></a>多键索引</h2><p>创建方式和单键相同，区别是字段的值，多键具有多个值，如：数组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.c1.insert(&#123;a:[1,2,3]&#125;)</div></pre></td></tr></table></figure>
<p>插入这条数据后，如果a创建了单键索引，那么对于这条数据就是多键索引。</p>
<h2 id="复合索引"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引</h2><p>当查询条件不止一个时，比如:这条数据{a:1,b:2,c:3}，如果需要同时查询a和b的值，就可以就需要使用复合索引。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.c1.ensureIndex(&#123;a:1,b:1&#125;)</div></pre></td></tr></table></figure>
<p>获取索引后可以看到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;v&quot; : 1,</div><div class="line">	&quot;key&quot; : &#123;</div><div class="line">		&quot;a&quot; : 1,</div><div class="line">		&quot;b&quot; : 1</div><div class="line">	&#125;,</div><div class="line">	&quot;name&quot; : &quot;a_1_b_1&quot;,</div><div class="line">	&quot;ns&quot; : &quot;test.c1&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="过期索引"><a href="#过期索引" class="headerlink" title="过期索引"></a>过期索引</h2><p>在一段时间后会过期的索引，过期后，相应的数据会被删除。适合存储登陆信息，日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//在time字段上创建了一个过期索引</div><div class="line">db.c1.ensureIndex(&#123;time:1&#125;,&#123;expireAfterSeconds:30&#125;)</div><div class="line"></div><div class="line">//这样插入一条数据，过期后就会删除，但是默认60秒扫描一次，所以最低也得60秒</div><div class="line">db.c1.insert(&#123;time:new Date()&#125; )</div></pre></td></tr></table></figure>
<p>注意：</p>
<ol>
<li>存储过期索引字段的值必须要是时间类型，也就是ISODate或者ISODate数组，不能使用时间戳，否则不能自动删除，但插入数据不会报错。</li>
<li>如果是ISODate数组，最只要满足最小的时间就删除</li>
<li>不能是复合索引</li>
<li>删除事件不精确，删除程序60s执行一次，删除也需要一定的时间，所以有误差</li>
</ol>
<h2 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h2><p>对于字符串，字符串数组可以创建全文索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">db.articles.ensureIndex(&#123;key:&quot;text&quot;&#125;)</div><div class="line"></div><div class="line">db.articles.ensureIndex(&#123;key_1:&quot;text&quot;,key_2:&quot;text&quot;&#125;)</div><div class="line"></div><div class="line">//将articles集合的每个字段都建立全文索引</div><div class="line">db.articles.ensureIndex(&#123;&quot;$**&quot;:&quot;text&quot;&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.articles.ensureIndex(&#123;&quot;article&quot;:&quot;text&quot;&#125;)</div></pre></td></tr></table></figure>
<h3 id="使用全文索引查询"><a href="#使用全文索引查询" class="headerlink" title="使用全文索引查询"></a>使用全文索引查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">db.articles.find(&#123;$text:&#123;$search:&quot;aa&quot;&#125;&#125;) //aa bb,cc aa bb</div><div class="line">db.articles.find(&#123;$text:&#123;$search:&quot;aa bb cc&quot;&#125;&#125;) //aa||bb||cc</div><div class="line">db.articles.find(&#123;$text:&#123;$search:&quot;aa bb -cc&quot;&#125;&#125;) //(aa||bb) &amp;&amp; !cc</div><div class="line">db.articles.find(&#123;$text:&#123;$search:&quot;\&quot;aa\&quot; \&quot;bb\&quot; \&quot;cc\&quot;&quot;&#125;&#125;) //aa &amp;&amp; bb &amp;&amp; cc,将每个关键词用引号</div><div class="line"></div><div class="line">db.articles.find(&#123;$text:&#123;$search:&apos;&quot;aa&quot; &quot;bb&quot; &quot;cc&quot;&apos;&#125;&#125;) //与上面等效</div><div class="line">db.articles.find(&#123;$text:&#123;$search:&quot;&apos;aa&apos; &apos;bb&apos; &apos;cc&apos;&quot;&#125;&#125;) //同上</div></pre></td></tr></table></figure>
<h3 id="全文查询相似度"><a href="#全文查询相似度" class="headerlink" title="全文查询相似度"></a>全文查询相似度</h3><p>使用$meta操作符，比如：{score:{$meta:”textScore”}}</p>
<p>写在查询条件后面就可以返还相似度score字段(该字段名字可以自定义)，同时还可以使用sort排序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.articles.find(&#123;$text:&#123;$search:&quot;aa bb&quot;&#125;&#125;,&#123;score:&#123;$meta:&quot;textScore&quot;&#125;&#125;)</div></pre></td></tr></table></figure>
<p>返回的数据</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">"_id"</span> : ObjectId(<span class="string">"583ad588d1671746663db3a0"</span>), <span class="attr">"article"</span> : <span class="string">"aa bb cc dd ee"</span>, <span class="attr">"score"</span> : <span class="number">1.2</span> &#125;</div><div class="line">&#123; <span class="attr">"_id"</span> : ObjectId(<span class="string">"583ad59ad1671746663db3a2"</span>), <span class="attr">"article"</span> : <span class="string">"aa bb cc hh dd"</span>, <span class="attr">"score"</span> : <span class="number">1.2</span> &#125;</div><div class="line">&#123; <span class="attr">"_id"</span> : ObjectId(<span class="string">"583ad591d1671746663db3a1"</span>), <span class="attr">"article"</span> : <span class="string">"aa bb rr gg"</span>, <span class="attr">"score"</span> : <span class="number">1.25</span> &#125;</div><div class="line">&#123; <span class="attr">"_id"</span> : ObjectId(<span class="string">"583ad85ad1671746663db3a3"</span>), <span class="attr">"article"</span> : <span class="string">"aa bb"</span>, <span class="attr">"score"</span> : <span class="number">1.5</span> &#125;</div></pre></td></tr></table></figure>
<p>按照相似度从大到小排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.articles.find(&#123;$text:&#123;$search:&quot;aa bb&quot;&#125;&#125;,&#123;score1:&#123;$meta:&quot;textScore&quot;&#125;&#125;).sort(&#123;score1:&#123;$meta:&quot;textScore&quot;&#125;&#125;)</div></pre></td></tr></table></figure>
<p>可以看到最大的值排到最前</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583ad85ad1671746663db3a3&quot;), &quot;article&quot; : &quot;aa bb&quot;, &quot;score1&quot; : 1.5 &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583ad591d1671746663db3a1&quot;), &quot;article&quot; : &quot;aa bb rr gg&quot;, &quot;score1&quot; : 1.25 &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583ad588d1671746663db3a0&quot;), &quot;article&quot; : &quot;aa bb cc dd ee&quot;, &quot;score1&quot; : 1.2 &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583ad59ad1671746663db3a2&quot;), &quot;article&quot; : &quot;aa bb cc hh dd&quot;, &quot;score1&quot; : 1.2 &#125;</div></pre></td></tr></table></figure>
<h3 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h3><p>每次查询只能指定一个$text</p>
<p>$text查询不能出现在nor查询中，也就是说不能查询不包含的某个值的数据</p>
<p>查询中如果包含$text,hint不再起作用，hint可以指定使用哪个索引</p>
<h2 id="索引属性"><a href="#索引属性" class="headerlink" title="索引属性"></a>索引属性</h2><p>名字，唯一性，稀疏性，是否定时删除，可以使用如下方式指定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.articles.ensureIndex(&#123;&#125;,&#123;属性名：值&#125;)</div></pre></td></tr></table></figure>
<h3 id="name名称"><a href="#name名称" class="headerlink" title="name名称"></a>name名称</h3><p>默认是键_排序方向</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//指定索引名称为normal_index</div><div class="line">db.c2.ensureIndex(&#123;a:1,b:-1,c:1&#125;,&#123;name:&quot;normal_index&quot;&#125;)</div></pre></td></tr></table></figure>
<h3 id="unique唯一性"><a href="#unique唯一性" class="headerlink" title="unique唯一性"></a>unique唯一性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//如果为true，有相同的值，则创建不成功</div><div class="line">db.c2.ensureIndex(&#123;a:1&#125;,&#123;unique:true/false&#125;)</div></pre></td></tr></table></figure>
<h2 id="稀疏性"><a href="#稀疏性" class="headerlink" title="稀疏性"></a>稀疏性</h2><p>默认创建的不稀疏的。例如：为x字段创建了索引，但插入的数据不存在x，默认也会为这条数据创建索引，如果不希望创建，就可以指定sparse:true。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.c2.createIndex(&#123;a:1&#125;,&#123;sparse:true/false&#125;)</div></pre></td></tr></table></figure>
<p>注意：不能再稀疏索引上查找不存在的某个字段的记录</p>
<p>查找不存在字段b的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.c2.find(&#123;b:&#123;$exists:false&#125;&#125;)</div></pre></td></tr></table></figure>
<p>强制指定使用某个索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.c2.find(&#123;b:&#123;$exists:false&#125;&#125;).hint(&quot;b_1&quot;)</div></pre></td></tr></table></figure>
<h2 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h2><p>指定索引名称就行了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">db.c2.dropIndex(&quot;normal_index&quot;)</div><div class="line"></div><div class="line">//删除所有索引，_id索引不能删除</div><div class="line">db.c2.dropIndexes()</div></pre></td></tr></table></figure>
<h2 id="地理位置索引"><a href="#地理位置索引" class="headerlink" title="地理位置索引"></a>地理位置索引</h2><p>将一些点的位置存储在mongoDB中，创建索引后，可以按照位置来超照其他点，有两种，他们的却别是计算距离上的区别：</p>
<p>2d索引：用于存储和查找平面上的点</p>
<p>2dsphere索引：用于存储和查找球面的点</p>
<p>查找方式：</p>
<ol>
<li>查找距离某个点一定距离内的点</li>
<li>查找包含在某个区域内的点</li>
</ol>
<h3 id="2d索引"><a href="#2d索引" class="headerlink" title="2d索引"></a>2d索引</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.location.ensureIndex(&#123;key:&quot;2d&quot;&#125;)</div></pre></td></tr></table></figure>
<p>位置的表示方式是：经纬度[经度,维度]，取值范围,经度[-180,180]，维度[-90,90]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//创建一个position字段， 用来存储经纬度</div><div class="line">db.location.ensureIndex(&#123;position:&quot;2d&quot;&#125;)</div><div class="line"></div><div class="line">//插入测试数据</div><div class="line">db.location.insert(&#123;position:[1,2]&#125;)</div><div class="line">db.location.insert(&#123;position:[3,2]&#125;)</div><div class="line">db.location.insert(&#123;position:[100,2]&#125;)</div><div class="line">db.location.insert(&#123;position:[100,20]&#125;)</div><div class="line">db.location.insert(&#123;position:[180,50]&#125;)</div><div class="line">db.location.insert(&#123;position:[180,100]&#125;)</div></pre></td></tr></table></figure>
<h4 id="查询方式"><a href="#查询方式" class="headerlink" title="查询方式"></a>查询方式</h4><h5 id="near"><a href="#near" class="headerlink" title="near"></a>near</h5><p>查询距离某个点最近的点，不支持$minDistance</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">//默认返回100个</div><div class="line">db.location.find(&#123;position:&#123;$near:[1,1]&#125;&#125;)</div><div class="line"></div><div class="line">//返回</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefba06570f2078e557bb&quot;), &quot;position&quot; : [ 1, 2 ] &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefbc06570f2078e557bc&quot;), &quot;position&quot; : [ 3, 2 ] &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefbf06570f2078e557bd&quot;), &quot;position&quot; : [ 100, 2 ] &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefc206570f2078e557be&quot;), &quot;position&quot; : [ 100, 20 ] &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefc806570f2078e557bf&quot;), &quot;position&quot; : [ 180, 50 ] &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefcb06570f2078e557c0&quot;), &quot;position&quot; : [ 180, 100 ] &#125;</div><div class="line"></div><div class="line">//限制最远距离</div><div class="line">db.location.find(&#123;position:&#123;$near:[1,1],$maxDistance:10&#125;&#125;)</div><div class="line"></div><div class="line">//返回</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefba06570f2078e557bb&quot;), &quot;position&quot; : [ 1, 2 ] &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefbc06570f2078e557bc&quot;), &quot;position&quot; : [ 3, 2 ] &#125;</div></pre></td></tr></table></figure>
<p>$geoWithin：查询包含在某个形状中的点</p>
<p>形状的表示：</p>
<p>$box:矩形，{$box:[[x1,y1],[x2,y2]]}</p>
<p>$center:圆形，{$center:[x,y],r}</p>
<p>$polygon:多边形，${polygon:[x1,y1],[x2,y2],[x3,y3]}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//查询在1,2:4,4中的点</div><div class="line">db.location.find(&#123;position:&#123;$geoWithin:&#123;$box:[[1,2],[4,4]]&#125;&#125;&#125;)</div><div class="line"></div><div class="line">//查询在圆心为1，1半径为5中的点</div><div class="line">db.location.find(&#123;position:&#123;$geoWithin:&#123;$center:[[1,1],5]&#125;&#125;&#125;)</div><div class="line"></div><div class="line">//查询在多边形中的点</div><div class="line">db.location.find(&#123;position:&#123;$geoWithin:&#123;$polygon:[[1,1],[2,3],[4,5],[100,50]]&#125;&#125;&#125;)</div></pre></td></tr></table></figure>
<h5 id="geoNear"><a href="#geoNear" class="headerlink" title="geoNear"></a>geoNear</h5><p>相当于是near的升级版。</p>
<p>在mongodb中可以使用runCommand执行一些命令，geoNear的使用方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">db.runCommand(</div><div class="line">&#123;</div><div class="line">	genoNear:集合名,</div><div class="line">	near:[x,y],</div><div class="line">	minDistance:值, //2d索引无效</div><div class="line">	maxDistance:值,</div><div class="line">	num:返回的条数</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.runCommand(&#123;geoNear:&quot;location&quot;,near:[1,2],maxDistance:10,num:3&#125;)</div></pre></td></tr></table></figure>
<p>返回：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;waitedMS&quot; : NumberLong(0),</div><div class="line">	&quot;results&quot; : [</div><div class="line">		&#123;</div><div class="line">			&quot;dis&quot; : 0,</div><div class="line">			&quot;obj&quot; : &#123;</div><div class="line">				&quot;_id&quot; : ObjectId(&quot;583aefba06570f2078e557bb&quot;),</div><div class="line">				&quot;position&quot; : [</div><div class="line">					1,</div><div class="line">					2</div><div class="line">				]</div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		&#123;</div><div class="line">			&quot;dis&quot; : 2, //距离我们制定的点，多远</div><div class="line">			&quot;obj&quot; : &#123; //真实的数据</div><div class="line">				&quot;_id&quot; : ObjectId(&quot;583aefbc06570f2078e557bc&quot;),</div><div class="line">				&quot;position&quot; : [</div><div class="line">					3,</div><div class="line">					2</div><div class="line">				]</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	],</div><div class="line">	&quot;stats&quot; : &#123;</div><div class="line">		&quot;nscanned&quot; : 41,</div><div class="line">		&quot;objectsLoaded&quot; : 2,</div><div class="line">		&quot;avgDistance&quot; : 1, //平均距离</div><div class="line">		&quot;maxDistance&quot; : 2, //最大距离</div><div class="line">		&quot;time&quot; : 4</div><div class="line">	&#125;,</div><div class="line">	&quot;ok&quot; : 1</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2dsphere索引"><a href="#2dsphere索引" class="headerlink" title="2dsphere索引"></a>2dsphere索引</h3><p>球面地理位置索引。创建方式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.location.ensureIndex(&#123;position:&quot;2dsphere&quot;&#125;)</div></pre></td></tr></table></figure>
<p>位置表示方式为：GeoJSON，可以描述为一个点，一条直线，多边形</p>
<p>//TODO</p>
<h1 id="索引分析"><a href="#索引分析" class="headerlink" title="索引分析"></a>索引分析</h1><p>好处：加快相关字段查询</p>
<p>坏处：增加磁盘空间消耗，降低写入性能</p>
<h2 id="如何评判索引构建情况"><a href="#如何评判索引构建情况" class="headerlink" title="如何评判索引构建情况"></a>如何评判索引构建情况</h2><h3 id="mongostat工具"><a href="#mongostat工具" class="headerlink" title="mongostat工具"></a>mongostat工具</h3><p>用来查看mongodb状态的工具，使用方式</p>
<p>与索引相关的字段为：idx miss百分比,太高有性能影响</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongostat -h 127.0.0.1:12345</div></pre></td></tr></table></figure>
<p>其中insert字段表示：插入数据</p>
<p>那怎么测试这值能，可以卡两个命令窗口，一边插入输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//插入10万条</div><div class="line">for(i=0;i&lt;100000;i++)db.c2.insert(&#123;x:i&#125;)</div></pre></td></tr></table></figure>
<p>另一个命令窗口查看状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongostat -h 127.0.0.1:12345</div></pre></td></tr></table></figure>
<p>返回：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">insert query update delete getmore command % dirty % used flushes vsize   res qr|qw ar|aw netIn netOut conn                      time</div><div class="line">  2531    *0     *0     *0       0     1|0     0.0    0.1       0 2.46G 13.0M   0|0   0|0  291k   122k    2 2016-11-27T23:53:57+08:00</div><div class="line">  2995    *0     *0     *0       0     1|0     0.1    0.1       0 2.46G 14.0M   0|0   0|0  344k   141k    2 2016-11-27T23:53:58+08:00</div><div class="line">  2873    *0     *0     *0       0     1|0     0.1    0.1       0 2.46G 15.0M   0|0   0|0  330k   136k    2 2016-11-27T23:53:59+08:00</div></pre></td></tr></table></figure>
<p>可以看到insert字段的值，改变了。</p>
<h3 id="profile集合"><a href="#profile集合" class="headerlink" title="profile集合"></a>profile集合</h3><p>慢操作值</p>
<p>注意：推荐只在开发，和测试阶段或上线观察阶段使用。</p>
<h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><p>可以在配置文件中使用verbose=vvvvv配置，v越多越详细。</p>
<h3 id="explain分析"><a href="#explain分析" class="headerlink" title="explain分析"></a>explain分析</h3><p><a href="http://www.cnblogs.com/c-abc/p/6023824.html" target="_blank" rel="external">http://www.cnblogs.com/c-abc/p/6023824.html</a></p>
<p>可以查看一个查询的详细信息，比如：耗时</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">db.c2.find(&#123;x:10000&#125;).explain() //2x</div><div class="line">db.c2.find(&#123;x:10000&#125;).explain(&quot;executionStats&quot;) //3x</div></pre></td></tr></table></figure>
<p>未创建索引时executionTimeMillis为51毫秒</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;queryPlanner&quot; : &#123;</div><div class="line">		&quot;plannerVersion&quot; : 1,</div><div class="line">		&quot;namespace&quot; : &quot;test.c2&quot;,</div><div class="line">		&quot;indexFilterSet&quot; : false,</div><div class="line">		&quot;parsedQuery&quot; : &#123;</div><div class="line">			&quot;x&quot; : &#123;</div><div class="line">				&quot;$eq&quot; : 10000</div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		&quot;winningPlan&quot; : &#123;</div><div class="line">			&quot;stage&quot; : &quot;COLLSCAN&quot;,</div><div class="line">			&quot;filter&quot; : &#123;</div><div class="line">				&quot;x&quot; : &#123;</div><div class="line">					&quot;$eq&quot; : 10000</div><div class="line">				&#125;</div><div class="line">			&#125;,</div><div class="line">			&quot;direction&quot; : &quot;forward&quot;</div><div class="line">		&#125;,</div><div class="line">		&quot;rejectedPlans&quot; : [ ]</div><div class="line">	&#125;,</div><div class="line">	&quot;executionStats&quot; : &#123;</div><div class="line">		&quot;executionSuccess&quot; : true,</div><div class="line">		&quot;nReturned&quot; : 1,</div><div class="line">		&quot;executionTimeMillis&quot; : 51,</div><div class="line">		&quot;totalKeysExamined&quot; : 0,</div><div class="line">		&quot;totalDocsExamined&quot; : 100014,</div><div class="line">		&quot;executionStages&quot; : &#123;</div><div class="line">			&quot;stage&quot; : &quot;COLLSCAN&quot;,</div><div class="line">			&quot;filter&quot; : &#123;</div><div class="line">				&quot;x&quot; : &#123;</div><div class="line">					&quot;$eq&quot; : 10000</div><div class="line">				&#125;</div><div class="line">			&#125;,</div><div class="line">			&quot;nReturned&quot; : 1,</div><div class="line">			&quot;executionTimeMillisEstimate&quot; : 50,</div><div class="line">			&quot;works&quot; : 100016,</div><div class="line">			&quot;advanced&quot; : 1,</div><div class="line">			&quot;needTime&quot; : 100014,</div><div class="line">			&quot;needYield&quot; : 0,</div><div class="line">			&quot;saveState&quot; : 781,</div><div class="line">			&quot;restoreState&quot; : 781,</div><div class="line">			&quot;isEOF&quot; : 1,</div><div class="line">			&quot;invalidates&quot; : 0,</div><div class="line">			&quot;direction&quot; : &quot;forward&quot;,</div><div class="line">			&quot;docsExamined&quot; : 100014</div><div class="line">		&#125;</div><div class="line">	&#125;,</div><div class="line">	&quot;serverInfo&quot; : &#123;</div><div class="line">		&quot;host&quot; : &quot;rmp.local&quot;,</div><div class="line">		&quot;port&quot; : 12345,</div><div class="line">		&quot;version&quot; : &quot;3.2.10&quot;,</div><div class="line">		&quot;gitVersion&quot; : &quot;79d9b3ab5ce20f51c272b4411202710a082d0317&quot;</div><div class="line">	&#125;,</div><div class="line">	&quot;ok&quot; : 1</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>创建索引后，为0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;queryPlanner&quot; : &#123;</div><div class="line">		&quot;plannerVersion&quot; : 1,</div><div class="line">		&quot;namespace&quot; : &quot;test.c2&quot;,</div><div class="line">		&quot;indexFilterSet&quot; : false,</div><div class="line">		&quot;parsedQuery&quot; : &#123;</div><div class="line">			&quot;x&quot; : &#123;</div><div class="line">				&quot;$eq&quot; : 10000</div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		&quot;winningPlan&quot; : &#123;</div><div class="line">			&quot;stage&quot; : &quot;FETCH&quot;,</div><div class="line">			&quot;inputStage&quot; : &#123;</div><div class="line">				&quot;stage&quot; : &quot;IXSCAN&quot;,</div><div class="line">				&quot;keyPattern&quot; : &#123;</div><div class="line">					&quot;x&quot; : 1</div><div class="line">				&#125;,</div><div class="line">				&quot;indexName&quot; : &quot;x_1&quot;,</div><div class="line">				&quot;isMultiKey&quot; : false,</div><div class="line">				&quot;isUnique&quot; : false,</div><div class="line">				&quot;isSparse&quot; : false,</div><div class="line">				&quot;isPartial&quot; : false,</div><div class="line">				&quot;indexVersion&quot; : 1,</div><div class="line">				&quot;direction&quot; : &quot;forward&quot;,</div><div class="line">				&quot;indexBounds&quot; : &#123;</div><div class="line">					&quot;x&quot; : [</div><div class="line">						&quot;[10000.0, 10000.0]&quot;</div><div class="line">					]</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		&quot;rejectedPlans&quot; : [ ]</div><div class="line">	&#125;,</div><div class="line">	&quot;executionStats&quot; : &#123;</div><div class="line">		&quot;executionSuccess&quot; : true,</div><div class="line">		&quot;nReturned&quot; : 1,</div><div class="line">		&quot;executionTimeMillis&quot; : 0,</div><div class="line">		&quot;totalKeysExamined&quot; : 1,</div><div class="line">		&quot;totalDocsExamined&quot; : 1,</div><div class="line">		&quot;executionStages&quot; : &#123;</div><div class="line">			&quot;stage&quot; : &quot;FETCH&quot;,</div><div class="line">			&quot;nReturned&quot; : 1,</div><div class="line">			&quot;executionTimeMillisEstimate&quot; : 0,</div><div class="line">			&quot;works&quot; : 2,</div><div class="line">			&quot;advanced&quot; : 1,</div><div class="line">			&quot;needTime&quot; : 0,</div><div class="line">			&quot;needYield&quot; : 0,</div><div class="line">			&quot;saveState&quot; : 0,</div><div class="line">			&quot;restoreState&quot; : 0,</div><div class="line">			&quot;isEOF&quot; : 1,</div><div class="line">			&quot;invalidates&quot; : 0,</div><div class="line">			&quot;docsExamined&quot; : 1,</div><div class="line">			&quot;alreadyHasObj&quot; : 0,</div><div class="line">			&quot;inputStage&quot; : &#123;</div><div class="line">				&quot;stage&quot; : &quot;IXSCAN&quot;,</div><div class="line">				&quot;nReturned&quot; : 1,</div><div class="line">				&quot;executionTimeMillisEstimate&quot; : 0,</div><div class="line">				&quot;works&quot; : 2,</div><div class="line">				&quot;advanced&quot; : 1,</div><div class="line">				&quot;needTime&quot; : 0,</div><div class="line">				&quot;needYield&quot; : 0,</div><div class="line">				&quot;saveState&quot; : 0,</div><div class="line">				&quot;restoreState&quot; : 0,</div><div class="line">				&quot;isEOF&quot; : 1,</div><div class="line">				&quot;invalidates&quot; : 0,</div><div class="line">				&quot;keyPattern&quot; : &#123;</div><div class="line">					&quot;x&quot; : 1</div><div class="line">				&#125;,</div><div class="line">				&quot;indexName&quot; : &quot;x_1&quot;,</div><div class="line">				&quot;isMultiKey&quot; : false,</div><div class="line">				&quot;isUnique&quot; : false,</div><div class="line">				&quot;isSparse&quot; : false,</div><div class="line">				&quot;isPartial&quot; : false,</div><div class="line">				&quot;indexVersion&quot; : 1,</div><div class="line">				&quot;direction&quot; : &quot;forward&quot;,</div><div class="line">				&quot;indexBounds&quot; : &#123;</div><div class="line">					&quot;x&quot; : [</div><div class="line">						&quot;[10000.0, 10000.0]&quot;</div><div class="line">					]</div><div class="line">				&#125;,</div><div class="line">				&quot;keysExamined&quot; : 1,</div><div class="line">				&quot;dupsTested&quot; : 0,</div><div class="line">				&quot;dupsDropped&quot; : 0,</div><div class="line">				&quot;seenInvalidated&quot; : 0</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;,</div><div class="line">	&quot;serverInfo&quot; : &#123;</div><div class="line">		&quot;host&quot; : &quot;rmp.local&quot;,</div><div class="line">		&quot;port&quot; : 12345,</div><div class="line">		&quot;version&quot; : &quot;3.2.10&quot;,</div><div class="line">		&quot;gitVersion&quot; : &quot;79d9b3ab5ce20f51c272b4411202710a082d0317&quot;</div><div class="line">	&#125;,</div><div class="line">	&quot;ok&quot; : 1</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h1><p>物理隔离</p>
<p>网络隔离</p>
<p>防火墙</p>
<h2 id="用户名密码"><a href="#用户名密码" class="headerlink" title="用户名密码"></a>用户名密码</h2><p>开启权限认证有两种方式</p>
<h3 id="auth"><a href="#auth" class="headerlink" title="auth"></a>auth</h3><p>是在配置文件中加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">auth=true</div></pre></td></tr></table></figure>
<p>然后重启服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ps -ef | grep mongd | grep 12345</div><div class="line">kill 1233</div></pre></td></tr></table></figure>
<p>重启后我们查看tail log/mongod.log可以看到security: { authorization: “enabled” }，表示已经开启。</p>
<p>但现在我们还可以连接，因为我们还没有创建用户名和密码。</p>
<h3 id="keyfile"><a href="#keyfile" class="headerlink" title="keyfile"></a>keyfile</h3><h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><p>参考：<a href="http://blog.csdn.net/chen88358323/article/details/50206651" target="_blank" rel="external">http://blog.csdn.net/chen88358323/article/details/50206651</a></p>
<p>2.6版本之前使用addUser，只用使用createUser，语法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	user:username,</div><div class="line">	pwd:pwd,</div><div class="line">	customData:&#123;自定义的描述信息&#125;,</div><div class="line">	roles:[&#123;role:角色,db:数据库&#125;]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>内建角色类型：</p>
<p>read,readWrite(只能读写，不能创建索引这些操作),dbAdmin,dbOwner,userAdmin(管理用户，创建用户)</p>

      
    </div>
    
    <div>
      
        
<div id="wechat_subscriber" style="display: block； padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/uploads/wechat-qcode.jpg" alt="任苹蜻 wechat" style="width: 200px; max-width: 100%;"/>
    <div>欢迎您扫一扫上面的微信公众号，订阅我的博客！</div>
</div>

      
    </div>

    <div>
      
        
<div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton", disable="enable", onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}", style="cursor: pointer; border: 0; outline: 0; border-radius: 100%; padding: 0; margin: 0; letter-spacing: normal; text-transform: none; text-indent: 0px; text-shadow: none">
    <span onmouseover="this.style.color='rgb(236,96,0)';this.style.background='rgb(204,204,204)'" onMouseOut="this.style.color='#fff';this.style.background='rgb(236,96,0)'" style="display: inline-block; width: 70px; height: 70px; border-radius: 100%; line-height: 81px; color: #fff; font: 400 35px/75px 'microsofty'; background: rgb(236,96,0)">赏</span>
  </button>
  <div id="QR" style="display: none;">
    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/wechat-reward-image.png" alt="任苹蜻 WeChat Pay" style="width: 200px; max-width: 100%; display: inline-block"/>
        <p>微信打赏</p>
      </div>
    
    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/uploads/alipay-reward-image.png" alt="任苹蜻 Alipay" style="width: 200px; max-width: 100%; display: inline-block"/>
        <p>支付宝打赏</p>
      </div>
    
  </div>
</div>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/MongoDB/" rel="tag">#MongoDB</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/23/nodejs/" rel="next" title="NodeJs">
                <i class="fa fa-chevron-left"></i> NodeJs
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/12/01/android-studio/" rel="prev" title="AndroidStudio">
                AndroidStudio <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2016/11/27/mongodb/"
     data-title="MongoDB"
     data-content=""
     data-url="http://i.woblog.cn/2016/11/27/mongodb/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          

  <p>热评文章</p>
  <div class="ds-top-threads" data-range="weekly" data-num-items="4"></div>


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/11/27/mongodb/"
           data-title="MongoDB" data-url="http://i.woblog.cn/2016/11/27/mongodb/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://tp4.sinaimg.cn/1662907603/180/5755316418/1"
               alt="任苹蜻" />
          <p class="site-author-name" itemprop="name">任苹蜻</p>
          <p class="site-description motion-element" itemprop="description">关注移动开发，大数据，云计算，软件架构（原博客：http://me.woblog.cn/）</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">62</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">29</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">86</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://www.weibo.com/renpingqing1993" target="_blank" title="Weibo">
                  
                    <i class="fa fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/lifengsofts/" target="_blank" title="GitHub">
                  
                    <i class="fa fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/2cb78e578e43/latest_articles" target="_blank" title="Jianshu">
                  
                    <i class="fa fa-Jianshu"></i>
                  
                  Jianshu
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element">
            <div class="links-of-blogroll-title">Links</div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://macshuo.com/" title="MacTalk" target="_blank">MacTalk</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://example.com/" title="Title" target="_blank">Title</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#为什么学mongodb"><span class="nav-number">1.</span> <span class="nav-text">为什么学mongodb</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#优势"><span class="nav-number">1.1.</span> <span class="nav-text">优势</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#无标结构限制"><span class="nav-number">1.1.1.</span> <span class="nav-text">无标结构限制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#完成的索引支持"><span class="nav-number">1.1.2.</span> <span class="nav-text">完成的索引支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方便的冗余和扩展"><span class="nav-number">1.1.3.</span> <span class="nav-text">方便的冗余和扩展</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#良好的支持"><span class="nav-number">1.1.4.</span> <span class="nav-text">良好的支持</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#相关工具"><span class="nav-number">1.2.</span> <span class="nav-text">相关工具</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#常用学习网站"><span class="nav-number">2.</span> <span class="nav-text">常用学习网站</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据库概念"><span class="nav-number">3.</span> <span class="nav-text">数据库概念</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据库分类"><span class="nav-number">4.</span> <span class="nav-text">数据库分类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装Mongodb"><span class="nav-number">5.</span> <span class="nav-text">安装Mongodb</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#mac"><span class="nav-number">5.1.</span> <span class="nav-text">mac</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#常用命令"><span class="nav-number">6.</span> <span class="nav-text">常用命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#搭建一个简单的数据库服务器"><span class="nav-number">7.</span> <span class="nav-text">搭建一个简单的数据库服务器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#创建配置文件"><span class="nav-number">7.1.</span> <span class="nav-text">创建配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动数据库服务器"><span class="nav-number">7.2.</span> <span class="nav-text">启动数据库服务器</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#连接mongo"><span class="nav-number">8.</span> <span class="nav-text">连接mongo</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#使用mongo命令"><span class="nav-number">8.1.</span> <span class="nav-text">使用mongo命令</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#关闭mongo服务"><span class="nav-number">9.</span> <span class="nav-text">关闭mongo服务</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#基本使用"><span class="nav-number">10.</span> <span class="nav-text">基本使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#增删改查"><span class="nav-number">10.1.</span> <span class="nav-text">增删改查</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#索引"><span class="nav-number">11.</span> <span class="nav-text">索引</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#查看索引"><span class="nav-number">11.1.</span> <span class="nav-text">查看索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建索引"><span class="nav-number">11.2.</span> <span class="nav-text">创建索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#id索引"><span class="nav-number">11.3.</span> <span class="nav-text">_id索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#单键"><span class="nav-number">11.3.1.</span> <span class="nav-text">单键</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多键索引"><span class="nav-number">11.4.</span> <span class="nav-text">多键索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#复合索引"><span class="nav-number">11.5.</span> <span class="nav-text">复合索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#过期索引"><span class="nav-number">11.6.</span> <span class="nav-text">过期索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#全文索引"><span class="nav-number">11.7.</span> <span class="nav-text">全文索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用全文索引查询"><span class="nav-number">11.7.1.</span> <span class="nav-text">使用全文索引查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#全文查询相似度"><span class="nav-number">11.7.2.</span> <span class="nav-text">全文查询相似度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#限制"><span class="nav-number">11.7.3.</span> <span class="nav-text">限制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引属性"><span class="nav-number">11.8.</span> <span class="nav-text">索引属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#name名称"><span class="nav-number">11.8.1.</span> <span class="nav-text">name名称</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unique唯一性"><span class="nav-number">11.8.2.</span> <span class="nav-text">unique唯一性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#稀疏性"><span class="nav-number">11.9.</span> <span class="nav-text">稀疏性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#删除索引"><span class="nav-number">11.10.</span> <span class="nav-text">删除索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#地理位置索引"><span class="nav-number">11.11.</span> <span class="nav-text">地理位置索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2d索引"><span class="nav-number">11.11.1.</span> <span class="nav-text">2d索引</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#查询方式"><span class="nav-number">11.11.1.1.</span> <span class="nav-text">查询方式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#near"><span class="nav-number">11.11.1.1.1.</span> <span class="nav-text">near</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#geoNear"><span class="nav-number">11.11.1.1.2.</span> <span class="nav-text">geoNear</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2dsphere索引"><span class="nav-number">11.11.2.</span> <span class="nav-text">2dsphere索引</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#索引分析"><span class="nav-number">12.</span> <span class="nav-text">索引分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#如何评判索引构建情况"><span class="nav-number">12.1.</span> <span class="nav-text">如何评判索引构建情况</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#mongostat工具"><span class="nav-number">12.1.1.</span> <span class="nav-text">mongostat工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#profile集合"><span class="nav-number">12.1.2.</span> <span class="nav-text">profile集合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#日志"><span class="nav-number">12.1.3.</span> <span class="nav-text">日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#explain分析"><span class="nav-number">12.1.4.</span> <span class="nav-text">explain分析</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安全"><span class="nav-number">13.</span> <span class="nav-text">安全</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#用户名密码"><span class="nav-number">13.1.</span> <span class="nav-text">用户名密码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#auth"><span class="nav-number">13.1.1.</span> <span class="nav-text">auth</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#keyfile"><span class="nav-number">13.1.2.</span> <span class="nav-text">keyfile</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建用户"><span class="nav-number">13.2.</span> <span class="nav-text">创建用户</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">任苹蜻</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"iwoblog"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  

  

</body>
</html>
