<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>任苹蜻的博客</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://i.woblog.cn/"/>
  <updated>2017-03-19T14:22:37.668Z</updated>
  <id>http://i.woblog.cn/</id>
  
  <author>
    <name>任苹蜻</name>
    <email>30234@163.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Sublime</title>
    <link href="http://i.woblog.cn/2017/03/19/sublime/"/>
    <id>http://i.woblog.cn/2017/03/19/sublime/</id>
    <published>2017-03-19T14:22:37.668Z</published>
    <updated>2017-03-19T14:22:37.668Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><a href="http://www.sublimetext.com" target="_blank" rel="external">http://www.sublimetext.com</a></p>
<h2 id="编辑"><a href="#编辑" class="headerlink" title="编辑"></a>编辑</h2><p>command+]:缩进</p>
<p>command+[:左缩进</p>
<p>command+shift+d:复制一行</p>
<p>control+shift+k:删除一行</p>
<p>command+shift+回车：在当前行前面插入一行</p>
<p>command+回车：在当前行后面插入一行</p>
<p>control+delete:从当前光标删除到行首</p>
<p>command+k：从当前光标删除到行尾</p>
<p>control+t:将光标两边的字母交换位置</p>
<h1 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h1><p>command+d:选择一个单词</p>
<p>command+l:选择一行</p>
<p>control+shift+上：将上一行添加到多行编辑</p>
<p>control+shift+下：将下一行添加到多行编辑</p>
<h1 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h1><p>command+/:添加或删除注释</p>
<p>command+option+/:添加或删除块注释</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;http://www.sublimetext.com&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ht
    
    </summary>
    
      <category term="Sublime" scheme="http://i.woblog.cn/categories/Sublime/"/>
    
    
      <category term="Sublime" scheme="http://i.woblog.cn/tags/Sublime/"/>
    
  </entry>
  
  <entry>
    <title>DrawerLayout</title>
    <link href="http://i.woblog.cn/2017/03/06/android-drawerlayout/"/>
    <id>http://i.woblog.cn/2017/03/06/android-drawerlayout/</id>
    <published>2017-03-06T21:23:04.000Z</published>
    <updated>2017-03-19T14:22:37.664Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compile &apos;com.android.support:appcompat-v7:25.1.0&apos;</div></pre></td></tr></table></figure>
<p>布局</p>
<p>这种布局是，侧滑不盖住toolbar</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line"></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/tb"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@color/colorPrimary"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v4.widget.DrawerLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/dl"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.ls_md_drawerlayout.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    <span class="comment">&lt;!--内容--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:background</span>=<span class="string">"#0f0"</span></div><div class="line">      <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">      <span class="comment">&lt;!--&lt;android.support.v7.widget.Toolbar--&gt;</span></div><div class="line">      <span class="comment">&lt;!--android:layout_width="match_parent"--&gt;</span></div><div class="line">      <span class="comment">&lt;!--android:id="@+id/tb"--&gt;</span></div><div class="line">      <span class="comment">&lt;!--android:background="@color/colorPrimary"--&gt;</span></div><div class="line">      <span class="comment">&lt;!--android:layout_height="wrap_content"&gt;&lt;/android.support.v7.widget.Toolbar&gt;--&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"我是内容"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--我是侧滑--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_gravity</span>=<span class="string">"start"</span></div><div class="line">      <span class="attr">android:background</span>=<span class="string">"#00f"</span></div><div class="line">      <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"item1"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"item1"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"item1"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">android.support.v4.widget.DrawerLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>盖住toolbar</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line"></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v4.widget.DrawerLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/dl"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.ls_md_drawerlayout.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    <span class="comment">&lt;!--内容--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:background</span>=<span class="string">"#0f0"</span></div><div class="line">      <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">      <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/tb"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"@color/colorPrimary"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"我是内容"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--我是侧滑--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_gravity</span>=<span class="string">"start"</span></div><div class="line">      <span class="attr">android:background</span>=<span class="string">"#00f"</span></div><div class="line">      <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"item1"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"item1"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"item1"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">android.support.v4.widget.DrawerLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>现在就有侧滑效果了。</p>
<p>添加toolbar menu效果</p>
<p>在代码中找到，并设置为actionBar</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Toolbar tb = (Toolbar) findViewById(R.id.tb);</div><div class="line">DrawerLayout dl = (DrawerLayout) findViewById(R.id.dl);</div><div class="line"></div><div class="line">setSupportActionBar(tb);</div><div class="line">ActionBarDrawerToggle actionBarDrawerToggle = <span class="keyword">new</span> ActionBarDrawerToggle(<span class="keyword">this</span>,dl,tb,R.string.drawer_open, R.string.drawer_close);</div><div class="line"></div><div class="line"><span class="comment">//同步状态</span></div><div class="line">actionBarDrawerToggle.syncState();</div><div class="line"></div><div class="line">dl.addDrawerListener(actionBarDrawerToggle);</div></pre></td></tr></table></figure>
<p>左右都侧滑，只需要在原有的菜单下面在添加一个菜单布局，然后android:layout_gravity=”end”</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line"></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v4.widget.DrawerLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/dl"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.ls_md_drawerlayout.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    <span class="comment">&lt;!--内容--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:background</span>=<span class="string">"#0f0"</span></div><div class="line">      <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">      <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/tb"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:background</span>=<span class="string">"@color/colorPrimary"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"我是内容"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--我是侧滑--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_gravity</span>=<span class="string">"start"</span></div><div class="line">      <span class="attr">android:background</span>=<span class="string">"#00f"</span></div><div class="line">      <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"item1"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"item1"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"item1"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--我是右边的侧滑--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_gravity</span>=<span class="string">"end"</span></div><div class="line">      <span class="attr">android:background</span>=<span class="string">"#00f"</span></div><div class="line">      <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"item20"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"item21"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"50dp"</span></div><div class="line">        <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"item22"</span></div><div class="line">        <span class="attr">android:textColor</span>=<span class="string">"#f00"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">android.support.v4.widget.DrawerLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>实现大概qq的效果,起始就是menu从小放大，并移动，内容缩小，右边移动</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//实现类似qq旧版侧滑</span></div><div class="line">dl.addDrawerListener(<span class="keyword">new</span> DrawerListener() &#123;</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDrawerSlide</span><span class="params">(View drawerView, <span class="keyword">float</span> slideOffset)</span> </span>&#123;</div><div class="line">    <span class="comment">//抽屉滑动的时候，调用，0~1</span></div><div class="line"></div><div class="line">    <span class="keyword">float</span> scale=<span class="number">1</span>-slideOffset;  <span class="comment">//1~0;</span></div><div class="line"></div><div class="line">    <span class="keyword">float</span> leftScale= (<span class="keyword">float</span>) (<span class="number">1</span>-scale*<span class="number">0.3</span>); <span class="comment">//scale*0.3,就将这个scale缩小到了0.3~0中，然后1-这个值，就是0.7~1</span></div><div class="line">    ll_left_men_container.setScaleX(leftScale); <span class="comment">//从小到大，0.7~1</span></div><div class="line">    ll_left_men_container.setScaleY(leftScale); <span class="comment">//从小到大，0.7~1</span></div><div class="line"></div><div class="line">    <span class="keyword">float</span> rightScale= (<span class="keyword">float</span>) (<span class="number">0.7</span>+scale*<span class="number">0.3</span>);</div><div class="line"></div><div class="line">    <span class="comment">//内容布局，缩放，0.7~1</span></div><div class="line">    ll_content_container.setScaleX(rightScale);</div><div class="line">    ll_content_container.setScaleY(rightScale);</div><div class="line"></div><div class="line">    <span class="comment">// 右移动,0~width*0.3</span></div><div class="line">    <span class="keyword">float</span> translation= (<span class="keyword">float</span>) (ll_content_container.getMeasuredWidth()*(slideOffset*<span class="number">0.3</span>));</div><div class="line">    ll_content_container.setTranslationX(translation);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDrawerOpened</span><span class="params">(View drawerView)</span> </span>&#123;</div><div class="line">    <span class="comment">//完全打开</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDrawerClosed</span><span class="params">(View drawerView)</span> </span>&#123;</div><div class="line"><span class="comment">//完全关闭</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDrawerStateChanged</span><span class="params">(<span class="keyword">int</span> newState)</span> </span>&#123;</div><div class="line"><span class="comment">//状态改变，比如现在是打开，然后关闭了</span></div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//    或者，内容右移动菜单的宽度</span></div><div class="line">ll_content_container.setTranslationX(ll_left_men_container.getMeasuredWidth()*slideOffset);</div></pre></td></tr></table></figure>
<p>android:layout_gravity=”start”,一定要设置这个属性</p>
<h1 id="NavigationView"><a href="#NavigationView" class="headerlink" title="NavigationView"></a>NavigationView</h1><p>谷歌侧滑的View。一种规范，用来规范侧滑的样式</p>
<p>Design包中。使用NavigationView，依赖design，recycelerView,CardView。外层还是DrawerLayout，这是Activity布局</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">android.support.v4.widget.DrawerLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line"></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:fitsSystemWindows</span>=<span class="string">"true"</span></div><div class="line">  <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.ls_md_drawerlayout.NavigationActivity"</span>&gt;</div><div class="line"></div><div class="line">  <span class="comment">&lt;!--内容--&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">RelativeLayout</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;<span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.design.widget.NavigationView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_gravity</span>=<span class="string">"start"</span></div><div class="line">    <span class="attr">app:headerLayout</span>=<span class="string">"@layout/header_menu"</span></div><div class="line">    <span class="attr">app:menu</span>=<span class="string">"@menu/navigation_menu"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.design.widget.NavigationView</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">android.support.v4.widget.DrawerLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>NavigationView引用了一个菜单和header_menu，header_menu就是一个常规布局用于显示到Item上方。</p>
<p>menu和普通的menu写法一样</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">item</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/menu_1"</span></div><div class="line">    <span class="attr">android:icon</span>=<span class="string">"@android:drawable/ic_menu_add"</span></div><div class="line">    <span class="attr">android:orderInCategory</span>=<span class="string">"100"</span></div><div class="line">    <span class="attr">android:title</span>=<span class="string">"add"</span> /&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">item</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/menu_2"</span></div><div class="line">    <span class="attr">android:icon</span>=<span class="string">"@android:drawable/ic_menu_agenda"</span></div><div class="line">    <span class="attr">android:orderInCategory</span>=<span class="string">"100"</span></div><div class="line">    <span class="attr">android:title</span>=<span class="string">"agenda"</span> /&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">item</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/menu_3"</span></div><div class="line">    <span class="attr">android:icon</span>=<span class="string">"@android:drawable/ic_menu_call"</span></div><div class="line">    <span class="attr">android:orderInCategory</span>=<span class="string">"100"</span></div><div class="line">    <span class="attr">android:title</span>=<span class="string">"call"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></div></pre></td></tr></table></figure>
<p>还可以有子菜单</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">item</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/menu_1"</span></div><div class="line">    <span class="attr">android:icon</span>=<span class="string">"@android:drawable/ic_menu_add"</span></div><div class="line">    <span class="attr">android:orderInCategory</span>=<span class="string">"100"</span></div><div class="line">    <span class="attr">android:title</span>=<span class="string">"add"</span> /&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">item</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/menu_2"</span></div><div class="line">    <span class="attr">android:icon</span>=<span class="string">"@android:drawable/ic_menu_agenda"</span></div><div class="line">    <span class="attr">android:orderInCategory</span>=<span class="string">"100"</span></div><div class="line">    <span class="attr">android:title</span>=<span class="string">"agenda"</span> /&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">item</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/menu_3"</span></div><div class="line">    <span class="attr">android:icon</span>=<span class="string">"@android:drawable/ic_menu_call"</span></div><div class="line">    <span class="attr">android:orderInCategory</span>=<span class="string">"100"</span></div><div class="line">    <span class="attr">android:title</span>=<span class="string">"call"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">menu</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">item</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/menu_31"</span></div><div class="line">        <span class="attr">android:icon</span>=<span class="string">"@android:drawable/ic_menu_agenda"</span></div><div class="line">        <span class="attr">android:orderInCategory</span>=<span class="string">"100"</span></div><div class="line">        <span class="attr">android:title</span>=<span class="string">"agenda"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;/<span class="name">menu</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></div></pre></td></tr></table></figure>
<h1 id="SnackBar"><a href="#SnackBar" class="headerlink" title="SnackBar"></a>SnackBar</h1><p>一个新的toast，和Dialog中间的产物。design中s</p>
<p>Toast:用户无法交互</p>
<p>Dialog:打断用户。</p>
<p>他结合了两种</p>
<p>基本使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">Snackbar s=Snackbar.make(view,<span class="string">"打开GPS?"</span>,Snackbar.LENGTH_LONG);</div><div class="line"><span class="comment">//按钮，不能设置多个，后面的覆盖前面的</span></div><div class="line">s.setAction(<span class="string">"确定"</span>, <span class="keyword">new</span> OnClickListener() &#123;</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">    showToast(<span class="keyword">null</span>);</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"><span class="comment">//监听关闭，打开</span></div><div class="line">s.addCallback(<span class="keyword">new</span> Callback()&#123;</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onShown</span><span class="params">(Snackbar sb)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onShown(sb);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDismissed</span><span class="params">(Snackbar transientBottomBar, <span class="keyword">int</span> event)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onDismissed(transientBottomBar, event);</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">//按钮颜色</span></div><div class="line">s.setActionTextColor(Color.RED);</div><div class="line"></div><div class="line">s.show();</div></pre></td></tr></table></figure>
<p>Android Resource Navigator：源码查看器</p>
<p>Android SDK Search:</p>
<p>如果想更改消息的颜色，可以通过更改项目的样式</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textSize"</span>&gt;</span>@dimen/design_snackbar_text_size<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textColor"</span>&gt;</span>?android:textColorPrimary<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div></pre></td></tr></table></figure>
<p>但是这样就更改了全局样式。</p>
<h1 id="TextInputLayout"><a href="#TextInputLayout" class="headerlink" title="TextInputLayout"></a>TextInputLayout</h1><p>带提示的信息的EditText</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.TextInputLayout</span></span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">app:hintAnimationEnabled</span>=<span class="string">"false"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</div><div class="line">  <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:hint</span>=<span class="string">"请输入密码"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.TextInputLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>app:hintAnimationEnabled=”false”：是否开启提示文字动画</p>
<p>app:errorEnabled=”true”:是否开启错误提示，但是你的自定义什么错误</p>
<p> app:counterOverflowTextAppearance=””  超出字符数文字样式</p>
<p>app:counterTextAppearance=””<br>app:errorTextAppearance=””</p>
<p>计数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">til = (TextInputLayout) findViewById(R.id.til);</div><div class="line"><span class="comment">//    til.getEditText().addTextChangedListener();</span></div><div class="line"></div><div class="line">    <span class="comment">//计数</span></div><div class="line">    til.setCounterEnabled(<span class="keyword">true</span>);</div><div class="line">    til.setCounterMaxLength(<span class="number">10</span>);</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">til.getEditText().addTextChangedListener(<span class="keyword">new</span> MinLengthTextWatch(til,<span class="string">"长度应低于6"</span>));</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//自定义错误</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinLengthTextWatch</span> <span class="keyword">implements</span> <span class="title">TextWatcher</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TextInputLayout textInputLayout;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String message;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MinLengthTextWatch</span><span class="params">(TextInputLayout textInputLayout,String message)</span> </span>&#123;</div><div class="line">      <span class="keyword">this</span>.textInputLayout=textInputLayout;</div><div class="line">      <span class="keyword">this</span>.message=message;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> count, <span class="keyword">int</span> after)</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTextChanged</span><span class="params">(CharSequence s, <span class="keyword">int</span> start, <span class="keyword">int</span> before, <span class="keyword">int</span> count)</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterTextChanged</span><span class="params">(Editable s)</span> </span>&#123;</div><div class="line">      <span class="keyword">if</span> (textInputLayout.getEditText().getText().toString().length() &lt;= <span class="number">6</span>) &#123;</div><div class="line">        textInputLayout.setErrorEnabled(<span class="keyword">false</span>);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        textInputLayout.setErrorEnabled(<span class="keyword">true</span>);</div><div class="line">        textInputLayout.setError(message);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="ToolBar"><a href="#ToolBar" class="headerlink" title="ToolBar"></a>ToolBar</h1><p>ActionBar:3.0,也就是兼容包,google规范了导航，但是不好用，扩展性不好。多数人用民间ActionBar，是SherlockActionBar,后面google重新定义了ToolBar,在MD中有AppBar</p>
<p>作用：导航-显示标题，导航back，会计操作，操蛋，toolbar不一定放在顶部，也可以底部</p>
<p>使用：</p>
<p>1.引入v7-appcompat</p>
<p>2.使用appcompatActivity</p>
<p>3.修改主题为Theme.AppCompat.Light.NoActionBar</p>
<p>4.然后在布局中添加Toolbar</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">android:id</span>=<span class="string">"@+id/activity_main"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.l10_md_toolbar.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/tb"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"?attr/colorPrimary"</span></div><div class="line">    <span class="attr">app:logo</span>=<span class="string">"@mipmap/ic_launcher"</span></div><div class="line">    <span class="attr">app:navigationIcon</span>=<span class="string">"@android:drawable/ic_menu_upload"</span></div><div class="line">    <span class="attr">app:subtitle</span>=<span class="string">"副标题"</span></div><div class="line">    <span class="attr">app:title</span>=<span class="string">"这是标题"</span>&gt;</div><div class="line">    <span class="comment">&lt;!--&lt;TextView--&gt;</span></div><div class="line">      <span class="comment">&lt;!--android:layout_width="wrap_content"--&gt;</span></div><div class="line">      <span class="comment">&lt;!--android:layout_height="wrap_content"--&gt;</span></div><div class="line">      <span class="comment">&lt;!--android:layout_gravity="center"--&gt;</span></div><div class="line">      <span class="comment">&lt;!--android:text="这是其他文本" /&gt;--&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>5.替换默认的actionBar</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Toolbar tb= (Toolbar) findViewById(R.id.tb);</div><div class="line">    setSupportActionBar(tb);</div></pre></td></tr></table></figure>
<p>//text 默认覆盖了 toolbar的字</p>
<p>监听返回按钮</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">tb.setNavigationOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">        finish();</div><div class="line">      &#125;</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<p>app:popupTheme=”@style/ThemeOverlay.AppCompat.Dark”:修改弹出窗体也就是右上角菜单的样式</p>
<h1 id="SearchView"><a href="#SearchView" class="headerlink" title="SearchView"></a>SearchView</h1><p>可以实现在Toolbar上显示一个搜索框</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span>&gt;</div><div class="line"></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">item</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/menu_search"</span></div><div class="line">    <span class="attr">app:actionViewClass</span>=<span class="string">"android.support.v7.widget.SearchView"</span></div><div class="line">    <span class="attr">android:icon</span>=<span class="string">"@android:drawable/ic_menu_search"</span></div><div class="line">    <span class="attr">android:title</span>=<span class="string">"搜索"</span></div><div class="line">    <span class="attr">app:showAsAction</span>=<span class="string">"always"</span> /&gt;</div><div class="line">  <span class="tag">&lt;<span class="name">item</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/menu_share"</span></div><div class="line">    <span class="attr">android:icon</span>=<span class="string">"@android:drawable/ic_menu_share"</span></div><div class="line">    <span class="attr">android:title</span>=<span class="string">"分享"</span> /&gt;</div><div class="line">  <span class="tag">&lt;<span class="name">item</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/menu_more"</span></div><div class="line">    <span class="attr">android:icon</span>=<span class="string">"@android:drawable/ic_menu_more"</span></div><div class="line">    <span class="attr">android:title</span>=<span class="string">"更多"</span></div><div class="line">    <span class="attr">app:showAsAction</span>=<span class="string">"never"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></div></pre></td></tr></table></figure>
<p>然后在activity中添加，显示menu，还可以设置一些监听器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.woblog.android.l10_md_toolbar;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.graphics.Color;</div><div class="line"><span class="keyword">import</span> android.support.v4.view.MenuItemCompat;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.SearchView;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.SearchView.OnQueryTextListener;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.SearchView.SearchAutoComplete;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.Toolbar;</div><div class="line"><span class="keyword">import</span> android.view.Menu;</div><div class="line"><span class="keyword">import</span> android.view.MenuItem;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.View.OnClickListener;</div><div class="line"><span class="keyword">import</span> android.view.View.OnFocusChangeListener;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">    Toolbar tb= (Toolbar) findViewById(R.id.tb);</div><div class="line">    setSupportActionBar(tb);</div><div class="line"></div><div class="line">    tb.setNavigationOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">        finish();</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreateOptionsMenu</span><span class="params">(Menu menu)</span> </span>&#123;</div><div class="line">    getMenuInflater().inflate(R.menu.menu_main,menu);</div><div class="line">    <span class="comment">//SearchView在menu中</span></div><div class="line">    MenuItem item = menu.findItem(R.id.menu_search);</div><div class="line">    SearchView searchView = (SearchView) MenuItemCompat.getActionView(item);</div><div class="line">    <span class="comment">//进来就呈现搜索框</span></div><div class="line"><span class="comment">//    searchView.setIconified(false);</span></div><div class="line">    <span class="comment">//不能取消这个搜索框</span></div><div class="line"><span class="comment">//    searchView.setIconifiedByDefault(false);</span></div><div class="line"></div><div class="line">    <span class="comment">//自定义扩展,更改提示和颜色</span></div><div class="line">    SearchView.SearchAutoComplete searchEditTextView = (SearchAutoComplete) searchView.findViewById(R.id.search_src_text);</div><div class="line">    searchEditTextView.setHint(<span class="string">"请输入商品名称"</span>);</div><div class="line">    searchEditTextView.setHintTextColor(Color.WHITE);</div><div class="line"></div><div class="line">  searchView.setSubmitButtonEnabled(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">    <span class="comment">//想AutoCompleteTextView提示</span></div><div class="line"><span class="comment">//    searchView.setSuggestionsAdapter();</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//进入查询</span></div><div class="line">    searchView.setOnQueryTextFocusChangeListener(<span class="keyword">new</span> OnFocusChangeListener() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFocusChange</span><span class="params">(View v, <span class="keyword">boolean</span> hasFocus)</span> </span>&#123;</div><div class="line"></div><div class="line"></div><div class="line">      &#125;</div><div class="line"></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="comment">//关闭</span></div><div class="line"><span class="comment">//    searchView.setOnCloseListener();</span></div><div class="line">    <span class="comment">//搜索按钮</span></div><div class="line"><span class="comment">//    searchView.setOnSearchClickListener(/);</span></div><div class="line"></div><div class="line">    <span class="comment">//文本变化</span></div><div class="line">    searchView.setOnQueryTextListener(<span class="keyword">new</span> OnQueryTextListener() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onQueryTextSubmit</span><span class="params">(String query)</span> </span>&#123;</div><div class="line">        <span class="comment">//点击提交时</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onQueryTextChange</span><span class="params">(String newText)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onCreateOptionsMenu(menu);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</div><div class="line">    <span class="keyword">switch</span> (item.getItemId()) &#123;</div><div class="line">      <span class="keyword">case</span> R.id.menu_share:</div><div class="line">        Toast.makeText(<span class="keyword">this</span>, <span class="string">"share"</span>, Toast.LENGTH_SHORT).show();</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="滑动是状态栏变透明"><a href="#滑动是状态栏变透明" class="headerlink" title="滑动是状态栏变透明"></a>滑动是状态栏变透明</h1><p>重点：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">android:paddingTop=&quot;?attr/actionBarSize&quot; //padding</div><div class="line">android:clipToPadding=&quot;false&quot; //绘制范围是否在padding里面，</div><div class="line">android:clipChildren=&quot;false&quot; //子控件是否超出padding区域</div></pre></td></tr></table></figure>
<p>布局</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">android:id</span>=<span class="string">"@+id/activity_main"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.l10_md_toolbar_translucent.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">cn.woblog.android.l10_md_toolbar_translucent.MyScrollView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/sv"</span></div><div class="line">    <span class="attr">android:paddingTop</span>=<span class="string">"?attr/actionBarSize"</span></div><div class="line">    <span class="attr">android:clipToPadding</span>=<span class="string">"false"</span></div><div class="line">    <span class="attr">android:clipChildren</span>=<span class="string">"false"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.LinearLayoutCompat</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line"></div><div class="line">      <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line"></div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">Button</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"button"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">android.support.v7.widget.LinearLayoutCompat</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">cn.woblog.android.l10_md_toolbar_translucent.MyScrollView</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/tb"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"?attr/colorPrimary"</span></div><div class="line">    <span class="attr">app:title</span>=<span class="string">"标题"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>自定义scrollView</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.woblog.android.l10_md_toolbar_translucent;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.widget.ScrollView;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by renpingqing on 2017/3/10.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyScrollView</span> <span class="keyword">extends</span> <span class="title">ScrollView</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span>  ScrollListener scrollListener;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScrollListener</span><span class="params">(ScrollListener scrollListener)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.scrollListener = scrollListener;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MyScrollView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(context, attrs);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onScrollChanged</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> oldl, <span class="keyword">int</span> oldt)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onScrollChanged(l, t, oldl, oldt);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (scrollListener != <span class="keyword">null</span>) &#123;</div><div class="line"></div><div class="line"><span class="comment">//      滑出去的高度/屏幕高度</span></div><div class="line">      <span class="keyword">int</span> scrollY=getScrollY();</div><div class="line">      <span class="keyword">int</span> height=getContext().getResources().getDisplayMetrics().heightPixels;</div><div class="line"></div><div class="line">      <span class="keyword">double</span> v = height * <span class="number">1.0</span> / <span class="number">3.0</span>;</div><div class="line">      <span class="keyword">if</span> (scrollY&lt;= v) &#123;</div><div class="line">        scrollListener.onScroll((<span class="keyword">float</span>) (<span class="number">1</span>- (scrollY*<span class="number">1.0</span>/v))); <span class="comment">//1~0</span></div><div class="line">      &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.woblog.android.l10_md_toolbar_translucent;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.Toolbar;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> <span class="keyword">implements</span> <span class="title">ScrollListener</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> Toolbar tb;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">    tb = (Toolbar) findViewById(R.id.tb);</div><div class="line"></div><div class="line">    setSupportActionBar(tb);</div><div class="line"></div><div class="line">    MyScrollView sv= (MyScrollView) findViewById(R.id.sv);</div><div class="line"></div><div class="line">    sv.setScrollListener(<span class="keyword">this</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScroll</span><span class="params">(<span class="keyword">float</span> alpha)</span> </span>&#123;</div><div class="line">    Log.d(<span class="string">"TAG"</span>,<span class="string">"a:"</span>+alpha);</div><div class="line">    tb.setAlpha(alpha);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Palette"><a href="#Palette" class="headerlink" title="Palette"></a>Palette</h1><p>调色板，v7-palette，可以分析出一些色彩特性,主色调，鲜艳的颜色，柔和的颜色等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">BitmapDrawable bitmapDrawable = (BitmapDrawable) iv.getDrawable();</div><div class="line">    Bitmap bitmap = bitmapDrawable.getBitmap();</div><div class="line"><span class="comment">//    Palette palette = Palette.generate(bitmap); //不推荐</span></div><div class="line">    Palette.from(bitmap).generate(<span class="keyword">new</span> PaletteAsyncListener() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onGenerated</span><span class="params">(Palette palette)</span> </span>&#123;</div><div class="line">        <span class="comment">//暗，柔和</span></div><div class="line">        <span class="keyword">int</span> darkMutedColor = palette.getDarkMutedColor(Color.BLUE);</div><div class="line">        <span class="comment">//暗，鲜艳</span></div><div class="line">        <span class="keyword">int</span> darkVibrantColor = palette.getDarkVibrantColor(Color.BLUE);</div><div class="line">        <span class="comment">//亮，柔和</span></div><div class="line">        <span class="keyword">int</span> lightMutedColor = palette.getLightMutedColor(Color.BLUE);</div><div class="line">        <span class="comment">//亮，鲜艳</span></div><div class="line">        <span class="keyword">int</span> lightVibrantColor = palette.getLightVibrantColor(Color.BLUE);</div><div class="line"></div><div class="line">        <span class="comment">//鲜艳</span></div><div class="line">        <span class="keyword">int</span> vibrantColor = palette.getVibrantColor(Color.BLUE);</div><div class="line">        <span class="comment">//柔和</span></div><div class="line">        <span class="keyword">int</span> mutedColor = palette.getMutedColor(Color.BLUE);</div><div class="line"></div><div class="line">        tv1.setBackgroundColor(darkMutedColor);</div><div class="line">        tv2.setBackgroundColor(darkVibrantColor);</div><div class="line">        tv3.setBackgroundColor(lightMutedColor);</div><div class="line">        tv4.setBackgroundColor(lightVibrantColor);</div><div class="line">        tv5.setBackgroundColor(vibrantColor);</div><div class="line">        tv6.setBackgroundColor(mutedColor);</div><div class="line"></div><div class="line">        <span class="comment">//颜色样板，拿到亮，鲜艳的</span></div><div class="line">        Swatch lightVibrantSwatch = palette.getLightVibrantSwatch();</div><div class="line">        <span class="comment">//推荐，标题颜色</span></div><div class="line">        <span class="keyword">int</span> titleTextColor = lightVibrantSwatch.getTitleTextColor();</div><div class="line">        <span class="keyword">int</span> bodyTextColor = lightVibrantSwatch.getBodyTextColor();</div><div class="line">        <span class="comment">//该颜色在图片中所占的比例</span></div><div class="line">        <span class="keyword">int</span> population = lightVibrantSwatch.getPopulation();</div><div class="line">        <span class="comment">//图片的整体颜色</span></div><div class="line">        <span class="keyword">int</span> rgb = lightVibrantSwatch.getRgb();</div><div class="line"></div><div class="line">        tv_title.setBackgroundColor(getTranslucentColor(<span class="number">0.6</span>,rgb));</div><div class="line">        tv_body.setBackgroundColor(rgb);</div><div class="line"></div><div class="line">        tv_title.setTextColor(titleTextColor);</div><div class="line">        tv_body.setTextColor(bodyTextColor);</div><div class="line">      &#125;</div><div class="line"></div><div class="line"></div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getTranslucentColor</span><span class="params">(<span class="keyword">double</span> v, <span class="keyword">int</span> rgb)</span> </span>&#123;</div><div class="line"><span class="comment">//    int blue=rgb&amp;0xff;</span></div><div class="line"></div><div class="line">    <span class="keyword">int</span> blue=Color.blue(rgb); <span class="comment">//还可以这样那</span></div><div class="line"></div><div class="line">    <span class="keyword">int</span> green=rgb&gt;&gt;<span class="number">8</span>&amp;<span class="number">0xff</span>;</div><div class="line">    <span class="keyword">int</span> red=rgb&gt;&gt;<span class="number">16</span>&amp;<span class="number">0xff</span>;</div><div class="line">    <span class="keyword">int</span> alpha=rgb&gt;&gt;&gt;<span class="number">24</span>; <span class="comment">//无符号，高位补0</span></div><div class="line">    alpha= (<span class="keyword">int</span>) Math.round(alpha*v);</div><div class="line">    <span class="keyword">return</span> Color.argb(alpha,red,green,blue);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h1 id="TabLayout"><a href="#TabLayout" class="headerlink" title="TabLayout"></a>TabLayout</h1><p>选项卡,design包</p>
<p>TabLayout+viewPager+fragment</p>
<p>布局</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line">&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"</div><div class="line">  xmlns:tools="http://schemas.android.com/tools"</div><div class="line">  xmlns:app="http://schemas.android.com/apk/res-auto"</div><div class="line">  android:id="@+id/activity_main"</div><div class="line">  android:layout_width="match_parent"</div><div class="line">  android:orientation="vertical"</div><div class="line">  android:layout_height="match_parent"</div><div class="line">  tools:context="cn.woblog.android.l12_md_tablayout.MainActivity"&gt;</div><div class="line"></div><div class="line">  &lt;android.support.design.widget.TabLayout</div><div class="line">    android:id="@+id/tl"</div><div class="line">    app:tabIndicatorColor="@color/colorPrimary"</div><div class="line">    app:tabTextColor="@color/colorPrimary"</div><div class="line">    app:tabSelectedTextColor="#f00"</div><div class="line">    app:tabMode="fixed"</div><div class="line">    app:tabGravity="center"</div><div class="line">    android:layout_width="match_parent"</div><div class="line">    android:layout_height="wrap_content"&gt;&lt;/android.support.design.widget.TabLayout&gt;</div><div class="line"></div><div class="line">  &lt;android.support.v4.view.ViewPager</div><div class="line">    android:id="@+id/vp"</div><div class="line">    android:layout_width="match_parent"</div><div class="line">    android:layout_height="match_parent"&gt;&lt;/android.support.v4.view.ViewPager&gt;</div><div class="line">&lt;/LinearLayout&gt;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.woblog.android.l12_md_tablayout;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.support.design.widget.TabLayout;</div><div class="line"><span class="keyword">import</span> android.support.design.widget.TabLayout.OnTabSelectedListener;</div><div class="line"><span class="keyword">import</span> android.support.design.widget.TabLayout.Tab;</div><div class="line"><span class="keyword">import</span> android.support.design.widget.TabLayout.TabLayoutOnPageChangeListener;</div><div class="line"><span class="keyword">import</span> android.support.v4.app.Fragment;</div><div class="line"><span class="keyword">import</span> android.support.v4.app.FragmentManager;</div><div class="line"><span class="keyword">import</span> android.support.v4.app.FragmentPagerAdapter;</div><div class="line"><span class="keyword">import</span> android.support.v4.view.ViewPager;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> String[] titles=&#123;<span class="string">"新闻"</span>,<span class="string">"体验"</span></div><div class="line"><span class="comment">//      ,"科学","汽车",</span></div><div class="line"><span class="comment">//  "科技","财经","美女","八卦"</span></div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">    <span class="keyword">final</span> ViewPager vp= (ViewPager) findViewById(R.id.vp);</div><div class="line">    TabLayout tl= (TabLayout) findViewById(R.id.tl);</div><div class="line"></div><div class="line">    MyPagerAdapter myPagerAdapter = <span class="keyword">new</span> MyPagerAdapter(getSupportFragmentManager());</div><div class="line">    vp.setAdapter(myPagerAdapter);</div><div class="line">    <span class="comment">//title 来自PagerAdapter</span></div><div class="line">  tl.setTabsFromPagerAdapter(myPagerAdapter);</div><div class="line"></div><div class="line">  <span class="comment">//1.tab和viewpager关联</span></div><div class="line">    tl.addOnTabSelectedListener(<span class="keyword">new</span> OnTabSelectedListener() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabSelected</span><span class="params">(Tab tab)</span> </span>&#123;</div><div class="line">        <span class="comment">//联动viewpager</span></div><div class="line">        vp.setCurrentItem(tab.getPosition());</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabUnselected</span><span class="params">(Tab tab)</span> </span>&#123;</div><div class="line"></div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabReselected</span><span class="params">(Tab tab)</span> </span>&#123;</div><div class="line"></div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line"><span class="comment">//    2.viewpager关联tab</span></div><div class="line">    vp.addOnPageChangeListener(<span class="keyword">new</span> TabLayoutOnPageChangeListener(tl));</div><div class="line">  &#125;</div><div class="line">  <span class="class"><span class="keyword">class</span>  <span class="title">MyPagerAdapter</span> <span class="keyword">extends</span> <span class="title">FragmentPagerAdapter</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyPagerAdapter</span><span class="params">(FragmentManager fm)</span> </span>&#123;</div><div class="line">      <span class="keyword">super</span>(fm);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Fragment <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">      NewsFragment fragment = <span class="keyword">new</span> NewsFragment();</div><div class="line">      Bundle bundle = <span class="keyword">new</span> Bundle();</div><div class="line">      bundle.putString(NewsFragment.DATA,titles[position]);</div><div class="line">      fragment.setArguments(bundle);</div><div class="line">      <span class="keyword">return</span> fragment;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">return</span> titles.length;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> CharSequence <span class="title">getPageTitle</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">      <span class="keyword">return</span> titles[position];</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面关联tabLayout和ViewPager可以这样关联</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tl.setupWithViewPager(vp);</div></pre></td></tr></table></figure>
<h1 id="当tab使用和自定义View"><a href="#当tab使用和自定义View" class="headerlink" title="当tab使用和自定义View"></a>当tab使用和自定义View</h1><p>只需要将tabLyout放到底部，自定义item，但是Item要定义高度，但是选中的颜色需要特别处理。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">android:id</span>=<span class="string">"@+id/activity_main"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.l12_md_tablayout.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v4.view.ViewPager</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/vp"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span> <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.v4.view.ViewPager</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.design.widget.TabLayout</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/tl"</span></div><div class="line">    <span class="attr">app:tabIndicatorHeight</span>=<span class="string">"0dp"</span></div><div class="line">    <span class="attr">app:tabIndicatorColor</span>=<span class="string">"@color/colorPrimary"</span></div><div class="line">    <span class="attr">app:tabTextColor</span>=<span class="string">"@color/colorPrimary"</span></div><div class="line">    <span class="attr">app:tabSelectedTextColor</span>=<span class="string">"#f00"</span></div><div class="line">    <span class="attr">app:tabMode</span>=<span class="string">"fixed"</span></div><div class="line">    <span class="attr">app:tabGravity</span>=<span class="string">"fill"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.design.widget.TabLayout</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.woblog.android.l12_md_tablayout;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.design.widget.TabLayout;</div><div class="line"><span class="keyword">import</span> android.support.design.widget.TabLayout.Tab;</div><div class="line"><span class="keyword">import</span> android.support.v4.app.Fragment;</div><div class="line"><span class="keyword">import</span> android.support.v4.app.FragmentManager;</div><div class="line"><span class="keyword">import</span> android.support.v4.app.FragmentPagerAdapter;</div><div class="line"><span class="keyword">import</span> android.support.v4.content.ContextCompat;</div><div class="line"><span class="keyword">import</span> android.support.v4.view.ViewPager;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.LinearLayout;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> String[] titles=&#123;<span class="string">"新闻"</span>,<span class="string">"体验"</span></div><div class="line"><span class="comment">//      ,"科学","汽车",</span></div><div class="line"><span class="comment">//  "科技","财经","美女","八卦"</span></div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">    <span class="keyword">final</span> ViewPager vp= (ViewPager) findViewById(R.id.vp);</div><div class="line">    TabLayout tl= (TabLayout) findViewById(R.id.tl);</div><div class="line"></div><div class="line">    MyPagerAdapter myPagerAdapter = <span class="keyword">new</span> MyPagerAdapter(getSupportFragmentManager());</div><div class="line">    vp.setAdapter(myPagerAdapter);</div><div class="line">    <span class="comment">//title 来自PagerAdapter</span></div><div class="line">  tl.setTabsFromPagerAdapter(myPagerAdapter);</div><div class="line"></div><div class="line"><span class="comment">//  //1.tab和viewpager关联</span></div><div class="line"><span class="comment">//    tl.addOnTabSelectedListener(new OnTabSelectedListener() &#123;</span></div><div class="line"><span class="comment">//      @Override</span></div><div class="line"><span class="comment">//      public void onTabSelected(Tab tab) &#123;</span></div><div class="line"><span class="comment">//        //联动viewpager</span></div><div class="line"><span class="comment">//        vp.setCurrentItem(tab.getPosition());</span></div><div class="line"><span class="comment">//      &#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//      @Override</span></div><div class="line"><span class="comment">//      public void onTabUnselected(Tab tab) &#123;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//      &#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//      @Override</span></div><div class="line"><span class="comment">//      public void onTabReselected(Tab tab) &#123;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//      &#125;</span></div><div class="line"><span class="comment">//    &#125;);</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">////    2.viewpager关联tab</span></div><div class="line"><span class="comment">//    vp.addOnPageChangeListener(new TabLayoutOnPageChangeListener(tl));</span></div><div class="line"></div><div class="line">    <span class="comment">//在setAdapter后调用</span></div><div class="line">    tl.setupWithViewPager(vp);</div><div class="line"></div><div class="line">    <span class="comment">//自定义view</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; tl.getTabCount(); i++) &#123;</div><div class="line">      Tab tab = tl.getTabAt(i);</div><div class="line">      View view = View.inflate(<span class="keyword">this</span>, R.layout.item_tab, <span class="keyword">null</span>);</div><div class="line">     TextView tv_tab_title= (TextView) view.findViewById(R.id.tv_tab_title);</div><div class="line">      tv_tab_title.setText(<span class="string">"标题："</span>+i);</div><div class="line">      tab.setCustomView(view);</div><div class="line"></div><div class="line">      <span class="comment">//分割线</span></div><div class="line">      LinearLayout linearLayout = (LinearLayout) tl.getChildAt(<span class="number">0</span>);</div><div class="line">      linearLayout.setShowDividers(LinearLayout.SHOW_DIVIDER_MIDDLE);</div><div class="line">      linearLayout.setDividerDrawable(ContextCompat.getDrawable(<span class="keyword">this</span>,</div><div class="line">          R.drawable.item_divider));</div><div class="line">      linearLayout.setDividerPadding(<span class="number">40</span>); <span class="comment">//值越大，线越短</span></div><div class="line"></div><div class="line"></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  <span class="class"><span class="keyword">class</span>  <span class="title">MyPagerAdapter</span> <span class="keyword">extends</span> <span class="title">FragmentPagerAdapter</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyPagerAdapter</span><span class="params">(FragmentManager fm)</span> </span>&#123;</div><div class="line">      <span class="keyword">super</span>(fm);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Fragment <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">      NewsFragment fragment = <span class="keyword">new</span> NewsFragment();</div><div class="line">      Bundle bundle = <span class="keyword">new</span> Bundle();</div><div class="line">      bundle.putString(NewsFragment.DATA,titles[position]);</div><div class="line">      fragment.setArguments(bundle);</div><div class="line">      <span class="keyword">return</span> fragment;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">return</span> titles.length;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> CharSequence <span class="title">getPageTitle</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">      <span class="keyword">return</span> titles[position];</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在还需要处理，选中颜色，首先需要定义一个selector</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"#80c0c0c0"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">size</span> <span class="attr">android:width</span>=<span class="string">"1dp"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div></pre></td></tr></table></figure>
<p>然后在item里面引用这个</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:textColor</span>=<span class="string">"@drawable/selector_tab_text"</span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/tv_tab_title"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"标题"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span> <span class="attr">android:layout_weight</span>=<span class="string">"1"</span> /&gt;</div><div class="line">  <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>选中处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//处理选中监听</span></div><div class="line">    tl.addOnTabSelectedListener(<span class="keyword">new</span> OnTabSelectedListener() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabSelected</span><span class="params">(Tab tab)</span> </span>&#123;</div><div class="line">        tab.getCustomView().findViewById(R.id.tv_tab_title).setSelected(<span class="keyword">true</span>);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabUnselected</span><span class="params">(Tab tab)</span> </span>&#123;</div><div class="line">        tab.getCustomView().findViewById(R.id.tv_tab_title).setSelected(<span class="keyword">false</span>);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabReselected</span><span class="params">(Tab tab)</span> </span>&#123;</div><div class="line"></div><div class="line">      &#125;</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<h1 id="澄清是"><a href="#澄清是" class="headerlink" title="澄清是"></a>澄清是</h1><p>让整个app沉浸到整个屏幕，没有显示状态栏，美有导航栏。显示做的是，状态栏和导航和app一体的颜色，还有考虑兼容性。兼容到4.4</p>
<h2 id="5-0"><a href="#5-0" class="headerlink" title="5.0"></a>5.0</h2><p>自定实现了，但是要用AppCompat主题</p>
<h3 id="设置主题"><a href="#设置主题" class="headerlink" title="设置主题"></a>设置主题</h3><p>值是colorPrimaryDark</p>
<h3 id="样式属性"><a href="#样式属性" class="headerlink" title="样式属性"></a>样式属性</h3><p>在values-v21及以上可以用这句话设置导航栏颜色</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&lt;item name=&quot;android:navigationBarColor&quot;&gt;#0f0&lt;/item&gt;</div><div class="line">    &lt;item name=&quot;android:statusBarColor&quot;&gt;#0f0&lt;/item&gt;</div></pre></td></tr></table></figure>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">getWindow().setStatusBarColor(Color.YELLOW);</div><div class="line">    getWindow().setNavigationBarColor(Color.RED);</div></pre></td></tr></table></figure>
<h2 id="4-4-19"><a href="#4-4-19" class="headerlink" title="4.4 19"></a>4.4 19</h2><p>只能使用特殊手段，特殊手段就是这个版本中可以设置状态栏为透明</p>
<h3 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h3><p>不推荐，只能设置19，而且写到主题的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;item name=&quot;android:windowTranslucentStatus&quot;&gt;true&lt;/item&gt;</div></pre></td></tr></table></figure>
<h3 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">getWindow().addFlags(LayoutParams.FLAG_TRANSLUCENT_STATUS);</div></pre></td></tr></table></figure>
<p>布局内部，的toolbar上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:fitsSystemWindows=&quot;true&quot;</div></pre></td></tr></table></figure>
<p>在setCOntentView前，另外界面到了状态栏下面了，但现在有问题了，就是如果有EditText,只要弹出键盘，toolbar的颜色就会连接到键盘顶部（6.0,4.4没有）。还有就是toolbar标题在最地步了。去掉外层的scrollview就可以了</p>
<p>1.解决办法，推荐</p>
<p>将  android:fitsSystemWindows=”true”，移动根布局，然后在设置一个背景(也可以设置android:windowBackground,默认主题里)，还得给内容设置白色。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">android:id</span>=<span class="string">"@+id/activity_main"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:background</span>=<span class="string">"?attr/colorPrimary"</span></div><div class="line">  <span class="attr">android:fitsSystemWindows</span>=<span class="string">"true"</span></div><div class="line">  <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">  <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.l13mdtranslucent.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@color/colorPrimary"</span></div><div class="line">    <span class="attr">app:title</span>=<span class="string">"这是toolbar标题"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">ScrollView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"#fff"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">ScrollView</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2.修改toolbal的高度</p>
<p>设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">android:fitsSystemWindows=&quot;true&quot;</div></pre></td></tr></table></figure>
<p>到Toolbar,然后修改toolbar高度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">ViewGroup.LayoutParams layoutParams = toolbar.getLayoutParams();</div><div class="line">layoutParams.height+=getStatusBarHeight();</div><div class="line">toolbar.setLayoutParams(layoutParams);</div><div class="line"></div><div class="line">//反射</div><div class="line">private int getStatusBarHeight() &#123;</div><div class="line">    //反射android.R.dimen.status_bar_height</div><div class="line">    try &#123;</div><div class="line">      Class&lt;?&gt; aClass = Class.forName(&quot;com.android.internal.R$dimen&quot;);</div><div class="line">      Object o = aClass.newInstance();</div><div class="line">      String status_bar_height = aClass.getField(&quot;status_bar_height&quot;).get(o).toString();</div><div class="line">      int height = Integer.parseInt(status_bar_height); //id</div><div class="line">      int dimensionPixelOffset = getResources().getDimensionPixelSize(height);</div><div class="line">      return dimensionPixelOffset;</div><div class="line">    &#125; catch (Exception e) &#123;</div><div class="line">      e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    return 0;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>3.修改toolbar的padding，比上面那种靠谱</p>
<h1 id="虚拟导航NavigationBar沉浸"><a href="#虚拟导航NavigationBar沉浸" class="headerlink" title="虚拟导航NavigationBar沉浸"></a>虚拟导航NavigationBar沉浸</h1><h2 id="5-x"><a href="#5-x" class="headerlink" title="5.x"></a>5.x</h2><h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><p>navigationBarColor</p>
<p>values-v21下设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;item name=&quot;android:navigationBarColor&quot;&gt;#0f0&lt;/item&gt;</div></pre></td></tr></table></figure>
<h3 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h3><p>setNavigationBarColor</p>
<h2 id="4-4"><a href="#4-4" class="headerlink" title="4.4"></a>4.4</h2><p>设置虚拟导航透明</p>
<p>跟scrollView设置一个marginBottom或者添加一个TextView,48dp，但是要在代码中动态判断，因为有些手机可以没有虚拟导航栏</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">android:id</span>=<span class="string">"@+id/activity_main"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">  <span class="attr">android:background</span>=<span class="string">"@color/colorPrimary"</span></div><div class="line">  <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.l13mdtranslucent.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/tb"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:titleTextColor</span>=<span class="string">"#fff"</span></div><div class="line">    <span class="attr">android:fitsSystemWindows</span>=<span class="string">"true"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@color/colorPrimary"</span></div><div class="line">    <span class="attr">app:title</span>=<span class="string">"这是toolbar标题"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">ScrollView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></div><div class="line">    <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"#fff"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">ScrollView</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"1dp"</span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/tv_navigation_bar"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//导航栏</div><div class="line">ViewGroup.LayoutParams params = tv_navigation_bar.getLayoutParams();</div><div class="line">params.height=getNavigationBarHeight();</div><div class="line">tv_navigation_bar.setLayoutParams(params);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">private int getNavigationBarHeight() &#123;</div><div class="line">  //反射android.R.dimen.status_bar_height</div><div class="line">  try &#123;</div><div class="line">    Class&lt;?&gt; aClass = Class.forName(&quot;com.android.internal.R$dimen&quot;);</div><div class="line">    Object o = aClass.newInstance();</div><div class="line">    String status_bar_height = aClass.getField(&quot;navigation_bar_height&quot;).get(o).toString();</div><div class="line">    int height = Integer.parseInt(status_bar_height); //id</div><div class="line">    int dimensionPixelOffset = getResources().getDimensionPixelSize(height);</div><div class="line">    return dimensionPixelOffset;</div><div class="line">  &#125; catch (Exception e) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">  &#125;</div><div class="line">  return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="兼容性判断"><a href="#兼容性判断" class="headerlink" title="兼容性判断"></a>兼容性判断</h2><p>1.sdk版本不一样</p>
<p>​    大于等于5.0，小于5.0大于等于4.4</p>
<p>2.有的没有虚拟导航</p>
<p>​    是否有（源码有方法）</p>
<p>3.有的虚拟导航可以隐藏</p>
<p>​    是否隐藏了</p>
<p>2，3可以一起解决，解决方法是navigationBarHeight高度=这个那个屏幕高度-内容部分view高度，如果大于0表示有</p>
<p>封装完成如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.woblog.android.l13mdtranslucent;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Build.VERSION;</div><div class="line"><span class="keyword">import</span> android.os.Build.VERSION_CODES;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.Toolbar;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.ViewGroup;</div><div class="line"><span class="keyword">import</span> android.view.WindowManager.LayoutParams;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by renpingqing on 2017/3/12.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseTranslucentActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">    <span class="comment">//版本大于等于4.4，小于5.0就设置状态栏，导航栏透明</span></div><div class="line">    <span class="keyword">if</span> (VERSION.SDK_INT&gt;= VERSION_CODES.KITKAT &amp;&amp;VERSION.SDK_INT&lt;VERSION_CODES.LOLLIPOP ) &#123;</div><div class="line">      getWindow().addFlags(LayoutParams.FLAG_TRANSLUCENT_STATUS);</div><div class="line">      getWindow().addFlags(LayoutParams.FLAG_TRANSLUCENT_NAVIGATION);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrChangeTranslucentColor</span><span class="params">( Toolbar toolbar,View bottomNavigationBar,<span class="keyword">int</span> primaryColor)</span></span>&#123;</div><div class="line">    <span class="comment">//版本大于等于4.4，小于5.0就设置状态栏，导航栏透明</span></div><div class="line">    <span class="keyword">if</span> (VERSION.SDK_INT &gt;= VERSION_CODES.KITKAT &amp;&amp; VERSION.SDK_INT &lt; VERSION_CODES.LOLLIPOP) &#123;</div><div class="line">      <span class="keyword">if</span> (toolbar != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="comment">//1.设置toolbar高度</span></div><div class="line">        ViewGroup.LayoutParams layoutParams = toolbar.getLayoutParams();</div><div class="line">        layoutParams.height+=getStatusBarHeight();</div><div class="line">        toolbar.setLayoutParams(layoutParams);</div><div class="line"></div><div class="line">        <span class="comment">//2.然后在设置顶部的padding,这样就不会有控件跑到状态栏下面了</span></div><div class="line">        toolbar.setPadding(</div><div class="line">            toolbar.getPaddingLeft(),</div><div class="line">            toolbar.getPaddingTop()+getStatusBarHeight(),</div><div class="line">            toolbar.getPaddingRight(),</div><div class="line">            toolbar.getPaddingBottom()</div><div class="line">        );</div><div class="line"></div><div class="line">        toolbar.setBackgroundColor(primaryColor);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">//导航栏</span></div><div class="line">      <span class="keyword">if</span> (bottomNavigationBar != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="comment">//导航栏</span></div><div class="line">        ViewGroup.LayoutParams params = bottomNavigationBar.getLayoutParams();</div><div class="line">        params.height=getNavigationBarHeight();</div><div class="line">        bottomNavigationBar.setLayoutParams(params);</div><div class="line"></div><div class="line">        <span class="comment">//设置导航栏颜色</span></div><div class="line">        bottomNavigationBar.setBackgroundColor(primaryColor);</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (VERSION.SDK_INT &gt;= VERSION_CODES.LOLLIPOP) &#123;</div><div class="line">      <span class="comment">//大于等于5.0</span></div><div class="line">      getWindow().setStatusBarColor(primaryColor);</div><div class="line">    getWindow().setNavigationBarColor(primaryColor);</div><div class="line"></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="comment">//小于4.4,不处理</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getNavigationBarHeight</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">//反射android.R.dimen.status_bar_height</span></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      Class&lt;?&gt; aClass = Class.forName(<span class="string">"com.android.internal.R$dimen"</span>);</div><div class="line">      Object o = aClass.newInstance();</div><div class="line">      String status_bar_height = aClass.getField(<span class="string">"navigation_bar_height"</span>).get(o).toString();</div><div class="line">      <span class="keyword">int</span> height = Integer.parseInt(status_bar_height); <span class="comment">//id</span></div><div class="line">      <span class="keyword">int</span> dimensionPixelOffset = getResources().getDimensionPixelSize(height);</div><div class="line">      <span class="keyword">return</span> dimensionPixelOffset;</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">      e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getStatusBarHeight</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">//反射android.R.dimen.status_bar_height</span></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">      Class&lt;?&gt; aClass = Class.forName(<span class="string">"com.android.internal.R$dimen"</span>);</div><div class="line">      Object o = aClass.newInstance();</div><div class="line">      String status_bar_height = aClass.getField(<span class="string">"status_bar_height"</span>).get(o).toString();</div><div class="line">      <span class="keyword">int</span> height = Integer.parseInt(status_bar_height); <span class="comment">//id</span></div><div class="line">      <span class="keyword">int</span> dimensionPixelOffset = getResources().getDimensionPixelSize(height);</div><div class="line">      <span class="keyword">return</span> dimensionPixelOffset;</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">      e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在activity里这么使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">super.onCreate(savedInstanceState);</div><div class="line">setContentView(R.layout.activity_main);</div><div class="line">Toolbar toolbar= (Toolbar) findViewById(R.id.tb);</div><div class="line">    TextView tv_navigation_bar= (TextView) findViewById(R.id.tv_navigation_bar);</div><div class="line"></div><div class="line">    setOrChangeTranslucentColor(toolbar,tv_navigation_bar,getResources().getColor(R.color.colorPrimary));</div></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">android:id</span>=<span class="string">"@+id/activity_main"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">  <span class="attr">android:background</span>=<span class="string">"@color/colorPrimary"</span></div><div class="line">  <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.l13mdtranslucent.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/tb"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:titleTextColor</span>=<span class="string">"#fff"</span></div><div class="line">    <span class="attr">android:fitsSystemWindows</span>=<span class="string">"true"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@color/colorPrimary"</span></div><div class="line">    <span class="attr">app:title</span>=<span class="string">"这是toolbar标题"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">ScrollView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"0dp"</span></div><div class="line">    <span class="attr">android:layout_weight</span>=<span class="string">"1"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"#fff"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">EditText</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"80dp"</span></div><div class="line">        <span class="attr">android:text</span>=<span class="string">"清输入名字"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">ScrollView</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"1dp"</span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/tv_navigation_bar"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<h1 id="CardView"><a href="#CardView" class="headerlink" title="CardView"></a>CardView</h1><p>v7-CardView项目</p>
<p>特性：</p>
<p>1.边框圆角</p>
<p>​    5.x:图片和布局都可以很好地显示圆角，图片也能变圆角</p>
<p>​    4.x：图片不能变圆角，如果要和5.x一样，通过加载图片的时候自己处理成圆角</p>
<p>2.阴影效果</p>
<p>3.5.x有Ripple水波效果（低版本需要自定义）</p>
<p>​    android:foreground=”?attr/selectableItemBackground”</p>
<p>​    androi:clickable=”true“</p>
<p>4.可以设置内容边距</p>
<p>​    app:contentPadding=”5dp”</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">android.support.v7.widget.CardView</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/cardView"</span></div><div class="line">         <span class="attr">android:layout_width</span>=<span class="string">"300dp"</span></div><div class="line">         <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">         <span class="attr">app:cardCornerRadius</span>=<span class="string">"20dp"</span></div><div class="line">         <span class="attr">app:cardElevation</span>=<span class="string">"20dp"</span></div><div class="line">         <span class="attr">android:layout_margin</span>=<span class="string">"16dp"</span></div><div class="line">         <span class="attr">android:foreground</span>=<span class="string">"?attr/selectableItemBackground"</span></div><div class="line">         <span class="attr">android:clickable</span>=<span class="string">"true"</span></div><div class="line">         <span class="attr">android:stateListAnimator</span>=<span class="string">"@anim/z_translation"</span></div><div class="line">         &gt;</div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">            <span class="attr">android:id</span>=<span class="string">"@+id/iv"</span></div><div class="line">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">            <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span></div><div class="line">            <span class="attr">android:src</span>=<span class="string">"@drawable/tulips2"</span> /&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">android.support.v7.widget.CardView</span>&gt;</span></div></pre></td></tr></table></figure>
<p>foreground:点击放开水波效果</p>
<p>stateListAnimator：按下z轴</p>
<h1 id="FloatingActionButton"><a href="#FloatingActionButton" class="headerlink" title="FloatingActionButton"></a>FloatingActionButton</h1><p>design包，悬浮动作按钮，可以设置着色阴影</p>
<p>特性：阴影，反馈（按下去，elevation）</p>
<p>兼容性：</p>
<p>需要些两个layout</p>
<p>layout-v21这里添加layoutMargin,16dp</p>
<p>低版本要将margin改为0dp</p>
<p>app:backgroundTint:背景着色</p>
<p>elevation：水波颜色</p>
<p>rippleColor:点击后的效果颜色，还要设置clickable，不然没效果</p>
<p>pressedTranslationZ:点击z轴变小多少高度，</p>
<p>点击弹出菜单：</p>
<p>多个按钮上下排列</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.FloatingActionButton</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></div><div class="line">    <span class="attr">android:src</span>=<span class="string">"@android:drawable/ic_input_add"</span></div><div class="line">    <span class="attr">app:backgroundTint</span>=<span class="string">"@color/colorPrimary"</span></div><div class="line">    <span class="attr">android:elevation</span>=<span class="string">"10dp"</span></div><div class="line">    <span class="attr">android:onClick</span>=<span class="string">"rotate"</span></div><div class="line">    <span class="attr">android:layout_margin</span>=<span class="string">"16dp"</span></div><div class="line">    <span class="attr">app:pressedTranslationZ</span>=<span class="string">"10dp"</span></div><div class="line">    <span class="attr">android:layout_alignParentBottom</span>=<span class="string">"true"</span></div><div class="line">    <span class="attr">android:layout_alignParentRight</span>=<span class="string">"true"</span></div><div class="line">    <span class="attr">app:rippleColor</span>=<span class="string">"#f00"</span></div><div class="line">    <span class="attr">android:clickable</span>=<span class="string">"true"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span> /&gt;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">    <span class="keyword">float</span> toDegree =reverse?-<span class="number">90.0F</span>:<span class="number">90.0F</span>;</div><div class="line">    ObjectAnimator anim=ObjectAnimator</div><div class="line">        .ofFloat(view,<span class="string">"rotation"</span>,<span class="number">0.0f</span>,toDegree)</div><div class="line">        ;</div><div class="line">    anim</div><div class="line">        .setDuration(<span class="number">200</span>)</div><div class="line">        .start();</div><div class="line"></div><div class="line">        reverse=!reverse;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h1 id="RV-FAB-TB"><a href="#RV-FAB-TB" class="headerlink" title="RV+FAB+TB"></a>RV+FAB+TB</h1><p>实现的效果就是滚动RV，然后分别隐藏FAB和TB</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">android:id</span>=<span class="string">"@+id/activity_main"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.l16mdfabanimation.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/rv"</span></div><div class="line">    <span class="attr">android:clipToPadding</span>=<span class="string">"false"</span></div><div class="line">    <span class="attr">android:clipChildren</span>=<span class="string">"false"</span></div><div class="line">    <span class="attr">android:paddingTop</span>=<span class="string">"?attr/actionBarSize"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.v7.widget.RecyclerView</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/tb"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@color/colorPrimary"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/fab"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"58dp"</span></div><div class="line">    <span class="attr">android:layout_alignParentBottom</span>=<span class="string">"true"</span></div><div class="line">    <span class="attr">android:layout_alignParentRight</span>=<span class="string">"true"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"58dp"</span></div><div class="line">    <span class="attr">android:layout_margin</span>=<span class="string">"16dp"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@drawable/fab_bg"</span></div><div class="line">    <span class="attr">android:src</span>=<span class="string">"@android:drawable/ic_input_add"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.woblog.android.l16mdfabanimation;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.LinearLayoutManager;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView.OnScrollListener;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView.ViewHolder;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.Toolbar;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.LayoutInflater;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.ViewGroup;</div><div class="line"><span class="keyword">import</span> android.view.animation.AccelerateInterpolator;</div><div class="line"><span class="keyword">import</span> android.view.animation.DecelerateInterpolator;</div><div class="line"><span class="keyword">import</span> android.widget.ImageView;</div><div class="line"><span class="keyword">import</span> android.widget.RelativeLayout;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> THRESHOLD = <span class="number">20</span>;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> Toolbar tb;</div><div class="line">  <span class="keyword">private</span> ImageView fab;</div><div class="line">  <span class="keyword">private</span> RecyclerView rv;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> isVisiable=<span class="keyword">true</span>;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">int</span> distance;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">    rv = (RecyclerView) findViewById(R.id.rv);</div><div class="line">    tb = (Toolbar) findViewById(R.id.tb);</div><div class="line">    fab = (ImageView) findViewById(R.id.fab);</div><div class="line"></div><div class="line">    setSupportActionBar(tb);</div><div class="line"></div><div class="line">    rv.addOnScrollListener(<span class="keyword">new</span> OnScrollListener() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onScrolled</span><span class="params">(RecyclerView recyclerView, <span class="keyword">int</span> dx,<span class="keyword">int</span> dy)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onScrolled(recyclerView, dx, dy);</div><div class="line">        Log.d(<span class="string">"TAG"</span>,<span class="string">"dy:"</span>+dy);</div><div class="line">        <span class="comment">//dy 垂直方向的，滚动值正，向上滚动，要隐藏</span></div><div class="line">        <span class="keyword">if</span> (distance &gt; THRESHOLD &amp;&amp; isVisiable) &#123;</div><div class="line">          <span class="comment">//dy为正，表示</span></div><div class="line">          isVisiable = <span class="keyword">false</span>;</div><div class="line">          hide();</div><div class="line">          distance = <span class="number">0</span>;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (distance&lt;-THRESHOLD&amp;&amp;!isVisiable) &#123;</div><div class="line">        <span class="comment">//如果值，小于，并且没有显示，那就显示</span></div><div class="line">          isVisiable=<span class="keyword">true</span>;</div><div class="line">          show();</div><div class="line">          distance = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//累加滚动距离distance</span></div><div class="line">        <span class="keyword">if</span> ((isVisiable&amp;&amp; dy&gt;<span class="number">0</span>)||(!isVisiable&amp;&amp;dy&lt;<span class="number">0</span>)) &#123;</div><div class="line">        distance+=dy;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    rv.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>));</div><div class="line"></div><div class="line">    ArrayList&lt;String&gt; strings = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</div><div class="line">      strings.add(<span class="string">"item:"</span>+i);</div><div class="line">    &#125;</div><div class="line">    MyAdapter myAdapter = <span class="keyword">new</span> MyAdapter(strings);</div><div class="line"></div><div class="line">    rv.setAdapter(myAdapter);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="comment">//和hide逻辑相反</span></div><div class="line">    tb.animate().translationY(<span class="number">0</span>).setInterpolator(<span class="keyword">new</span> AccelerateInterpolator(<span class="number">3</span>));</div><div class="line"></div><div class="line">    RelativeLayout.LayoutParams layoutParams= (RelativeLayout.LayoutParams) fab.getLayoutParams();</div><div class="line">    fab.animate().translationY(<span class="number">0</span>).setInterpolator(<span class="keyword">new</span> DecelerateInterpolator(<span class="number">3</span>));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hide</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">//toolbar，向上移动，自己的高度</span></div><div class="line">    tb.animate().translationY(-tb.getHeight()).setInterpolator(<span class="keyword">new</span> AccelerateInterpolator(<span class="number">3</span>));</div><div class="line"></div><div class="line">    <span class="comment">//fab向下移动，自己的高度和底部的高度</span></div><div class="line">    RelativeLayout.LayoutParams layoutParams = (RelativeLayout.LayoutParams) fab.getLayoutParams();</div><div class="line">    fab.animate().translationY(fab.getHeight()+layoutParams.bottomMargin).setInterpolator(<span class="keyword">new</span> AccelerateInterpolator(<span class="number">3</span>));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">RecyclerView</span>.<span class="title">ViewHolder</span>&gt;</span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;String&gt; strings;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyAdapter</span><span class="params">(ArrayList&lt;String&gt; strings)</span> </span>&#123;</div><div class="line">      <span class="keyword">this</span>.strings=strings;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">new</span> MyViewHolder(LayoutInflater.from(parent.getContext()).inflate(android.R.layout.simple_list_item_1,parent,<span class="keyword">false</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line"></div><div class="line">      String s = strings.get(position);</div><div class="line">      MyViewHolder holder1= (MyViewHolder) holder;</div><div class="line">      holder1.tv.setText(s);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">return</span> strings.size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewHolder</span> <span class="keyword">extends</span> <span class="title">ViewHolder</span> </span>&#123;</div><div class="line"></div><div class="line">      <span class="keyword">public</span> TextView tv;</div><div class="line"></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="title">MyViewHolder</span><span class="params">(View inflate)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(inflate);</div><div class="line">        tv = (TextView) itemView.findViewById(android.R.id.text1);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="CoordinatorLayout"><a href="#CoordinatorLayout" class="headerlink" title="CoordinatorLayout"></a>CoordinatorLayout</h1><p>上面那种实现方法我们还得写监听器，继承ViewGroup,协调并掉拥堵子控件，产生一些效果。</p>
<p>通过设置View的Behavior来设置触摸动画的调度。</p>
<p>滑动控件：RecyclerView/NetstedScrollView(ScorllView升级版)，ViewPager也可以，ListView不行</p>
<h2 id="Behavior"><a href="#Behavior" class="headerlink" title="Behavior"></a>Behavior</h2><p>他是监听和被监听的桥梁，被监听通知Behavior，我们在Behavior里更改监听控件，这里是监听RV,更改FAB</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span></span></div><div class="line">  <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">android:id</span>=<span class="string">"@+id/activity_main"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.l16mdfabanimation.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/tb"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@color/colorPrimary"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.design.widget.FloatingActionButton</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/fab"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"58dp"</span></div><div class="line">    <span class="attr">app:layout_behavior</span>=<span class="string">"cn.woblog.android.l16mdfabanimation.FabBehavior"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"58dp"</span></div><div class="line">    <span class="attr">android:layout_margin</span>=<span class="string">"16dp"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@drawable/fab_bg"</span></div><div class="line">    <span class="attr">android:layout_gravity</span>=<span class="string">"bottom|end"</span></div><div class="line">    <span class="attr">android:src</span>=<span class="string">"@android:drawable/ic_input_add"</span> /&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/rv"</span></div><div class="line"></div><div class="line">    <span class="attr">android:clipToPadding</span>=<span class="string">"false"</span></div><div class="line">    <span class="attr">android:clipChildren</span>=<span class="string">"false"</span></div><div class="line">    <span class="attr">android:paddingTop</span>=<span class="string">"?attr/actionBarSize"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.v7.widget.RecyclerView</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.woblog.android.l16mdfabanimation;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.design.widget.FloatingActionButton;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.LinearLayoutManager;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView.ViewHolder;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.Toolbar;</div><div class="line"><span class="keyword">import</span> android.view.LayoutInflater;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.ViewGroup;</div><div class="line"><span class="keyword">import</span> android.view.animation.AccelerateInterpolator;</div><div class="line"><span class="keyword">import</span> android.view.animation.DecelerateInterpolator;</div><div class="line"><span class="keyword">import</span> android.widget.RelativeLayout;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> THRESHOLD = <span class="number">20</span>;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> Toolbar tb;</div><div class="line">  <span class="keyword">private</span> FloatingActionButton fab;</div><div class="line">  <span class="keyword">private</span> RecyclerView rv;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> isVisiable=<span class="keyword">true</span>;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">int</span> distance;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">    rv = (RecyclerView) findViewById(R.id.rv);</div><div class="line">    tb = (Toolbar) findViewById(R.id.tb);</div><div class="line">    fab = (FloatingActionButton) findViewById(R.id.fab);</div><div class="line"></div><div class="line">    setSupportActionBar(tb);</div><div class="line"></div><div class="line"><span class="comment">//    rv.addOnScrollListener(new OnScrollListener() &#123;</span></div><div class="line"><span class="comment">//      @Override</span></div><div class="line"><span class="comment">//      public void onScrolled(RecyclerView recyclerView, int dx,int dy) &#123;</span></div><div class="line"><span class="comment">//        super.onScrolled(recyclerView, dx, dy);</span></div><div class="line"><span class="comment">//        Log.d("TAG","dy:"+dy);</span></div><div class="line"><span class="comment">//        //dy 垂直方向的，滚动值正，向上滚动，要隐藏</span></div><div class="line"><span class="comment">//        if (distance &gt; THRESHOLD &amp;&amp; isVisiable) &#123;</span></div><div class="line"><span class="comment">//          //dy为正，表示</span></div><div class="line"><span class="comment">//          isVisiable = false;</span></div><div class="line"><span class="comment">//          hide();</span></div><div class="line"><span class="comment">//          distance = 0;</span></div><div class="line"><span class="comment">//        &#125; else if (distance&lt;-THRESHOLD&amp;&amp;!isVisiable) &#123;</span></div><div class="line"><span class="comment">//        //如果值，小于，并且没有显示，那就显示</span></div><div class="line"><span class="comment">//          isVisiable=true;</span></div><div class="line"><span class="comment">//          show();</span></div><div class="line"><span class="comment">//          distance = 0;</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//        //累加滚动距离distance</span></div><div class="line"><span class="comment">//        if ((isVisiable&amp;&amp; dy&gt;0)||(!isVisiable&amp;&amp;dy&lt;0)) &#123;</span></div><div class="line"><span class="comment">//        distance+=dy;</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line"><span class="comment">//      &#125;</span></div><div class="line"><span class="comment">//    &#125;);</span></div><div class="line"></div><div class="line">    rv.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>));</div><div class="line"></div><div class="line">    ArrayList&lt;String&gt; strings = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</div><div class="line">      strings.add(<span class="string">"item:"</span>+i);</div><div class="line">    &#125;</div><div class="line">    MyAdapter myAdapter = <span class="keyword">new</span> MyAdapter(strings);</div><div class="line"></div><div class="line">    rv.setAdapter(myAdapter);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="comment">//和hide逻辑相反</span></div><div class="line">    tb.animate().translationY(<span class="number">0</span>).setInterpolator(<span class="keyword">new</span> AccelerateInterpolator(<span class="number">3</span>));</div><div class="line"></div><div class="line">    RelativeLayout.LayoutParams layoutParams= (RelativeLayout.LayoutParams) fab.getLayoutParams();</div><div class="line">    fab.animate().translationY(<span class="number">0</span>).setInterpolator(<span class="keyword">new</span> DecelerateInterpolator(<span class="number">3</span>));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">hide</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">//toolbar，向上移动，自己的高度</span></div><div class="line">    tb.animate().translationY(-tb.getHeight()).setInterpolator(<span class="keyword">new</span> AccelerateInterpolator(<span class="number">3</span>));</div><div class="line"></div><div class="line">    <span class="comment">//fab向下移动，自己的高度和底部的高度</span></div><div class="line">    RelativeLayout.LayoutParams layoutParams = (RelativeLayout.LayoutParams) fab.getLayoutParams();</div><div class="line">    fab.animate().translationY(fab.getHeight()+layoutParams.bottomMargin).setInterpolator(<span class="keyword">new</span> AccelerateInterpolator(<span class="number">3</span>));</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">RecyclerView</span>.<span class="title">ViewHolder</span>&gt;</span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArrayList&lt;String&gt; strings;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyAdapter</span><span class="params">(ArrayList&lt;String&gt; strings)</span> </span>&#123;</div><div class="line">      <span class="keyword">this</span>.strings=strings;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</div><div class="line">      <span class="keyword">return</span> <span class="keyword">new</span> MyViewHolder(LayoutInflater.from(parent.getContext()).inflate(android.R.layout.simple_list_item_1,parent,<span class="keyword">false</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line"></div><div class="line">      String s = strings.get(position);</div><div class="line">      MyViewHolder holder1= (MyViewHolder) holder;</div><div class="line">      holder1.tv.setText(s);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">return</span> strings.size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewHolder</span> <span class="keyword">extends</span> <span class="title">ViewHolder</span> </span>&#123;</div><div class="line"></div><div class="line">      <span class="keyword">public</span> TextView tv;</div><div class="line"></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="title">MyViewHolder</span><span class="params">(View inflate)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(inflate);</div><div class="line">        tv = (TextView) itemView.findViewById(android.R.id.text1);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.woblog.android.l16mdfabanimation;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.support.design.widget.CoordinatorLayout;</div><div class="line"><span class="keyword">import</span> android.support.design.widget.FloatingActionButton;</div><div class="line"><span class="keyword">import</span> android.support.v4.view.ViewCompat;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.view.animation.AccelerateInterpolator;</div><div class="line"><span class="keyword">import</span> android.view.animation.DecelerateInterpolator;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by renpingqing on 2017/3/14.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FabBehavior</span> <span class="keyword">extends</span> <span class="title">FloatingActionButton</span>.<span class="title">Behavior</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> isVisiable=<span class="keyword">true</span>;</div><div class="line"><span class="comment">//  @Override</span></div><div class="line"><span class="comment">//  public boolean layoutDependsOn(CoordinatorLayout parent, FloatingActionButton child,</span></div><div class="line"><span class="comment">//      View dependency) &#123;</span></div><div class="line"><span class="comment">//    return super.layoutDependsOn(parent, child, dependency);</span></div><div class="line"><span class="comment">//  &#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  @Override</span></div><div class="line"><span class="comment">//  public boolean onDependentViewChanged(CoordinatorLayout parent, FloatingActionButton child,</span></div><div class="line"><span class="comment">//      View dependency) &#123;</span></div><div class="line"><span class="comment">//    return super.onDependentViewChanged(parent, child, dependency);</span></div><div class="line"><span class="comment">//  &#125;</span></div><div class="line"></div><div class="line"></div><div class="line">  <span class="comment">//要重写这两个构造方法，不然崩溃</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">FabBehavior</span><span class="params">()</span> </span>&#123;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">FabBehavior</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(context, attrs);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onStartNestedScroll</span><span class="params">(CoordinatorLayout coordinatorLayout,</span></span></div><div class="line">      FloatingActionButton child, View directTargetChild, View target, <span class="keyword">int</span> nestedScrollAxes) &#123;</div><div class="line">    <span class="comment">//当观察的view滑动的时候，开始滑动，这是RV</span></div><div class="line">    <span class="comment">//nestedScrollAxes:滑动关联轴，这里只关心，垂直</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> nestedScrollAxes== ViewCompat.SCROLL_AXIS_VERTICAL || <span class="keyword">super</span></div><div class="line">        .onStartNestedScroll(coordinatorLayout, child, directTargetChild, target, nestedScrollAxes);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNestedScroll</span><span class="params">(CoordinatorLayout coordinatorLayout, FloatingActionButton child,</span></span></div><div class="line">      View target, <span class="keyword">int</span> dxConsumed, <span class="keyword">int</span> dyConsumed, <span class="keyword">int</span> dxUnconsumed, <span class="keyword">int</span> dyUnconsumed) &#123;</div><div class="line">    <span class="comment">//滑动的时候</span></div><div class="line">    <span class="keyword">super</span>.onNestedScroll(coordinatorLayout, child, target, dxConsumed, dyConsumed, dxUnconsumed,</div><div class="line">        dyUnconsumed);</div><div class="line"></div><div class="line">    <span class="comment">//根据情况执行动画</span></div><div class="line">    <span class="keyword">if</span> (dyConsumed&gt;<span class="number">0</span> &amp;&amp; isVisiable) &#123;</div><div class="line">    <span class="comment">//hide</span></div><div class="line">      onHide(child);</div><div class="line">      isVisiable=<span class="keyword">false</span>;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (dyConsumed&lt;<span class="number">0</span> &amp;&amp; !isVisiable) &#123;</div><div class="line"></div><div class="line">      onShow(child);</div><div class="line">      isVisiable=<span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onHide</span><span class="params">(FloatingActionButton fab)</span> </span>&#123;</div><div class="line">    <span class="comment">//fab向下移动，自己的高度和底部的高度</span></div><div class="line">    CoordinatorLayout.LayoutParams layoutParams = (CoordinatorLayout.LayoutParams) fab.getLayoutParams();</div><div class="line">    fab.animate().translationY(fab.getHeight()+layoutParams.bottomMargin).setInterpolator(<span class="keyword">new</span> AccelerateInterpolator(<span class="number">3</span>));</div><div class="line"></div><div class="line"><span class="comment">//    ViewCompat.animate(fab).scaleX(0f).scaleY(0f).start();;</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">onShow</span><span class="params">(FloatingActionButton fab)</span> </span>&#123;</div><div class="line">    CoordinatorLayout.LayoutParams layoutParams= (CoordinatorLayout.LayoutParams) fab.getLayoutParams();</div><div class="line">    fab.animate().translationY(<span class="number">0</span>).setInterpolator(<span class="keyword">new</span> DecelerateInterpolator(<span class="number">3</span>));</div><div class="line"></div><div class="line"><span class="comment">//    ViewCompat.animate(fab).scaleX(1f).scaleY(1f).start();;</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>当用FloatActionButton和Snake时，如果外层不是CoordinatorLayout，Snake显示的时候回盖住FloatActionButton</p>
<h1 id="AppBarLayout"><a href="#AppBarLayout" class="headerlink" title="AppBarLayout"></a>AppBarLayout</h1><p>增强ToolBar,在RecycleView上设置一个</p>
<p>app:layout_behavior=”@string/appbar_scrolling_view_behavior”</p>
<p>然后Toolbar上设置</p>
<p>app:layout_scrollFlags=”scroll”，就可以监听RecycleView滑动，TOolbar上滑</p>
<p>layout_scrollFlags取值：</p>
<p>scroll：一定要滑到顶部才显示toolbar</p>
<p>enterAlways:快速返回，只要下滑就显示</p>
<p>enterAlwaysCollapsed:</p>
<p>exitUnitCollapsed:折叠后，toolbar停留在顶部</p>
<p>snap:</p>
<h2 id="NestedScrollView"><a href="#NestedScrollView" class="headerlink" title="NestedScrollView"></a>NestedScrollView</h2><p>v4, ScrollView升级版,联动</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">android:id</span>=<span class="string">"@+id/activity_main"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.l16mdfabanimation.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">      <span class="attr">android:id</span>=<span class="string">"@+id/tb"</span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span></div><div class="line">      <span class="attr">android:background</span>=<span class="string">"@color/colorPrimary"</span></div><div class="line">      <span class="attr">app:layout_scrollFlags</span>=<span class="string">"scroll|enterAlways"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.design.widget.FloatingActionButton</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/fab"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"58dp"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"58dp"</span></div><div class="line">    <span class="attr">android:layout_margin</span>=<span class="string">"16dp"</span></div><div class="line">    <span class="attr">android:layout_gravity</span>=<span class="string">"bottom|end"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"@drawable/fab_bg"</span></div><div class="line">    <span class="attr">android:onClick</span>=<span class="string">"fabClick"</span></div><div class="line">    <span class="attr">android:src</span>=<span class="string">"@android:drawable/ic_input_add"</span></div><div class="line">    <span class="attr">app:layout_behavior</span>=<span class="string">"cn.woblog.android.l16mdfabanimation.FabBehavior"</span> /&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/rv"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:clipChildren</span>=<span class="string">"false"</span></div><div class="line">    <span class="attr">android:clipToPadding</span>=<span class="string">"false"</span></div><div class="line">    <span class="attr">app:layout_behavior</span>=<span class="string">"@string/appbar_scrolling_view_behavior"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">      <span class="tag">&lt;<span class="name">android.support.v7.widget.CardView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"300dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">        <span class="attr">android:layout_margin</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:cardCornerRadius</span>=<span class="string">"20dp"</span></div><div class="line">        <span class="attr">app:cardElevation</span>=<span class="string">"10dp"</span></div><div class="line">        <span class="attr">app:contentPadding</span>=<span class="string">"5dp"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">          <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">          <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">          <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span></div><div class="line">          <span class="attr">android:src</span>=<span class="string">"@drawable/tulips2"</span> /&gt;</div><div class="line">      <span class="tag">&lt;/<span class="name">android.support.v7.widget.CardView</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">android.support.v7.widget.CardView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"300dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">        <span class="attr">android:layout_margin</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:cardCornerRadius</span>=<span class="string">"20dp"</span></div><div class="line">        <span class="attr">app:cardElevation</span>=<span class="string">"10dp"</span></div><div class="line">        <span class="attr">app:contentPadding</span>=<span class="string">"5dp"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">          <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">          <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">          <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span></div><div class="line">          <span class="attr">android:src</span>=<span class="string">"@drawable/tulips2"</span> /&gt;</div><div class="line">      <span class="tag">&lt;/<span class="name">android.support.v7.widget.CardView</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">android.support.v7.widget.CardView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"300dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">        <span class="attr">android:layout_margin</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:cardCornerRadius</span>=<span class="string">"20dp"</span></div><div class="line">        <span class="attr">app:cardElevation</span>=<span class="string">"10dp"</span></div><div class="line">        <span class="attr">app:contentPadding</span>=<span class="string">"5dp"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">          <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">          <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">          <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span></div><div class="line">          <span class="attr">android:src</span>=<span class="string">"@drawable/tulips2"</span> /&gt;</div><div class="line">      <span class="tag">&lt;/<span class="name">android.support.v7.widget.CardView</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">android.support.v7.widget.CardView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"300dp"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">        <span class="attr">android:layout_margin</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:cardCornerRadius</span>=<span class="string">"20dp"</span></div><div class="line">        <span class="attr">app:cardElevation</span>=<span class="string">"10dp"</span></div><div class="line">        <span class="attr">app:contentPadding</span>=<span class="string">"5dp"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">          <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">          <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">          <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span></div><div class="line">          <span class="attr">android:src</span>=<span class="string">"@drawable/tulips2"</span> /&gt;</div><div class="line">      <span class="tag">&lt;/<span class="name">android.support.v7.widget.CardView</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">android.support.v4.widget.NestedScrollView</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="ViewPager-TabLyout-Fragment-AppBarLayout"><a href="#ViewPager-TabLyout-Fragment-AppBarLayout" class="headerlink" title="ViewPager+TabLyout+Fragment+AppBarLayout"></a>ViewPager+TabLyout+Fragment+AppBarLayout</h2><p>在activity中使用AppBarLayout包裹住Toolbar,TabLyout,然后在TabLyout中添加</p>
<p>app:layout_scrollFlags=”scroll|enterAlways”，将NestedScrollView放到每个fragment中。</p>
<p>activity.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">android:id</span>=<span class="string">"@+id/activity_main"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">  <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.l12_md_tablayout.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span></span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">android.support.v7.widget.Toolbar</span></span></div><div class="line">      <span class="attr">android:id</span>=<span class="string">"@+id/tb"</span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:title</span>=<span class="string">"这是标题"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"?attr/actionBarSize"</span></div><div class="line">      <span class="attr">android:background</span>=<span class="string">"@color/colorPrimary"</span></div><div class="line">      <span class="attr">app:layout_scrollFlags</span>=<span class="string">"scroll|enterAlways"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">android.support.design.widget.TabLayout</span></span></div><div class="line">      <span class="attr">android:id</span>=<span class="string">"@+id/tl"</span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">      <span class="attr">app:tabIndicatorColor</span>=<span class="string">"#0f0"</span></div><div class="line">      <span class="attr">app:tabMode</span>=<span class="string">"fixed"</span></div><div class="line">      <span class="attr">app:tabSelectedTextColor</span>=<span class="string">"#f00"</span></div><div class="line">      <span class="attr">app:tabTextColor</span>=<span class="string">"@color/colorPrimary"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.design.widget.TabLayout</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v4.view.ViewPager</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/vp"</span></div><div class="line">    <span class="attr">app:layout_behavior</span>=<span class="string">"@string/appbar_scrolling_view_behavior"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;<span class="tag">&lt;/<span class="name">android.support.v4.view.ViewPager</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<p>fragment_news.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v4.widget.NestedScrollView</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/rv"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:clipChildren</span>=<span class="string">"false"</span></div><div class="line">    <span class="attr">android:clipToPadding</span>=<span class="string">"false"</span></div><div class="line">    <span class="attr">app:layout_behavior</span>=<span class="string">"@string/appbar_scrolling_view_behavior"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">LinearLayout</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">      <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</div><div class="line"></div><div class="line">      <span class="tag">&lt;<span class="name">android.support.v7.widget.CardView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">        <span class="attr">android:layout_margin</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:cardCornerRadius</span>=<span class="string">"20dp"</span></div><div class="line">        <span class="attr">app:cardElevation</span>=<span class="string">"10dp"</span></div><div class="line">        <span class="attr">app:contentPadding</span>=<span class="string">"5dp"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">          <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">          <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">          <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span></div><div class="line">          <span class="attr">android:src</span>=<span class="string">"@drawable/tulips2"</span> /&gt;</div><div class="line">      <span class="tag">&lt;/<span class="name">android.support.v7.widget.CardView</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">android.support.v7.widget.CardView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">        <span class="attr">android:layout_margin</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:cardCornerRadius</span>=<span class="string">"20dp"</span></div><div class="line">        <span class="attr">app:cardElevation</span>=<span class="string">"10dp"</span></div><div class="line">        <span class="attr">app:contentPadding</span>=<span class="string">"5dp"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">          <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">          <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">          <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span></div><div class="line">          <span class="attr">android:src</span>=<span class="string">"@drawable/tulips2"</span> /&gt;</div><div class="line">      <span class="tag">&lt;/<span class="name">android.support.v7.widget.CardView</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">android.support.v7.widget.CardView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">        <span class="attr">android:layout_margin</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:cardCornerRadius</span>=<span class="string">"20dp"</span></div><div class="line">        <span class="attr">app:cardElevation</span>=<span class="string">"10dp"</span></div><div class="line">        <span class="attr">app:contentPadding</span>=<span class="string">"5dp"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">          <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">          <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">          <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span></div><div class="line">          <span class="attr">android:src</span>=<span class="string">"@drawable/tulips2"</span> /&gt;</div><div class="line">      <span class="tag">&lt;/<span class="name">android.support.v7.widget.CardView</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">android.support.v7.widget.CardView</span></span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">        <span class="attr">android:layout_margin</span>=<span class="string">"0dp"</span></div><div class="line">        <span class="attr">app:cardCornerRadius</span>=<span class="string">"20dp"</span></div><div class="line">        <span class="attr">app:cardElevation</span>=<span class="string">"10dp"</span></div><div class="line">        <span class="attr">app:contentPadding</span>=<span class="string">"5dp"</span>&gt;</div><div class="line">        <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line">          <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">          <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></div><div class="line">          <span class="attr">android:scaleType</span>=<span class="string">"centerCrop"</span></div><div class="line">          <span class="attr">android:src</span>=<span class="string">"@drawable/tulips2"</span> /&gt;</div><div class="line">      <span class="tag">&lt;/<span class="name">android.support.v7.widget.CardView</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">android.support.v4.widget.NestedScrollView</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="CollapsingToolBarLayout"><a href="#CollapsingToolBarLayout" class="headerlink" title="CollapsingToolBarLayout"></a>CollapsingToolBarLayout</h2><p>toolbar折叠，</p>
<p>1.AppBarLayout设置固定高度，并且要实现折叠效果必须必toolbar高</p>
<p>2.CollapsingToolBarLayout高度要match_parent</p>
<p>​    app:layout_collapseMode:</p>
<p>​        parallax:视差效果</p>
<p>​            layout_collapseParallaxMultiplier:0~1,视差效果，0：完全被推上去，1：完成不动</p>
<p>​        pin:固定，最后推出去</p>
<p>​        none:推出去</p>
<h1 id="Behavior-1"><a href="#Behavior-1" class="headerlink" title="Behavior"></a>Behavior</h1><p>桥梁，监听子控件</p>
<p>所有的Behavior都是CoordinatorLayout里面的public static abstract class Behavior<v extends="" view="">的子类。</v></p>
<p>他可以应用在一下场景:</p>
<p>1.某个View监听另外一个View的状态,比如：位置，大小，显示状态</p>
<p>​    重写layoutDependsOn/onDependentViewChanged</p>
<p>2.某个View需要监听Coordinator里面的所有控件滑动状态</p>
<p>​    onStartNestedScroll,onNestedScroll,onNestedPreScroll</p>
<h2 id="监听另一个控件状态"><a href="#监听另一个控件状态" class="headerlink" title="监听另一个控件状态"></a>监听另一个控件状态</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.CoordinatorLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">android:id</span>=<span class="string">"@+id/activity_main"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:paddingTop</span>=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">  <span class="attr">android:paddingBottom</span>=<span class="string">"@dimen/activity_vertical_margin"</span></div><div class="line">  <span class="attr">android:paddingLeft</span>=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">  <span class="attr">android:paddingRight</span>=<span class="string">"@dimen/activity_horizontal_margin"</span></div><div class="line">  <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.l19mdcustombehavior.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/tv1"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"100dp"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"#f00"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"被观察者"</span> /&gt;</div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">    <span class="attr">app:layout_behavior</span>=<span class="string">"cn.woblog.android.l19mdcustombehavior.CustomBehavior"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"100dp"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"200dp"</span></div><div class="line">    <span class="attr">android:layout_gravity</span>=<span class="string">"right|top"</span></div><div class="line">    <span class="attr">android:background</span>=<span class="string">"#0f0"</span></div><div class="line">    <span class="attr">android:text</span>=<span class="string">"观察者"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.CoordinatorLayout</span>&gt;</span></div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.woblog.android.l19mdcustombehavior;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.support.design.widget.CoordinatorLayout;</div><div class="line"><span class="keyword">import</span> android.support.v4.view.ViewCompat;</div><div class="line"><span class="keyword">import</span> android.util.AttributeSet;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by renpingqing on 2017/3/18.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomBehavior</span> <span class="keyword">extends</span> <span class="title">CoordinatorLayout</span>.<span class="title">Behavior</span>&lt;<span class="title">View</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CustomBehavior</span><span class="params">()</span> </span>&#123;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CustomBehavior</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(context, attrs);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * 用来决定需要监听哪些控件或者容器的状态</div><div class="line">   *  1.系统需要知道监听谁</div><div class="line">   *  2.监听什么状体</div><div class="line">   *    比如：只监听TextView的上下滑动事件</div><div class="line">   * <span class="doctag">@param</span> parent 父容器，CoordinatorLayout</div><div class="line">   * <span class="doctag">@param</span> child 子控件,被监听的View</div><div class="line">   * <span class="doctag">@param</span> dependency 你要监听的View</div><div class="line">   * <span class="doctag">@return</span></div><div class="line">   */</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">layoutDependsOn</span><span class="params">(CoordinatorLayout parent, View child, View dependency)</span> </span>&#123;</div><div class="line">    <span class="comment">//可以根据tag，id判断确定检测那个</span></div><div class="line">    <span class="keyword">return</span> dependency <span class="keyword">instanceof</span> TextView || <span class="keyword">super</span>.layoutDependsOn(parent, child, dependency);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">/**</span></div><div class="line">   * 当被监听的View发生改变的时候，这里是Textview1</div><div class="line">   * <span class="doctag">@param</span> parent</div><div class="line">   * <span class="doctag">@param</span> child</div><div class="line">   * <span class="doctag">@param</span> dependency</div><div class="line">   * <span class="doctag">@return</span></div><div class="line">   */</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onDependentViewChanged</span><span class="params">(CoordinatorLayout parent, View child, View dependency)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//获取被监听View垂直方向的位置</span></div><div class="line">    <span class="keyword">int</span> offset=dependency.getTop()-child.getTop();</div><div class="line">    ViewCompat.offsetTopAndBottom(child,offset);</div><div class="line"></div><div class="line">    <span class="comment">//还可以旋转</span></div><div class="line">    child.animate().rotation(child.getTop()*<span class="number">20</span>);</div><div class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onDependentViewChanged(parent, child, dependency);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后改变TextView1的位置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">tv1 = (TextView) findViewById(R.id.tv1);</div><div class="line">    tv1.setOnClickListener(<span class="keyword">new</span> OnClickListener() &#123;</div><div class="line">      <span class="meta">@Override</span></div><div class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">        ViewCompat.offsetTopAndBottom(v,<span class="number">20</span>);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<h2 id="监听另一个控件滑动"><a href="#监听另一个控件滑动" class="headerlink" title="监听另一个控件滑动"></a>监听另一个控件滑动</h2><h1 id="属性动画"><a href="#属性动画" class="headerlink" title="属性动画"></a>属性动画</h1><h2 id="什么是"><a href="#什么是" class="headerlink" title="什么是"></a>什么是</h2><p>控制控件属性，3.0开始的，如果兼容3.0以下，使用NineOldAnimation,和系统API差不多</p>
<p>以前都是补间动画BetweenAnimation，帧动画FrameAnimation</p>
<h2 id="补间动画"><a href="#补间动画" class="headerlink" title="补间动画"></a>补间动画</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Animation animation = AnimationUtils.loadAnimation(this, R.anim.translate);</div><div class="line">button.startAnimation(animation);</div></pre></td></tr></table></figure>
<h2 id="属性动画-1"><a href="#属性动画-1" class="headerlink" title="属性动画"></a>属性动画</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator animator = ObjectAnimator.ofFloat(view, &quot;translationX&quot;, 0f, 200f);</div><div class="line">animator.setDuration(400);</div><div class="line">animator.start();</div></pre></td></tr></table></figure>
<h3 id="多个动画"><a href="#多个动画" class="headerlink" title="多个动画"></a>多个动画</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator animator=ObjectAnimator.ofFloat(view,&quot;hehe&quot;,0f,200f);</div><div class="line">animator.setDuration(5000);</div><div class="line">animator.addUpdateListener(new AnimatorUpdateListener() &#123;</div><div class="line">  @Override</div><div class="line">  public void onAnimationUpdate(ValueAnimator animation) &#123;</div><div class="line">    animation.getAnimatedFraction();//以及执行的动画百分比</div><div class="line">    float v = (float) animation.getAnimatedValue(); //当前值</div><div class="line">    view.setAlpha(v/200);</div><div class="line">    view.setScaleX(v/200);</div><div class="line">    view.setScaleY(v/200);</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line">animator.start();</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"> ValueAnimator valueAnimator = ValueAnimator.ofFloat(0f, 200f);</div><div class="line">  valueAnimator.setDuration(200);</div><div class="line">  valueAnimator.addUpdateListener(new AnimatorUpdateListener() &#123;</div><div class="line">    @Override</div><div class="line">    public void onAnimationUpdate(ValueAnimator animation) &#123;</div><div class="line">      float v= (float) animation.getAnimatedValue();</div><div class="line">      view.setScaleX(0.5f+v/200); //0.5~1.0</div><div class="line">      view.setScaleY(0.5f+v/200); //0.5~1.0</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line"></div><div class="line">valueAnimator.start();</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">PropertyValuesHolder alpha = PropertyValuesHolder.ofFloat(&quot;alpha&quot;, 1.0f, 0.6f, 1.0f);</div><div class="line">PropertyValuesHolder scaleX = PropertyValuesHolder.ofFloat(&quot;scaleX&quot;, 1.0f, 0.6f, 1.0f);</div><div class="line">PropertyValuesHolder scaleY = PropertyValuesHolder.ofFloat(&quot;scaleY&quot;, 1.0f, 0.6f, 1.0f);</div><div class="line">ObjectAnimator objectAnimator = ObjectAnimator</div><div class="line">    .ofPropertyValuesHolder(view, alpha, scaleX, scaleY);</div><div class="line">objectAnimator.setDuration(400);</div><div class="line">objectAnimator.start();</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//动画集合</div><div class="line">    ObjectAnimator objectAnimator1 = ObjectAnimator.ofFloat(view, &quot;alpha&quot;, 1.0f, 0.6f, 1.0f);</div><div class="line">    ObjectAnimator objectAnimator2 = ObjectAnimator.ofFloat(view, &quot;scaleX&quot;, 1.0f, 0.6f, 1.0f);</div><div class="line">    ObjectAnimator objectAnimator3 = ObjectAnimator.ofFloat(view, &quot;scaleY&quot;, 1.0f, 0.6f, 1.0f);</div><div class="line"></div><div class="line">    AnimatorSet animatorSet = new AnimatorSet();</div><div class="line">    animatorSet.setDuration(400);</div><div class="line">//    animatorSet.play();//单个动画</div><div class="line">//    animatorSet.playTogether(objectAnimator1,objectAnimator2,objectAnimator3); //将动画加入，同时执行</div><div class="line">    animatorSet.playSequentially(objectAnimator1,objectAnimator2,objectAnimator3); //将动画加入，顺序执行</div><div class="line">    animatorSet.start();</div></pre></td></tr></table></figure>
<h2 id="插值器"><a href="#插值器" class="headerlink" title="插值器"></a>插值器</h2><h3 id="加速"><a href="#加速" class="headerlink" title="加速"></a>加速</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator animator = ObjectAnimator.ofFloat(view, &quot;translationX&quot;, 0f, 400f);</div><div class="line">animator.setDuration(2000);</div><div class="line">animator.setInterpolator(new AccelerateInterpolator(5));  //5是插值因子，越大越快</div><div class="line">animator.start();</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;div class=&quot;line&quot;&gt;1&lt;/div&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;div class=&quot;lin
    
    </summary>
    
      <category term="Android" scheme="http://i.woblog.cn/categories/Android/"/>
    
    
      <category term="DrawerLayout" scheme="http://i.woblog.cn/tags/DrawerLayout/"/>
    
  </entry>
  
  <entry>
    <title>RecyclerView的使用解析</title>
    <link href="http://i.woblog.cn/2017/03/05/use-recycler-view/"/>
    <id>http://i.woblog.cn/2017/03/05/use-recycler-view/</id>
    <published>2017-03-05T10:48:03.000Z</published>
    <updated>2017-03-19T14:22:37.668Z</updated>
    
    <content type="html"><![CDATA[<h1 id="为什么要使用它"><a href="#为什么要使用它" class="headerlink" title="为什么要使用它"></a>为什么要使用它</h1><p>RecyclerView比ListView更灵活，比如我现在是显示一个List，过一会儿需要换成Grid格式，在这种情况下如果使用的是ListView，那我们需要换成GridView等，下面就来看看他的基本使用</p>
<h1 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h1><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compile <span class="string">'com.android.support:design:25.1.0'</span></div></pre></td></tr></table></figure>
<h1 id="添加控件到布局文件"><a href="#添加控件到布局文件" class="headerlink" title="添加控件到布局文件"></a>添加控件到布局文件</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">android.support.v7.widget.RecyclerView</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/my_recycler_view"</span></div><div class="line">    <span class="attr">android:scrollbars</span>=<span class="string">"vertical"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>/&gt;</div></pre></td></tr></table></figure>
<h1 id="设置布局管理器"><a href="#设置布局管理器" class="headerlink" title="设置布局管理器"></a>设置布局管理器</h1><p>所谓布局管理器就是你要告诉RecyclerView怎样去显示一个Item，因为他不像ListView那样一开始就定义死了怎么布局，比如ListView定义死了垂直布局，而GridView用于显示格式样式的布局。他提供了几个默认的实现</p>
<ul>
<li>LinearLayoutManager：垂直或水平滚动列表方式显示项目。</li>
<li>GridLayoutManager：网格中显示项目。</li>
<li>StaggeredGridLayoutManager：在分散对齐网格中显示项目。</li>
</ul>
<p>我们这里用垂直布局管理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//设置布局管理器</span></div><div class="line">LinearLayoutManager linearLayoutManager = <span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>);</div><div class="line">rv.setLayoutManager(linearLayoutManager);</div></pre></td></tr></table></figure>
<h1 id="设置adapter"><a href="#设置adapter" class="headerlink" title="设置adapter"></a>设置adapter</h1><p>这一步和ListView这类的控件使用的方式差不多，也要设置一个适配器，告诉他数据源，他是继承RecyclerView.Adapter，我们需要实现三个方法</p>
<p>onCreateViewHolder：创建一个ViewHolder</p>
<p>onBindViewHolder：为ViewHolder绑定数据</p>
<p>getItemCount：整个列表的长度</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleAdapter</span> <span class="keyword">extends</span> <span class="title">BaseRecyclerViewAdapter</span>&lt;<span class="title">String</span>, <span class="title">SimpleAdapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimpleAdapter</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//下面两个方法想当与BaseAdapter的getView，只是他将创建view和设置view数据分开了</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup parent, <span class="keyword">int</span> viewType)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ViewHolder(LayoutInflater.from(context).inflate(android.R.layout.simple_list_item_1, parent, <span class="keyword">false</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        holder.bindView(getItem(position), position);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> TextView tv;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View itemView)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(itemView);</div><div class="line">            tv = (TextView) itemView.findViewById(android.R.id.text1);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bindView</span><span class="params">(<span class="keyword">final</span> String item, <span class="keyword">final</span> <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">            tv.setText(item);</div><div class="line">            tv.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">                    onItemClickListener.onItemClick(position);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里我写了一个通用的Adapter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.woblog.recyclerviewsimple;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseRecyclerViewAdapter</span>&lt;<span class="title">D</span>, <span class="title">VH</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span>&gt; <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">VH</span>&gt; </span>&#123;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 条目点击事件</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> OnItemClickListener onItemClickListener;</div><div class="line"></div><div class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Context context;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnItemClickListener</span><span class="params">(OnItemClickListener onItemClickListener)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.onItemClickListener = onItemClickListener;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseRecyclerViewAdapter</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.context = context;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> List&lt;D&gt; data = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;D&gt; <span class="title">getData</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> data;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> D <span class="title">getItem</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> data.get(position);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//整个列表的长度，类似BaseAdapter的getCount</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> data.size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(List&lt;D&gt; data)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.data.clear();</div><div class="line">        <span class="keyword">this</span>.data.addAll(data);</div><div class="line">        notifyDataSetChanged();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addData</span><span class="params">(List&lt;D&gt; data)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.data.addAll(data);</div><div class="line">        notifyDataSetChanged();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OnItemClickListener</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(<span class="keyword">int</span> position)</span></span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>他定义了data列表对应最终的数据集合，定义了一个条目点击事件接口。接下来我们将整个适配器设置到RecyclerView</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//设置adapter</span></div><div class="line">simpleAdapter = <span class="keyword">new</span> SimpleAdapter(<span class="keyword">this</span>);</div><div class="line">rv.setAdapter(simpleAdapter);</div><div class="line"></div><div class="line">simpleAdapter.setOnItemClickListener(<span class="keyword">this</span>);</div><div class="line"></div><div class="line">simpleAdapter.setData(getTestData());</div></pre></td></tr></table></figure>
<p>到这一步我们这个相当于ListView的列表已经显示出来了</p>
<p>//无分割线图</p>
<p>但是还发现少点什么，对，就是分割线，RecyclerView的分割线实现起来要比ListView要难一点，我们需要通过addItemDecoration添加一个实现，居然没人默认的实现，真是醉了，这里我们先实现一个垂直列表的水平分割线，实现分割线需要继承ItemDecoration类，一般要复写如下方法：</p>
<ul>
<li>onDraw：改方法调用在drawChildren之前</li>
<li>onDrawOver：该方法调用位于drawChildren之后</li>
<li>getItemOffsets：通过outRect.set方法为每一个Item设置一个偏移量，用来绘制分割线</li>
</ul>
<p>onDraw和onDrawOver一般只需要重写其中一个</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.woblog.recyclerviewsimple;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.content.res.TypedArray;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Rect;</div><div class="line"><span class="keyword">import</span> android.graphics.drawable.Drawable;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.LinearLayout;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListItemDecoration</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ItemDecoration</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span>[] ATTRS = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;</div><div class="line">            android.R.attr.listDivider</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Drawable mDivider;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mOrientation;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ListItemDecoration</span><span class="params">(Context context, <span class="keyword">int</span> orientation)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> TypedArray a = context.obtainStyledAttributes(ATTRS);</div><div class="line">        mDivider = a.getDrawable(<span class="number">0</span>);</div><div class="line">        a.recycle();</div><div class="line">        setOrientation(orientation);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrientation</span><span class="params">(<span class="keyword">int</span> orientation)</span> </span>&#123;</div><div class="line">        mOrientation = orientation;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas c, RecyclerView parent)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mOrientation == LinearLayout.VERTICAL) &#123;</div><div class="line">            drawVertical(c, parent);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            drawHorizontal(c, parent);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawVertical</span><span class="params">(Canvas c, RecyclerView parent)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> left = parent.getPaddingLeft();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> right = parent.getWidth() - parent.getPaddingRight();</div><div class="line"></div><div class="line">        <span class="comment">//获取每个child个数</span></div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> childCount = parent.getChildCount();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++) &#123;</div><div class="line">            <span class="comment">//获取到每一个child</span></div><div class="line">            <span class="keyword">final</span> View child = parent.getChildAt(i);</div><div class="line"></div><div class="line">            <span class="comment">//获取到每个child的params</span></div><div class="line">            <span class="keyword">final</span> RecyclerView.LayoutParams params = (RecyclerView.LayoutParams) child</div><div class="line">                    .getLayoutParams();</div><div class="line"></div><div class="line">            <span class="comment">//计算分割线的顶部位置=当前Item的高度+当前item到顶部分割线的距离</span></div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> top = child.getBottom() + params.topMargin;</div><div class="line"></div><div class="line">            <span class="comment">//计算分割线的底部位置=top+分割线的真实高度+当前Item到底部分割线的距离</span></div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> bottom = top + mDivider.getIntrinsicHeight() + params.bottomMargin;</div><div class="line"></div><div class="line">            <span class="comment">//设置分割线线的边距</span></div><div class="line">            mDivider.setBounds(left, top, right, bottom);</div><div class="line">            mDivider.draw(c);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawHorizontal</span><span class="params">(Canvas c, RecyclerView parent)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> top = parent.getPaddingTop();</div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> bottom = parent.getHeight() - parent.getPaddingBottom();</div><div class="line"></div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> childCount = parent.getChildCount();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++) &#123;</div><div class="line">            <span class="keyword">final</span> View child = parent.getChildAt(i);</div><div class="line">            <span class="keyword">final</span> RecyclerView.LayoutParams params = (RecyclerView.LayoutParams) child</div><div class="line">                    .getLayoutParams();</div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> left = child.getRight() + params.leftMargin;</div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> right = left + mDivider.getIntrinsicHeight() + params.rightMargin;</div><div class="line">            mDivider.setBounds(left, top, right, bottom);</div><div class="line">            mDivider.draw(c);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getItemOffsets</span><span class="params">(Rect outRect, <span class="keyword">int</span> itemPosition, RecyclerView parent)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mOrientation == LinearLayout.VERTICAL) &#123;</div><div class="line">            outRect.set(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, mDivider.getIntrinsicHeight()); <span class="comment">//dp单位</span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            outRect.set(<span class="number">0</span>, <span class="number">0</span>, mDivider.getIntrinsicWidth(), <span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>设置分割线</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//设置分割线</span></div><div class="line">rv.addItemDecoration(<span class="keyword">new</span> ListItemDecoration(<span class="keyword">this</span>, LinearLayoutManager.VERTICAL));</div></pre></td></tr></table></figure>
<p>到这里一个效果基本ListView差不多了</p>
<h1 id="定制分割线样式"><a href="#定制分割线样式" class="headerlink" title="定制分割线样式"></a>定制分割线样式</h1><p>到这一步虽然分割线已经显示出来了，但是还是系统默认的，我们肯定有需要换颜色的需要对吧。我们从上面可以得知是使用了系统的listDivider属性，那要更改分割线肯定也是更改他了</p>
<p>item_divider.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> </span></div><div class="line">    <span class="attr">android:shape</span>=<span class="string">"rectangle"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">size</span> <span class="attr">android:width</span>=<span class="string">"10dp"</span> <span class="attr">android:height</span>=<span class="string">"10dp"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"#ff0000"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div></pre></td></tr></table></figure>
<p>我这里定义的高度为1dp，形状为矩形，大家可以根据自己的需求随便改。重要的步骤来了，就是要设置listDivider属性了，可以直接在application对应的theme里面设置，也可以对单个activity的theme设置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;</span><span class="xml"></span></div><div class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:listDivider"</span>&gt;</span>@drawable/item_divider<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="LinearLayoutManager"><a href="#LinearLayoutManager" class="headerlink" title="LinearLayoutManager"></a>LinearLayoutManager</h2><p>这个布局管理器可以垂直和水平</p>
<p>使用ItemViewDecoration</p>
<p>ItemViewDecoration.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.woblog.android;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.content.res.TypedArray;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Rect;</div><div class="line"><span class="keyword">import</span> android.graphics.drawable.Drawable;</div><div class="line"><span class="keyword">import</span> android.support.v4.view.ViewCompat;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView.ItemDecoration;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView.LayoutParams;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView.State;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.LinearLayout;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by renpingqing on 2017/3/4.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemViewDecoration</span> <span class="keyword">extends</span> <span class="title">ItemDecoration</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> <span class="keyword">int</span> orientation;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span>[] atts = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;android.R.attr.listDivider&#125;;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Drawable dividerDrawable;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Context context;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ItemViewDecoration</span><span class="params">(Context context, <span class="keyword">int</span> orientation)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.context = context;</div><div class="line">    <span class="keyword">this</span>.orientation = orientation;</div><div class="line">    TypedArray typedArray = context.obtainStyledAttributes(atts);</div><div class="line">    dividerDrawable = typedArray.getDrawable(<span class="number">0</span>);</div><div class="line">    typedArray.recycle();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ItemViewDecoration</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>(context, LinearLayout.VERTICAL);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas c, RecyclerView parent, State state)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onDraw(c, parent, state);</div><div class="line">    <span class="keyword">if</span> (isVertical()) &#123;</div><div class="line">      drawVertical(c, parent, state);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      drawHorizontal(c, parent, state);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawHorizontal</span><span class="params">(Canvas c, RecyclerView parent, State state)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> top = parent.getPaddingTop();</div><div class="line">    <span class="keyword">int</span> bottom = parent.getHeight() - parent.getPaddingBottom();</div><div class="line"></div><div class="line">    <span class="keyword">int</span> childCount = parent.getChildCount();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++) &#123;</div><div class="line">      View view = parent.getChildAt(i);</div><div class="line">      RecyclerView.LayoutParams params = (LayoutParams) view.getLayoutParams();</div><div class="line">      <span class="keyword">int</span> left =</div><div class="line">          view.getRight() + params.rightMargin + Math.round(ViewCompat.getTranslationX(view));</div><div class="line">      <span class="keyword">int</span> right = left + dividerDrawable.getIntrinsicWidth();</div><div class="line">      dividerDrawable.setBounds(left, top, right, bottom);</div><div class="line">      dividerDrawable.draw(c);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawVertical</span><span class="params">(Canvas c, RecyclerView parent, State state)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> left = parent.getPaddingLeft();</div><div class="line">    <span class="keyword">int</span> right = parent.getWidth() - parent.getPaddingRight();</div><div class="line">    <span class="keyword">int</span> childCount = parent.getChildCount();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++) &#123;</div><div class="line">      View view = parent.getChildAt(i);</div><div class="line">      RecyclerView.LayoutParams params = (LayoutParams) view.getLayoutParams();</div><div class="line">      <span class="keyword">int</span> top =</div><div class="line">          view.getBottom() + params.bottomMargin + Math.round(ViewCompat.getTranslationY(view));</div><div class="line">      <span class="keyword">int</span> bottom = top + dividerDrawable.getIntrinsicHeight();</div><div class="line">      dividerDrawable.setBounds(left, top, right, bottom);</div><div class="line">      dividerDrawable.draw(c);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isVertical</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> orientation == LinearLayout.VERTICAL;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrientation</span><span class="params">(<span class="keyword">int</span> orientation)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.orientation = orientation;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getItemOffsets</span><span class="params">(Rect outRect, View view, RecyclerView parent, State state)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (isVertical()) &#123;</div><div class="line">      outRect.set(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, dividerDrawable.getIntrinsicHeight());</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      outRect.set(<span class="number">0</span>, <span class="number">0</span>, dividerDrawable.getIntrinsicWidth(), <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="水平方向"><a href="#水平方向" class="headerlink" title="水平方向"></a>水平方向</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rv.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>, LinearLayout.HORIZONTAL,<span class="keyword">false</span>));</div><div class="line">itemViewDecoration = <span class="keyword">new</span> ItemViewDecoration(<span class="keyword">this</span>,LinearLayout.HORIZONTAL);</div><div class="line">rv.addItemDecoration(itemViewDecoration);</div></pre></td></tr></table></figure>
<h3 id="垂直方向"><a href="#垂直方向" class="headerlink" title="垂直方向"></a>垂直方向</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rv.setLayoutManager(new LinearLayoutManager(this));</div><div class="line">itemViewDecoration = new ItemViewDecoration(this);</div><div class="line">rv.addItemDecoration(itemViewDecoration);</div></pre></td></tr></table></figure>
<h2 id="GridLayoutManager"><a href="#GridLayoutManager" class="headerlink" title="GridLayoutManager"></a>GridLayoutManager</h2><p>使用ItemGridViewDecoration，他里面写了两种情况，一种是四边都有，一种是只有中间才有</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.woblog.android;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.content.res.TypedArray;</div><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Rect;</div><div class="line"><span class="keyword">import</span> android.graphics.drawable.Drawable;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.GridLayoutManager;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView.ItemDecoration;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView.LayoutParams;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.RecyclerView.State;</div><div class="line"><span class="keyword">import</span> android.support.v7.widget.StaggeredGridLayoutManager;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.LinearLayout;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by renpingqing on 2017/3/4.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemGridViewDecoration</span> <span class="keyword">extends</span> <span class="title">ItemDecoration</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="keyword">private</span> <span class="keyword">int</span> orientation;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span>[] atts = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;android.R.attr.listDivider&#125;;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Drawable dividerDrawable;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Context context;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">int</span> spanCount;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ItemGridViewDecoration</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.context = context;</div><div class="line">    TypedArray typedArray = context.obtainStyledAttributes(atts);</div><div class="line">    dividerDrawable = typedArray.getDrawable(<span class="number">0</span>);</div><div class="line">    typedArray.recycle();</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas c, RecyclerView parent, State state)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onDraw(c, parent, state);</div><div class="line">    drawVertical(c, parent, state);</div><div class="line">    drawHorizontal(c, parent, state);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawHorizontal</span><span class="params">(Canvas c, RecyclerView parent, State state)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> childCount = parent.getChildCount();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++) &#123;</div><div class="line">      View view = parent.getChildAt(i);</div><div class="line">      LayoutParams params = (LayoutParams) view.getLayoutParams();</div><div class="line"></div><div class="line">      <span class="keyword">int</span> c2 = i % spanCount;</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (i &lt;= spanCount) &#123;</div><div class="line">        <span class="comment">//第一行，绘制第一行，顶部</span></div><div class="line">        <span class="keyword">int</span> left = view.getLeft() - params.rightMargin - dividerDrawable.getIntrinsicWidth();</div><div class="line"></div><div class="line">        <span class="keyword">int</span> top = params.bottomMargin;</div><div class="line"><span class="comment">//      这里加上dividerDrawable.getIntrinsicWidth()，边框宽度，就可以绘制到下一个格子的左边，如果这里不加，当然也可以加在绘制垂直的时候</span></div><div class="line">        <span class="keyword">int</span> right = view.getRight() + params.rightMargin + dividerDrawable.getIntrinsicWidth();</div><div class="line">        <span class="keyword">int</span> bottom = top + dividerDrawable.getIntrinsicHeight() + params.bottomMargin;</div><div class="line">        dividerDrawable.setBounds(left, top, right, bottom);</div><div class="line">        dividerDrawable.draw(c);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">//左边减去divider的宽度，就可以绘制最左边的线了</span></div><div class="line">      <span class="keyword">int</span> left = view.getLeft() - params.rightMargin - dividerDrawable.getIntrinsicWidth();</div><div class="line">      <span class="keyword">int</span> top = view.getBottom() + params.bottomMargin;</div><div class="line"><span class="comment">//      这里加上dividerDrawable.getIntrinsicWidth()，边框宽度，就可以绘制到下一个格子的左边，如果这里不加，当然也可以加在绘制垂直的时候</span></div><div class="line">      <span class="keyword">int</span> right = view.getRight() + params.rightMargin + dividerDrawable.getIntrinsicWidth();</div><div class="line">      <span class="keyword">int</span> bottom = top + dividerDrawable.getIntrinsicHeight() + params.bottomMargin;</div><div class="line">      dividerDrawable.setBounds(left, top, right, bottom);</div><div class="line">      dividerDrawable.draw(c);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawVertical</span><span class="params">(Canvas c, RecyclerView parent, State state)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> childCount = parent.getChildCount();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++) &#123;</div><div class="line">      View view = parent.getChildAt(i);</div><div class="line">      LayoutParams params = (LayoutParams) view.getLayoutParams();</div><div class="line"></div><div class="line">      <span class="keyword">int</span> c2 = i % spanCount;</div><div class="line"><span class="comment">//      if (c2 == 2) &#123;</span></div><div class="line">      <span class="comment">//第一列，左边线</span></div><div class="line">      <span class="keyword">int</span> left = params.rightMargin;</div><div class="line">      <span class="keyword">int</span> top = view.getTop() - params.bottomMargin - dividerDrawable.getIntrinsicHeight(); <span class="comment">//就能补齐</span></div><div class="line">      <span class="keyword">int</span> right = left + dividerDrawable.getIntrinsicWidth();</div><div class="line">      <span class="keyword">int</span> bottom = view.getBottom() + params.bottomMargin;</div><div class="line">      dividerDrawable.setBounds(left, top, right, bottom);</div><div class="line">      dividerDrawable.draw(c);</div><div class="line"><span class="comment">//      &#125;</span></div><div class="line"></div><div class="line">      left = view.getRight() + params.rightMargin;</div><div class="line">      top = view.getTop() - params.bottomMargin;</div><div class="line">      right = left + dividerDrawable.getIntrinsicWidth();</div><div class="line">      bottom = view.getBottom() + params.bottomMargin;</div><div class="line">      dividerDrawable.setBounds(left, top, right, bottom);</div><div class="line">      dividerDrawable.draw(c);</div><div class="line"></div><div class="line"></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isVertical</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> orientation == LinearLayout.VERTICAL;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrientation</span><span class="params">(<span class="keyword">int</span> orientation)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.orientation = orientation;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getItemOffsets</span><span class="params">(Rect outRect, View view, RecyclerView parent, State state)</span> </span>&#123;</div><div class="line">    <span class="comment">//左边，右边都偏移divider宽度</span></div><div class="line"></div><div class="line">    <span class="keyword">int</span> itemCount = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> position = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (parent.getLayoutManager() <span class="keyword">instanceof</span> GridLayoutManager) &#123;</div><div class="line">      GridLayoutManager layoutManager = (GridLayoutManager) parent.getLayoutManager();</div><div class="line"></div><div class="line">      itemCount = layoutManager.getItemCount();</div><div class="line">      position = layoutManager.getPosition(view) + <span class="number">1</span>;</div><div class="line">      spanCount = layoutManager.getSpanCount();</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (parent.getLayoutManager() <span class="keyword">instanceof</span> StaggeredGridLayoutManager) &#123;</div><div class="line">      <span class="comment">//TODO 显示还有问题</span></div><div class="line">      StaggeredGridLayoutManager layoutManager = (StaggeredGridLayoutManager) parent</div><div class="line">          .getLayoutManager();</div><div class="line"></div><div class="line">      itemCount = layoutManager.getItemCount();</div><div class="line">      position = layoutManager.getPosition(view) + <span class="number">1</span>;</div><div class="line">      spanCount = layoutManager.getSpanCount();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> childSize = parent.getChildCount();</div><div class="line"></div><div class="line">    <span class="keyword">int</span> rowCount = itemCount / spanCount - <span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> lastRowStart = rowCount * spanCount;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> c = position % spanCount;</div><div class="line"></div><div class="line"><span class="comment">//    //    ---中间，四边都有</span></div><div class="line"><span class="comment">//    if (position &lt;= spanCount) &#123;</span></div><div class="line"><span class="comment">//      //如果是第一列</span></div><div class="line"><span class="comment">//      if (c == 1) &#123;</span></div><div class="line"><span class="comment">//        outRect.set(dividerDrawable.getIntrinsicWidth(), dividerDrawable.getIntrinsicWidth(),</span></div><div class="line"><span class="comment">//            dividerDrawable.getIntrinsicWidth(), dividerDrawable.getIntrinsicHeight());</span></div><div class="line"><span class="comment">//      &#125; else &#123;</span></div><div class="line"><span class="comment">//        outRect.set(0, dividerDrawable.getIntrinsicHeight(), dividerDrawable.getIntrinsicWidth(),</span></div><div class="line"><span class="comment">//            dividerDrawable.getIntrinsicHeight());</span></div><div class="line"><span class="comment">//      &#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//    &#125; else &#123;</span></div><div class="line"><span class="comment">//      //判断是否是第一列</span></div><div class="line"><span class="comment">//      if (c == 1) &#123;</span></div><div class="line"><span class="comment">//        outRect.set(dividerDrawable.getIntrinsicWidth(), 0, dividerDrawable.getIntrinsicWidth(),</span></div><div class="line"><span class="comment">//            dividerDrawable.getIntrinsicHeight());</span></div><div class="line"><span class="comment">//      &#125; else &#123;</span></div><div class="line"><span class="comment">//        outRect</span></div><div class="line"><span class="comment">//            .set(0, 0, dividerDrawable.getIntrinsicWidth(), dividerDrawable.getIntrinsicHeight());</span></div><div class="line"><span class="comment">//      &#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//    &#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//    //    \---中间，四边都有</span></div><div class="line"></div><div class="line"><span class="comment">//    ---只有中间才有分割线</span></div><div class="line">    <span class="keyword">if</span> (position &gt; lastRowStart) &#123;</div><div class="line">      <span class="comment">//最后一行</span></div><div class="line">      <span class="comment">//最后一列</span></div><div class="line">      <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</div><div class="line">        outRect.set(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        outRect.set(<span class="number">0</span>, <span class="number">0</span>, dividerDrawable.getIntrinsicWidth(), <span class="number">0</span>);</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</div><div class="line">        outRect.set(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, dividerDrawable.getIntrinsicHeight());</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        outRect</div><div class="line">            .set(<span class="number">0</span>, <span class="number">0</span>, dividerDrawable.getIntrinsicWidth(), dividerDrawable.getIntrinsicHeight());</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//    \---只有中间才有分割线</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用的时候添加一个布局管理器和一个分割线</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rv.setLayoutManager(new GridLayoutManager(this,3));</div><div class="line">rv.addItemDecoration(new ItemGridViewDecoration(this));</div></pre></td></tr></table></figure>
<h1 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h1><h2 id="item宽度一直是wrap-content"><a href="#item宽度一直是wrap-content" class="headerlink" title="item宽度一直是wrap_content"></a>item宽度一直是wrap_content</h2><p>布局里面我们一直是写的match_parent，但是运行后却不是，最后发现是inflate时没有穿parent</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//return ViewHolder(ViewGroup.inflate(parent.ctx, R.layout.item_weather, null),itemClick);</span></div><div class="line"><span class="comment">//return ViewHolder(View.inflate(parent.ctx, R.layout.item_weather, null),itemClick);</span></div><div class="line"><span class="keyword">return</span> ViewHolder(LayoutInflater.from(parent.context).inflate(R.layout.item_weather, parent,<span class="literal">false</span>),itemClick);</div></pre></td></tr></table></figure>
<h2 id="ScrollView嵌套"><a href="#ScrollView嵌套" class="headerlink" title="ScrollView嵌套"></a>ScrollView嵌套</h2><p>对于这个问题，网上的解决办法五花八门，但都是重写layoutManager的onMeasure方法，这样会有各种问题，要么兼容性不好，要么有性能问题，好消息是在23.2.0后，google提供了官方解决方法，我们只需要</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">layoutManager.isAutoMeasureEnabled = <span class="literal">true</span></div></pre></td></tr></table></figure>
<p>这样就不会有问题了</p>
<h1 id="瀑布流"><a href="#瀑布流" class="headerlink" title="瀑布流"></a>瀑布流</h1><h2 id="设置布局管理器-1"><a href="#设置布局管理器-1" class="headerlink" title="设置布局管理器"></a>设置布局管理器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rv = (RecyclerView) findViewById(R.id.rv);</div><div class="line">rv.setLayoutManager(<span class="keyword">new</span> StaggeredGridLayoutManager(<span class="number">3</span>, LinearLayout.VERTICAL));</div></pre></td></tr></table></figure>
<h2 id="设置高度"><a href="#设置高度" class="headerlink" title="设置高度"></a>设置高度</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ListAdapter.ViewHolder holder, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">  MyData data = getData(position);</div><div class="line">  LayoutParams layoutParams = holder.tv.getLayoutParams(); <span class="comment">//</span></div><div class="line">  layoutParams.height=data.getHeight();</div><div class="line">  holder.tv.setBackgroundColor(data.getColor());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通常使用这种方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">return new ViewHolder(layoutInflater.inflate(R.layout.item_1,parent,false));</div></pre></td></tr></table></figure>
<p>但是如果你使用了这种：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">return new ViewHolder(View.inflate(context,R.layout.item_1,null));</div></pre></td></tr></table></figure>
<p>如果你的item_1里面外层有ViewGroup包裹那也是没问题的，因为holder.tv.getLayoutParams()就能返回值了，如果没有包裹，那这里是空。</p>
<p>但是如果手动传值给parent给他，也会报错，只不过不是这里空指针。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">return new ViewHolder(View.inflate(context,R.layout.item_2,parent));</div></pre></td></tr></table></figure>
<p>如果这样就会报错：</p>
<p>java.lang.IllegalStateException: The specified child already has a parent. You must call removeView() on the child’s parent first.</p>
<p>原因是新创建的view是否添加到布局是由RecyelerView决定的，如果我们手动添加就会导致有两个父类。</p>
<p>解放方式是要么，在外层包裹一个ViewGroup,或者直接使用layoutInflater填充布局。一般不要用View.inflate，这就是偷懒的代价。</p>
<h2 id="动态更改List和瀑布流效果"><a href="#动态更改List和瀑布流效果" class="headerlink" title="动态更改List和瀑布流效果"></a>动态更改List和瀑布流效果</h2><p>只需要更改布局管理器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (isList) &#123;</div><div class="line">  rv.setLayoutManager(<span class="keyword">new</span> StaggeredGridLayoutManager(<span class="number">3</span>, LinearLayout.VERTICAL));</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">  rv.setLayoutManager(<span class="keyword">new</span> LinearLayoutManager(<span class="keyword">this</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;为什么要使用它&quot;&gt;&lt;a href=&quot;#为什么要使用它&quot; class=&quot;headerlink&quot; title=&quot;为什么要使用它&quot;&gt;&lt;/a&gt;为什么要使用它&lt;/h1&gt;&lt;p&gt;RecyclerView比ListView更灵活，比如我现在是显示一个List，过一会儿需要换成Gr
    
    </summary>
    
      <category term="Android" scheme="http://i.woblog.cn/categories/Android/"/>
    
    
      <category term="RecyclerView" scheme="http://i.woblog.cn/tags/RecyclerView/"/>
    
  </entry>
  
  <entry>
    <title>LinearLayoutCompat源码分析</title>
    <link href="http://i.woblog.cn/2017/03/04/LinearLayoutCompat-source/"/>
    <id>http://i.woblog.cn/2017/03/04/LinearLayoutCompat-source/</id>
    <published>2017-03-04T20:15:58.000Z</published>
    <updated>2017-03-19T14:22:37.664Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>他可以实现快速为里面的内容前，中和后面添加分割线，使用方法也很简单。</p>
<p>其中有几个很重要的属性：</p>
<p>app:divider=”@drawable/item_divider”：给他一个drawable,用来当做分割线</p>
<p>app:showDividers=”beginning|middle|end”：显示分割线的位置</p>
<h1 id="水平分割线"><a href="#水平分割线" class="headerlink" title="水平分割线"></a>水平分割线</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">HorizontalScrollView</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v7.widget.LinearLayoutCompat</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/ll_root_container"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"horizontal"</span></div><div class="line">    <span class="attr">app:divider</span>=<span class="string">"@drawable/item_divider"</span></div><div class="line">    <span class="attr">app:showDividers</span>=<span class="string">"beginning|middle|end"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.linealayoutcompat.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"100dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"1"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:background</span>=<span class="string">"#f00"</span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"100dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"1"</span> /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"100dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"1"</span> /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"100dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"1"</span> /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"100dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"1"</span> /&gt;</div><div class="line">  <span class="tag">&lt;/<span class="name">android.support.v7.widget.LinearLayoutCompat</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">HorizontalScrollView</span>&gt;</span></div></pre></td></tr></table></figure>
<h1 id="垂直分割线"><a href="#垂直分割线" class="headerlink" title="垂直分割线"></a>垂直分割线</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">ScrollView</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</div><div class="line">  <span class="tag">&lt;<span class="name">android.support.v7.widget.LinearLayoutCompat</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/ll_root_container"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">    <span class="attr">app:divider</span>=<span class="string">"@drawable/item_divider"</span></div><div class="line">    <span class="attr">app:showDividers</span>=<span class="string">"beginning|middle|end"</span></div><div class="line">    <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.linealayoutcompat.MainActivity"</span>&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"100dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"1"</span> /&gt;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:background</span>=<span class="string">"#f00"</span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"100dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"1"</span> /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"100dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"1"</span> /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"100dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"1"</span> /&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line">      <span class="attr">android:layout_width</span>=<span class="string">"100dp"</span></div><div class="line">      <span class="attr">android:layout_height</span>=<span class="string">"30dp"</span></div><div class="line">      <span class="attr">android:gravity</span>=<span class="string">"center"</span></div><div class="line">      <span class="attr">android:text</span>=<span class="string">"1"</span> /&gt;</div><div class="line">  <span class="tag">&lt;/<span class="name">android.support.v7.widget.LinearLayoutCompat</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ScrollView</span>&gt;</span></div></pre></td></tr></table></figure>
<p>item_divider.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span> </span></div><div class="line">    <span class="attr">android:shape</span>=<span class="string">"rectangle"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">size</span> <span class="attr">android:width</span>=<span class="string">"10dp"</span> <span class="attr">android:height</span>=<span class="string">"10dp"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">"#ff0000"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h1&gt;&lt;p&gt;他可以实现快速为里面的内容前，中和后面添加分割线，使用方法也很简单。&lt;/p&gt;
&lt;p&gt;其中有几个很重要的属性：&lt;/p&gt;
&lt;p&gt;app:divi
    
    </summary>
    
      <category term="Android" scheme="http://i.woblog.cn/categories/Android/"/>
    
    
      <category term="LinearLayoutCompat" scheme="http://i.woblog.cn/tags/LinearLayoutCompat/"/>
    
      <category term="View" scheme="http://i.woblog.cn/tags/View/"/>
    
  </entry>
  
  <entry>
    <title>Swipe Refresh Layout</title>
    <link href="http://i.woblog.cn/2017/03/01/swipe-refresh-layout/"/>
    <id>http://i.woblog.cn/2017/03/01/swipe-refresh-layout/</id>
    <published>2017-03-01T22:38:40.000Z</published>
    <updated>2017-03-19T14:22:37.668Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><p>用SwipeRefreshLayout包裹你要刷新的布局。然后在代码摄者一些参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">srl = (SwipeRefreshLayout) findViewById(R.id.srl);</div><div class="line">srl.setColorSchemeColors(Color.RED,Color.GREEN,Color.BLUE);</div><div class="line">srl.setProgressBackgroundColorSchemeColor(Color.DKGRAY);</div><div class="line"></div><div class="line">srl.setOnRefreshListener(<span class="keyword">new</span> OnRefreshListener() &#123;</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span> </span>&#123;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h1 id="ListPopupWindow"><a href="#ListPopupWindow" class="headerlink" title="ListPopupWindow"></a>ListPopupWindow</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">ArrayAdapter&lt;String&gt; stringArrayAdapter = <span class="keyword">new</span> ArrayAdapter&lt;String&gt;(<span class="keyword">this</span>,android.R</div><div class="line">.layout.simple_list_item_1,<span class="keyword">new</span> String[]&#123;<span class="string">"条目1"</span>,<span class="string">"条目1"</span>,<span class="string">"条目1"</span>,<span class="string">"条目1"</span>&#125;);</div><div class="line"><span class="keyword">final</span> ListPopupWindow listPopupWindow = <span class="keyword">new</span> ListPopupWindow(<span class="keyword">this</span>);</div><div class="line">listPopupWindow.setAdapter(stringArrayAdapter);</div><div class="line">listPopupWindow.setOnItemClickListener(<span class="keyword">new</span> OnItemClickListener() &#123;</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; adapterView, View view, <span class="keyword">int</span> i, <span class="keyword">long</span> l)</span> </span>&#123;</div><div class="line">    Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">"click："</span>+i, Toast.LENGTH_SHORT).show();</div><div class="line">    listPopupWindow.dismiss();</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line">listPopupWindow.setAnchorView(view);</div><div class="line">listPopupWindow.show();</div></pre></td></tr></table></figure>
<h1 id="PopupMenu"><a href="#PopupMenu" class="headerlink" title="PopupMenu"></a>PopupMenu</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">PopupMenu popupMenu = <span class="keyword">new</span> PopupMenu(<span class="keyword">this</span>, view);</div><div class="line">popupMenu.getMenuInflater().inflate(R.menu.main,popupMenu.getMenu());</div><div class="line">popupMenu.setOnMenuItemClickListener(<span class="keyword">new</span> OnMenuItemClickListener() &#123;</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onMenuItemClick</span><span class="params">(MenuItem item)</span> </span>&#123;</div><div class="line">    Toast.makeText(MainActivity.<span class="keyword">this</span>, item.getTitle(), Toast.LENGTH_SHORT).show();</div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line">popupMenu.show();</div></pre></td></tr></table></figure>
<h1 id="LinearLayoutCompat"><a href="#LinearLayoutCompat" class="headerlink" title="LinearLayoutCompat"></a>LinearLayoutCompat</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">android.support.v7.widget.LinearLayoutCompat</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">  <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></div><div class="line">  <span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></div><div class="line">  <span class="attr">android:id</span>=<span class="string">"@+id/activity_main"</span></div><div class="line">  <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></div><div class="line">  <span class="attr">android:orientation</span>=<span class="string">"vertical"</span></div><div class="line">  <span class="attr">app:divider</span>=<span class="string">"@android:drawable/divider_horizontal_bright"</span></div><div class="line">  <span class="attr">app:showDividers</span>=<span class="string">"middle|end|beginning"</span></div><div class="line">  <span class="attr">tools:context</span>=<span class="string">"cn.woblog.android.androiddialog.MainActivity"</span>&gt;</div></pre></td></tr></table></figure>
<p>可以自动给每个条目前后添加分割线</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h1&gt;&lt;h1 id=&quot;基本使用&quot;&gt;&lt;a href=&quot;#基本使用&quot; class=&quot;headerlink&quot; title=&quot;基本使用&quot;&gt;&lt;/a&gt;基本使用&lt;/h
    
    </summary>
    
      <category term="Android" scheme="http://i.woblog.cn/categories/Android/"/>
    
    
      <category term="Refresh" scheme="http://i.woblog.cn/tags/Refresh/"/>
    
  </entry>
  
  <entry>
    <title>Android Dialog</title>
    <link href="http://i.woblog.cn/2017/03/01/android-dialog/"/>
    <id>http://i.woblog.cn/2017/03/01/android-dialog/</id>
    <published>2017-03-01T21:49:11.000Z</published>
    <updated>2017-03-19T14:22:37.664Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><h1 id="确定取消"><a href="#确定取消" class="headerlink" title="确定取消"></a>确定取消</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">AlertDialog.Builder builder=<span class="keyword">new</span> AlertDialog.Builder(<span class="keyword">this</span>);</div><div class="line">builder.setTitle(<span class="string">"这是对话框标题"</span>);</div><div class="line">builder.setMessage(<span class="string">"消息"</span>);</div><div class="line">builder.setPositiveButton(<span class="string">"确定"</span>, <span class="keyword">new</span> OnClickListener() &#123;</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialogInterface, <span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line">builder.setNegativeButton(<span class="string">"取消"</span>, <span class="keyword">new</span> OnClickListener() &#123;</div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialogInterface, <span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line">builder.show();</div></pre></td></tr></table></figure>
<p>如果导入android的包在19和23上效果很差，如果导入android.support.v7.app.AlertDialog效果相同。该类在appcompat-v7中。</p>
<p>该包还有其他的控件：AppCompatEditText，AppCompatButton</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h1&gt;&lt;h1 id=&quot;确定取消&quot;&gt;&lt;a href=&quot;#确定取消&quot; class=&quot;headerlink&quot; title=&quot;确定取消&quot;&gt;&lt;/a&gt;确定取消&lt;/h
    
    </summary>
    
      <category term="Android" scheme="http://i.woblog.cn/categories/Android/"/>
    
    
      <category term="Dialog" scheme="http://i.woblog.cn/tags/Dialog/"/>
    
  </entry>
  
  <entry>
    <title>常用alias</title>
    <link href="http://i.woblog.cn/2017/02/26/material-design/"/>
    <id>http://i.woblog.cn/2017/02/26/material-design/</id>
    <published>2017-02-26T17:21:44.000Z</published>
    <updated>2017-03-19T14:22:37.668Z</updated>
    
    <content type="html"><![CDATA[<h1 id="什么是Material-Design"><a href="#什么是Material-Design" class="headerlink" title="什么是Material Design"></a>什么是Material Design</h1><p>Android5.0引入的，是一种全新的设计语言，翻译为原材料设计，是Goole提倡的一种设计风格，理念，原则。是拟物设计和扁平设计的一种结合。</p>
<p>层次感：z轴</p>
<p>1.对于美工：遵循MD的界面设计，图标合集</p>
<p>2.对于产品：页面的跳转，动画效果，交互设计。</p>
<p>3.对于开发：参与原型，辅助美工原型设计。开发实现，界面，动画，专场</p>
<h1 id="如何开发MD效果"><a href="#如何开发MD效果" class="headerlink" title="如何开发MD效果"></a>如何开发MD效果</h1><p>使用appcompat包，自定义控件实现MD效果</p>
<p>v4:最低兼容到android1.6,ViewPager</p>
<p>v7:2.1,appcompat,cardview,gridlayout,mediarouter,palette,preference,recyclerview(3.0)，该包让开发人员统一开发标准，在任何系统版本保证统一，如：Theme,value，布局，新的特性，动画</p>
<p>现在一般兼容到4.0</p>
<h1 id="Theme"><a href="#Theme" class="headerlink" title="Theme"></a>Theme</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.Light.DarkActionBar"</span>&gt;</span><span class="xml"></span></div><div class="line">  <span class="comment">&lt;!-- Customize your theme here. --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimary"</span>&gt;</span>#f00<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorPrimaryDark"</span>&gt;</span>#0f0<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"colorAccent"</span>&gt;</span>#00f<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:textColor"</span>&gt;</span>#080<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>colorPrimary:主色调用于标题栏，Toolbar背景</p>
<p>colorPrimaryDark：次(深)主色调，用于状态栏，底部导航栏</p>
<p>colorAccent：每个控件的主色调，比如RatingBar的填充色</p>
<p>android:textColor：所有文本颜色</p>
<p>android:navigationBarColor:屏幕底部导航栏颜色，21才有</p>
<h1 id="Android历史上重要的版本"><a href="#Android历史上重要的版本" class="headerlink" title="Android历史上重要的版本"></a>Android历史上重要的版本</h1><p>14:4.0</p>
<p>19:4.4</p>
<p>21:5.0</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;什么是Material-Design&quot;&gt;&lt;a href=&quot;#什么是Material-Design&quot; class=&quot;headerlink&quot; title=&quot;什么是Material Design&quot;&gt;&lt;/a&gt;什么是Material Design&lt;/h1&gt;&lt;p&gt;Androi
    
    </summary>
    
      <category term="Android" scheme="http://i.woblog.cn/categories/Android/"/>
    
    
      <category term="Material Design" scheme="http://i.woblog.cn/tags/Material-Design/"/>
    
  </entry>
  
  <entry>
    <title>数据结构-线性表</title>
    <link href="http://i.woblog.cn/2017/02/14/data-structure-line-table/"/>
    <id>http://i.woblog.cn/2017/02/14/data-structure-line-table/</id>
    <published>2017-02-14T18:28:48.000Z</published>
    <updated>2017-03-19T14:22:37.664Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>线性表：</p>
<p>顺序表(数组)，链表</p>
<p>链表：</p>
<p>静态链表，单链表，循环链表，双向链表</p>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>常见的应用场景，比如通讯录，有增加，删除，搜索。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h1&gt;&lt;p&gt;线性表：&lt;/p&gt;
&lt;p&gt;顺序表(数组)，链表&lt;/p&gt;
&lt;p&gt;链表：&lt;/p&gt;
&lt;p&gt;静态链表，单链表，循环链表，双向链表&lt;/p&gt;
&lt;h2 id
    
    </summary>
    
      <category term="DataStructure" scheme="http://i.woblog.cn/categories/DataStructure/"/>
    
    
      <category term="LineTable" scheme="http://i.woblog.cn/tags/LineTable/"/>
    
  </entry>
  
  <entry>
    <title>C++</title>
    <link href="http://i.woblog.cn/2017/02/14/c++/"/>
    <id>http://i.woblog.cn/2017/02/14/c++/</id>
    <published>2017-02-14T11:48:58.000Z</published>
    <updated>2017-03-19T14:22:37.664Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>c++的诞生地是贝尔实验室，作者是比亚尼.斯特劳斯特录普博士。</p>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>嵌入式，游戏编程，网络编程，系统编程</p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>快：运行速度快</p>
<p>省：节省内存资源</p>
<h2 id="c与c-关系"><a href="#c与c-关系" class="headerlink" title="c与c++关系"></a>c与c++关系</h2><p>c是c++的一个子集，也就是说将c代码拷贝到c++的编译环境中编译时完全没问题的。</p>
<p>c++是从c的基础发展而来的</p>
<p>c语言是面向过程</p>
<p>c++支持面向过和面向对象</p>
<h2 id="HelloC"><a href="#HelloC" class="headerlink" title="HelloC++"></a>HelloC++</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt; //包含c++标准输入输出库</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>; <span class="comment">//命名空间</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Hello c++"</span> &lt;&lt; <span class="built_in">endl</span>; <span class="comment">//输出,并换行</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="新特性"><a href="#新特性" class="headerlink" title="新特性"></a>新特性</h1><h2 id="新增数据类型"><a href="#新增数据类型" class="headerlink" title="新增数据类型"></a>新增数据类型</h2><table>
<thead>
<tr>
<th>语言</th>
<th>逻辑类型</th>
<th>真</th>
<th>假</th>
</tr>
</thead>
<tbody>
<tr>
<td>c</td>
<td>没提供</td>
<td>非0</td>
<td>0</td>
</tr>
<tr>
<td>c++</td>
<td>bool</td>
<td>true</td>
<td>false</td>
</tr>
</tbody>
</table>
<p>有什么好处，当我们使用c语言的时候，就这样使用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">testCBool</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> flag=<span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span> (flag == <span class="number">1</span>) &#123;</div><div class="line">        <span class="comment">//为真的时候执行</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">//为假执行</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>而在c++中就这样使用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">testCppBool</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">bool</span> flag= <span class="literal">true</span>;</div><div class="line">    <span class="keyword">if</span> (flag) &#123;</div><div class="line">        <span class="comment">//为真的时候执行</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">//为假执行</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="初始化方法"><a href="#初始化方法" class="headerlink" title="初始化方法"></a>初始化方法</h2><h3 id="c语言"><a href="#c语言" class="headerlink" title="c语言"></a>c语言</h3><p>只有一种，叫复制初始化</p>
<p>int x=1024;</p>
<h3 id="c"><a href="#c" class="headerlink" title="c++"></a>c++</h3><p>他提供了两种，一种是复制初始化(和c语言一样)，另一种是直接初始化。</p>
<p>int x(1024);</p>
<h2 id="随用随定义"><a href="#随用随定义" class="headerlink" title="随用随定义"></a>随用随定义</h2><p>C语言：所以变量定义必须位于函数体的最前面</p>
<p>c++:所有变量随用随定义</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">testCDefinVar</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> v1=<span class="number">3</span>;</div><div class="line">    <span class="keyword">int</span> v2=<span class="number">4</span>;</div><div class="line"></div><div class="line">    v1=v1+<span class="number">2</span>;</div><div class="line">    v2=v2+v1;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">testCppDefinVar</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> v1=<span class="number">3</span>;</div><div class="line">    v1=v1+<span class="number">2</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">int</span> v2=<span class="number">4</span>;</div><div class="line">    v2=v2+v1;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="输入输出"><a href="#输入输出" class="headerlink" title="输入输出"></a>输入输出</h1><p>在c++中scanf用cin代替，printf用cout代替</p>
<h2 id="cout"><a href="#cout" class="headerlink" title="cout"></a>cout</h2><p>cout&lt;&lt;x&lt;&lt;endl;</p>
<p>cout&lt;&lt;”x+y=”&lt;&lt;x+y&lt;&lt;endl;</p>
<p>cout&lt;&lt;x,y,z&lt;&lt;endl; //错误</p>
<h2 id="cin"><a href="#cin" class="headerlink" title="cin"></a>cin</h2><p>cin&gt;&gt;x;</p>
<p>cin&gt;&gt;x&gt;&gt;y;</p>
<h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><p>不关注暂未符，不关心数据类型，所以不易出现问题。</p>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//1.提示输入一个整数,并将该整数用8,10,16进制打印</span></div><div class="line">    <span class="comment">//2.提示输入一个布尔值(0,1),并以布尔的方式打印</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"请输入一个整数:"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">int</span> x=<span class="number">0</span>;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;x;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;oct&lt;&lt;x&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;dec&lt;&lt;x&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;hex&lt;&lt;x&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"请输入一个布尔值(0,1):"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">bool</span> y= <span class="literal">false</span>;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;y;</div><div class="line"></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;boolalpha&lt;&lt;y&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h1><p>划片取名字。</p>
<h2 id="为什么要有名称空间"><a href="#为什么要有名称空间" class="headerlink" title="为什么要有名称空间"></a>为什么要有名称空间</h2><p>防止命名冲突</p>
<h2 id="练习：模拟c公司购买了a-b两家公司的软件"><a href="#练习：模拟c公司购买了a-b两家公司的软件" class="headerlink" title="练习：模拟c公司购买了a,b两家公司的软件"></a>练习：模拟c公司购买了a,b两家公司的软件</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>; <span class="comment">//命名空间</span></div><div class="line"></div><div class="line"><span class="comment">//a公司代码</span></div><div class="line"><span class="keyword">namespace</span> A</div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> x=<span class="number">1</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"A"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> B</div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> x=<span class="number">2</span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"B"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fun2</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"2B"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> B;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//使用这两个公司的代码</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;A::x&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="comment">//因为上面使用了命名空间b,所以从这里找</span></div><div class="line">    fun();</div><div class="line">    fun2();</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="练习：最大值和最小值"><a href="#练习：最大值和最小值" class="headerlink" title="练习：最大值和最小值"></a>练习：最大值和最小值</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt; //包含c++标准输入输出库</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>; <span class="comment">//命名空间</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> CompA&#123;</div><div class="line">    <span class="comment">//定义一个函数,找出整型数组中的最大值,最小值</span></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getMaxOrMin</span><span class="params">(<span class="keyword">int</span> *arr,<span class="keyword">int</span> count,<span class="keyword">bool</span> isMax)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> temp=arr[<span class="number">0</span>];</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; count; ++i) &#123;</div><div class="line">            <span class="keyword">if</span> (isMax) &#123;</div><div class="line">                <span class="keyword">if</span> (temp &lt; arr[i]) &#123;</div><div class="line">                    temp=arr[i];</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">if</span> (temp &gt; arr[i]) &#123;</div><div class="line">                    temp=arr[i];</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> temp;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> arr[]=&#123;<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">8</span>&#125;;</div><div class="line">    <span class="keyword">bool</span>  isMax= <span class="literal">false</span>;</div><div class="line">    <span class="built_in">cin</span>&gt;&gt;isMax;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;CompA::getMaxOrMin(arr,<span class="number">4</span>,isMax)&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="c-引用-别名"><a href="#c-引用-别名" class="headerlink" title="c++引用(别名)"></a>c++引用(别名)</h1><p>引用就是变量的别名。不能只有别名。</p>
<h2 id="基本类型"><a href="#基本类型" class="headerlink" title="基本类型"></a>基本类型</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt; //包含c++标准输入输出库</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>; <span class="comment">//命名空间</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">    <span class="comment">//定义别名,是在变量名前加&amp;</span></div><div class="line">    <span class="keyword">int</span> a=<span class="number">10</span>;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> &amp;b=a;</div><div class="line"></div><div class="line">    b=<span class="number">20</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;a&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//20</span></div><div class="line"></div><div class="line">    a=<span class="number">30</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;b&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//30</span></div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">int</span> y;</div><div class="line">&#125;Point;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">    Point p;</div><div class="line"></div><div class="line">    Point &amp;p1=p;</div><div class="line"></div><div class="line">    p1.x=<span class="number">10</span>;</div><div class="line">    p1.y=<span class="number">20</span>;</div><div class="line"></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;p.x&lt;&lt;<span class="string">","</span>&lt;&lt;p.y&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">int</span> a=<span class="number">3</span>;</div><div class="line">    <span class="keyword">int</span> *p=&amp;a;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> *&amp;q=p;</div><div class="line"></div><div class="line">    *q=<span class="number">5</span>; <span class="comment">//由于q是p的别名,所以*q和*p都是访问的a</span></div><div class="line"></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;a&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//5</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>使用别名交换两个变量的值，如果是在c中，只能使用指针</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt; //包含c++标准输入输出库</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>; <span class="comment">//命名空间</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;a,<span class="keyword">int</span> &amp;b)</span></span>; <span class="comment">//函数原型声明</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> x=<span class="number">10</span>;</div><div class="line">    <span class="keyword">int</span> y=<span class="number">20</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;x&lt;&lt;<span class="string">","</span>&lt;&lt;y&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//10,20</span></div><div class="line"></div><div class="line">    swap(x,y);</div><div class="line"></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;x&lt;&lt;<span class="string">","</span>&lt;&lt;y&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//20,10</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;a,<span class="keyword">int</span> &amp;b)</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> c=a;</div><div class="line">    a=b;</div><div class="line">    b=c;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="const"><a href="#const" class="headerlink" title="const"></a>const</h1><p>控制变量的值是否可以改变。</p>
<h2 id="基本类型-1"><a href="#基本类型-1" class="headerlink" title="基本类型"></a>基本类型</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> x=<span class="number">3</span>;<span class="comment">//常量，不能改变x的值</span></div></pre></td></tr></table></figure>
<h2 id="指针-1"><a href="#指针-1" class="headerlink" title="指针"></a>指针</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//功能等价</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> *p =<span class="literal">NULL</span>;</div><div class="line"><span class="keyword">int</span> <span class="keyword">const</span> *p=<span class="literal">NULL</span>;</div><div class="line"></div><div class="line"><span class="keyword">int</span> * <span class="keyword">const</span> p = <span class="literal">NULL</span>;</div><div class="line"></div><div class="line"><span class="comment">//等价</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> * <span class="keyword">const</span> p=<span class="literal">NULL</span>;</div><div class="line"><span class="keyword">int</span> <span class="keyword">const</span> * <span class="keyword">const</span> p =<span class="literal">NULL</span>;</div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> x=<span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> *p=&amp;x;</div><div class="line"></div><div class="line"><span class="keyword">int</span> y=<span class="number">10</span>;</div><div class="line">p=&amp;y; <span class="comment">//正确，因为const修饰的是*p，也就是说不能改变*p的值</span></div><div class="line"><span class="comment">//*p=4; //错误</span></div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> x=<span class="number">3</span>;</div><div class="line"><span class="keyword">int</span> * <span class="keyword">const</span> p=&amp;x;</div><div class="line"></div><div class="line"><span class="keyword">int</span> y=<span class="number">10</span>;</div><div class="line"><span class="comment">//p=&amp;y;//错误，因为const修饰的是p</span></div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> x=<span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> * <span class="keyword">const</span> p=&amp;x;</div><div class="line"><span class="comment">//p=&amp;y; //错误，是因为int *后面的const修饰符</span></div><div class="line"><span class="comment">//*p=4;//错误，是int *前面的修饰符</span></div></pre></td></tr></table></figure>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> x=<span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> &amp;y=x;</div><div class="line">x=<span class="number">10</span>;<span class="comment">//正确</span></div><div class="line"><span class="comment">//y=30;//错误，因为const修饰的是y</span></div></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> x=<span class="number">3</span>;</div><div class="line">x=<span class="number">5</span>; <span class="comment">//错误</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> x=<span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> y=x;</div><div class="line">y=<span class="number">5</span>;<span class="comment">//错误</span></div><div class="line"></div><div class="line"><span class="keyword">int</span> x=<span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> *y=&amp;x;</div><div class="line">*y=<span class="number">5</span>;</div><div class="line"></div><div class="line"><span class="keyword">int</span> x=<span class="number">3</span>,z=<span class="number">4</span>;</div><div class="line"><span class="keyword">int</span> * <span class="keyword">const</span> y=&amp;x;</div><div class="line">y=&amp;z;<span class="comment">//错误</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> x=<span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> &amp;y=x;</div><div class="line">y=<span class="number">5</span>;<span class="comment">//错误</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> x=<span class="number">3</span>;</div><div class="line"><span class="keyword">int</span> *y=&amp;x; <span class="comment">//错误，因为x是不可以，但我们定义的y指针是可变的，编译器报错,这样改const int *y=&amp;x;</span></div><div class="line"></div><div class="line"><span class="comment">//这样没问题，是因为用小权限接收大权限是可以的</span></div><div class="line"><span class="keyword">int</span> x=<span class="number">3</span>;</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> *y=&amp;x;</div></pre></td></tr></table></figure>
<h2 id="函数-1"><a href="#函数-1" class="headerlink" title="函数"></a>函数</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp;a, <span class="keyword">const</span> <span class="keyword">int</span> &amp;b)</span></span>&#123;</div><div class="line">    a=<span class="number">10</span>;</div><div class="line">    b=<span class="number">20</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>用const修饰了，里面就不能改变变量(常量)的值了</p>
<h2 id="常对象成员和常成员函数"><a href="#常对象成员和常成员函数" class="headerlink" title="常对象成员和常成员函数"></a>常对象成员和常成员函数</h2><p>这样声明</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> Coordinate m_pCoorA;</div><div class="line"></div><div class="line"><span class="comment">//也可以这样</span></div><div class="line">Coordinate <span class="keyword">const</span> m_pCoorA;</div></pre></td></tr></table></figure>
<p>改进上面的例子，将Line其中的一个成员改为常成员，并添加一些常成员函数。</p>
<p>Coordinate.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Coordinate_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Coordinate_hpp</span></div><div class="line"></div><div class="line"><span class="keyword">class</span>  Coordinate&#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Coordinate(<span class="keyword">int</span> x,<span class="keyword">int</span> y);</div><div class="line">    ~Coordinate();</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span> <span class="keyword">const</span></span>; <span class="comment">//因为该类，有可能在其他类声明了常成员，所以要定义常成员函数，不然无法编译，也就是说在该函数中不能改变常成员的值</span></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span> <span class="keyword">const</span></span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> m_iX;</div><div class="line">    <span class="keyword">int</span> m_iY;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Coordinate_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Coordinate.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Coordinate.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Coordinate::Coordinate(<span class="keyword">int</span> x,<span class="keyword">int</span> y)&#123;</div><div class="line">    m_iX=x;</div><div class="line">    m_iY=y;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Coordinate(int x,int y)"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Coordinate::~Coordinate()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Coordinate"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Coordinate::getX() <span class="keyword">const</span>&#123;</div><div class="line">    <span class="keyword">return</span> m_iX;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Coordinate::getY() <span class="keyword">const</span>&#123;</div><div class="line">    <span class="keyword">return</span> m_iY;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Line.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Line_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Line_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Coordinate.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Line &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Line(<span class="keyword">int</span> x1,<span class="keyword">int</span> y1,<span class="keyword">int</span> x2,<span class="keyword">int</span> y2);</div><div class="line">    ~Line();</div><div class="line">    </div><div class="line">    <span class="comment">//这两个函数重载</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printInfo</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printInfo</span><span class="params">()</span> <span class="keyword">const</span></span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">const</span> Coordinate m_pCoorA;</div><div class="line">    Coordinate m_pCoorB;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Line_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Line.cpp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">#include &lt;iostream&gt;</div><div class="line"></div><div class="line">#include &quot;Line.hpp&quot;</div><div class="line"></div><div class="line">using namespace std;</div><div class="line"></div><div class="line">Line::Line(int x1,int y1,int x2,int y2):m_pCoorA(x1,y1),m_pCoorB(x2,y2)&#123;</div><div class="line">    cout&lt;&lt;&quot;Line()&quot;&lt;&lt;endl;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Line::~Line()&#123;</div><div class="line">    </div><div class="line">    cout&lt;&lt;&quot;~Line()&quot;&lt;&lt;endl;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void Line::printInfo()&#123;</div><div class="line">    cout&lt;&lt;&quot;printinfo()&quot;&lt;&lt;endl;</div><div class="line">    cout&lt;&lt;m_pCoorA.getX()&lt;&lt;&quot;,&quot;&lt;&lt;m_pCoorA.getY()&lt;&lt;endl;</div><div class="line">    cout&lt;&lt;m_pCoorB.getX()&lt;&lt;&quot;,&quot;&lt;&lt;m_pCoorB.getY()&lt;&lt;endl;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void Line::printInfo() const&#123;</div><div class="line">    cout&lt;&lt;&quot;printinfo() const&quot;&lt;&lt;endl;</div><div class="line">    cout&lt;&lt;m_pCoorA.getX()&lt;&lt;&quot;,&quot;&lt;&lt;m_pCoorA.getY()&lt;&lt;endl;</div><div class="line">    cout&lt;&lt;m_pCoorB.getX()&lt;&lt;&quot;,&quot;&lt;&lt;m_pCoorB.getY()&lt;&lt;endl;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//这样就调用到了const函数</span></div><div class="line"><span class="function"><span class="keyword">const</span> Line <span class="title">line</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span></span>;</div><div class="line">line.printInfo();</div></pre></td></tr></table></figure>
<h2 id="对象常指针和对象常引用"><a href="#对象常指针和对象常引用" class="headerlink" title="对象常指针和对象常引用"></a>对象常指针和对象常引用</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function">Line <span class="title">line</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span></span>;</div><div class="line"></div><div class="line"><span class="keyword">const</span> Line &amp;l1=line; <span class="comment">//常对象引用</span></div><div class="line"><span class="keyword">const</span> Line *l2=&amp;line; <span class="comment">//常对象指针</span></div></pre></td></tr></table></figure>
<p>综合案例</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="keyword">class</span> Coordinate</div><div class="line">&#123;</div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">	Coordinate(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">// 设置X,Y的坐标</span></div><div class="line">		m_iX=x;</div><div class="line">        m_iY=y;</div><div class="line">	&#125;</div><div class="line">    <span class="comment">// 实现常成员函数</span></div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">printInfo</span><span class="params">()</span> <span class="keyword">const</span></span></div><div class="line">	&#123;</div><div class="line">	    <span class="built_in">cout</span>&lt;&lt;<span class="string">"("</span>&lt;&lt;m_iX&lt;&lt;<span class="string">","</span>&lt;&lt;m_iY&lt;&lt;<span class="string">")"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">	&#125;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">	<span class="keyword">int</span> m_iX;</div><div class="line">	<span class="keyword">int</span> m_iY;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="function"><span class="keyword">const</span> Coordinate <span class="title">coor</span><span class="params">(<span class="number">3</span>, <span class="number">5</span>)</span></span>;</div><div class="line"></div><div class="line">	<span class="comment">// 创建常指针p</span></div><div class="line">	<span class="keyword">const</span> Coordinate *p=&amp;coor;</div><div class="line">    <span class="comment">// 创建常引用c</span></div><div class="line">    <span class="keyword">const</span> Coordinate &amp;c=coor;</div><div class="line">	</div><div class="line">	coor.printInfo();</div><div class="line">	p-&gt;printInfo();</div><div class="line">	c.printInfo();  </div><div class="line">	</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(3,5)</div><div class="line">(3,5)</div><div class="line">(3,5)</div></pre></td></tr></table></figure>
<h1 id="函数新特性"><a href="#函数新特性" class="headerlink" title="函数新特性"></a>函数新特性</h1><h2 id="函数参数默认值"><a href="#函数参数默认值" class="headerlink" title="函数参数默认值"></a>函数参数默认值</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//声明的时候写默认值</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j=<span class="number">5</span>,<span class="keyword">int</span> k=<span class="number">1</span>)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">//定义的时候不写,因为写了,有些编译器报错</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j,<span class="keyword">int</span> k)</span></span>&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">int</span> i=<span class="number">10</span>,<span class="keyword">int</span> j=<span class="number">20</span>)</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    fun();</div><div class="line">    fun(<span class="number">100</span>);</div><div class="line">    fun(<span class="number">200</span>,<span class="number">300</span>);</div><div class="line"></div><div class="line"><span class="comment">//    10,20</span></div><div class="line"><span class="comment">//    100,20</span></div><div class="line"><span class="comment">//    200,300</span></div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span>&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;i&lt;&lt;<span class="string">","</span>&lt;&lt;j&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="函数重载"><a href="#函数重载" class="headerlink" title="函数重载"></a>函数重载</h2><p>在相同作用域中，函数名相同，参数个数或类型不一样，叫重载。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//生成的函数名为getMax_int_int</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getMax</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//生成的函数名为getMax_double_double</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getMax</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y)</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0.0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="内联函数"><a href="#内联函数" class="headerlink" title="内联函数"></a>内联函数</h2><p>普通函数执行流程：</p>
<p>main函数-调用fun方法的过程：</p>
<p>先找到fun函数的入口地址，然后准备参数，跳转到改函数地址，开始执行，执行完了以后处理返回值，跳转到main函数的位置，继续执行main函数。</p>
<p>内联函数：</p>
<p>编译时将函数体代码和实参代替函数的调用语句。</p>
<p>实例：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span> (a &gt; b) &#123;</div><div class="line">        <span class="keyword">return</span> a;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> b;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> x=<span class="number">10</span>;</div><div class="line">    <span class="keyword">int</span> y=<span class="number">20</span>;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> m=max(x,y);</div><div class="line"></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;m&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>相当于</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">int</span> x=<span class="number">10</span>;</div><div class="line">    <span class="keyword">int</span> y=<span class="number">20</span>;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> m=<span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">//max函数的展开代码</span></div><div class="line">    <span class="keyword">int</span> a=x;</div><div class="line">    <span class="keyword">int</span> b=y;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (a &gt; b) &#123;</div><div class="line">        m= a;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        m= b;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;m&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>问：为什么所以函数不都使用成内联函数呢？</p>
<p>1.内联是编译器决定的，也就是说你全加上，有可能他没有编译为内联</p>
<p>2.逻辑简单，调用频繁的建议使用</p>
<p>3.如果内联函数写成了递归，就无法成为内联函数了</p>
<h1 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h1><p>内存的本质是：资源</p>
<p>谁掌控内存资源：操作系统</p>
<p>我们能做什么：申请/归还</p>
<h2 id="申请和是否内存运算符"><a href="#申请和是否内存运算符" class="headerlink" title="申请和是否内存运算符"></a>申请和是否内存运算符</h2><p>申请内存:new</p>
<p>释放内存：delete</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//int *p=new int(10);</span></div><div class="line"><span class="comment">//还可以这样</span></div><div class="line"><span class="keyword">int</span> *p=<span class="keyword">new</span> <span class="keyword">int</span>;</div><div class="line"><span class="keyword">if</span> (<span class="literal">NULL</span>!=p) &#123;</div><div class="line">    *p=<span class="number">20</span>;</div><div class="line">    </div><div class="line">    <span class="built_in">cout</span>&lt;&lt;*p&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">delete</span> p;</div><div class="line">    p=<span class="literal">NULL</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//块内存的申请和释放</span></div><div class="line"><span class="keyword">int</span> *p=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">100</span>];</div><div class="line"><span class="keyword">if</span> (<span class="literal">NULL</span>!=p) &#123;</div><div class="line">    p[<span class="number">0</span>]=<span class="number">20</span>;</div><div class="line">    p[<span class="number">1</span>]=<span class="number">10</span>;</div><div class="line"></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;p[<span class="number">0</span>]&lt;&lt;<span class="string">","</span>&lt;&lt;p[<span class="number">1</span>]&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="keyword">delete</span> []p;</div><div class="line">    p=<span class="literal">NULL</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="实例：拷贝字符串"><a href="#实例：拷贝字符串" class="headerlink" title="实例：拷贝字符串"></a>实例：拷贝字符串</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//在堆中申请100个char类型的内存</span></div><div class="line">    <span class="keyword">char</span> *str = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">100</span>];</div><div class="line">    <span class="comment">//拷贝Hello C++字符串到分配的堆中的内存中</span></div><div class="line">    <span class="built_in">strcpy</span>(str, <span class="string">"Hello C++"</span>);</div><div class="line">    <span class="comment">//打印字符串</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;str&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="comment">//释放内存</span></div><div class="line">    <span class="keyword">delete</span> []str;</div><div class="line">    str=<span class="literal">NULL</span>;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>类</p>
<p>定义类</p>
<pre><code>class Point {

public:
    int x;
    int y;
    void printX(){
        cout&lt;&lt;x&lt;&lt;endl;
    }
    void printY(){
        cout&lt;&lt;y&lt;&lt;endl;
    }
};
</code></pre><p>实例化对象</p>
<p>在栈上创建对象:</p>
<pre><code>//通过栈的方式实例化对象
Point point;
point.x=10;
point.y=20;

point.printX();
point.printY();
</code></pre><p>在堆上创建对象：</p>
<pre><code>Point *point=new Point();
if (NULL==point) {
    //实例化对象失败
    return 0;
}

point-&gt;x=100;
point-&gt;y=200;
point-&gt;printX();
point-&gt;printY();
</code></pre><p>字符串</p>
<p>初始化方式</p>
<pre><code>string s1;
string s2(&quot;abc&quot;);
string s3(s2);
string s4(3,&apos;c&apos;);

cout&lt;&lt;s1&lt;&lt;endl;
cout&lt;&lt;s2&lt;&lt;endl;
cout&lt;&lt;s3&lt;&lt;endl;
cout&lt;&lt;s4&lt;&lt;endl;
</code></pre><p>常用函数</p>
<p>  方法名        作用<br>  s.empty    字符串为空，返回true，否则false<br>  s.size     字符的个数<br>  s[n]       返回s中n位置的字符<br>  s1+s2      连接字符串<br>  s1=s2      将s1的内容替换为s2的副本<br>  v1==v2     内容相等，返回true<br>  v1!=v2     内容不相等，返回true        </p>
<pre><code>string s1=&quot;hello&quot;;
string s2(&quot;world&quot;);
string s3=s1+s2;
string s4=&quot;hello&quot; +s2;
string s5=&quot;hello&quot;+s2+&quot;world&quot;;

//    string s6=&quot;hello&quot;+&quot;world&quot;; //这种方式错误，只有一端是一个变量才可以，而java中则可以
</code></pre><p>实例：读取用户姓名</p>
<pre><code>cout&lt;&lt;&quot;请输入用户名：&quot;&lt;&lt;endl;
string name;
getline(cin, name);

cout&lt;&lt;name&lt;&lt;endl;

if (name.empty()) {
    cout&lt;&lt;&quot;输入的姓名不能为空&quot;&lt;&lt;endl;
    return 0;
}

cout&lt;&lt;&quot;Hello &quot;+name&lt;&lt;endl;
cout&lt;&lt;&quot;你的名字长度：&quot;&lt;&lt;name.size()&lt;&lt;endl;
cout&lt;&lt;&quot;你的名字首字母是：&quot;&lt;&lt;name[0]&lt;&lt;endl;

if (&quot;admin&quot;==name) {
    cout&lt;&lt;&quot;你是一个管理员&quot;&lt;&lt;endl;
}
</code></pre><p>封装</p>
<p>他的好处是保护数据不被恶意篡改。下面模拟一个用户的实例化，然后打印用户信息：</p>
<pre><code>#include &lt;iostream&gt;
#include &lt;string&gt;

using namespace std;

class Student {


public:
    void setName(string _name){
        m_strName=_name;
    }
    string getName(){
        return m_strName;
    }
    void setGender(string _gender){
        m_strGender=_gender;
    }
    string getGender(){
        return m_strGender;
    }
    int getScore(){
        return m_iScore;
    }

    void initScore(){
        m_iScore=0;
    }

    void study(int _score){
        m_iScore+=_score;
    }

private:
    string m_strName;
    string m_strGender;
    int m_iScore;
};

int main(){
    Student stu;

    stu.initScore();
    stu.setName(&quot;张三&quot;);
    stu.setGender(&quot;男&quot;);
    stu.study(5);
    stu.study(3);

    cout&lt;&lt;stu.getName()&lt;&lt;&quot; &quot;&lt;&lt;stu.getGender()&lt;&lt;&quot; &quot; &lt;&lt;stu.getScore()&lt;&lt;endl;


    return 0;
}
</code></pre><p>类外定义</p>
<p>一般情况下，我们将类的声明定义在一个文件：</p>
<p>Student.hpp</p>
<pre><code>#ifndef Student_hpp
#define Student_hpp

#include &lt;stdio.h&gt;
#include &lt;string&gt;

using namespace std;

//定义类
class Student {


public:
    void setName(string _name);
    string getName();
    void setGender(string _gender);
    string getGender();
    void setAge(int _age);
    int getAge();
    void teach();
private:
    string m_strName;
    string m_strGedner;
    int m_iAge;
};

#endif /* Student_hpp */
</code></pre><p>然后在另一个文件实现：</p>
<p>Student.cpp</p>
<pre><code>#include &lt;iostream&gt;

#include &quot;Student.hpp&quot;
</code></pre><p>​<br>​<br>    //实现类<br>    void Student::setName(string _name){<br>        m_strName=_name;<br>    }<br>    string Student::getName(){<br>        return m_strName;<br>    }<br>    void Student::setGender(string _gender){<br>        m_strGedner=_gender;<br>    }<br>    string Student::getGender(){<br>        return m_strGedner;<br>    }<br>    void Student::setAge(int _age){<br>        m_iAge=_age;<br>    }<br>    int Student::getAge(){<br>        return m_iAge;<br>    }<br>    void Student::teach(){<br>        cout&lt;&lt;”现在上课了…”&lt;&lt;endl;<br>    }</p>
<p>内存分区</p>
<p>栈区：int x=0；int *p=NULL;</p>
<p>堆区：int *p=new int[20];</p>
<p>全局区：存储全局变量以静态变量</p>
<p>常量区：string str=”hello”;</p>
<p>代码区：存储逻辑代码的二进制</p>
<p>构造函数</p>
<p>Teacher.hpp</p>
<p>在头文件里面定义构造函数</p>
<pre><code>#ifndef Teacher_hpp
#define Teacher_hpp

#include &lt;iostream&gt;
#include &lt;string&gt;

using namespace std;

class Teacher {


public:
    //构造函数
    Teacher();
    Teacher(string name,int age=20);

    //成员函数
    void setName(string _name);
    string getName();
    void setAge(int _age);
    int getAge();
private:
    string m_strName;
    int m_iAge;

};

#endif /* Teacher_hpp */
</code></pre><p>在实现文件里面实现构造函数：</p>
<pre><code>#include &quot;Teacher.hpp&quot;
</code></pre><p>​<br>    Teacher::Teacher(){<br>        m_strName=”jack”;<br>        m_iAge=30;<br>        cout&lt;&lt;”Teacher()”&lt;&lt;endl;<br>    }<br>    Teacher::Teacher(string name,int age){<br>        m_strName=name;<br>        m_iAge=age;<br>        cout&lt;&lt;”Teacher(string name,int age)”&lt;&lt;endl;<br>    }</p>
<pre><code>void Teacher::setName(string _name){
    m_strName=_name;
}
string Teacher::getName(){
    return m_strName;
}
void Teacher::setAge(int _age){
    m_iAge=_age;
}
int Teacher::getAge(){
    return m_iAge;
}
</code></pre><p>然后在实现文件里面就可以使用：</p>
<pre><code>#include &quot;Teacher.hpp&quot;

int main(){

    Teacher t1;

    Teacher t2(&quot;zhangsan&quot;,10);

    Teacher t3(&quot;lisi&quot;);

    cout&lt;&lt;t1.getName()&lt;&lt;&quot; &quot;&lt;&lt;t1.getAge()&lt;&lt;endl;
    cout&lt;&lt;t2.getName()&lt;&lt;&quot; &quot;&lt;&lt;t2.getAge()&lt;&lt;endl;
    cout&lt;&lt;t3.getName()&lt;&lt;&quot; &quot;&lt;&lt;t3.getAge()&lt;&lt;endl;

    return 0;
}
</code></pre><p>构造函数初始化列表</p>
<p>常量必须用初始化列表初始化。</p>
<p>Teacher.hpp</p>
<pre><code>#ifndef Teacher_hpp
#define Teacher_hpp

#include &lt;iostream&gt;
#include &lt;string&gt;

using namespace std;

class Teacher {


public:
    //构造函数
    Teacher(string name=&quot;jack&quot;,int age=20,int max=100);

    //成员函数
    void setName(string _name);
    string getName();
    void setAge(int _age);
    int getAge();
private:
    string m_strName;
    int m_iAge;
    const int m_iMax; //表示这个老师能带多少个学生，是一个常量只能初始化一次
};

#endif /* Teacher_hpp */
</code></pre><p>Teacher.cpp</p>
<pre><code>#include &quot;Teacher.hpp&quot;
</code></pre><p>​<br>    Teacher::Teacher(string name,int age,int max):m_strName(name),m_iAge(age),m_iMax(max){<br>        //这里使用初始化列表<br>        cout&lt;&lt;”Teacher(string name,int age)”&lt;&lt;endl;<br>    }</p>
<pre><code>void Teacher::setName(string _name){
    m_strName=_name;
}
string Teacher::getName(){
    return m_strName;
}
void Teacher::setAge(int _age){
    m_iAge=_age;
}
int Teacher::getAge(){
    return m_iAge;
}
</code></pre><p>main.cpp</p>
<pre><code>Teacher t1;

Teacher t2(&quot;zhangsan&quot;,10);

Teacher t3(&quot;zhangsan&quot;,150);
</code></pre><p>​<br>    cout&lt;&lt;t1.getName()&lt;&lt;” “&lt;&lt;t1.getAge()&lt;&lt;endl;<br>    cout&lt;&lt;t2.getName()&lt;&lt;” “&lt;&lt;t2.getAge()&lt;&lt;endl;<br>    cout&lt;&lt;t3.getName()&lt;&lt;” “&lt;&lt;t3.getAge()&lt;&lt;endl;</p>
<p>拷贝构造函数</p>
<p>如果没有定义，则系统默认生成一个。当采用直接初始化(赋值)或复制初始化时系统将自动调用，还有就是参数传递也会调用。</p>
<p>Teacher.hpp</p>
<pre><code>#ifndef Teacher_hpp
#define Teacher_hpp

#include &lt;iostream&gt;
#include &lt;string&gt;

using namespace std;

class Teacher {


public:
    //构造函数
    Teacher(string name=&quot;jack&quot;,int age=20);
    //拷贝构造函数
    Teacher(const Teacher &amp; tea);

    //成员函数
    void setName(string _name);
    string getName();
    void setAge(int _age);
    int getAge();
private:
    string m_strName;
    int m_iAge;

};

#endif /* Teacher_hpp */
</code></pre><p>Teacher.cpp</p>
<pre><code>#include &quot;Teacher.hpp&quot;
</code></pre><p>​<br>    Teacher::Teacher(string name,int age):m_strName(name),m_iAge(age){<br>        //这里使用初始化列表<br>        cout&lt;&lt;”Teacher(string name,int age)”&lt;&lt;endl;<br>    }</p>
<pre><code>Teacher::Teacher(const Teacher &amp; tea){
    cout&lt;&lt;&quot;Teacher(const Teacher &amp; tea)&quot;&lt;&lt;endl;
}

void Teacher::setName(string _name){
    m_strName=_name;
}
string Teacher::getName(){
    return m_strName;
}
void Teacher::setAge(int _age){
    m_iAge=_age;
}
int Teacher::getAge(){
    return m_iAge;
}
</code></pre><p>main.cpp</p>
<pre><code>Teacher t1;
</code></pre><p>​<br>    Teacher t2=t1;//会调用拷贝构造函数<br>    Teacher t3(t1);//会调用拷贝构造函数</p>
<pre><code>test(t1);
</code></pre><p>test是一个函数</p>
<pre><code>void test(Teacher t){
    t.setName(&quot;a&quot;);
    cout&lt;&lt;t.getName()&lt;&lt;endl;
}
</code></pre><p>析构函数</p>
<p>1.没有定义则系统自动生成。</p>
<p>2.对象销毁时自动调用，目的是归还资源。</p>
<p>3.析构函数，没有返回值，没有参数，不能重载。</p>
<p>Teacher.hpp</p>
<pre><code>#ifndef Teacher_hpp
#define Teacher_hpp

#include &lt;iostream&gt;
#include &lt;string&gt;

using namespace std;

class Teacher {


public:
    //构造函数
    Teacher(string name=&quot;jack&quot;,int age=20);
    //拷贝构造函数
    Teacher(const Teacher &amp; tea);

    //析构函数
    ~Teacher();

    //成员函数
    void setName(string _name);
    string getName();
    void setAge(int _age);
    int getAge();
private:
    string m_strName;
    int m_iAge;

};

#endif /* Teacher_hpp */
</code></pre><p>然后实现析构函数</p>
<pre><code>#include &quot;Teacher.hpp&quot;
</code></pre><p>​<br>    Teacher::Teacher(string name,int age):m_strName(name),m_iAge(age){<br>        //这里使用初始化列表<br>        cout&lt;&lt;”Teacher(string name,int age)”&lt;&lt;endl;<br>    }</p>
<pre><code>Teacher::Teacher(const Teacher &amp; tea){
    cout&lt;&lt;&quot;Teacher(const Teacher &amp; tea)&quot;&lt;&lt;endl;
}

Teacher::~Teacher(){
    cout&lt;&lt;&quot;~Teacher()&quot;&lt;&lt;endl;
}

void Teacher::setName(string _name){
    m_strName=_name;
}
string Teacher::getName(){
    return m_strName;
}
void Teacher::setAge(int _age){
    m_iAge=_age;
}
int Teacher::getAge(){
    return m_iAge;
}
</code></pre><p>最后测试是否调用了析构函数</p>
<p>main.cpp</p>
<pre><code>Teacher t1; //这样方式声明的，会自动调用析构函数
Teacher t2(t1); //这样方式声明的，会自动调用析构函数

Teacher *t3 = new Teacher();
delete t3; //在堆上创建的对象，必须手动调用
</code></pre><h1 id="类"><a href="#类" class="headerlink" title="类"></a>类</h1><h2 id="定义类"><a href="#定义类" class="headerlink" title="定义类"></a>定义类</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> Point &#123;</div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">int</span> x;</div><div class="line">    <span class="keyword">int</span> y;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printX</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;x&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printY</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;y&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="实例化对象"><a href="#实例化对象" class="headerlink" title="实例化对象"></a>实例化对象</h2><p>在栈上创建对象:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//通过栈的方式实例化对象</span></div><div class="line">Point point;</div><div class="line">point.x=<span class="number">10</span>;</div><div class="line">point.y=<span class="number">20</span>;</div><div class="line"></div><div class="line">point.printX();</div><div class="line">point.printY();</div></pre></td></tr></table></figure>
<p>在堆上创建对象：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Point *point=<span class="keyword">new</span> Point();</div><div class="line"><span class="keyword">if</span> (<span class="literal">NULL</span>==point) &#123;</div><div class="line">    <span class="comment">//实例化对象失败</span></div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">point-&gt;x=<span class="number">100</span>;</div><div class="line">point-&gt;y=<span class="number">200</span>;</div><div class="line">point-&gt;printX();</div><div class="line">point-&gt;printY();</div></pre></td></tr></table></figure>
<h1 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h1><h2 id="初始化方式"><a href="#初始化方式" class="headerlink" title="初始化方式"></a>初始化方式</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">string</span> s1;</div><div class="line"><span class="function"><span class="built_in">string</span> <span class="title">s2</span><span class="params">(<span class="string">"abc"</span>)</span></span>;</div><div class="line"><span class="function"><span class="built_in">string</span> <span class="title">s3</span><span class="params">(s2)</span></span>;</div><div class="line"><span class="function"><span class="built_in">string</span> <span class="title">s4</span><span class="params">(<span class="number">3</span>,<span class="string">'c'</span>)</span></span>;</div><div class="line"></div><div class="line"><span class="built_in">cout</span>&lt;&lt;s1&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"><span class="built_in">cout</span>&lt;&lt;s2&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"><span class="built_in">cout</span>&lt;&lt;s3&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"><span class="built_in">cout</span>&lt;&lt;s4&lt;&lt;<span class="built_in">endl</span>;</div></pre></td></tr></table></figure>
<h2 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h2><table>
<thead>
<tr>
<th>方法名</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>s.empty</td>
<td>字符串为空，返回true，否则false</td>
</tr>
<tr>
<td>s.size</td>
<td>字符的个数</td>
</tr>
<tr>
<td>s[n]</td>
<td>返回s中n位置的字符</td>
</tr>
<tr>
<td>s1+s2</td>
<td>连接字符串</td>
</tr>
<tr>
<td>s1=s2</td>
<td>将s1的内容替换为s2的副本</td>
</tr>
<tr>
<td>v1==v2</td>
<td>内容相等，返回true</td>
</tr>
<tr>
<td>v1!=v2</td>
<td>内容不相等，返回true</td>
</tr>
</tbody>
</table>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">string</span> s1=<span class="string">"hello"</span>;</div><div class="line"><span class="function"><span class="built_in">string</span> <span class="title">s2</span><span class="params">(<span class="string">"world"</span>)</span></span>;</div><div class="line"><span class="built_in">string</span> s3=s1+s2;</div><div class="line"><span class="built_in">string</span> s4=<span class="string">"hello"</span> +s2;</div><div class="line"><span class="built_in">string</span> s5=<span class="string">"hello"</span>+s2+<span class="string">"world"</span>;</div><div class="line"></div><div class="line"><span class="comment">//    string s6="hello"+"world"; //这种方式错误，只有一端是一个变量才可以，而java中则可以</span></div></pre></td></tr></table></figure>
<h2 id="实例：读取用户姓名"><a href="#实例：读取用户姓名" class="headerlink" title="实例：读取用户姓名"></a>实例：读取用户姓名</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cout</span>&lt;&lt;<span class="string">"请输入用户名："</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"><span class="built_in">string</span> name;</div><div class="line">getline(<span class="built_in">cin</span>, name);</div><div class="line"></div><div class="line"><span class="built_in">cout</span>&lt;&lt;name&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (name.empty()) &#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"输入的姓名不能为空"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">cout</span>&lt;&lt;<span class="string">"Hello "</span>+name&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"><span class="built_in">cout</span>&lt;&lt;<span class="string">"你的名字长度："</span>&lt;&lt;name.size()&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"><span class="built_in">cout</span>&lt;&lt;<span class="string">"你的名字首字母是："</span>&lt;&lt;name[<span class="number">0</span>]&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (<span class="string">"admin"</span>==name) &#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"你是一个管理员"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h1><p>他的好处是保护数据不被恶意篡改。下面模拟一个用户的实例化，然后打印用户信息：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Student &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="built_in">string</span> _name)</span></span>&#123;</div><div class="line">        m_strName=_name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="built_in">string</span> <span class="title">getName</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> m_strName;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setGender</span><span class="params">(<span class="built_in">string</span> _gender)</span></span>&#123;</div><div class="line">        m_strGender=_gender;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="built_in">string</span> <span class="title">getGender</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> m_strGender;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getScore</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> m_iScore;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">initScore</span><span class="params">()</span></span>&#123;</div><div class="line">        m_iScore=<span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">study</span><span class="params">(<span class="keyword">int</span> _score)</span></span>&#123;</div><div class="line">        m_iScore+=_score;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="built_in">string</span> m_strName;</div><div class="line">    <span class="built_in">string</span> m_strGender;</div><div class="line">    <span class="keyword">int</span> m_iScore;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    Student stu;</div><div class="line">    </div><div class="line">    stu.initScore();</div><div class="line">    stu.setName(<span class="string">"张三"</span>);</div><div class="line">    stu.setGender(<span class="string">"男"</span>);</div><div class="line">    stu.study(<span class="number">5</span>);</div><div class="line">    stu.study(<span class="number">3</span>);</div><div class="line">    </div><div class="line">    <span class="built_in">cout</span>&lt;&lt;stu.getName()&lt;&lt;<span class="string">" "</span>&lt;&lt;stu.getGender()&lt;&lt;<span class="string">" "</span> &lt;&lt;stu.getScore()&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="类外定义"><a href="#类外定义" class="headerlink" title="类外定义"></a>类外定义</h1><p>一般情况下，我们将类的声明定义在一个文件：</p>
<p>Student.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Student_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Student_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="comment">//定义类</span></div><div class="line"><span class="keyword">class</span> Student &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="built_in">string</span> _name)</span></span>;</div><div class="line">    <span class="function"><span class="built_in">string</span> <span class="title">getName</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setGender</span><span class="params">(<span class="built_in">string</span> _gender)</span></span>;</div><div class="line">    <span class="function"><span class="built_in">string</span> <span class="title">getGender</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> _age)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">teach</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="built_in">string</span> m_strName;</div><div class="line">    <span class="built_in">string</span> m_strGedner;</div><div class="line">    <span class="keyword">int</span> m_iAge;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Student_hpp */</span></span></div></pre></td></tr></table></figure>
<p>然后在另一个文件实现：</p>
<p>Student.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Student.hpp"</span></span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//实现类</span></div><div class="line"><span class="keyword">void</span> Student::setName(<span class="built_in">string</span> _name)&#123;</div><div class="line">    m_strName=_name;</div><div class="line">&#125;</div><div class="line"><span class="built_in">string</span> Student::getName()&#123;</div><div class="line">    <span class="keyword">return</span> m_strName;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Student::setGender(<span class="built_in">string</span> _gender)&#123;</div><div class="line">    m_strGedner=_gender;</div><div class="line">&#125;</div><div class="line"><span class="built_in">string</span> Student::getGender()&#123;</div><div class="line">    <span class="keyword">return</span> m_strGedner;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Student::setAge(<span class="keyword">int</span> _age)&#123;</div><div class="line">    m_iAge=_age;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Student::getAge()&#123;</div><div class="line">    <span class="keyword">return</span> m_iAge;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Student::teach()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"现在上课了..."</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="内存分区"><a href="#内存分区" class="headerlink" title="内存分区"></a>内存分区</h1><p>栈区：int x=0；int *p=NULL;</p>
<p>堆区：int *p=new int[20];</p>
<p>全局区：存储全局变量以静态变量</p>
<p>常量区：string str=”hello”;</p>
<p>代码区：存储逻辑代码的二进制</p>
<h1 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h1><p>Teacher.hpp</p>
<p>在头文件里面定义构造函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Teacher_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Teacher_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Teacher &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">//构造函数</span></div><div class="line">    Teacher();</div><div class="line">    Teacher(<span class="built_in">string</span> name,<span class="keyword">int</span> age=<span class="number">20</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//成员函数</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="built_in">string</span> _name)</span></span>;</div><div class="line">    <span class="function"><span class="built_in">string</span> <span class="title">getName</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> _age)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="built_in">string</span> m_strName;</div><div class="line">    <span class="keyword">int</span> m_iAge;</div><div class="line"></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Teacher_hpp */</span></span></div></pre></td></tr></table></figure>
<p>在实现文件里面实现构造函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Teacher.hpp"</span></span></div><div class="line"></div><div class="line"></div><div class="line">Teacher::Teacher()&#123;</div><div class="line">    m_strName=<span class="string">"jack"</span>;</div><div class="line">    m_iAge=<span class="number">30</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Teacher()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line">Teacher::Teacher(<span class="built_in">string</span> name,<span class="keyword">int</span> age)&#123;</div><div class="line">    m_strName=name;</div><div class="line">    m_iAge=age;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Teacher(string name,int age)"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Teacher::setName(<span class="built_in">string</span> _name)&#123;</div><div class="line">    m_strName=_name;</div><div class="line">&#125;</div><div class="line"><span class="built_in">string</span> Teacher::getName()&#123;</div><div class="line">    <span class="keyword">return</span> m_strName;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Teacher::setAge(<span class="keyword">int</span> _age)&#123;</div><div class="line">    m_iAge=_age;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Teacher::getAge()&#123;</div><div class="line">    <span class="keyword">return</span> m_iAge;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在实现文件里面就可以使用：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Teacher.hpp"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    </div><div class="line">    Teacher t1;</div><div class="line">    </div><div class="line">    <span class="function">Teacher <span class="title">t2</span><span class="params">(<span class="string">"zhangsan"</span>,<span class="number">10</span>)</span></span>;</div><div class="line">    </div><div class="line">    <span class="function">Teacher <span class="title">t3</span><span class="params">(<span class="string">"lisi"</span>)</span></span>;</div><div class="line">    </div><div class="line">    <span class="built_in">cout</span>&lt;&lt;t1.getName()&lt;&lt;<span class="string">" "</span>&lt;&lt;t1.getAge()&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;t2.getName()&lt;&lt;<span class="string">" "</span>&lt;&lt;t2.getAge()&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;t3.getName()&lt;&lt;<span class="string">" "</span>&lt;&lt;t3.getAge()&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="构造函数初始化列表"><a href="#构造函数初始化列表" class="headerlink" title="构造函数初始化列表"></a>构造函数初始化列表</h2><p>常量必须用初始化列表初始化。</p>
<p>Teacher.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Teacher_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Teacher_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Teacher &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">//构造函数</span></div><div class="line">    Teacher(<span class="built_in">string</span> name=<span class="string">"jack"</span>,<span class="keyword">int</span> age=<span class="number">20</span>,<span class="keyword">int</span> max=<span class="number">100</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//成员函数</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="built_in">string</span> _name)</span></span>;</div><div class="line">    <span class="function"><span class="built_in">string</span> <span class="title">getName</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> _age)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="built_in">string</span> m_strName;</div><div class="line">    <span class="keyword">int</span> m_iAge;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> m_iMax; <span class="comment">//表示这个老师能带多少个学生，是一个常量只能初始化一次</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Teacher_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Teacher.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Teacher.hpp"</span></span></div><div class="line"></div><div class="line"></div><div class="line">Teacher::Teacher(<span class="built_in">string</span> name,<span class="keyword">int</span> age,<span class="keyword">int</span> max):m_strName(name),m_iAge(age),m_iMax(max)&#123;</div><div class="line">    <span class="comment">//这里使用初始化列表</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Teacher(string name,int age)"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Teacher::setName(<span class="built_in">string</span> _name)&#123;</div><div class="line">    m_strName=_name;</div><div class="line">&#125;</div><div class="line"><span class="built_in">string</span> Teacher::getName()&#123;</div><div class="line">    <span class="keyword">return</span> m_strName;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Teacher::setAge(<span class="keyword">int</span> _age)&#123;</div><div class="line">    m_iAge=_age;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Teacher::getAge()&#123;</div><div class="line">    <span class="keyword">return</span> m_iAge;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>main.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Teacher t1;</div><div class="line"></div><div class="line"><span class="function">Teacher <span class="title">t2</span><span class="params">(<span class="string">"zhangsan"</span>,<span class="number">10</span>)</span></span>;</div><div class="line"></div><div class="line"><span class="function">Teacher <span class="title">t3</span><span class="params">(<span class="string">"zhangsan"</span>,<span class="number">150</span>)</span></span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="built_in">cout</span>&lt;&lt;t1.getName()&lt;&lt;<span class="string">" "</span>&lt;&lt;t1.getAge()&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"><span class="built_in">cout</span>&lt;&lt;t2.getName()&lt;&lt;<span class="string">" "</span>&lt;&lt;t2.getAge()&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"><span class="built_in">cout</span>&lt;&lt;t3.getName()&lt;&lt;<span class="string">" "</span>&lt;&lt;t3.getAge()&lt;&lt;<span class="built_in">endl</span>;</div></pre></td></tr></table></figure>
<h2 id="拷贝构造函数"><a href="#拷贝构造函数" class="headerlink" title="拷贝构造函数"></a>拷贝构造函数</h2><p>如果没有定义，则系统默认生成一个。当采用直接初始化(赋值)或复制初始化时系统将自动调用，还有就是参数传递也会调用。</p>
<p>Teacher.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Teacher_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Teacher_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Teacher &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">//构造函数</span></div><div class="line">    Teacher(<span class="built_in">string</span> name=<span class="string">"jack"</span>,<span class="keyword">int</span> age=<span class="number">20</span>);</div><div class="line">    <span class="comment">//拷贝构造函数</span></div><div class="line">    Teacher(<span class="keyword">const</span> Teacher &amp; tea);</div><div class="line">    </div><div class="line">    <span class="comment">//成员函数</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="built_in">string</span> _name)</span></span>;</div><div class="line">    <span class="function"><span class="built_in">string</span> <span class="title">getName</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> _age)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="built_in">string</span> m_strName;</div><div class="line">    <span class="keyword">int</span> m_iAge;</div><div class="line">   </div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Teacher_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Teacher.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Teacher.hpp"</span></span></div><div class="line"></div><div class="line"></div><div class="line">Teacher::Teacher(<span class="built_in">string</span> name,<span class="keyword">int</span> age):m_strName(name),m_iAge(age)&#123;</div><div class="line">    <span class="comment">//这里使用初始化列表</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Teacher(string name,int age)"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Teacher::Teacher(<span class="keyword">const</span> Teacher &amp; tea)&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Teacher(const Teacher &amp; tea)"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Teacher::setName(<span class="built_in">string</span> _name)&#123;</div><div class="line">    m_strName=_name;</div><div class="line">&#125;</div><div class="line"><span class="built_in">string</span> Teacher::getName()&#123;</div><div class="line">    <span class="keyword">return</span> m_strName;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Teacher::setAge(<span class="keyword">int</span> _age)&#123;</div><div class="line">    m_iAge=_age;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Teacher::getAge()&#123;</div><div class="line">    <span class="keyword">return</span> m_iAge;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>main.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Teacher t1;</div><div class="line"></div><div class="line"></div><div class="line">Teacher t2=t1;<span class="comment">//会调用拷贝构造函数</span></div><div class="line"><span class="function">Teacher <span class="title">t3</span><span class="params">(t1)</span></span>;<span class="comment">//会调用拷贝构造函数</span></div><div class="line"></div><div class="line">test(t1);</div></pre></td></tr></table></figure>
<p>test是一个函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">(Teacher t)</span></span>&#123;</div><div class="line">    t.setName(<span class="string">"a"</span>);</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;t.getName()&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="浅拷贝"><a href="#浅拷贝" class="headerlink" title="浅拷贝"></a>浅拷贝</h3><p>定义一个Array类，数据成员为m_iCount，成员函数包括数据封装函数，构造函数，拷贝构造函数和析构函数。</p>
<p>Array.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Array_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Array_hpp</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Array &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Array();</div><div class="line">    Array(<span class="keyword">const</span> Array &amp;arr);</div><div class="line">    ~Array();</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setCount</span><span class="params">(<span class="keyword">int</span> count)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> m_iCount;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Array_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Array.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Array.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Array::Array()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Array"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Array::Array(<span class="keyword">const</span> Array &amp;arr)&#123;</div><div class="line">    <span class="comment">//浅拷贝</span></div><div class="line">    m_iCount=arr.m_iCount;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Array &amp;"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Array::~Array()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Array"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Array::setCount(<span class="keyword">int</span> count)&#123;</div><div class="line">    m_iCount=count;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Array::getCount()&#123;</div><div class="line">    <span class="keyword">return</span> m_iCount;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Array arr1;</div><div class="line">arr1.setCount(<span class="number">5</span>);</div><div class="line"></div><div class="line"><span class="function">Array <span class="title">arr2</span><span class="params">(arr1)</span></span>;</div><div class="line"></div><div class="line"><span class="built_in">cout</span>&lt;&lt;arr2.getCount()&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//5,可以看到拷贝成功</span></div></pre></td></tr></table></figure>
<h3 id="深拷贝"><a href="#深拷贝" class="headerlink" title="深拷贝"></a>深拷贝</h3><p>我们在上一节的例子增加一个指针成员变量，实现深拷贝。</p>
<p>Array.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Array_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Array_hpp</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Array &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Array(<span class="keyword">int</span> count);</div><div class="line">    Array(<span class="keyword">const</span> Array &amp;arr);</div><div class="line">    ~Array();</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setCount</span><span class="params">(<span class="keyword">int</span> count)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span></span>;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printAddr</span><span class="params">()</span></span>;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printArr</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> m_iCount;</div><div class="line">    <span class="keyword">int</span> *m_pAdd; <span class="comment">//增加了指针</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Array_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Array.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Array.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Array::Array(<span class="keyword">int</span> count)&#123;</div><div class="line">    m_iCount=count;</div><div class="line">    m_pAdd=<span class="keyword">new</span> <span class="keyword">int</span>(m_iCount);</div><div class="line">    </div><div class="line">    <span class="comment">//赋默认值</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;m_iCount; i++) &#123;</div><div class="line">        m_pAdd[i]=i+<span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Array"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Array::Array(<span class="keyword">const</span> Array &amp;arr)&#123;</div><div class="line">    <span class="comment">//深拷贝</span></div><div class="line">    m_iCount=arr.m_iCount;</div><div class="line">    </div><div class="line">    m_pAdd=<span class="keyword">new</span> <span class="keyword">int</span>[m_iCount];</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;m_iCount; i++) &#123;</div><div class="line">        m_pAdd[i]=arr.m_pAdd[i];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Array &amp;"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Array::~Array()&#123;</div><div class="line">    <span class="keyword">delete</span> [] m_pAdd;</div><div class="line">    m_pAdd=<span class="literal">NULL</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Array"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Array::setCount(<span class="keyword">int</span> count)&#123;</div><div class="line">    m_iCount=count;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Array::getCount()&#123;</div><div class="line">    <span class="keyword">return</span> m_iCount;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Array::printAddr()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;m_pAdd&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Array::printArr()&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;m_iCount; i++) &#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;m_pAdd[i]&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试是否拷贝成功</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function">Array <span class="title">arr1</span><span class="params">(<span class="number">5</span>)</span></span>;</div><div class="line"></div><div class="line"><span class="function">Array <span class="title">arr2</span><span class="params">(arr1)</span></span>;</div><div class="line"></div><div class="line">arr1.printArr();</div><div class="line">arr2.printArr();</div></pre></td></tr></table></figure>
<p>他们打印的值相同，但地址就不一样了。</p>
<h1 id="析构函数"><a href="#析构函数" class="headerlink" title="析构函数"></a>析构函数</h1><p>1.没有定义则系统自动生成。</p>
<p>2.对象销毁时自动调用，目的是归还资源。</p>
<p>3.析构函数，没有返回值，没有参数，不能重载。</p>
<p>Teacher.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Teacher_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Teacher_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Teacher &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">//构造函数</span></div><div class="line">    Teacher(<span class="built_in">string</span> name=<span class="string">"jack"</span>,<span class="keyword">int</span> age=<span class="number">20</span>);</div><div class="line">    <span class="comment">//拷贝构造函数</span></div><div class="line">    Teacher(<span class="keyword">const</span> Teacher &amp; tea);</div><div class="line">    </div><div class="line">    <span class="comment">//析构函数</span></div><div class="line">    ~Teacher();</div><div class="line">    </div><div class="line">    <span class="comment">//成员函数</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setName</span><span class="params">(<span class="built_in">string</span> _name)</span></span>;</div><div class="line">    <span class="function"><span class="built_in">string</span> <span class="title">getName</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> _age)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="built_in">string</span> m_strName;</div><div class="line">    <span class="keyword">int</span> m_iAge;</div><div class="line">   </div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Teacher_hpp */</span></span></div></pre></td></tr></table></figure>
<p>然后实现析构函数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Teacher.hpp"</span></span></div><div class="line"></div><div class="line"></div><div class="line">Teacher::Teacher(<span class="built_in">string</span> name,<span class="keyword">int</span> age):m_strName(name),m_iAge(age)&#123;</div><div class="line">    <span class="comment">//这里使用初始化列表</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Teacher(string name,int age)"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Teacher::Teacher(<span class="keyword">const</span> Teacher &amp; tea)&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Teacher(const Teacher &amp; tea)"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Teacher::~Teacher()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Teacher()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Teacher::setName(<span class="built_in">string</span> _name)&#123;</div><div class="line">    m_strName=_name;</div><div class="line">&#125;</div><div class="line"><span class="built_in">string</span> Teacher::getName()&#123;</div><div class="line">    <span class="keyword">return</span> m_strName;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> Teacher::setAge(<span class="keyword">int</span> _age)&#123;</div><div class="line">    m_iAge=_age;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> Teacher::getAge()&#123;</div><div class="line">    <span class="keyword">return</span> m_iAge;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后测试是否调用了析构函数</p>
<p>main.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Teacher t1; <span class="comment">//这样方式声明的，会自动调用析构函数</span></div><div class="line"><span class="function">Teacher <span class="title">t2</span><span class="params">(t1)</span></span>; <span class="comment">//这样方式声明的，会自动调用析构函数</span></div><div class="line"></div><div class="line">Teacher *t3 = <span class="keyword">new</span> Teacher();</div><div class="line"><span class="keyword">delete</span> t3; <span class="comment">//在堆上创建的对象，必须手动调用</span></div></pre></td></tr></table></figure>
<h1 id="对象数组"><a href="#对象数组" class="headerlink" title="对象数组"></a>对象数组</h1><p>首先定义一个对象Point用来表示一个二维坐标。</p>
<p>Point.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Point_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Point_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Point &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Point();</div><div class="line">    ~Point();</div><div class="line">    </div><div class="line">    <span class="keyword">int</span> m_iX;</div><div class="line">    <span class="keyword">int</span> m_iY;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Point_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Point.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Point.hpp"</span></span></div><div class="line"></div><div class="line">Point::Point()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Point()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Point::~Point()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Point()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后创建这个对象的对象数组。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Point.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//在栈上创建对象</span></div><div class="line">    Point t[<span class="number">3</span>];</div><div class="line">    </div><div class="line">    t[<span class="number">0</span>].m_iX=<span class="number">10</span>;</div><div class="line">    t[<span class="number">0</span>].m_iY=<span class="number">20</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//在堆上创建对象</span></div><div class="line">    Point *p=<span class="keyword">new</span> Point[<span class="number">3</span>];</div><div class="line">    p-&gt;m_iX=<span class="number">7</span>;</div><div class="line">    p[<span class="number">0</span>].m_iY=<span class="number">10</span>;</div><div class="line">    </div><div class="line">    p++;<span class="comment">//p+=1;p+=1;</span></div><div class="line">    </div><div class="line">    <span class="comment">//1</span></div><div class="line">    p-&gt;m_iX=<span class="number">11</span>;</div><div class="line">    p[<span class="number">0</span>].m_iY=<span class="number">20</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//2</span></div><div class="line">    p[<span class="number">1</span>].m_iX=<span class="number">20</span>;</div><div class="line">    p++;</div><div class="line">    p-&gt;m_iY=<span class="number">30</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//遍历</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;t[i].m_iX&lt;&lt;<span class="string">" "</span>&lt;&lt;t[i].m_iY&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">//现在指针是指向最后一个元素，所以只能倒序遍历</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;<span class="number">3</span>; j++) &#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;p-&gt;m_iX&lt;&lt;<span class="string">" "</span>&lt;&lt;p-&gt;m_iY&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">        p--;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    p++; <span class="comment">//重要，因为p现在指向到了，数组前面的元素</span></div><div class="line">    </div><div class="line">    <span class="keyword">delete</span> []p;</div><div class="line">    p=<span class="literal">NULL</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="对象成员"><a href="#对象成员" class="headerlink" title="对象成员"></a>对象成员</h1><p>一个对象的成员是对象。下面模拟一个Line类，有两个Point，point对象有两个成员x,y。</p>
<p>Point.hpp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">#ifndef Point_hpp</div><div class="line">#define Point_hpp</div><div class="line"></div><div class="line">#include &lt;iostream&gt;</div><div class="line"></div><div class="line">using namespace std;</div><div class="line"></div><div class="line">class Point &#123;</div><div class="line">    </div><div class="line">    </div><div class="line">public:</div><div class="line">    Point();</div><div class="line">    ~Point();</div><div class="line">    </div><div class="line">    void setX(int _x);</div><div class="line">    int getX();</div><div class="line">    </div><div class="line">    void setY(int _y);</div><div class="line">    int getY();</div><div class="line">private:</div><div class="line">    int m_iX;</div><div class="line">    int m_iY;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">#endif /* Point_hpp */</div></pre></td></tr></table></figure>
<p>Point.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Point.hpp"</span></span></div><div class="line"></div><div class="line">Point::Point()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Point()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Point::~Point()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Point()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Point::setX(<span class="keyword">int</span> _x)&#123;</div><div class="line">    m_iX=_x;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Point::getX()&#123;</div><div class="line">    <span class="keyword">return</span> m_iX;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Point::setY(<span class="keyword">int</span> _y)&#123;</div><div class="line">    m_iY=_y;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Point::getY()&#123;</div><div class="line">    <span class="keyword">return</span> m_iY;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们现在测试他们的构造函数调用顺序：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Line *line=<span class="keyword">new</span> Line();</div><div class="line"></div><div class="line"><span class="keyword">delete</span> line;</div></pre></td></tr></table></figure>
<p>输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Point()</div><div class="line">Point()</div><div class="line">Line()</div><div class="line">~Line()</div><div class="line">~Point()</div><div class="line">~Point()</div></pre></td></tr></table></figure>
<p>结论：先初始化内部对象成员，然后在初始化外部类。销毁先外部类，然后销毁内部成员对象。</p>
<p>那成员之间他们的初始化顺序和销毁顺序是什么呢：</p>
<p>我给Point,Line都加上了构造参数</p>
<p>Point.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Point::Point(<span class="keyword">int</span> x,<span class="keyword">int</span> y):m_iX(x),m_iY(y)&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Point()"</span>&lt;&lt;m_iX&lt;&lt;<span class="string">","</span>&lt;&lt;m_iY&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Point::~Point()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Point()"</span>&lt;&lt;m_iX&lt;&lt;<span class="string">","</span>&lt;&lt;m_iY&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Line.cpp</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Line::Line(<span class="keyword">int</span> x1,<span class="keyword">int</span> y1,<span class="keyword">int</span> x2,<span class="keyword">int</span> y2):m_pointA(x1,y1),m_pointB(x2,y2)&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Line()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line">Line::~Line()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Line()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后穿入值：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Line *line=<span class="keyword">new</span> Line(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</div><div class="line"></div><div class="line"><span class="keyword">delete</span> line;</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Point()1,2</div><div class="line">Point()3,4</div><div class="line">Line()</div><div class="line">~Line()</div><div class="line">~Point()3,4</div><div class="line">~Point()1,2</div></pre></td></tr></table></figure>
<p>可以看见小初始化最上面的对象成员，销毁则相反。</p>
<h1 id="对象指针"><a href="#对象指针" class="headerlink" title="对象指针"></a>对象指针</h1><p>首先定义一个坐标类，然后实例化两个对象，然后分别计算坐标之和，最后使用指针操作。</p>
<p>Coordinate.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Coordinate_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Coordinate_hpp</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Coordinate &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Coordinate();</div><div class="line">    ~Coordinate();</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">int</span> m_iX;</div><div class="line">    <span class="keyword">int</span> m_iY;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Coordinate_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Coordinate.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Coordinate.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Coordinate::Coordinate()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Coordinate()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Coordinate::~Coordinate()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Coordinate()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//    Coordinate *p1=NULL;</span></div><div class="line"><span class="comment">//    p1=new Coordinate;</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    Coordinate *p2=new Coordinate();</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    p1-&gt;m_iX=10;</span></div><div class="line"><span class="comment">//    p1-&gt;m_iY=20;</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    (*p2).m_iX=30;</span></div><div class="line"><span class="comment">//    (*p2).m_iY=40;</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    //计算这两个点坐标之和</span></div><div class="line"><span class="comment">//    cout&lt;&lt;p1-&gt;m_iX+(*p2).m_iX&lt;&lt;endl; //40</span></div><div class="line"><span class="comment">//    cout&lt;&lt;p1-&gt;m_iY+(*p2).m_iY&lt;&lt;endl; //60</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    delete p1;</span></div><div class="line"><span class="comment">//    p1=NULL;</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    delete p2;</span></div><div class="line"><span class="comment">//    p2=NULL;</span></div><div class="line"></div><div class="line"><span class="comment">//对象指针</span></div><div class="line">Coordinate p1;</div><div class="line"></div><div class="line">Coordinate *p2=&amp;p1;</div><div class="line"></div><div class="line">p2-&gt;m_iX=<span class="number">10</span>;</div><div class="line">p2-&gt;m_iY=<span class="number">20</span>;</div><div class="line"></div><div class="line"><span class="built_in">cout</span>&lt;&lt;p1.m_iX&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//10</span></div><div class="line"><span class="built_in">cout</span>&lt;&lt;p1.m_iY&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//20，可以看到我们通过指针的方式操作了p1</span></div></pre></td></tr></table></figure>
<h2 id="成员对象指针"><a href="#成员对象指针" class="headerlink" title="成员对象指针"></a>成员对象指针</h2><p>改进上面的项目，将Line里面的点换成指针。</p>
<p>Coordinate.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Coordinate_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Coordinate_hpp</span></div><div class="line"></div><div class="line"><span class="keyword">class</span>  Coordinate&#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Coordinate(<span class="keyword">int</span> x,<span class="keyword">int</span> y);</div><div class="line">    ~Coordinate();</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> m_iX;</div><div class="line">    <span class="keyword">int</span> m_iY;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Coordinate_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Coordinate.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Coordinate.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Coordinate::Coordinate(<span class="keyword">int</span> x,<span class="keyword">int</span> y)&#123;</div><div class="line">    m_iX=x;</div><div class="line">    m_iY=y;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Coordinate(int x,int y)"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Coordinate::~Coordinate()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Coordinate"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Coordinate::getX()&#123;</div><div class="line">    <span class="keyword">return</span> m_iX;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Coordinate::getY()&#123;</div><div class="line">    <span class="keyword">return</span> m_iY;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Line.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Line_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Line_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Coordinate.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Line &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Line(<span class="keyword">int</span> x1,<span class="keyword">int</span> y1,<span class="keyword">int</span> x2,<span class="keyword">int</span> y2);</div><div class="line">    ~Line();</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printInfo</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    Coordinate *m_pCoorA;</div><div class="line">    Coordinate *m_pCoorB;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Line_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Line.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Line.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Line::Line(<span class="keyword">int</span> x1,<span class="keyword">int</span> y1,<span class="keyword">int</span> x2,<span class="keyword">int</span> y2)&#123;</div><div class="line">    <span class="comment">//先实例化两个点</span></div><div class="line">    m_pCoorA=<span class="keyword">new</span> Coordinate(x1,y1);</div><div class="line">    m_pCoorB=<span class="keyword">new</span> Coordinate(x2,y2);</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Line()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Line::~Line()&#123;</div><div class="line">    <span class="keyword">delete</span> m_pCoorA;</div><div class="line">    m_pCoorA=<span class="literal">NULL</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">delete</span> m_pCoorB;</div><div class="line">    m_pCoorB=<span class="literal">NULL</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Line()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Line::printInfo()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"printinfo()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;m_pCoorA-&gt;getX()&lt;&lt;<span class="string">","</span>&lt;&lt;m_pCoorA-&gt;getY()&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;m_pCoorB-&gt;getX()&lt;&lt;<span class="string">","</span>&lt;&lt;m_pCoorB-&gt;getY()&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">Line *p=<span class="keyword">new</span> Line(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>);</div><div class="line">p-&gt;printInfo();</div><div class="line"></div><div class="line"><span class="keyword">delete</span> p;</div><div class="line">p=<span class="literal">NULL</span>;</div><div class="line"></div><div class="line"><span class="built_in">cout</span>&lt;&lt;<span class="keyword">sizeof</span>(p)&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"><span class="built_in">cout</span>&lt;&lt;<span class="keyword">sizeof</span>(Line)&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"></div><div class="line"><span class="comment">//    Coordinate(int x,int y)</span></div><div class="line"><span class="comment">//    Coordinate(int x,int y)</span></div><div class="line"><span class="comment">//    Line()</span></div><div class="line"><span class="comment">//    printinfo()</span></div><div class="line"><span class="comment">//    1,2</span></div><div class="line"><span class="comment">//    3,4</span></div><div class="line"><span class="comment">//    ~Coordinate</span></div><div class="line"><span class="comment">//    ~Coordinate</span></div><div class="line"><span class="comment">//    ~Line()</span></div><div class="line"><span class="comment">//    8 //64位，一个指针8位，</span></div><div class="line"><span class="comment">//    16 //line里面有两个指针</span></div></pre></td></tr></table></figure>
<h1 id="this指针"><a href="#this指针" class="headerlink" title="this指针"></a>this指针</h1><p>this指针指向当前对象的地址，值和&amp;当前对象的值一样。</p>
<p>Array.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Array_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Array_hpp</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Array &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Array(<span class="keyword">int</span> len);</div><div class="line">    ~Array();</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setLen</span><span class="params">(<span class="keyword">int</span> len)</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getLen</span><span class="params">()</span></span>;</div><div class="line">    </div><div class="line">    <span class="function">Array* <span class="title">printInfo</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> len;</div><div class="line">    </div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Array_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Array.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Array.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Array::Array(<span class="keyword">int</span> len)&#123;</div><div class="line">    <span class="keyword">this</span>-&gt;len=len;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Array::~Array()&#123;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Array::setLen(<span class="keyword">int</span> len)&#123;</div><div class="line">    <span class="keyword">this</span>-&gt;len=len;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Array::getLen()&#123;</div><div class="line">    <span class="keyword">return</span> len;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//如果这里return的Array对象，那么他是一个临时对象，不会更改原对象的值</span></div><div class="line"><span class="comment">//如果return是Array&amp;,新对象的改变会影响到原对象</span></div><div class="line"><span class="comment">//如果return是指针，也会改变原对象</span></div><div class="line">Array* Array::printInfo()&#123;</div><div class="line"><span class="comment">//    cout&lt;&lt;"len="&lt;&lt;len&lt;&lt;endl;</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="keyword">this</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>; <span class="comment">//他要求返回一个对象，this是一个指针，*this就是一个对象</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function">Array <span class="title">arr</span><span class="params">(<span class="number">10</span>)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">//    arr.printInfo().setLen(5);</span></div><div class="line">arr.printInfo()-&gt;setLen(<span class="number">5</span>);</div><div class="line"></div><div class="line"><span class="comment">//    cout&lt;&lt;arr.getLen()&lt;&lt;endl;</span></div><div class="line"><span class="built_in">cout</span>&lt;&lt;&amp;arr&lt;&lt;<span class="built_in">endl</span>;</div></pre></td></tr></table></figure>
<h1 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h1><h2 id="什么是继承"><a href="#什么是继承" class="headerlink" title="什么是继承"></a>什么是继承</h2><p>学生继承人类的一些共性。</p>
<p>定义一个Person类，然后让Worker共有继承Person类。</p>
<h2 id="继承中构造函数和析构函数调用顺序"><a href="#继承中构造函数和析构函数调用顺序" class="headerlink" title="继承中构造函数和析构函数调用顺序"></a>继承中构造函数和析构函数调用顺序</h2><p>在继承中：</p>
<p>创建对象时先调用父类的构造函数，在调用子类的构造函数。</p>
<p>销毁对象时先调用子类的析构函数，然后在调用父类的析构函数。</p>
<p>输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Person()</div><div class="line">Worker()</div><div class="line">~Worker()</div><div class="line">~Person()</div></pre></td></tr></table></figure>
<p>其中Worker继承Person</p>
<h2 id="继承方式"><a href="#继承方式" class="headerlink" title="继承方式"></a>继承方式</h2><h3 id="共有继承"><a href="#共有继承" class="headerlink" title="共有继承"></a>共有继承</h3><p>class A:public B</p>
<table>
<thead>
<tr>
<th>父类成员访问属性</th>
<th>子类成员访问属性</th>
</tr>
</thead>
<tbody>
<tr>
<td>private</td>
<td>无法访问(也可以说没继承下来)</td>
</tr>
<tr>
<td>protected</td>
<td>protected</td>
</tr>
<tr>
<td>public</td>
<td>public</td>
</tr>
</tbody>
</table>
<h3 id="保护继承"><a href="#保护继承" class="headerlink" title="保护继承"></a>保护继承</h3><p>class A:protected B</p>
<table>
<thead>
<tr>
<th style="text-align:left">父类成员访问属性</th>
<th>子类成员访问属性</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">private</td>
<td>无法访问(也可以说没继承下来)</td>
</tr>
<tr>
<td style="text-align:left">protected</td>
<td>protected</td>
</tr>
<tr>
<td style="text-align:left">public</td>
<td>protected</td>
</tr>
</tbody>
</table>
<h3 id="私有继承"><a href="#私有继承" class="headerlink" title="私有继承"></a>私有继承</h3><p>class A:private B</p>
<table>
<thead>
<tr>
<th style="text-align:left">父类成员访问属性</th>
<th>子类成员访问属性</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">private</td>
<td>无法访问(也可以说没继承下来)</td>
</tr>
<tr>
<td style="text-align:left">protected</td>
<td>private</td>
</tr>
<tr>
<td style="text-align:left">public</td>
<td>private</td>
</tr>
</tbody>
</table>
<p>私有继承也属于一个Has a关系，因为他只能访问父类的共有属性。</p>
<h2 id="隐藏"><a href="#隐藏" class="headerlink" title="隐藏"></a>隐藏</h2><p>父子关系，成员同名，隐藏。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Soldier里有一个play,他的父类也有一个play方法</span></div><div class="line">Soldier s;</div><div class="line"></div><div class="line"><span class="comment">//调用Soldier里的play方法</span></div><div class="line">s.play();</div><div class="line">s.work();</div><div class="line"></div><div class="line"><span class="comment">//调用Person里面的play方法</span></div><div class="line">s.Person::play();</div></pre></td></tr></table></figure>
<h2 id="多重集成"><a href="#多重集成" class="headerlink" title="多重集成"></a>多重集成</h2><p>注意他不是多继承，比如：士兵继承人，步兵继承士兵，他们之间的关系是多重继承。</p>
<h2 id="多继承"><a href="#多继承" class="headerlink" title="多继承"></a>多继承</h2><p>比如:农民集成工人类，还继承农民类，简称农民工类，他们之间的关系就是多继承。</p>
<p>Worker.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Worker_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Worker_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Worker &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Worker(<span class="built_in">string</span> code=<span class="string">"001"</span>);</div><div class="line">    <span class="keyword">virtual</span> ~Worker();</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">carry</span><span class="params">()</span></span>;  <span class="comment">//射击</span></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="built_in">string</span> m_strCode;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Worker_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Worker.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Worker.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Worker::Worker(<span class="built_in">string</span> code)&#123;</div><div class="line">    m_strCode=code;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Worker()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Worker::~Worker()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Worker()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Worker::carry()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;m_strCode&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Worker-carry()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Farmer.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Farmer_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Farmer_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Farmer &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Farmer(<span class="built_in">string</span> name=<span class="string">"jack"</span>);</div><div class="line">    <span class="keyword">virtual</span> ~Farmer();</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sow</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="built_in">string</span> m_strName;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Farmer_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Farmer.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Farmer.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Farmer::Farmer(<span class="built_in">string</span> name)&#123;</div><div class="line">    m_strName=name;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Farmer()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Farmer::~Farmer()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Farmer()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">void</span> Farmer::sow()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"sow()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MigrantWorker.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MigrantWorker_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MigrantWorker_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Worker.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Farmer.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="comment">//这里在前面，先调用构造函数</span></div><div class="line"><span class="keyword">class</span> MigrantWorker:<span class="keyword">public</span> Worker,<span class="keyword">public</span> Farmer &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    MigrantWorker(<span class="built_in">string</span> name,<span class="built_in">string</span> code);</div><div class="line">    ~MigrantWorker();</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* MigrantWorker_hpp */</span></span></div></pre></td></tr></table></figure>
<p>MigrantWorker.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"MigrantWorker.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">MigrantWorker::MigrantWorker(<span class="built_in">string</span> name,<span class="built_in">string</span> code):Farmer(name),Worker(code)&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"MigrantWorker"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">MigrantWorker::~MigrantWorker()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~MigrantWorker()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">MigrantWorker *p = <span class="keyword">new</span> MigrantWorker(<span class="string">"Merry"</span>,<span class="string">"100"</span>);</div><div class="line"></div><div class="line">p-&gt;carry();</div><div class="line">p-&gt;sow();</div><div class="line"></div><div class="line"><span class="keyword">delete</span> p;</div><div class="line">p=<span class="literal">NULL</span>;</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Worker()</div><div class="line">Farmer()</div><div class="line">MigrantWorker</div><div class="line">100</div><div class="line">Worker-carry()</div><div class="line">sow()</div><div class="line">~MigrantWorker()</div><div class="line">~Farmer()</div><div class="line">~Worker()</div></pre></td></tr></table></figure>
<h2 id="虚继承"><a href="#虚继承" class="headerlink" title="虚继承"></a>虚继承</h2><p>是为了解决菱形继承问题。简单来讲就是，工人继承人，农民继承人，农民工继承工人，农民就会出现两份人的信息，如果让工人虚继承人，农民虚继承人，农民工在继承他们两个，就只会出现一份人的信息。就这问题，如果按照常规写法，会报错，Person重定义。解决方法有多种</p>
<h3 id="宏定义"><a href="#宏定义" class="headerlink" title="宏定义"></a>宏定义</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Person_hpp <span class="comment">//解决宏定义</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Person_hpp <span class="comment">//解决宏定义</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Person &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Person(<span class="built_in">string</span> color=<span class="string">"blue"</span>);</div><div class="line">    <span class="keyword">virtual</span> ~Person();</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printColor</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="built_in">string</span> m_strColor;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">//解决宏定义</span></span></div></pre></td></tr></table></figure>
<p>在菱形继承中，会导致里面有多份数据。可以这样验证：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Person()</div><div class="line">Worker()</div><div class="line">Person()</div><div class="line">Farmer()</div><div class="line">MigrantWorker</div><div class="line">Worker red //重复数据</div><div class="line">Person-printColor()</div><div class="line">Farmer red //重复数据</div><div class="line">Person-printColor()</div><div class="line">~MigrantWorker()</div><div class="line">~Farmer()</div><div class="line">~Person()</div><div class="line">~Worker()</div><div class="line">~Person()</div></pre></td></tr></table></figure>
<p>解决方法是工人，农民从人类那里虚拟继承。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> Worker:<span class="keyword">virtual</span> <span class="keyword">public</span> Person</div><div class="line">  </div><div class="line"><span class="keyword">class</span> Farmer:<span class="keyword">virtual</span> <span class="keyword">public</span> Person</div></pre></td></tr></table></figure>
<p>这样打印结果就是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Person()</div><div class="line">Worker()</div><div class="line">Farmer()</div><div class="line">MigrantWorker</div><div class="line">b</div><div class="line">Person-printColor()</div><div class="line">b</div><div class="line">Person-printColor()</div><div class="line">~MigrantWorker()</div><div class="line">~Farmer()</div><div class="line">~Worker()</div><div class="line">~Person()</div></pre></td></tr></table></figure>
<p>但是这样的结果就是，Person类无法接收到子类传递的参数。下面是完整测试代码：</p>
<p>Person.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Person_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Person_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Person &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Person(<span class="built_in">string</span> color=<span class="string">"b"</span>);</div><div class="line">    <span class="keyword">virtual</span> ~Person();</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printColor</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="built_in">string</span> m_strColor;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Person_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Person.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Person.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Person::Person(<span class="built_in">string</span> code)&#123;</div><div class="line">    m_strColor=code;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Person()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Person::~Person()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Person()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Person::printColor()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;m_strColor&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Person-printColor()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Worker.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Worker_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Worker_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Person.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Worker:<span class="keyword">virtual</span> <span class="keyword">public</span> Person &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Worker(<span class="built_in">string</span> code=<span class="string">"001"</span>,<span class="built_in">string</span> color=<span class="string">"blue"</span>);</div><div class="line">    <span class="keyword">virtual</span> ~Worker();</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">carry</span><span class="params">()</span></span>;  <span class="comment">//射击</span></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="built_in">string</span> m_strCode;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Worker_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Worker.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Worker.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Worker::Worker(<span class="built_in">string</span> code,<span class="built_in">string</span> color):Person(<span class="string">"Worker "</span>+color)&#123;</div><div class="line">    m_strCode=code;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Worker()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Worker::~Worker()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Worker()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Worker::carry()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;m_strCode&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Worker-carry()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Farmer.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Farmer_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Farmer_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Person.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Farmer:<span class="keyword">virtual</span> <span class="keyword">public</span> Person &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Farmer(<span class="built_in">string</span> name=<span class="string">"jack"</span>,<span class="built_in">string</span> color=<span class="string">"blue"</span>);</div><div class="line">    <span class="keyword">virtual</span> ~Farmer();</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sow</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="built_in">string</span> m_strName;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Farmer_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Farmer.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Farmer.hpp"</span></span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Farmer::Farmer(<span class="built_in">string</span> name,<span class="built_in">string</span> color):Person(<span class="string">"Farmer "</span>+color)&#123;</div><div class="line">    m_strName=name;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Farmer()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Farmer::~Farmer()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Farmer()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">void</span> Farmer::sow()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"sow()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MigrantWorker.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MigrantWorker_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MigrantWorker_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Worker.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Farmer.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="comment">//这里在前面，先调用构造函数</span></div><div class="line"><span class="keyword">class</span> MigrantWorker:<span class="keyword">public</span> Worker,<span class="keyword">public</span> Farmer &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    MigrantWorker(<span class="built_in">string</span> name,<span class="built_in">string</span> code,<span class="built_in">string</span> color);</div><div class="line">    ~MigrantWorker();</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* MigrantWorker_hpp */</span></span></div></pre></td></tr></table></figure>
<p>MigrantWorker.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"MigrantWorker.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">MigrantWorker::MigrantWorker(<span class="built_in">string</span> name,<span class="built_in">string</span> code,<span class="built_in">string</span> color):Farmer(name,color),Worker(code,color)&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"MigrantWorker"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">MigrantWorker::~MigrantWorker()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~MigrantWorker()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h1><h2 id="静态多态-早绑定"><a href="#静态多态-早绑定" class="headerlink" title="静态多态(早绑定)"></a>静态多态(早绑定)</h2><p>例子是，一个类有多个函数重载，在调用的时候传不同的参数，在编译时就确定了要调用那个函数。</p>
<h2 id="动态多态-晚绑定"><a href="#动态多态-晚绑定" class="headerlink" title="动态多态(晚绑定)"></a>动态多态(晚绑定)</h2><p>比如：我们定义一个形状类定义一个计算面积的函数，在定义圆继承形状类中也定义一个计算面积函数并实现，在定义一个矩形并也实现计算面积的函数。</p>
<p>然后也用形状类型的指针，引用这两个对象，然后调用计算面积的方法。他们会调用不同对象类的面积方法。</p>
<p>Shape.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Shape_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Shape_hpp</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">class</span> Shape &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Shape();</div><div class="line">    ~Shape();</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">double</span> <span class="title">calcArea</span><span class="params">()</span></span>; <span class="comment">//要实现多态，需要加virtual，子类方法默认也就加上了，但最好手动也加上，这样一看就明白，</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Shape_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Shape.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Shape.hpp"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Shape::Shape()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Shape()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Shape::~Shape()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Shape"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">double</span> Shape::calcArea()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Shape-calcAre()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Circle.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Circle_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Circle_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Shape.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Circle:<span class="keyword">public</span> Shape &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Circle(<span class="keyword">double</span> r);</div><div class="line">    ~Circle();</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">calcArea</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="keyword">double</span> m_dR; <span class="comment">//圆的半径</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Circle_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Circle.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Circle.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Circle::Circle(<span class="keyword">double</span> r)&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Circle"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Circle::~Circle()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Circle"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">double</span> Circle::calcArea()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Circle-calcArea"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">3.14</span>*m_dR*m_dR;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Rect.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Rect_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Rect_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Shape.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Rect:<span class="keyword">public</span> Shape &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Rect(<span class="keyword">double</span> width,<span class="keyword">double</span> height);</div><div class="line">    ~Rect();</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">calcArea</span><span class="params">()</span></span>;</div><div class="line">    </div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="keyword">double</span> m_dWidth;</div><div class="line">    <span class="keyword">double</span> m_dHeight;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Rect_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Rect.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Rect.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Rect::Rect(<span class="keyword">double</span> width,<span class="keyword">double</span> height)&#123;</div><div class="line">    m_dWidth=width;</div><div class="line">    m_dHeight=height;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Rect"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Rect::~Rect()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Rect"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">double</span> Rect::calcArea()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Rect-calcArea"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> m_dHeight*m_dWidth;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Shape *shape1=<span class="keyword">new</span> Rect(<span class="number">2</span>,<span class="number">5</span>);</div><div class="line">Shape *shape2=<span class="keyword">new</span> Circle(<span class="number">3</span>);</div><div class="line"></div><div class="line">shape1-&gt;calcArea();</div><div class="line">shape2-&gt;calcArea();</div><div class="line"></div><div class="line"><span class="keyword">delete</span> shape1;</div><div class="line"><span class="keyword">delete</span> shape2;</div><div class="line"></div><div class="line">shape1=<span class="literal">NULL</span>;</div><div class="line">shape2=<span class="literal">NULL</span>;</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Shape()</div><div class="line">Rect</div><div class="line">Shape()</div><div class="line">Circle</div><div class="line">Rect-calcArea</div><div class="line">Circle-calcArea</div><div class="line">~Shape //可以看见析构函数还有问题，因为只调用了父类析构函数</div><div class="line">~Shape</div></pre></td></tr></table></figure>
<h2 id="virtual使用限制"><a href="#virtual使用限制" class="headerlink" title="virtual使用限制"></a>virtual使用限制</h2><p>修饰的函数不能使全局函数，不能修饰静态成员函数，不能修饰构造函数，导致编译错误。</p>
<p>不能修饰内联函数，如果修饰了inline将被忽略。</p>
<h2 id="虚析构函数"><a href="#虚析构函数" class="headerlink" title="虚析构函数"></a>虚析构函数</h2><p>他就是解决上面例子中析构函数问题的。一般建议父类都声明虚构析构函数，因为你不知道未来的子类是否会使用析构函数释放资源。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">virtual</span> ~Shape();</div></pre></td></tr></table></figure>
<h2 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h2><p>含有纯虚函数的类叫抽象类。不能实例化对象，编译错误</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">virtual</span> <span class="keyword">double</span> <span class="title">test</span><span class="params">()</span></span>=<span class="number">0</span>; <span class="comment">//声明一个纯虚函数</span></div></pre></td></tr></table></figure>
<p>这里我们设计这样一个示例，一个人类，一个工人类，一个清洁工类</p>
<p>Person.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Person_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Person_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Person &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Person(<span class="built_in">string</span> name);</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">()</span></span>=<span class="number">0</span>; <span class="comment">//纯虚函数</span></div><div class="line">    <span class="keyword">virtual</span> ~Person()&#123;&#125;;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="built_in">string</span> m_strName;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Person_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Person.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Person.hpp"</span></span></div><div class="line"></div><div class="line">Person::Person(<span class="built_in">string</span> name)&#123;</div><div class="line">    m_strName=name;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Worker.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Worker_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Worker_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Person.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Worker:<span class="keyword">public</span> Person &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Worker(<span class="built_in">string</span> name,<span class="keyword">int</span> age);</div><div class="line"><span class="comment">//    virtual void work();</span></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> m_iAge;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Worker_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Worker.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Worker.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Worker::Worker(<span class="built_in">string</span> name,<span class="keyword">int</span> age):Person(name)&#123;</div><div class="line">    m_iAge=age;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//void Worker::work()&#123;</span></div><div class="line"><span class="comment">//    cout&lt;&lt;"Work-work()"&lt;&lt;endl;</span></div><div class="line"><span class="comment">//&#125;</span></div></pre></td></tr></table></figure>
<p>Dustman.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Dustman_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Dustman_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Worker.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Dustman:<span class="keyword">public</span> Worker &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Dustman(<span class="built_in">string</span> name,<span class="keyword">int</span> age);</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">work</span><span class="params">()</span></span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Dustman_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Dustman.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Dustman.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Dustman::Dustman(<span class="built_in">string</span> name,<span class="keyword">int</span> age):Worker(name,age)&#123;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Dustman::work()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Dustman-扫地"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function">Dustman <span class="title">dustman</span><span class="params">(<span class="string">"a"</span>,<span class="number">20</span>)</span></span>; <span class="comment">//测试是否可以被实例化</span></div></pre></td></tr></table></figure>
<h2 id="接口类"><a href="#接口类" class="headerlink" title="接口类"></a>接口类</h2><p>仅含有纯虚函数的类称为接口类。下面定义一个可飞的接口，然后实现一个飞机，战斗机类。</p>
<p>Flyable.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Flyable_h</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Flyable_h</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Flyable &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">takeoff</span><span class="params">()</span></span>=<span class="number">0</span>;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">land</span><span class="params">()</span></span>=<span class="number">0</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Flyable_h */</span></span></div></pre></td></tr></table></figure>
<p>由于它是接口类，所以没有cpp文件。</p>
<p>Plane.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Plane_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Plane_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Flyable.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Plane :<span class="keyword">public</span> Flyable &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Plane(<span class="built_in">string</span> code);</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">takeoff</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">land</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printCode</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="built_in">string</span> m_strCode;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Plane_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Plane.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Plane.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">Plane::Plane(<span class="built_in">string</span> code)&#123;</div><div class="line">    m_strCode=code;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Plane::takeoff()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Plane-takeoff()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Plane::land()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Plane-land()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Plane::printCode()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;m_strCode&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>FighterPlane.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> FighterPlane_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> FighterPlane_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Plane.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> FighterPlane:<span class="keyword">public</span> Plane &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    FighterPlane(<span class="built_in">string</span> code);</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">takeoff</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">land</span><span class="params">()</span></span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* FighterPlane_hpp */</span></span></div></pre></td></tr></table></figure>
<p>FighterPlane.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"FighterPlane.hpp"</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line">FighterPlane::FighterPlane(<span class="built_in">string</span> code):Plane(code)&#123;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> FighterPlane::takeoff()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"FighterPlane-takeoff()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> FighterPlane::land()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"FighterPlane-land()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Flyable.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Plane.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"FighterPlane.hpp"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">flyMatch</span><span class="params">(Flyable *f1,Flyable *f2)</span></span>&#123;</div><div class="line">    f1-&gt;takeoff();</div><div class="line">    f1-&gt;land();</div><div class="line">    f2-&gt;takeoff();</div><div class="line">    f2-&gt;land();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//传入父类</span></div><div class="line"><span class="comment">//    Plane p1("1");</span></div><div class="line"><span class="comment">//    Plane p2("2");</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    flyMatch(&amp;p1, &amp;p2);</span></div><div class="line">    </div><div class="line">    <span class="comment">//传入子类</span></div><div class="line">    <span class="function">FighterPlane <span class="title">p1</span><span class="params">(<span class="string">"1"</span>)</span></span>;</div><div class="line">    <span class="function">FighterPlane <span class="title">p2</span><span class="params">(<span class="string">"2"</span>)</span></span>;</div><div class="line">    </div><div class="line">    p1.printCode();</div><div class="line">    p2.printCode();</div><div class="line">    </div><div class="line">    flyMatch(&amp;p1, &amp;p2);</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="RTTI-运行时类型识别"><a href="#RTTI-运行时类型识别" class="headerlink" title="RTTI(运行时类型识别)"></a>RTTI(运行时类型识别)</h1><p>Run-Time Type Identification</p>
<h2 id="typeid"><a href="#typeid" class="headerlink" title="typeid"></a>typeid</h2><p>注意：</p>
<p>他返回一个type_info对象的引用</p>
<p>如果想通过父类的指针获得派生类的数据类型，父类必须带有虚函数。</p>
<p>只能获取对象的实际类型，不能判断指针</p>
<h2 id="dynamic-cast"><a href="#dynamic-cast" class="headerlink" title="dynamic_cast"></a>dynamic_cast</h2><p>注意：</p>
<p>只能用于指针和引用的转换</p>
<p>要转换的类型中必须包含虚函数</p>
<p>转换成功返回子类的地址，失败返回NULL</p>
<p>下面演示定义一个Flyable,然后定义一个Bird,Plane继承Flyable,然后演示使用方法。</p>
<p>Flyable.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Flyable_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Flyable_hpp</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Flyable &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">takeoff</span><span class="params">()</span></span>=<span class="number">0</span>;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">land</span><span class="params">()</span></span>=<span class="number">0</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Flyable_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Bird.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Bird_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Bird_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Flyable.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Bird:<span class="keyword">public</span> Flyable &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">foraging</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">takeoff</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">land</span><span class="params">()</span></span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Bird_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Bird.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Bird.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Bird::foraging()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Bird-foraging()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Bird::takeoff()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Bird-takeoff()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Bird::land()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Bird-land()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Plane.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Plane_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Plane_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Flyable.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span>  Plane:<span class="keyword">public</span> Flyable &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">carry</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">takeoff</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">land</span><span class="params">()</span></span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Plane_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Plane.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Plane.hpp"</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Plane::carry()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Plane-carry()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Plane::takeoff()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Plane-takeoff()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Plane::land()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Plane-land()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>main.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"><span class="comment">//#include &lt;typeinfo&gt; //有些编译器要包含</span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Flyable.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Bird.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Plane.hpp"</span></span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">doSomething</span><span class="params">(Flyable *obj)</span></span>&#123;</div><div class="line">    <span class="comment">//xcode中输出5Plane,4Bird</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="keyword">typeid</span>(*obj).name()&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    obj-&gt;takeoff();</div><div class="line">    </div><div class="line"><span class="comment">//    typeid有点栗色java中的instance</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeid</span>(*obj)==<span class="keyword">typeid</span>(Bird)) &#123;</div><div class="line">        Bird *bird=<span class="keyword">dynamic_cast</span>&lt;Bird *&gt;(obj);</div><div class="line">        bird-&gt;foraging();</div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeid</span>(*obj)==<span class="keyword">typeid</span>(Plane))&#123;</div><div class="line">        Plane *plane=<span class="keyword">dynamic_cast</span>&lt;Plane *&gt;(obj);</div><div class="line">        plane-&gt;carry();</div><div class="line">    &#125;</div><div class="line">    obj-&gt;land();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</div><div class="line">    </div><div class="line"><span class="comment">//    Bird b;</span></div><div class="line"><span class="comment">//    doSomething(&amp;b);</span></div><div class="line">    </div><div class="line">    <span class="comment">//输出</span></div><div class="line"><span class="comment">//    4Bird</span></div><div class="line"><span class="comment">//    Bird-takeoff()</span></div><div class="line"><span class="comment">//    Bird-foraging()</span></div><div class="line"><span class="comment">//    Bird-land()</span></div><div class="line">    </div><div class="line">    <span class="comment">//基本类型</span></div><div class="line">    <span class="keyword">int</span> i=<span class="number">10</span>; <span class="comment">//i</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="keyword">typeid</span>(i).name()&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//指针</span></div><div class="line">    Plane *p=<span class="keyword">new</span> Plane();</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="keyword">typeid</span>(p).name()&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//P5Plane</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="keyword">typeid</span>(*p).name()&lt;&lt;<span class="built_in">endl</span>;<span class="comment">//5Plane</span></div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h1><p>Exception.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Exception_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Exception_hpp</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Exception &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">printException</span><span class="params">()</span></span>;</div><div class="line">    <span class="keyword">virtual</span> ~Exception()&#123;&#125;</div><div class="line"></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Exception_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Exception.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Exception.hpp"</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Exception.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Exception::printException()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Exception-printException"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>IndexException.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> IndexException_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> IndexException_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Exception.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">class</span> IndexException:<span class="keyword">public</span> Exception &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">printException</span><span class="params">()</span></span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* IndexException_hpp */</span></span></div></pre></td></tr></table></figure>
<p>IndexException.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"IndexException.hpp"</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">void</span> IndexException::printException()&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"IndexException-下标越界"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"IndexException.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//基本方式</span></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="number">1</span>;</div><div class="line">    &#125; <span class="keyword">catch</span> (<span class="keyword">int</span>) &#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"捕捉到异常了"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//捕捉到异常的值</span></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="number">0.1</span>;</div><div class="line">    &#125; <span class="keyword">catch</span> (<span class="keyword">double</span> &amp;e) &#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;e&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//对象异常</span></div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="keyword">throw</span> IndexException();</div><div class="line">    &#125; <span class="keyword">catch</span> (IndexException e) &#123;</div><div class="line">        e.printException();</div><div class="line">    &#125;<span class="keyword">catch</span>(Exception e)&#123;</div><div class="line">        e.printException();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="友元"><a href="#友元" class="headerlink" title="友元"></a>友元</h1><h2 id="友元函数"><a href="#友元函数" class="headerlink" title="友元函数"></a>友元函数</h2><p>不建议使用，会影响封装讯。</p>
<p>在友元函数里面可以直接访问对象的私有属性。</p>
<h3 id="友元全局函数"><a href="#友元全局函数" class="headerlink" title="友元全局函数"></a>友元全局函数</h3><p>这里演示先定义一个Time,然后在定义一个全局函数，并在Time中声明这个函数为Time类的友元函数。并访问私有属性。</p>
<p>Time.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Time_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Time_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Time &#123;</div><div class="line">    </div><div class="line">    <span class="comment">//声明为全局友元函数，这样在这个函数中就可以直接访问私有变量</span></div><div class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">void</span> <span class="title">printTime</span><span class="params">(Time &amp;t)</span></span>;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Time(<span class="keyword">int</span> hour,<span class="keyword">int</span> min,<span class="keyword">int</span> sec);</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> m_iHour;</div><div class="line">    <span class="keyword">int</span> m_iMinute;</div><div class="line">    <span class="keyword">int</span> m_iSecond;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Time_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Time.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Time.hpp"</span></span></div><div class="line"></div><div class="line">Time::Time(<span class="keyword">int</span> hour,<span class="keyword">int</span> min,<span class="keyword">int</span> sec)&#123;</div><div class="line">    m_iHour=hour;</div><div class="line">    m_iMinute=min;</div><div class="line">    m_iSecond=sec;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后定一个全局函数，并测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Time.hpp"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">printTime</span><span class="params">(Time &amp;t)</span></span>&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;t.m_iHour&lt;&lt;<span class="string">":"</span>&lt;&lt;t.m_iMinute&lt;&lt;<span class="string">":"</span>&lt;&lt;t.m_iHour&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="function">Time <span class="title">t</span><span class="params">(<span class="number">6</span>,<span class="number">10</span>,<span class="number">20</span>)</span></span>;</div><div class="line">    printTime(t);</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到现在完全可以访问私有函数。</p>
<h3 id="友元成员函数"><a href="#友元成员函数" class="headerlink" title="友元成员函数"></a>友元成员函数</h3><p>这里我们定义一个Time,然后在Match类中定义一个函数，然后将这个函数申明为Time类中的友元成员函数。</p>
<p>Time.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Time_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Time_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Match.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Time &#123;</div><div class="line">    </div><div class="line">    <span class="comment">//声明为全局友元函数，这样在这个函数中就可以直接访问私有变量</span></div><div class="line">    <span class="keyword">friend</span> <span class="keyword">void</span> Match::printTime(Time &amp;t);</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Time(<span class="keyword">int</span> hour,<span class="keyword">int</span> min,<span class="keyword">int</span> sec);</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> m_iHour;</div><div class="line">    <span class="keyword">int</span> m_iMinute;</div><div class="line">    <span class="keyword">int</span> m_iSecond;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Time_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Time.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Time.hpp"</span></span></div><div class="line"></div><div class="line">Time::Time(<span class="keyword">int</span> hour,<span class="keyword">int</span> min,<span class="keyword">int</span> sec)&#123;</div><div class="line">    m_iHour=hour;</div><div class="line">    m_iMinute=min;</div><div class="line">    m_iSecond=sec;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Match.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Match_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Match_hpp</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Time;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Match &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printTime</span><span class="params">(Time &amp;t)</span></span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Match_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Match.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Time.hpp"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Match.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">void</span> Match::printTime(Time &amp;t)&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;t.m_iHour&lt;&lt;<span class="string">":"</span>&lt;&lt;t.m_iMinute&lt;&lt;<span class="string">":"</span>&lt;&lt;t.m_iHour&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Time.hpp"</span></span></div><div class="line"></div><div class="line"><span class="comment">//void printTime(Time &amp;t)&#123;</span></div><div class="line"><span class="comment">//    cout&lt;&lt;t.m_iHour&lt;&lt;":"&lt;&lt;t.m_iMinute&lt;&lt;":"&lt;&lt;t.m_iHour&lt;&lt;endl;</span></div><div class="line"><span class="comment">//&#125;</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="function">Time <span class="title">t</span><span class="params">(<span class="number">6</span>,<span class="number">10</span>,<span class="number">20</span>)</span></span>;</div><div class="line"><span class="comment">//    printTime(t);</span></div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="友元类"><a href="#友元类" class="headerlink" title="友元类"></a>友元类</h2><p>注意：</p>
<p>友元关系不可以传递，A是B的朋友，B是C的朋友，A不一定是C的朋友</p>
<p>友元关系的单向性，A是B的朋友，B不一定是A的朋友</p>
<p>友元声明的形式以及数量不受限制，也就是说即声明函数，字段都可以</p>
<p>特别注意：友元只是封装的补充，并不是很好地设计。</p>
<p>下载演示将Match类声明为Time的友元类，这样就可以访问Time的私有函数，数据成员。</p>
<h1 id="静态"><a href="#静态" class="headerlink" title="静态"></a>静态</h1><h2 id="静态数据成员"><a href="#静态数据成员" class="headerlink" title="静态数据成员"></a>静态数据成员</h2><h2 id="静态成员函数"><a href="#静态成员函数" class="headerlink" title="静态成员函数"></a>静态成员函数</h2><p>注意：</p>
<p>静态数据成员必须单独初始化</p>
<p>静态数据成员不能调用飞静态成员函数和非静态数据成员。</p>
<p>静态成员函数后面不能加const</p>
<p>Tank.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Tank_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Tank_hpp</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Tank &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    Tank(<span class="keyword">char</span> code);</div><div class="line">    ~Tank();</div><div class="line">    Tank();</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fire</span><span class="params">()</span></span>;</div><div class="line"><span class="comment">//    static int getCount(); //静态成员函数</span></div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> s_iCount;</div><div class="line">    <span class="keyword">char</span> m_cCode; <span class="comment">//静态数据成员</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Tank_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Tank.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Tank.hpp"</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="comment">//初始化静态数据成员</span></div><div class="line"><span class="keyword">int</span> Tank::s_iCount=<span class="number">0</span>;</div><div class="line"></div><div class="line">Tank::Tank(<span class="keyword">char</span> code)&#123;</div><div class="line">    m_cCode=code;</div><div class="line">    s_iCount++;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Tank()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Tank::~Tank()&#123;</div><div class="line">    s_iCount--;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"~Tank()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> Tank::fire()&#123;</div><div class="line"><span class="comment">//    getCount(); //可以调用</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"fire()"</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//实现静态成员函数时，不用写static</span></div><div class="line"><span class="keyword">int</span> Tank::getCount()&#123;</div><div class="line"><span class="comment">//    fire();//不能调用</span></div><div class="line">    <span class="keyword">return</span> s_iCount;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//int Tank::getCount()&#123;</span></div><div class="line"><span class="comment">//    return s_iCount;</span></div><div class="line"><span class="comment">//&#125;</span></div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//    Tank t1('a');</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    cout&lt;&lt;t1.getCount()&lt;&lt;endl;</span></div><div class="line"><span class="comment">//    cout&lt;&lt;Tank::getCount()&lt;&lt;endl;</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    Tank *t2=new Tank('b');</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    cout&lt;&lt;Tank::getCount()&lt;&lt;endl;</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    delete t2;</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    cout&lt;&lt;Tank::getCount()&lt;&lt;endl;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    Tank *t3=new Tank('c');</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    cout&lt;&lt;Tank::getCount()&lt;&lt;endl;</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    delete t3;</span></div><div class="line"><span class="comment">//    </span></div><div class="line"><span class="comment">//    cout&lt;&lt;Tank::getCount()&lt;&lt;endl;</span></div></pre></td></tr></table></figure>
<h1 id="运算符重载"><a href="#运算符重载" class="headerlink" title="运算符重载"></a>运算符重载</h1><p>给原有的运算符赋予新的功能。本质就是函数重载</p>
<h2 id="负号"><a href="#负号" class="headerlink" title="-负号"></a>-负号</h2><p>友元函数,成员函数两种方式</p>
<p>Coordinate.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Coordinate_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Coordinate_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Coordinate &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">//友元函数方式重载-</span></div><div class="line">    <span class="keyword">friend</span> Coordinate &amp;<span class="keyword">operator</span>-(Coordinate &amp;c);</div><div class="line">    </div><div class="line">    Coordinate(<span class="keyword">int</span> x,<span class="keyword">int</span> y);</div><div class="line">    </div><div class="line">    <span class="comment">//声明-(负号)运算符重载,成员函数重载</span></div><div class="line"><span class="comment">//    Coordinate &amp;operator-();</span></div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span></span>;</div><div class="line">    </div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> m_iX;</div><div class="line">    <span class="keyword">int</span> m_iY;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Coordinate_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Coordinate.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Coordinate.hpp"</span></span></div><div class="line"></div><div class="line">Coordinate::Coordinate(<span class="keyword">int</span> x,<span class="keyword">int</span> y)&#123;</div><div class="line">    m_iX=x;</div><div class="line">    m_iY=y;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Coordinate::getX()&#123;</div><div class="line">    <span class="keyword">return</span> m_iX;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Coordinate::getY()&#123;</div><div class="line">    <span class="keyword">return</span> m_iY;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//Coordinate &amp;Coordinate::operator-()&#123;</span></div><div class="line"><span class="comment">//    m_iX=-m_iX;</span></div><div class="line"><span class="comment">//    this-&gt;m_iY=-this-&gt;m_iY;</span></div><div class="line"><span class="comment">//    return *this;</span></div><div class="line"><span class="comment">//&#125;</span></div><div class="line"></div><div class="line">Coordinate &amp;<span class="keyword">operator</span>-(Coordinate &amp;c)&#123;</div><div class="line">    c.m_iX=-c.m_iX;</div><div class="line">    c.m_iY=-c.m_iY;</div><div class="line">    <span class="keyword">return</span> c;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function">Coordinate <span class="title">coor</span><span class="params">(<span class="number">1</span>,<span class="number">3</span>)</span></span>;</div><div class="line"><span class="built_in">cout</span>&lt;&lt;coor.getX()&lt;&lt;<span class="string">","</span>&lt;&lt;coor.getY()&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//1,3</span></div><div class="line">-coor;</div><div class="line"><span class="built_in">cout</span>&lt;&lt;coor.getX()&lt;&lt;<span class="string">","</span>&lt;&lt;coor.getY()&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//-1,-3</span></div></pre></td></tr></table></figure>
<h2 id="重载"><a href="#重载" class="headerlink" title="++重载"></a>++重载</h2><p>包括前置,后置</p>
<p>Coordinate.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Coordinate_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Coordinate_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Coordinate &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">//友元函数方式重载-</span></div><div class="line">    <span class="keyword">friend</span> Coordinate &amp;<span class="keyword">operator</span>-(Coordinate &amp;c);</div><div class="line">    <span class="keyword">friend</span> Coordinate &amp;<span class="keyword">operator</span>++(Coordinate &amp;c);</div><div class="line">    </div><div class="line">    Coordinate(<span class="keyword">int</span> x,<span class="keyword">int</span> y);</div><div class="line">    </div><div class="line">    <span class="comment">//声明-(负号)运算符重载,成员函数重载</span></div><div class="line"><span class="comment">//    Coordinate &amp;operator-();</span></div><div class="line">    </div><div class="line">    <span class="comment">//前置++</span></div><div class="line"><span class="comment">//    Coordinate &amp;operator++();</span></div><div class="line">    </div><div class="line">    <span class="comment">//后置++</span></div><div class="line">    Coordinate <span class="keyword">operator</span>++(<span class="keyword">int</span>);</div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span></span>;</div><div class="line">    </div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> m_iX;</div><div class="line">    <span class="keyword">int</span> m_iY;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Coordinate_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Coordinate.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Coordinate.hpp"</span></span></div><div class="line"></div><div class="line">Coordinate::Coordinate(<span class="keyword">int</span> x,<span class="keyword">int</span> y)&#123;</div><div class="line">    m_iX=x;</div><div class="line">    m_iY=y;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Coordinate::getX()&#123;</div><div class="line">    <span class="keyword">return</span> m_iX;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Coordinate::getY()&#123;</div><div class="line">    <span class="keyword">return</span> m_iY;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//Coordinate &amp;Coordinate::operator-()&#123;</span></div><div class="line"><span class="comment">//    m_iX=-m_iX;</span></div><div class="line"><span class="comment">//    this-&gt;m_iY=-this-&gt;m_iY;</span></div><div class="line"><span class="comment">//    return *this;</span></div><div class="line"><span class="comment">//&#125;</span></div><div class="line"></div><div class="line">Coordinate &amp;<span class="keyword">operator</span>-(Coordinate &amp;c)&#123;</div><div class="line">    c.m_iX=-c.m_iX;</div><div class="line">    c.m_iY=-c.m_iY;</div><div class="line">    <span class="keyword">return</span> c;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Coordinate &amp;Coordinate::operator++()&#123;</span></div><div class="line"><span class="comment">//    m_iX++;</span></div><div class="line"><span class="comment">//    ++m_iY;</span></div><div class="line"><span class="comment">//    return *this;</span></div><div class="line"><span class="comment">//&#125;</span></div><div class="line"></div><div class="line">Coordinate &amp;<span class="keyword">operator</span>++(Coordinate &amp;c)&#123;</div><div class="line">    c.m_iX++;</div><div class="line">    c.m_iY++;</div><div class="line">    <span class="keyword">return</span> c;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Coordinate Coordinate::<span class="keyword">operator</span>++(<span class="keyword">int</span>)&#123;</div><div class="line">    </div><div class="line">    <span class="function">Coordinate <span class="title">old</span><span class="params">(*<span class="keyword">this</span>)</span></span>;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>-&gt;m_iX++;</div><div class="line">    <span class="keyword">this</span>-&gt;m_iY++;</div><div class="line">    <span class="keyword">return</span> old;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Coordinate.hpp"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</div><div class="line">    </div><div class="line"><span class="function">Coordinate <span class="title">coor</span><span class="params">(<span class="number">1</span>,<span class="number">3</span>)</span></span>;</div><div class="line"><span class="built_in">cout</span>&lt;&lt;coor.getX()&lt;&lt;<span class="string">","</span>&lt;&lt;coor.getY()&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//1,3</span></div><div class="line">    </div><div class="line"><span class="comment">//-coor;</span></div><div class="line"><span class="comment">//cout&lt;&lt;coor.getX()&lt;&lt;","&lt;&lt;coor.getY()&lt;&lt;endl;</span></div><div class="line">    </div><div class="line"><span class="comment">//    ++coor;</span></div><div class="line"><span class="comment">//    cout&lt;&lt;coor.getX()&lt;&lt;","&lt;&lt;coor.getY()&lt;&lt;endl; //2,4</span></div><div class="line">    </div><div class="line">    <span class="built_in">cout</span>&lt;&lt;(coor++).getX()&lt;&lt;<span class="string">","</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;(coor++).getY()&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//1,4</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;coor.getX()&lt;&lt;<span class="string">","</span>&lt;&lt;coor.getY()&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//3,5</span></div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="加号，cout-lt-lt-，"><a href="#加号，cout-lt-lt-，" class="headerlink" title="+加号，cout&lt;&lt;，[]"></a>+加号，cout&lt;&lt;，[]</h2><p>Coordinate.hpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Coordinate_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> Coordinate_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Coordinate &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">//友元函数方式重载-</span></div><div class="line">    <span class="keyword">friend</span> Coordinate &amp;<span class="keyword">operator</span>-(Coordinate &amp;c);</div><div class="line">    <span class="keyword">friend</span> Coordinate &amp;<span class="keyword">operator</span>++(Coordinate &amp;c);</div><div class="line">    <span class="keyword">friend</span> Coordinate <span class="keyword">operator</span>+(Coordinate c1,Coordinate c2);</div><div class="line">    <span class="comment">//输出函数，必须是友元函数</span></div><div class="line">    <span class="keyword">friend</span> ostream &amp;<span class="keyword">operator</span>&lt;&lt;(ostream &amp;out,Coordinate &amp;c);</div><div class="line">    </div><div class="line">    Coordinate(<span class="keyword">int</span> x,<span class="keyword">int</span> y);</div><div class="line">    </div><div class="line">    <span class="comment">//声明-(负号)运算符重载,成员函数重载</span></div><div class="line"><span class="comment">//    Coordinate &amp;operator-();</span></div><div class="line">    </div><div class="line">    <span class="comment">//前置++</span></div><div class="line"><span class="comment">//    Coordinate &amp;operator++();</span></div><div class="line">    </div><div class="line">    <span class="comment">//后置++</span></div><div class="line">    Coordinate <span class="keyword">operator</span>++(<span class="keyword">int</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//a+b</span></div><div class="line"><span class="comment">//    Coordinate operator+(Coordinate c);</span></div><div class="line">    </div><div class="line">    <span class="comment">//[]，索引负号</span></div><div class="line">    <span class="keyword">int</span> <span class="keyword">operator</span>[](<span class="keyword">int</span> index);</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getX</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getY</span><span class="params">()</span></span>;</div><div class="line">    </div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">int</span> m_iX;</div><div class="line">    <span class="keyword">int</span> m_iY;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* Coordinate_hpp */</span></span></div></pre></td></tr></table></figure>
<p>Coordinate.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">Coordinate <span class="keyword">operator</span>+(Coordinate c1,Coordinate c2)&#123;</div><div class="line">    <span class="function">Coordinate <span class="title">temp</span><span class="params">(<span class="number">0</span>,<span class="number">0</span>)</span></span>;</div><div class="line">        temp.m_iX=c1.m_iX+c2.m_iX;</div><div class="line">        temp.m_iY=c1.m_iY+c2.m_iY;</div><div class="line">        <span class="keyword">return</span> temp;</div><div class="line">&#125;</div><div class="line"></div><div class="line">ostream &amp;<span class="keyword">operator</span>&lt;&lt;(ostream &amp;out,Coordinate &amp;c)&#123;</div><div class="line">    out&lt;&lt;c.m_iX&lt;&lt;<span class="string">","</span>&lt;&lt;c.m_iY&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> out;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> Coordinate::<span class="keyword">operator</span>[](<span class="keyword">int</span> index)&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="number">0</span>==index) &#123;</div><div class="line">        <span class="keyword">return</span> m_iX;</div><div class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="number">1</span>==index)&#123;</div><div class="line">        <span class="keyword">return</span> m_iY;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">Coordinate coor(1,3);</div><div class="line">cout&lt;&lt;coor.getX()&lt;&lt;&quot;,&quot;&lt;&lt;coor.getY()&lt;&lt;endl; //1,3</div><div class="line"></div><div class="line">//-coor;</div><div class="line">//cout&lt;&lt;coor.getX()&lt;&lt;&quot;,&quot;&lt;&lt;coor.getY()&lt;&lt;endl;</div><div class="line"></div><div class="line">//    ++coor;</div><div class="line">//    cout&lt;&lt;coor.getX()&lt;&lt;&quot;,&quot;&lt;&lt;coor.getY()&lt;&lt;endl; //2,4</div><div class="line"></div><div class="line">//    cout&lt;&lt;(coor++).getX()&lt;&lt;&quot;,&quot;;</div><div class="line">//    cout&lt;&lt;(coor++).getY()&lt;&lt;endl; //1,4</div><div class="line">//    cout&lt;&lt;coor.getX()&lt;&lt;&quot;,&quot;&lt;&lt;coor.getY()&lt;&lt;endl; //3,5</div><div class="line"></div><div class="line"></div><div class="line">//a+b</div><div class="line">Coordinate coor1(2,4);</div><div class="line">Coordinate c3(0,0);</div><div class="line"></div><div class="line">c3=coor+coor1;</div><div class="line"></div><div class="line">//    cout&lt;&lt;c3.getX()&lt;&lt;&quot;,&quot;&lt;&lt;c3.getY()&lt;&lt;endl; //3,7</div><div class="line">cout&lt;&lt;c3&lt;&lt;endl;</div><div class="line"></div><div class="line">//[]</div><div class="line">cout&lt;&lt;c3[0]&lt;&lt;endl; //3</div><div class="line">cout&lt;&lt;c3[1]&lt;&lt;endl; //7</div><div class="line">cout&lt;&lt;c3[30]&lt;&lt;endl; //-1</div></pre></td></tr></table></figure>
<h1 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h1><p>将类型作为参数传递给函数。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="comment">//函数模板 ，这里的class用typename也行</span></div><div class="line"><span class="function">T <span class="title">max</span><span class="params">(T a,T b)</span></span>&#123; </div><div class="line">	<span class="keyword">return</span> (a&gt;b)?a:b;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> ival=max(<span class="number">10</span>,<span class="number">100</span>); <span class="comment">//没有指定数据类型，这里自动用int实例化一个模板函数</span></div><div class="line"><span class="keyword">char</span> cval=max&lt;<span class="keyword">char</span>&gt;(<span class="string">'a'</span>,<span class="string">'b'</span>);<span class="comment">//指定了类型</span></div></pre></td></tr></table></figure>
<h2 id="函数模板"><a href="#函数模板" class="headerlink" title="函数模板"></a>函数模板</h2><h3 id="变量作为模板参数"><a href="#变量作为模板参数" class="headerlink" title="变量作为模板参数"></a>变量作为模板参数</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">int</span> size&gt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>&#123;</div><div class="line">	<span class="built_in">cout</span>&lt;&lt;size&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">display&lt;<span class="number">10</span>&gt;();</div></pre></td></tr></table></figure>
<h3 id="多模板参数"><a href="#多模板参数" class="headerlink" title="多模板参数"></a>多模板参数</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T,<span class="keyword">typename</span> c&gt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">(T a,C b)</span></span>&#123;</div><div class="line">	<span class="built_in">cout</span>&lt;&lt;a&lt;&lt;<span class="string">" "</span>&lt;&lt;b&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> a=<span class="number">103</span>;</div><div class="line"><span class="built_in">string</span> str=<span class="string">"hello"</span>;</div><div class="line">display&lt;<span class="keyword">int</span>,<span class="built_in">string</span>&gt;(a,str);</div></pre></td></tr></table></figure>
<p>typename和class可以混用。</p>
<p>下面定义了一些函数模板并使用它</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">(T a)</span> </span>&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;a&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T,<span class="keyword">class</span> S&gt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">(T t,S s)</span> </span>&#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;t&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;s&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T,<span class="keyword">int</span> kSize&gt;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">(T a)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;kSize; i++) &#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;a&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</div><div class="line"><span class="comment">//    display(10);</span></div><div class="line"><span class="comment">//    display&lt;double&gt;(10.18);</span></div><div class="line"></div><div class="line"><span class="comment">//    display&lt;int,double&gt;(10, 20.4);</span></div><div class="line">    </div><div class="line">    display&lt;<span class="keyword">int</span>, <span class="number">4</span>&gt;(<span class="number">3</span>);</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="类模板"><a href="#类模板" class="headerlink" title="类模板"></a>类模板</h2><p>类内定义</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line"><span class="keyword">class</span> MyArray&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>&#123;</div><div class="line">	...</div><div class="line">	&#125;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">	T *m_pArr;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>类外定义</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;typname T&gt;</div><div class="line"><span class="keyword">void</span> MyArray&lt;T&gt;::display()&#123;</div><div class="line">	...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实例化类</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MyArray&lt;<span class="keyword">int</span>&gt; arr;</div><div class="line">arr.display();</div></pre></td></tr></table></figure>
<p>注意：暂时模板的定义和声明必须在一个文件中，不能分离</p>
<p>这里我们定义一个MyArray</p>
<p>MyArray.hpp，实现也写道这里离了，所以没有cpp文件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MyArray_hpp</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MyArray_hpp</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T,<span class="keyword">int</span> kSize,<span class="keyword">int</span> kVal&gt;</div><div class="line"><span class="keyword">class</span> MyArray &#123;</div><div class="line">    </div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line">    MyArray();</div><div class="line">    ~MyArray()&#123;</div><div class="line">        <span class="keyword">delete</span> []m_pArr;</div><div class="line">        m_pArr=<span class="literal">NULL</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">()</span></span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    T *m_pArr;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//实现</span></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T,<span class="keyword">int</span> kSize,<span class="keyword">int</span> kVal&gt;</div><div class="line">MyArray&lt;T,kSize,kVal&gt;::MyArray()&#123;</div><div class="line">    m_pArr=<span class="keyword">new</span> T[kSize];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;kSize; i++) &#123;</div><div class="line">        m_pArr[i]=kVal;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T,<span class="keyword">int</span> kSize,<span class="keyword">int</span> kVal&gt;</div><div class="line"><span class="keyword">void</span> MyArray&lt;T,kSize,kVal&gt;::display()&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;kSize; i++) &#123;</div><div class="line">        <span class="built_in">cout</span>&lt;&lt;m_pArr[i]&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">/* MyArray_hpp */</span></span></div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MyArray&lt;<span class="keyword">int</span>,<span class="number">4</span>,<span class="number">10</span>&gt; arr;</div><div class="line">arr.display(); <span class="comment">//打印4个10</span></div></pre></td></tr></table></figure>
<h1 id="标准模板库"><a href="#标准模板库" class="headerlink" title="标准模板库"></a>标准模板库</h1><p>STL:standard template lib</p>
<h2 id="vector向量"><a href="#vector向量" class="headerlink" title="vector向量"></a>vector向量</h2><p>对数组的封装</p>
<h3 id="初始化方法-1"><a href="#初始化方法-1" class="headerlink" title="初始化方法"></a>初始化方法</h3><table>
<thead>
<tr>
<th>vector<t> v1;</t></th>
<th>保存为T类型，v1默认为空</th>
</tr>
</thead>
<tbody>
<tr>
<td>vector<t> v2(v1);</t></td>
<td>v2是v1的副本</td>
</tr>
<tr>
<td>vector<t> v3(n,i);</t></td>
<td>v3包含n个值为i的元素</td>
</tr>
<tr>
<td>vector<t> v4(n);</t></td>
<td>v4包含有n个初始化元素</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>empty()</th>
<th>向量是否为空</th>
</tr>
</thead>
<tbody>
<tr>
<td>begin()</td>
<td>返回迭代器首元素</td>
</tr>
<tr>
<td>end()</td>
<td>返回迭代器末尾元素的下一个元素</td>
</tr>
<tr>
<td>clear()</td>
<td>清空向量</td>
</tr>
<tr>
<td>front()</td>
<td>第一个元素</td>
</tr>
<tr>
<td>back()</td>
<td>最后一个元素</td>
</tr>
<tr>
<td>size()</td>
<td>获得向量中数据的个数</td>
</tr>
<tr>
<td>push_back(elem)</td>
<td>在末尾插入数据</td>
</tr>
<tr>
<td>pop_back()</td>
<td>在末尾删除数据</td>
</tr>
</tbody>
</table>
<h2 id="迭代器iterator"><a href="#迭代器iterator" class="headerlink" title="迭代器iterator"></a>迭代器iterator</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">vector</span> vec;</div><div class="line">vec.push_back(<span class="string">"aa"</span>);</div><div class="line">vec.push_back(<span class="string">"bb"</span>);</div><div class="line"><span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;::iterator it=vec.begin();</div><div class="line"><span class="keyword">for</span>(;it!vec.end();it++)&#123;</div><div class="line">	<span class="built_in">cout</span>&lt;&lt;*it&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec;</div><div class="line"></div><div class="line">vec.push_back(<span class="number">3</span>);</div><div class="line">vec.push_back(<span class="number">4</span>);</div><div class="line">vec.push_back(<span class="number">6</span>);</div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//    cout&lt;&lt;vec.size()&lt;&lt;endl;</span></div><div class="line"><span class="comment">//    vec.pop_back();</span></div><div class="line"><span class="comment">//    cout&lt;&lt;vec.size()&lt;&lt;endl;</span></div><div class="line"></div><div class="line"><span class="comment">//    for (int i=0; i&lt;vec.size(); i++) &#123;</span></div><div class="line"><span class="comment">//        cout&lt;&lt;vec[i]&lt;&lt;endl;</span></div><div class="line"><span class="comment">//    &#125;</span></div><div class="line"></div><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator it=vec.begin();</div><div class="line"><span class="comment">//    cout&lt;&lt;*it&lt;&lt;endl;//3</span></div><div class="line"><span class="comment">//    for (; it!=vec.end(); it++) &#123;</span></div><div class="line"><span class="comment">//        cout&lt;&lt;*it&lt;&lt;endl;</span></div><div class="line"><span class="comment">//    &#125;</span></div><div class="line"></div><div class="line"><span class="built_in">cout</span>&lt;&lt;vec.front()&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//3</span></div><div class="line"><span class="built_in">cout</span>&lt;&lt;vec.back()&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//6</span></div></pre></td></tr></table></figure>
<h2 id="list链表"><a href="#list链表" class="headerlink" title="list链表"></a>list链表</h2><p>和vector使用差不多，插入山数据块</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt; l1;</div><div class="line">l1.push_back(<span class="number">1</span>);</div><div class="line">l1.push_back(<span class="number">10</span>);</div><div class="line">l1.push_back(<span class="number">20</span>);</div><div class="line"></div><div class="line"><span class="comment">//list不能使用[]</span></div><div class="line"><span class="comment">//    for (int i=0; i&lt;l1.size(); i++) &#123;</span></div><div class="line"><span class="comment">//        cout&lt;&lt;l1[i]&lt;&lt;endl;</span></div><div class="line"><span class="comment">//    &#125;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt;::iterator it=l1.begin();</div><div class="line"><span class="keyword">for</span> (; it!=l1.end(); it++) &#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;*it&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="map映射"><a href="#map映射" class="headerlink" title="map映射"></a>map映射</h2><p>存储的数据成对，key-value</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>,<span class="built_in">string</span>&gt; m;</div><div class="line"></div><div class="line"><span class="comment">//定义一对</span></div><div class="line">pair&lt;<span class="keyword">int</span>,<span class="built_in">string</span>&gt; p1(<span class="number">10</span>,<span class="string">"shanghai"</span>);</div><div class="line">pair&lt;<span class="keyword">int</span>,<span class="built_in">string</span>&gt; p2(<span class="number">20</span>,<span class="string">"beijing"</span>);</div><div class="line"></div><div class="line">m.insert(p1);</div><div class="line">m.insert(p2);</div><div class="line"></div><div class="line"><span class="built_in">cout</span>&lt;&lt;m[<span class="number">10</span>]&lt;&lt;<span class="built_in">endl</span>;</div><div class="line"><span class="built_in">cout</span>&lt;&lt;m[<span class="number">20</span>]&lt;&lt;<span class="built_in">endl</span>;</div></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>,<span class="built_in">string</span>&gt; m;</div><div class="line">pair&lt;<span class="keyword">int</span>, <span class="built_in">string</span>&gt; p1(<span class="number">3</span>,<span class="string">"hello"</span>);</div><div class="line">pair&lt;<span class="keyword">int</span>, <span class="built_in">string</span>&gt; p2(<span class="number">5</span>,<span class="string">"a"</span>);</div><div class="line"></div><div class="line">m.insert(p1);</div><div class="line">m.insert(p2);</div><div class="line"></div><div class="line"><span class="comment">//    cout&lt;&lt;m[3]&lt;&lt;endl; //hello</span></div><div class="line"></div><div class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>,<span class="built_in">string</span>&gt;::iterator it=m.begin();</div><div class="line"><span class="keyword">for</span> (; it!=m.end(); it++) &#123;</div><div class="line">    <span class="built_in">cout</span>&lt;&lt;it-&gt;first&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//key</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;it-&gt;second&lt;&lt;<span class="built_in">endl</span>; <span class="comment">//value</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h1&gt;&lt;p&gt;c++的诞生地是贝尔实验室，作者是比亚尼.斯特劳斯特录普博士。&lt;/p&gt;
&lt;h2 id=&quot;应用场景&quot;&gt;&lt;a href=&quot;#应用场景&quot; clas
    
    </summary>
    
      <category term="C++" scheme="http://i.woblog.cn/categories/C/"/>
    
    
      <category term="c++" scheme="http://i.woblog.cn/tags/c/"/>
    
  </entry>
  
  <entry>
    <title>Android-logback</title>
    <link href="http://i.woblog.cn/2017/01/08/android-logback/"/>
    <id>http://i.woblog.cn/2017/01/08/android-logback/</id>
    <published>2017-01-08T12:19:16.000Z</published>
    <updated>2017-03-19T14:22:37.664Z</updated>
    
    <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>logback-android:<a href="https://github.com/tony19/logback-android" target="_blank" rel="external">https://github.com/tony19/logback-android</a></p>
<p>logback:<a href="http://logback.qos.ch/" target="_blank" rel="external">http://logback.qos.ch/</a></p>
<h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><h2 id="加入依赖"><a href="#加入依赖" class="headerlink" title="加入依赖"></a>加入依赖</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">compile <span class="string">'org.slf4j:slf4j-api:1.7.21'</span></div><div class="line">compile <span class="string">'com.github.tony19:logback-android-core:1.1.1-6'</span></div><div class="line">compile(<span class="string">'com.github.tony19:logback-android-classic:1.1.1-6'</span>) &#123;</div><div class="line">    <span class="comment">// workaround issue #73</span></div><div class="line">    exclude <span class="string">group:</span> <span class="string">'com.google.android'</span>, <span class="string">module:</span> <span class="string">'android'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="添加配置文件"><a href="#添加配置文件" class="headerlink" title="添加配置文件"></a>添加配置文件</h2><p>assets/logback.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- Create a file appender for a log in the application's data directory --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.FileAppender"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>/sdcard/log/test1.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- Write INFO (and higher-level) messages to the log file --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"INFO"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"file"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="代码中输出日志"><a href="#代码中输出日志" class="headerlink" title="代码中输出日志"></a>代码中输出日志</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Logger log = LoggerFactory.getLogger(MainActivity.class);</div><div class="line">log.info(<span class="string">"hello world"</span>);</div></pre></td></tr></table></figure>
<p>这样我们就可以将日志输出到文件了</p>
<h2 id="在代码中配置"><a href="#在代码中配置" class="headerlink" title="在代码中配置"></a>在代码中配置</h2><h3 id="默认配置"><a href="#默认配置" class="headerlink" title="默认配置"></a>默认配置</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> &#123;</div><div class="line">    BasicLogcatConfigurator.configureDefaultContext();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">    org.slf4j.Logger log = LoggerFactory.getLogger(MainActivity.class);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</div><div class="line">        log.info(<span class="string">"hello world"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="将所有日志级别都记录到文件和logcat"><a href="#将所有日志级别都记录到文件和logcat" class="headerlink" title="将所有日志级别都记录到文件和logcat"></a>将所有日志级别都记录到文件和logcat</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">configureLogbackDirectly</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// reset the default context (which may already have been initialized)</span></div><div class="line">    <span class="comment">// since we want to reconfigure it</span></div><div class="line">    LoggerContext lc = (LoggerContext) LoggerFactory.getILoggerFactory();</div><div class="line">    lc.reset();</div><div class="line"></div><div class="line">    <span class="comment">// setup FileAppender</span></div><div class="line">    PatternLayoutEncoder encoder1 = <span class="keyword">new</span> PatternLayoutEncoder();</div><div class="line">    encoder1.setContext(lc);</div><div class="line">    encoder1.setPattern(<span class="string">"%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n"</span>);</div><div class="line">    encoder1.start();</div><div class="line"></div><div class="line">    FileAppender&lt;ILoggingEvent&gt; fileAppender = <span class="keyword">new</span> FileAppender&lt;ILoggingEvent&gt;();</div><div class="line">    fileAppender.setContext(lc);</div><div class="line">    fileAppender.setFile(Environment.getExternalStorageDirectory().getAbsolutePath().concat(<span class="string">"/log/file1.log"</span>));</div><div class="line">    fileAppender.setEncoder(encoder1);</div><div class="line">    fileAppender.start();</div><div class="line"></div><div class="line">    <span class="comment">// setup LogcatAppender</span></div><div class="line">    PatternLayoutEncoder encoder2 = <span class="keyword">new</span> PatternLayoutEncoder();</div><div class="line">    encoder2.setContext(lc);</div><div class="line">    encoder2.setPattern(<span class="string">"[%thread] %msg%n"</span>);</div><div class="line">    encoder2.start();</div><div class="line"></div><div class="line">    LogcatAppender logcatAppender = <span class="keyword">new</span> LogcatAppender();</div><div class="line">    logcatAppender.setContext(lc);</div><div class="line">    logcatAppender.setEncoder(encoder2);</div><div class="line">    logcatAppender.start();</div><div class="line"></div><div class="line">    <span class="comment">// add the newly created appenders to the root logger;</span></div><div class="line">    <span class="comment">// qualify Logger to disambiguate from org.slf4j.Logger</span></div><div class="line">    ch.qos.logback.classic.Logger root = (ch.qos.logback.classic.Logger) LoggerFactory.getLogger(Logger.ROOT_LOGGER_NAME);</div><div class="line">    root.addAppender(fileAppender);</div><div class="line">    root.addAppender(logcatAppender);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在onCreate方法中调用或者在Application中调用configureLogbackDirectly();。最后就可以使用日志api</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">log.debug(&quot;debug&quot;);</div><div class="line">log.info(&quot;info&quot;);</div><div class="line">log.warn(&quot;warn&quot;);</div><div class="line">log.error(&quot;error&quot;);</div></pre></td></tr></table></figure>
<p>这样所有级别的日志都记录到了文件，和logcat</p>
<h2 id="将所有日志级别都记录到logcat，debug级别以上的记录到文件"><a href="#将所有日志级别都记录到logcat，debug级别以上的记录到文件" class="headerlink" title="将所有日志级别都记录到logcat，debug级别以上的记录到文件"></a>将所有日志级别都记录到logcat，debug级别以上的记录到文件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--将所有日志级别都记录到logcat，debug级别以上的记录到文件--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"LOG_DIR"</span> <span class="attr">value</span>=<span class="string">"/sdcard/log"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- Create a logcat appender --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"logcat"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.android.LogcatAppender"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%msg<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- Create a file appender for DEBUG-level messages --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"InfoLog"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.FileAppender"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.ThresholdFilter"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;LOG_DIR&#125;/info.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 将debug级别的日志打印到logcat，info及以上的日志写到文件 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"DEBUG"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"logcat"</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"InfoLog"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></div></pre></td></tr></table></figure>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h2 id="Encoders"><a href="#Encoders" class="headerlink" title="Encoders"></a>Encoders</h2><p>pattern输出格式配置，一般情况下用这段</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></div></pre></td></tr></table></figure>
<p>输出格式解释参考以下链接</p>
<p>参考：<a href="http://blog.csdn.net/haidage/article/details/6794529" target="_blank" rel="external">http://blog.csdn.net/haidage/article/details/6794529</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h1&gt;&lt;p&gt;logback-android:&lt;a href=&quot;https://github.com/tony19/logback-android&quot; ta
    
    </summary>
    
      <category term="Android" scheme="http://i.woblog.cn/categories/Android/"/>
    
    
      <category term="log" scheme="http://i.woblog.cn/tags/log/"/>
    
  </entry>
  
  <entry>
    <title>AndroidHttp</title>
    <link href="http://i.woblog.cn/2017/01/07/android-http/"/>
    <id>http://i.woblog.cn/2017/01/07/android-http/</id>
    <published>2017-01-07T21:21:29.000Z</published>
    <updated>2017-03-19T14:22:37.664Z</updated>
    
    <content type="html"><![CDATA[<h1 id="常用网络框架介绍"><a href="#常用网络框架介绍" class="headerlink" title="常用网络框架介绍"></a>常用网络框架介绍</h1><h1 id="Volley"><a href="#Volley" class="headerlink" title="Volley"></a>Volley</h1><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>默认2.3及上以上基于HttpUrlConnection，2.3以下基于HttpClient</p>
<p>符合http缓存语义的缓存机制（提供了默认的磁盘缓存和内存缓存）</p>
<p>请求队列的优先级排序</p>
<p>提供多样的取消机制</p>
<p>提供简单的图片加载工具（一般使用它就是为了他有图片加载功能，很轻量）</p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>不能下载文件</p>
<h2 id="Android-async-http"><a href="#Android-async-http" class="headerlink" title="Android-async-http"></a>Android-async-http</h2><h3 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h3><p>在匿名回调中处理请求结构</p>
<p>在子线程中处理Http请求</p>
<p>文件的端点上传</p>
<p>智能重试功能</p>
<p>默认开启gzip亚索</p>
<p>支持解析json数据</p>
<p>可以将Cookies保存到SharedPreferences</p>
<h3 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h3><p>可以说是基本上没有缺点，但是就是作者好像没维护了</p>
<h2 id="Afinal"><a href="#Afinal" class="headerlink" title="Afinal"></a>Afinal</h2><h3 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h3><p>该框架提供了很多功能</p>
<p>数据库：使用了线程池操作sqlite</p>
<p>注解模块：ioc框架，使用注解方法绑定UI和事件，不需要findViewById和setOnClickListener</p>
<p>网络模块：通过httpclient请求数据，支持ajax方法，支持文件下载，上传功能</p>
<p>图片缓存模块：通过FinalBitmap,使得加载Bitmap无序考虑是否有OOM异常</p>
<h2 id="XUtils"><a href="#XUtils" class="headerlink" title="XUtils"></a>XUtils</h2><p>和Afinal差不多</p>
<h2 id="Okhttp"><a href="#Okhttp" class="headerlink" title="Okhttp"></a>Okhttp</h2><p>支持Http/2协议</p>
<p>使用连接池减少网络延迟</p>
<p>支持gzip</p>
<p>请求的缓存</p>
<h2 id="retrofit"><a href="#retrofit" class="headerlink" title="retrofit"></a>retrofit</h2><p>在okhttp上的一层封装</p>
<h2 id="优点-3"><a href="#优点-3" class="headerlink" title="优点"></a>优点</h2><p>支持okhttp</p>
<p>注解处理，简化代码</p>
<p>支持上传和下载文件</p>
<p>支持自定义解析数据格式</p>
<p>支持多种http库</p>
<h1 id="如何选择一个框架"><a href="#如何选择一个框架" class="headerlink" title="如何选择一个框架"></a>如何选择一个框架</h1><p>学习成本</p>
<p>文档是否完善</p>
<p>github star数量</p>
<p>现在是否有人在维护</p>
<p>流行程度</p>
<p>代码的设计是否有可借鉴性</p>
<p>代码的体积</p>
<h1 id="Okhttp-1"><a href="#Okhttp-1" class="headerlink" title="Okhttp"></a>Okhttp</h1><h2 id="加入引用"><a href="#加入引用" class="headerlink" title="加入引用"></a>加入引用</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compile <span class="string">'com.squareup.okhttp3:okhttp:3.5.0'</span></div></pre></td></tr></table></figure>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">OkHttpClient okHttpClient = <span class="keyword">new</span> OkHttpClient();</div><div class="line"></div><div class="line">Request request = <span class="keyword">new</span> Request.Builder().url(<span class="string">"http://www.baidu.com"</span>).build();</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    Response response = okHttpClient.newCall(request).execute();</div><div class="line">    <span class="keyword">if</span> (response.isSuccessful()) &#123;</div><div class="line">        System.out.println(response.body().string());</div><div class="line">    &#125;</div><div class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="Http"><a href="#Http" class="headerlink" title="Http"></a>Http</h1><h2 id="什么是Http协议"><a href="#什么是Http协议" class="headerlink" title="什么是Http协议"></a>什么是Http协议</h2><h2 id="版本区别"><a href="#版本区别" class="headerlink" title="版本区别"></a>版本区别</h2><p>1.:当前使用最多的版本，</p>
<p>默认持久连接，支持缓存，支持管道方式发送多个请求</p>
<p>2.0:每次都发送很多的请求头</p>
<h3 id="spdy"><a href="#spdy" class="headerlink" title="spdy"></a>spdy</h3><p>google推出的，对2.0有重大的意义，特点:</p>
<p>多路复用，一个tcp连接上同时跑多个http请求，请求可以设定优先级</p>
<p>去除不需要的http头，压缩http头</p>
<p>使用ssl作为传输协议，保证数据安全</p>
<p>对传输使用gzip压缩</p>
<p>提供服务方发起通讯，提供了向客户端推送数据的机制</p>
<h2 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h2><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><h2 id="相应码"><a href="#相应码" class="headerlink" title="相应码"></a>相应码</h2><p>100-199 信息提示，101</p>
<p>200-299 成功，206</p>
<p>300-399 重定向，305</p>
<p>400-499 客户端错误，415</p>
<p>500-599 服务器错误，505</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;常用网络框架介绍&quot;&gt;&lt;a href=&quot;#常用网络框架介绍&quot; class=&quot;headerlink&quot; title=&quot;常用网络框架介绍&quot;&gt;&lt;/a&gt;常用网络框架介绍&lt;/h1&gt;&lt;h1 id=&quot;Volley&quot;&gt;&lt;a href=&quot;#Volley&quot; class=&quot;headerli
    
    </summary>
    
      <category term="Android" scheme="http://i.woblog.cn/categories/Android/"/>
    
    
      <category term="Android" scheme="http://i.woblog.cn/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>使用ReactNative开发狗狗说应用流程</title>
    <link href="http://i.woblog.cn/2016/12/03/dev-gougou-say/"/>
    <id>http://i.woblog.cn/2016/12/03/dev-gougou-say/</id>
    <published>2016-12-03T10:58:58.000Z</published>
    <updated>2017-03-19T14:22:37.668Z</updated>
    
    <content type="html"><![CDATA[<h1 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h1><h1 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h1><h2 id="主界面Tab切换"><a href="#主界面Tab切换" class="headerlink" title="主界面Tab切换"></a>主界面Tab切换</h2><p>1.先完成主界面的三个tab切换，我们这里使用TabBarIOS</p>
<p><a href="http://facebook.github.io/react-native/releases/0.22/docs/tabbarios.html#content" target="_blank" rel="external">来到官方的TabBarIOS文档</a>直接将实例代码的拷贝到项目</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> base64Icon = <span class="string">'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEsAAABLCAQAAACSR7JhAAADtUlEQVR4Ac3YA2Bj6QLH0XPT1Fzbtm29tW3btm3bfLZtv7e2ObZnms7d8Uw098tuetPzrxv8wiISrtVudrG2JXQZ4VOv+qUfmqCGGl1mqLhoA52oZlb0mrjsnhKpgeUNEs91Z0pd1kvihA3ULGVHiQO2narKSHKkEMulm9VgUyE60s1aWoMQUbpZOWE+kaqs4eLEjdIlZTcFZB0ndc1+lhB1lZrIuk5P2aib1NBpZaL+JaOGIt0ls47SKzLC7CqrlGF6RZ09HGoNy1lYl2aRSWL5GuzqWU1KafRdoRp0iOQEiDzgZPnG6DbldcomadViflnl/cL93tOoVbsOLVM2jylvdWjXolWX1hmfZbGR/wjypDjFLSZIRov09BgYmtUqPQPlQrPapecLgTIy0jMgPKtTeob2zWtrGH3xvjUkPCtNg/tm1rjwrMa+mdUkPd3hWbH0jArPGiU9ufCsNNWFZ40wpwn+62/66R2RUtoso1OB34tnLOcy7YB1fUdc9e0q3yru8PGM773vXsuZ5YIZX+5xmHwHGVvlrGPN6ZSiP1smOsMMde40wKv2VmwPPVXNut4sVpUreZiLBHi0qln/VQeI/LTMYXpsJtFiclUN+5HVZazim+Ky+7sAvxWnvjXrJFneVtLWLyPJu9K3cXLWeOlbMTlrIelbMDlrLenrjEQOtIF+fuI9xRp9ZBFp6+b6WT8RrxEpdK64BuvHgDk+vUy+b5hYk6zfyfs051gRoNO1usU12WWRWL73/MMEy9pMi9qIrR4ZpV16Rrvduxazmy1FSvuFXRkqTnE7m2kdb5U8xGjLw/spRr1uTov4uOgQE+0N/DvFrG/Jt7i/FzwxbA9kDanhf2w+t4V97G8lrT7wc08aA2QNUkuTfW/KimT01wdlfK4yEw030VfT0RtZbzjeMprNq8m8tnSTASrTLti64oBNdpmMQm0eEwvfPwRbUBywG5TzjPCsdwk3IeAXjQblLCoXnDVeoAz6SfJNk5TTzytCNZk/POtTSV40NwOFWzw86wNJRpubpXsn60NJFlHeqlYRbslqZm2jnEZ3qcSKgm0kTli3zZVS7y/iivZTweYXJ26Y+RTbV1zh3hYkgyFGSTKPfRVbRqWWVReaxYeSLarYv1Qqsmh1s95S7G+eEWK0f3jYKTbV6bOwepjfhtafsvUsqrQvrGC8YhmnO9cSCk3yuY984F1vesdHYhWJ5FvASlacshUsajFt2mUM9pqzvKGcyNJW0arTKN1GGGzQlH0tXwLDgQTurS8eIQAAAABJRU5ErkJggg=='</span>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">var</span> say = React.createClass( &#123;</div><div class="line">  <span class="attr">statics</span>: &#123;</div><div class="line">    <span class="attr">title</span>: <span class="string">'&lt;TabBarIOS&gt;'</span>,</div><div class="line">    <span class="attr">description</span>: <span class="string">'Tab-based navigation.'</span>,</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">displayName</span>: <span class="string">'TabBarExample'</span>,</div><div class="line"></div><div class="line">  <span class="attr">getInitialState</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">selectedTab</span>: <span class="string">'redTab'</span>,</div><div class="line">      <span class="attr">notifCount</span>: <span class="number">0</span>,</div><div class="line">      <span class="attr">presses</span>: <span class="number">0</span>,</div><div class="line">    &#125;;</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">_renderContent</span>: <span class="function"><span class="keyword">function</span>(<span class="params">color: string, pageText: string, num?: number</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;[styles.tabContent,</span> &#123;<span class="attr">backgroundColor:</span> <span class="attr">color</span>&#125;]&#125;&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.tabText&#125;</span>&gt;</span>&#123;pageText&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.tabText&#125;</span>&gt;</span>&#123;num&#125; re-renders of the &#123;pageText&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">render</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;TabBarIOS</div><div class="line">        tintColor="#ee735c"&gt;</div><div class="line">        &lt;TabBarIOS.Item</div><div class="line">          title="视频"</div><div class="line">          icon=&#123;&#123;uri: base64Icon, scale: 3&#125;&#125;</div><div class="line">          selected=&#123;this.state.selectedTab === 'blueTab'&#125;</div><div class="line">          onPress=&#123;() =&gt; &#123;</div><div class="line">            this.setState(&#123;</div><div class="line">              selectedTab: 'blueTab',</div><div class="line">            &#125;);</div><div class="line">          &#125;&#125;&gt;</div><div class="line">          &#123;this._renderContent('#414A8C', 'Blue Tab')&#125;</div><div class="line">        &lt;/TabBarIOS.Item&gt;</div><div class="line">        &lt;TabBarIOS.Item</div><div class="line">          systemIcon="history"</div><div class="line">          badge=&#123;this.state.notifCount &gt; 0 ? this.state.notifCount : undefined&#125;</div><div class="line">          selected=&#123;this.state.selectedTab === 'redTab'&#125;</div><div class="line">          onPress=&#123;() =&gt; &#123;</div><div class="line">            this.setState(&#123;</div><div class="line">              selectedTab: 'redTab',</div><div class="line">              notifCount: this.state.notifCount + 1,</div><div class="line">            &#125;);</div><div class="line">          &#125;&#125;&gt;</div><div class="line">          &#123;this._renderContent('#783E33', 'Red Tab', this.state.notifCount)&#125;</div><div class="line">        &lt;/TabBarIOS.Item&gt;</div><div class="line">        &lt;TabBarIOS.Item</div><div class="line">          icon=&#123;require('./flux.png')&#125;</div><div class="line">          title="More"</div><div class="line">          selected=&#123;this.state.selectedTab === 'greenTab'&#125;</div><div class="line">          onPress=&#123;() =&gt; &#123;</div><div class="line">            this.setState(&#123;</div><div class="line">              selectedTab: 'greenTab',</div><div class="line">              presses: this.state.presses + 1</div><div class="line">            &#125;);</div><div class="line">          &#125;&#125;&gt;</div><div class="line">          &#123;this._renderContent('#21551C', 'Green Tab', this.state.presses)&#125;</div><div class="line">        &lt;/TabBarIOS.Item&gt;</div><div class="line">      &lt;/TabBarIOS&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>同时在项目根目录添加一个flux.png图片，因为上面的代码引用到了，添加他只是为了能够将项目跑起来，后面会替换掉他，现在运行就能看的效果了。</p>
<h2 id="替换Tab图标"><a href="#替换Tab图标" class="headerlink" title="替换Tab图标"></a>替换Tab图标</h2><p>我们这里使用一个react-native-vector-icons库，它自带了很多的图标，安装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i react-native-vector-icons@<span class="number">2.0</span><span class="number">.2</span>  --save</div></pre></td></tr></table></figure>
<p>直接安装完还是不能直接使用的，作用就是将一些库连接到工程，包括字体和图标。这里使用rnpm</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">npm i rnpm@<span class="number">1.7</span><span class="number">.0</span> -g</div><div class="line"></div><div class="line"><span class="comment">//连接</span></div><div class="line">rnpm link react-native-vector-icons</div></pre></td></tr></table></figure>
<p>现在就可以来到<a href="http://ionicons.com选择喜欢的图标了，选择后单击图标就可以得到名称。然后在代码中引入" target="_blank" rel="external">http://ionicons.com选择喜欢的图标了，选择后单击图标就可以得到名称。然后在代码中引入</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Icon = <span class="built_in">require</span>(<span class="string">'react-native-vector-icons/Ionicons'</span>)</div><div class="line"></div><div class="line"><span class="comment">//将自带的tab替换为Icon.TabBarItem，他是react-native-vector-icons提供的，能更好的配合这个图标</span></div><div class="line">&lt;Icon.TabBarItem</div><div class="line">  title=<span class="string">"Blue Tab"</span></div><div class="line">  iconName=<span class="string">'ios-videocam-outline'</span></div><div class="line">  selectedIconName=<span class="string">'ios-videocam'</span></div><div class="line">  selected=&#123;<span class="keyword">this</span>.state.selectedTab === <span class="string">'blueTab'</span>&#125;</div><div class="line">  onPress=&#123;() =&gt; &#123;</div><div class="line">    <span class="keyword">this</span>.setState(&#123;</div><div class="line">      <span class="attr">selectedTab</span>: <span class="string">'blueTab'</span>,</div><div class="line">    &#125;);</div><div class="line">  &#125;&#125;&gt;</div><div class="line">  &#123;<span class="keyword">this</span>._renderContent(<span class="string">'#414A8C'</span>, <span class="string">'Blue Tab'</span>)&#125;</div><div class="line">&lt;<span class="regexp">/Icon.TabBarItem&gt;</span></div></pre></td></tr></table></figure>
<p>特别注意icon变成了iconName，selected变为了selectedIconName，完整的tab代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> say = React.createClass( &#123;</div><div class="line">  <span class="attr">getInitialState</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">selectedTab</span>: <span class="string">'videoTab'</span></div><div class="line">    &#125;;</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">_renderContent</span>: <span class="function"><span class="keyword">function</span>(<span class="params">color: string, pageText: string, num?: number</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;[styles.tabContent,</span> &#123;<span class="attr">backgroundColor:</span> <span class="attr">color</span>&#125;]&#125;&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.tabText&#125;</span>&gt;</span>&#123;pageText&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.tabText&#125;</span>&gt;</span>&#123;num&#125; re-renders of the &#123;pageText&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">render</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      &lt;TabBarIOS</div><div class="line">        tintColor="#ee735c"&gt;</div><div class="line">        &lt;Icon.TabBarItem</div><div class="line">          title="视频"</div><div class="line">          iconName='ios-videocam-outline'</div><div class="line">          selectedIconName='ios-videocam'</div><div class="line">          selected=&#123;this.state.selectedTab === 'videoTab'&#125;</div><div class="line">          onPress=&#123;() =&gt; &#123;</div><div class="line">            this.setState(&#123;</div><div class="line">              selectedTab: 'videoTab',</div><div class="line">            &#125;);</div><div class="line">          &#125;&#125;&gt;</div><div class="line">          &#123;this._renderContent('#414A8C', 'Blue Tab')&#125;</div><div class="line">        &lt;/Icon.TabBarItem&gt;</div><div class="line">        &lt;Icon.TabBarItem</div><div class="line">          title="录制"</div><div class="line">          iconName='ios-recording-outline'</div><div class="line">          selectedIconName='ios-recording'</div><div class="line">          selected=&#123;this.state.selectedTab === 'recordTab'&#125;</div><div class="line">          onPress=&#123;() =&gt; &#123;</div><div class="line">            this.setState(&#123;</div><div class="line">              selectedTab: 'recordTab'</div><div class="line">            &#125;);</div><div class="line">          &#125;&#125;&gt;</div><div class="line">          &#123;this._renderContent('#783E33', 'Red Tab', this.state.notifCount)&#125;</div><div class="line">        &lt;/Icon.TabBarItem&gt;</div><div class="line">        &lt;Icon.TabBarItem</div><div class="line">          title="更多"</div><div class="line">          iconName='ios-more-outline'</div><div class="line">          selectedIconName='ios-more'</div><div class="line">          selected=&#123;this.state.selectedTab === 'moreTab'&#125;</div><div class="line">          onPress=&#123;() =&gt; &#123;</div><div class="line">            this.setState(&#123;</div><div class="line">              selectedTab: 'moreTab'</div><div class="line">            &#125;);</div><div class="line">          &#125;&#125;&gt;</div><div class="line">          &#123;this._renderContent('#21551C', 'Green Tab', this.state.presses)&#125;</div><div class="line">        &lt;/Icon.TabBarItem&gt;</div><div class="line">      &lt;/TabBarIOS&gt;</div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="写tab对应的页面"><a href="#写tab对应的页面" class="headerlink" title="写tab对应的页面"></a>写tab对应的页面</h2><p>接下来我们需要将内容更换为三个子组件，分别对应三个tab页面。</p>
<p>首先先写三个组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> List=React.createClass(&#123;</div><div class="line">  <span class="attr">render</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span>&gt;</span>视频列表<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> Edit=React.createClass(&#123;</div><div class="line">  <span class="attr">render</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span>&gt;</span>制作页面<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> Account=React.createClass(&#123;</div><div class="line">  <span class="attr">render</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span>&gt;</span>账户页面<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>然后在tab中分别加入三个组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;Icon.TabBarItem</div><div class="line">  title=<span class="string">"视频"</span></div><div class="line">  iconName=<span class="string">'ios-videocam-outline'</span></div><div class="line">  selectedIconName=<span class="string">'ios-videocam'</span></div><div class="line">  selected=&#123;<span class="keyword">this</span>.state.selectedTab === <span class="string">'list'</span>&#125;</div><div class="line">  onPress=&#123;() =&gt; &#123;</div><div class="line">    <span class="keyword">this</span>.setState(&#123;</div><div class="line">      <span class="attr">selectedTab</span>: <span class="string">'list'</span>,</div><div class="line">    &#125;);</div><div class="line">  &#125;&#125;&gt;</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">List</span>/&gt;</span></span> <span class="comment">//在这里我们替换成了上面定义的组件</span></div><div class="line">&lt;<span class="regexp">/Icon.TabBarItem&gt;</span></div></pre></td></tr></table></figure>
<h3 id="将组件拿到对应的目录下"><a href="#将组件拿到对应的目录下" class="headerlink" title="将组件拿到对应的目录下"></a>将组件拿到对应的目录下</h3><p>上面的组件还是放到一个文件中的，导致的问题是，多个页面逻辑都混到一个页面了，修改和删除代码都不是很方法，所以采用的方法时将每个组件都放到相应的目录，然后在入口文件导入他。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> React = <span class="built_in">require</span>(<span class="string">'react-native'</span>)</div><div class="line"><span class="keyword">var</span> &#123;</div><div class="line">  StyleSheet,</div><div class="line">  Text,</div><div class="line">  View,</div><div class="line">&#125; = React;</div><div class="line"></div><div class="line"><span class="keyword">var</span> Icon = <span class="built_in">require</span>(<span class="string">'react-native-vector-icons/Ionicons'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> List=React.createClass(&#123;</div><div class="line">  <span class="attr">render</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span>&gt;</span>视频列表<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> styles = StyleSheet.create(&#123;</div><div class="line">  <span class="attr">container</span>: &#123;</div><div class="line">    <span class="attr">flex</span>: <span class="number">1</span>,</div><div class="line">    <span class="attr">justifyContent</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">alignItems</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">backgroundColor</span>: <span class="string">'#F5FCFF'</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">welcome</span>: &#123;</div><div class="line">    <span class="attr">fontSize</span>: <span class="number">20</span>,</div><div class="line">    <span class="attr">textAlign</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">margin</span>: <span class="number">10</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">instructions</span>: &#123;</div><div class="line">    <span class="attr">textAlign</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">color</span>: <span class="string">'#333333'</span>,</div><div class="line">    <span class="attr">marginBottom</span>: <span class="number">5</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports=List</div></pre></td></tr></table></figure>
<p>在入口文件中导入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//自定义模块</span></div><div class="line"><span class="keyword">var</span> List=<span class="built_in">require</span>(<span class="string">'./app/list/index'</span>)</div><div class="line"><span class="keyword">var</span> Edit=<span class="built_in">require</span>(<span class="string">'./app/edit/index'</span>)</div><div class="line"><span class="keyword">var</span> Account=<span class="built_in">require</span>(<span class="string">'./app/account/index'</span>)</div></pre></td></tr></table></figure>
<h2 id="创建模拟数据"><a href="#创建模拟数据" class="headerlink" title="创建模拟数据"></a>创建模拟数据</h2><p>我们这里使用rap和mockjs。</p>
<p>先去rap官网创建一个项目。<a href="http://rap.taobao.org/org/index.do，配置完生成规则后，可以使用下面地址获取规则或真实数据" target="_blank" rel="external">http://rap.taobao.org/org/index.do，配置完生成规则后，可以使用下面地址获取规则或真实数据</a></p>
<p><a href="http://rap.taobao.org/mockjsdata/11015/api/video?accessToken=111" target="_blank" rel="external">http://rap.taobao.org/mockjsdata/11015/api/video?accessToken=111</a></p>
<p><a href="http://rap.taobao.org/mockjs/11015/api/video?accessToken=111" target="_blank" rel="external">http://rap.taobao.org/mockjs/11015/api/video?accessToken=111</a></p>
<p>如果是规则，则需要使用mockjs解析，官网为：<a href="http://mockjs.com/" target="_blank" rel="external">http://mockjs.com/</a></p>
<p>你可以在控制台下输入Mock.mock(mock规则数据试试)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Mock.mock(&#123;<span class="string">"data|10"</span>:[&#123;<span class="string">"_id"</span>:<span class="string">"@ID"</span>,<span class="string">"video"</span>:<span class="string">"http:\/\/v2.mukewang.com\/cef3e514-8203-4c67-877f-79f7763553cf\/L.mp4?auth_key=1480760293-0-0-a693983f9d989e19a2c1c19f52d1e169"</span>,<span class="string">"thumb"</span>:<span class="string">"@IMG(1200x600,@color())"</span>&#125;],<span class="string">"success"</span>:<span class="literal">true</span>&#125;)</div><div class="line"></div><div class="line"><span class="comment">//会输出10条测试数据</span></div></pre></td></tr></table></figure>
<p>我们也可以直接在该页面的控制台下输入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> d = Mock.mock(&#123;<span class="string">"data|10"</span>:[&#123;<span class="string">"_id"</span>:<span class="string">"@ID"</span>,<span class="string">"video"</span>:<span class="string">"http:\/\/v2.mukewang.com\/cef3e514-8203-4c67-877f-79f7763553cf\/L.mp4?auth_key=1480760293-0-0-a693983f9d989e19a2c1c19f52d1e169"</span>,<span class="string">"thumb"</span>:<span class="string">"@IMG(1200x600,@color())"</span>&#125;],<span class="string">"success"</span>:<span class="literal">true</span>&#125;);d.data.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;$(<span class="string">"#examples"</span>).append(<span class="string">'&lt;h3&gt;'</span>+item._id+<span class="string">'&lt;/h3&gt;&lt;img src="'</span>+item.thumb+<span class="string">'"/&gt;'</span>)&#125;)</div></pre></td></tr></table></figure>
<p>就可以看到该页面最后又很多的图片和id数组。</p>
<h2 id="视频页面"><a href="#视频页面" class="headerlink" title="视频页面"></a>视频页面</h2><h3 id="添加视频页面标题"><a href="#添加视频页面标题" class="headerlink" title="添加视频页面标题"></a>添加视频页面标题</h3><p>在List下面的index.js文件中添加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;View style=&#123;styles.container&#125;&gt;</div><div class="line">	<span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.header&#125;</span>&gt;</span></span></div><div class="line">    	<span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.headerTitle&#125;</span>&gt;</span>列表页面<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">&lt;<span class="regexp">/View&gt;</span></div></pre></td></tr></table></figure>
<p>然后修改样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> styles = StyleSheet.create(&#123;</div><div class="line">  <span class="attr">container</span>: &#123;</div><div class="line">    <span class="attr">flex</span>: <span class="number">1</span>, </div><div class="line">    <span class="attr">backgroundColor</span>: <span class="string">'#F5FCFF'</span>,</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">header</span>:&#123;</div><div class="line">    <span class="attr">paddingTop</span>:<span class="number">25</span>,</div><div class="line">    <span class="attr">paddingBottom</span>:<span class="number">12</span>,</div><div class="line">    <span class="attr">backgroundColor</span>:<span class="string">'#ee735c'</span></div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">headerTitle</span>:&#123;</div><div class="line">    <span class="attr">color</span>:<span class="string">'white'</span>,</div><div class="line">    <span class="attr">fontSize</span>:<span class="number">16</span>,</div><div class="line">    <span class="attr">textAlign</span>:<span class="string">'center'</span>,</div><div class="line">    <span class="attr">fontWeight</span>:<span class="string">'600'</span></div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="添加视频列表"><a href="#添加视频列表" class="headerlink" title="添加视频列表"></a>添加视频列表</h3><p>添加一个ListView，首先要导出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;ListView</div><div class="line">  dataSource=&#123;<span class="keyword">this</span>.state.dataSource&#125;</div><div class="line">  renderRow=&#123;<span class="keyword">this</span>.renderRow&#125;</div><div class="line">  enableEmptySections=&#123;<span class="literal">true</span>&#125;</div><div class="line">/&gt;</div></pre></td></tr></table></figure>
<p>在定义一个renderRow方法，用来渲染每一个条目，相当于Android中Adapter的getView</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">renderRow(row)&#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>完整代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> List=React.createClass(&#123;</div><div class="line"></div><div class="line">  <span class="attr">getInitialState</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> ds = <span class="keyword">new</span> ListView.DataSource(&#123;<span class="attr">rowHasChanged</span>: <span class="function">(<span class="params">r1, r2</span>) =&gt;</span> r1 !== r2&#125;);</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">dataSource</span>: ds.cloneWithRows([]),</div><div class="line">    &#125;;</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  renderRow(row)&#123;</div><div class="line"></div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  <span class="attr">render</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">      	<span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.header&#125;</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.headerTitle&#125;</span>&gt;</span>列表页面<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      	<span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">ListView</span></span></div><div class="line">          <span class="attr">dataSource</span>=<span class="string">&#123;this.state.dataSource&#125;</span></div><div class="line">          <span class="attr">renderRow</span>=<span class="string">&#123;this.renderRow&#125;</span></div><div class="line">          <span class="attr">enableEmptySections</span>=<span class="string">&#123;true&#125;</span></div><div class="line">        /&gt;</div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>我们实现了一下renderRow方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">renderRow(row)&#123;</div><div class="line">	<span class="keyword">return</span>(</div><div class="line">	  &lt;TouchableHighlight&gt;</div><div class="line">	    &lt;View style=&#123;styles.item&#125;&gt;</div><div class="line">	      &#123;/* 标题 */&#125;</div><div class="line">	      &lt;Text style=&#123;styles.title&#125;&gt;&#123;row.title&#125;&lt;/Text&gt;</div><div class="line">	      </div><div class="line">	      &#123;/* 图片 */&#125;</div><div class="line">	      &lt;Image</div><div class="line">	        source=&#123;&#123;uri:row.thumb&#125;&#125;</div><div class="line">	        style=&#123;styles.thumb&#125;</div><div class="line">	      &gt;</div><div class="line">	        &lt;Icon</div><div class="line">	          name='ios-play'</div><div class="line">	          size=&#123;28&#125;</div><div class="line">	          style=&#123;styles.play&#125; /&gt;</div><div class="line">	      &lt;/Image&gt;  </div><div class="line"></div><div class="line">	      &#123;/* 底部按钮 */&#125;</div><div class="line">	      &lt;View style=&#123;styles.itemFooterContainer&#125;&gt;</div><div class="line">	        &lt;View style=&#123;styles.handleBox&#125;&gt;</div><div class="line">	          &lt;Icon </div><div class="line">	            name='ios-heart-outline'</div><div class="line">	            size=&#123;28&#125;</div><div class="line">	            style=&#123;styles.up&#125;  /&gt;</div><div class="line">	          &lt;Text style=&#123;styles.handleText&#125;&gt;喜欢&lt;/Text&gt;</div><div class="line">	        &lt;/View&gt;</div><div class="line">	        &lt;View style=&#123;styles.handleBox&#125;&gt;</div><div class="line">	          &lt;Icon </div><div class="line">	            name='ios-chatboxes-outline'</div><div class="line">	            size=&#123;28&#125;</div><div class="line">	            style=&#123;styles.commonIcon&#125;  /&gt;</div><div class="line">	          &lt;Text style=&#123;styles.handleText&#125;&gt;评论&lt;/Text&gt;</div><div class="line">	        &lt;/View&gt;</div><div class="line">	      &lt;/View&gt;</div><div class="line">	    &lt;/View&gt;</div><div class="line">	  &lt;/TouchableHighlight&gt;</div><div class="line">	)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在定义一些样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">item:&#123;</div><div class="line">    <span class="attr">width</span>:width,</div><div class="line">    <span class="attr">marginBottom</span>:<span class="number">10</span>,</div><div class="line">    <span class="attr">backgroundColor</span>:<span class="string">'#fff'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">thumb</span>:&#123;</div><div class="line">    <span class="attr">width</span>:width,</div><div class="line">    <span class="attr">height</span>:width*<span class="number">0.56</span>,</div><div class="line">    <span class="attr">resizeMode</span>:<span class="string">'cover'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">title</span>:&#123;</div><div class="line">    <span class="attr">padding</span>:<span class="number">10</span>,</div><div class="line">    <span class="attr">fontSize</span>:<span class="number">18</span>,</div><div class="line">    <span class="attr">color</span>:<span class="string">'#333'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">itemFooterContainer</span>:&#123;</div><div class="line">    <span class="attr">flexDirection</span>:<span class="string">'row'</span>,</div><div class="line">    <span class="attr">justifyContent</span>:<span class="string">'space-between'</span>,</div><div class="line">    <span class="attr">backgroundColor</span>:<span class="string">'#eee'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">handleBox</span>:&#123;</div><div class="line">    <span class="attr">padding</span>:<span class="number">10</span>,</div><div class="line">    <span class="attr">flexDirection</span>:<span class="string">'row'</span>,</div><div class="line">    <span class="attr">width</span>:width/<span class="number">2</span><span class="number">-0.5</span>,</div><div class="line">    <span class="attr">justifyContent</span>:<span class="string">'center'</span>,</div><div class="line">    <span class="attr">backgroundColor</span>:<span class="string">'#fff'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">play</span>:&#123;</div><div class="line">    <span class="attr">position</span>:<span class="string">'absolute'</span>,</div><div class="line">    <span class="attr">bottom</span>:<span class="number">14</span>,</div><div class="line">    <span class="attr">right</span>:<span class="number">14</span>,</div><div class="line">    <span class="attr">width</span>:<span class="number">46</span>,</div><div class="line">    <span class="attr">height</span>:<span class="number">46</span>,</div><div class="line">    <span class="attr">paddingTop</span>:<span class="number">9</span>,</div><div class="line">    <span class="attr">paddingLeft</span>:<span class="number">18</span>,</div><div class="line">    <span class="attr">backgroundColor</span>:<span class="string">'transparent'</span>,</div><div class="line">    <span class="attr">borderColor</span>:<span class="string">'#fff'</span>,</div><div class="line">    <span class="attr">borderWidth</span>:<span class="number">1</span>,</div><div class="line">    <span class="attr">borderRadius</span>:<span class="number">23</span>,</div><div class="line">    <span class="attr">color</span>:<span class="string">'#ed7b66'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">handleText</span>:&#123;</div><div class="line">    <span class="attr">paddingLeft</span>:<span class="number">12</span>,</div><div class="line">    <span class="attr">fontSize</span>:<span class="number">18</span>,</div><div class="line">    <span class="attr">color</span>:<span class="string">'#333'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">up</span>:&#123;</div><div class="line">    <span class="attr">fontSize</span>:<span class="number">22</span>,</div><div class="line">    <span class="attr">color</span>:<span class="string">'#333'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">commonIcon</span>:&#123;</div><div class="line">    <span class="attr">fontSize</span>:<span class="number">22</span>,</div><div class="line">    <span class="attr">color</span>:<span class="string">'#333'</span></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>样式中我们使用了屏幕的宽度，可以通过</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//导入Dimensions</span></div><div class="line"></div><div class="line"><span class="comment">// 当前屏幕宽度</span></div><div class="line"><span class="keyword">var</span> width=Dimensions.get(<span class="string">'window'</span>).width</div></pre></td></tr></table></figure>
<p>然后初始化一些假数据，然列表能显示出来</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">getInitialState: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> ds = <span class="keyword">new</span> ListView.DataSource(&#123;<span class="attr">rowHasChanged</span>: <span class="function">(<span class="params">r1, r2</span>) =&gt;</span> r1 !== r2&#125;);</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">	  <span class="attr">dataSource</span>: ds.cloneWithRows([</div><div class="line">	        &#123;</div><div class="line">	            <span class="string">"_id"</span>:<span class="string">"350000197307022063"</span>,<span class="string">"thumb"</span>:<span class="string">"http://dummyimage.com/1280x720/e5488e"</span>,<span class="string">"title"</span>:<span class="string">"测试内容95hw"</span>,<span class="string">"video"</span>:<span class="string">"http://v2.mukewang.com/cef3e514-8203-4c67-877f-79f7763553cf/L.mp4?auth_key=1480760293-0-0-a693983f9d989e19a2c1c19f52d1e169"</span></div><div class="line">	        &#125;</div><div class="line">	        ,</div><div class="line">	        &#123;</div><div class="line">	            <span class="string">"_id"</span>:<span class="string">"330000201112047039"</span>,<span class="string">"thumb"</span>:<span class="string">"http://dummyimage.com/1280x720/91d5da"</span>,<span class="string">"title"</span>:<span class="string">"测试内容95hw"</span>,<span class="string">"video"</span>:<span class="string">"http://v2.mukewang.com/cef3e514-8203-4c67-877f-79f7763553cf/L.mp4?auth_key=1480760293-0-0-a693983f9d989e19a2c1c19f52d1e169"</span></div><div class="line">	        &#125;</div><div class="line">	  ]),</div><div class="line">	&#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="获取网络数据"><a href="#获取网络数据" class="headerlink" title="获取网络数据"></a>获取网络数据</h2><p>Fetch,WebSocket,XMLHttpRequest</p>
<p>官方网络文档：<a href="http://facebook.github.io/react-native/releases/0.22/docs/network.html#content" target="_blank" rel="external">http://facebook.github.io/react-native/releases/0.22/docs/network.html#content</a></p>
<p>我们这里使用fetch</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">componentDidMount()&#123;</div><div class="line">	<span class="keyword">this</span>._fetchData()</div><div class="line">&#125;,</div><div class="line"></div><div class="line">_fetchData()&#123;</div><div class="line">	fetch(<span class="string">'http://rap.taobao.org/mockjs/11015/api/video'</span>)</div><div class="line">	  .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</div><div class="line">	  .then(<span class="function">(<span class="params">responseText</span>) =&gt;</span> &#123;</div><div class="line">	    <span class="built_in">console</span>.log(responseText);</div><div class="line">	  &#125;)</div><div class="line">	  .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">	    <span class="built_in">console</span>.warn(error);</div><div class="line">	  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但是现在还是获取的mock规则，我们需要借助mockjs生成真是的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i mockjs --save</div></pre></td></tr></table></figure>
<p>然后将生成的规则使用Mock解析，就可以得到真是数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> data=Mock.mock(response)</div></pre></td></tr></table></figure>
<blockquote>
<p>注意：这里有个小插曲就是要删除mock.js中的dataImage方法，我们用不到canvas，所以要删掉他。</p>
</blockquote>
<p>获取完网络数据后还需要判断是否请求成功，然后将数据替换到datasource中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">_fetchData()&#123;</div><div class="line">fetch(<span class="string">'http://rap.taobao.org/mockjs/11015/api/video'</span>)</div><div class="line">  .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</div><div class="line">  .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">var</span> data=Mock.mock(response)</div><div class="line">    <span class="built_in">console</span>.log(data)</div><div class="line">    <span class="keyword">if</span> (data.success) &#123;</div><div class="line">      <span class="keyword">this</span>.setState(&#123;</div><div class="line">        <span class="attr">dataSource</span>:<span class="keyword">this</span>.state.dataSource.cloneWithRows(data.data)</div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">  .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">    <span class="built_in">console</span>.warn(error);</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="重构网络模块"><a href="#重构网络模块" class="headerlink" title="重构网络模块"></a>重构网络模块</h3><p>这样写不好是因为几乎我们每个页面都要用到网络请求，通常的情况下是将网络请求封装成一个类，所以这里我们将网络请求封装到request.js中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> queryString=<span class="built_in">require</span>(<span class="string">'query-string'</span>)</div><div class="line"><span class="keyword">var</span> _=<span class="built_in">require</span>(<span class="string">'lodash'</span>)</div><div class="line"><span class="keyword">var</span> config=<span class="built_in">require</span>(<span class="string">'./config'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> Mock=<span class="built_in">require</span>(<span class="string">'mockjs'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> request=&#123;&#125;</div><div class="line"></div><div class="line"></div><div class="line">request.get=<span class="function"><span class="keyword">function</span> (<span class="params">url,params</span>) </span>&#123;</div><div class="line"><span class="keyword">if</span> (params) &#123;</div><div class="line">	url+=<span class="string">'?'</span>+queryString.stringify(params)</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> fetch(url)</div><div class="line">		.then(<span class="function">(<span class="params">response</span>)=&gt;</span>response.json())</div><div class="line">		.then(<span class="function">(<span class="params">response</span>)=&gt;</span>Mock.mock(response))</div><div class="line">&#125;</div><div class="line"></div><div class="line">request.post=<span class="function"><span class="keyword">function</span> (<span class="params">url,body</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> options = _.extend(config.header,&#123;</div><div class="line">		<span class="attr">body</span>:<span class="built_in">JSON</span>.stringify(body)</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	<span class="keyword">return</span> fetch(url,options)</div><div class="line">			.then(<span class="function">(<span class="params">response</span>)=&gt;</span>response.json())</div><div class="line">			.then(<span class="function">(<span class="params">response</span>)=&gt;</span>Mock.mock(response))</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports=request</div></pre></td></tr></table></figure>
<p>我暴露了get,post方法，其中config是一个配置文件，包括网络的根请求地址和一些接口地址</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports=&#123;</div><div class="line">	<span class="attr">header</span>: &#123;</div><div class="line">	  <span class="attr">method</span>: <span class="string">'POST'</span>,</div><div class="line">	  <span class="attr">headers</span>: &#123;</div><div class="line">	    <span class="string">'Accept'</span>: <span class="string">'application/json'</span>,</div><div class="line">	    <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</div><div class="line">	  &#125;</div><div class="line">	&#125;,</div><div class="line">	<span class="attr">api</span>:&#123;</div><div class="line">		<span class="attr">base</span>:<span class="string">'http://rap.taobao.org/mockjs/11015/'</span>,</div><div class="line">		<span class="comment">// base:'http://rap.taobao.org/mockjsdata/11015/',</span></div><div class="line">		videoList:<span class="string">'api/video'</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中我们用到了query-string，lodash需要手动安装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm i query-string --save</div><div class="line">npm i lodash --save</div></pre></td></tr></table></figure>
<p>这样我们首页的请求就可以改写为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">_fetchData()&#123;</div><div class="line">  request.get(config.api.base+config.api.videoList,&#123;</div><div class="line">    <span class="attr">accessToken</span>:<span class="string">'abbbb'</span></div><div class="line">  &#125;)</div><div class="line">    .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</div><div class="line">      <span class="built_in">console</span>.log(data)</div><div class="line">      <span class="keyword">if</span> (data.success) &#123;</div><div class="line">        <span class="keyword">this</span>.setState(&#123;</div><div class="line">          <span class="attr">dataSource</span>:<span class="keyword">this</span>.state.dataSource.cloneWithRows(data.data)</div><div class="line">        &#125;)</div><div class="line">      &#125;</div><div class="line">    &#125;)</div><div class="line">    .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">      <span class="built_in">console</span>.warn(error);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样就方便快捷多了,<a href="https://git.oschina.net/lfsoft/ReactDog/commit/dd5f859537c13fdceeaec245d077e70221ea743f" target="_blank" rel="external">代码变更地址为</a></p>
<h2 id="上拉加载更多"><a href="#上拉加载更多" class="headerlink" title="上拉加载更多"></a>上拉加载更多</h2><p>我们要在listview中添加一个onEndReached方法监测是否滑到了底部</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">onEndReached=&#123;<span class="keyword">this</span>._fetchMoreData&#125;</div></pre></td></tr></table></figure>
<p>然后实现_fetchMoreData方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">_fetchMoreData()&#123;</div><div class="line">	<span class="keyword">if</span> (!<span class="keyword">this</span>._hasMore() || <span class="keyword">this</span>.state.isLoading) &#123;</div><div class="line">	  <span class="comment">//如果没有更多数据了，或者正在加载中，直接返回</span></div><div class="line">	  <span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">var</span> page = cacheReuslts.nextPage</div><div class="line"></div><div class="line">	<span class="keyword">this</span>._fetchData(page)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当然回来的数据还是得和原来的数据追加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">_fetchData(page)&#123;</div><div class="line">	<span class="keyword">var</span> that = <span class="keyword">this</span></div><div class="line"></div><div class="line">	<span class="keyword">this</span>.setState(&#123;</div><div class="line">	  <span class="attr">isLoading</span>:<span class="literal">true</span></div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	request.get(config.api.base+config.api.videoList,&#123;</div><div class="line">	  <span class="attr">accessToken</span>:<span class="string">'abbbb'</span>,</div><div class="line">	  <span class="attr">page</span>:page</div><div class="line">	&#125;)</div><div class="line">	  .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</div><div class="line">	    <span class="built_in">console</span>.log(data)</div><div class="line">	    <span class="keyword">if</span> (data.success) &#123;</div><div class="line"></div><div class="line">	      <span class="keyword">var</span> items = cacheReuslts.items.slice()</div><div class="line"></div><div class="line">	      items=items.concat(data.data)</div><div class="line"></div><div class="line">	      cacheReuslts.items=items</div><div class="line">	      cacheReuslts.total=data.total</div><div class="line"></div><div class="line">	      <span class="built_in">console</span>.log(cacheReuslts.items.length)</div><div class="line"></div><div class="line">	      <span class="comment">//这里是为了有显示loading</span></div><div class="line">	      setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	        that.setState(&#123;</div><div class="line">	          <span class="attr">isLoading</span>:<span class="literal">false</span>,</div><div class="line">	          <span class="attr">dataSource</span>:that.state.dataSource.cloneWithRows(cacheReuslts.items)</div><div class="line">	        &#125;)</div><div class="line">	      &#125;,<span class="number">2000</span>)</div><div class="line"></div><div class="line">	      </div><div class="line">	    &#125;</div><div class="line">	  &#125;)</div><div class="line">	  .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</div><div class="line">	    <span class="keyword">this</span>.setState(&#123;</div><div class="line">	        <span class="attr">isLoading</span>:<span class="literal">false</span></div><div class="line">	      &#125;)</div><div class="line">	    <span class="built_in">console</span>.warn(error);</div><div class="line">	  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="下拉刷新"><a href="#下拉刷新" class="headerlink" title="下拉刷新"></a>下拉刷新</h2><p>使用refreshControl</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">refreshControl=&#123;</div><div class="line">	&lt;RefreshControl</div><div class="line">	  refreshing=&#123;<span class="keyword">this</span>.state.isRefreshing&#125;</div><div class="line">	  onRefresh=&#123;<span class="keyword">this</span>._onRefresh&#125;</div><div class="line">	  tintColor=<span class="string">"#ff6600"</span></div><div class="line">	  title=<span class="string">"拼命加载中..."</span></div><div class="line">	  colors=&#123;[<span class="string">'#ff0000'</span>, <span class="string">'#00ff00'</span>, <span class="string">'#0000ff'</span>]&#125;</div><div class="line">	  progressBackgroundColor=<span class="string">"#ffff00"</span> /&gt;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后实现_onRefresh方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">_onRefresh()&#123;</div><div class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>.state.isRefreshing) &#123;</div><div class="line">	  <span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">this</span>._fetchData(<span class="number">0</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同时还得在fetchData方法里面通过判断page是否等于0来更改是刷新还是加载更多。</p>
<h2 id="列表页点赞"><a href="#列表页点赞" class="headerlink" title="列表页点赞"></a>列表页点赞</h2><p>这个功能分两部分，第一部分是在View中根据是否点赞显示不同的图标</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;View style=&#123;styles.handleBox&#125;&gt;</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Icon</span> </span></span></div><div class="line">    <span class="attr">name</span>=<span class="string">&#123;this.state.up</span> ? '<span class="attr">ios-heart</span>' <span class="attr">:</span> '<span class="attr">ios-heart-outline</span>'&#125;</div><div class="line">    <span class="attr">size</span>=<span class="string">&#123;28&#125;</span></div><div class="line">    <span class="attr">onPress</span>=<span class="string">&#123;this._up&#125;</span></div><div class="line">    <span class="attr">style</span>=<span class="string">&#123;[styles.up</span> ,<span class="attr">this.state.up</span> ? <span class="attr">null</span> <span class="attr">:</span> <span class="attr">styles.down</span> ]&#125;  /&gt;</div><div class="line">  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.handleText&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this._up&#125;</span>&gt;</span>喜欢<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">View</span>&gt;</span></div></pre></td></tr></table></figure>
<p>第二部分是当点击了按钮，发送点赞请求</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">_up()&#123;</div><div class="line">	<span class="keyword">var</span> that=<span class="keyword">this</span></div><div class="line"></div><div class="line">	<span class="keyword">var</span> up = !<span class="keyword">this</span>.state.up</div><div class="line">	<span class="keyword">var</span> row=<span class="keyword">this</span>.state.row</div><div class="line">	<span class="keyword">var</span> url=config.api.base+config.api.up</div><div class="line"></div><div class="line">	<span class="keyword">var</span> body=&#123;</div><div class="line">	  <span class="attr">id</span>:row._id,</div><div class="line">	  <span class="attr">up</span>:up,</div><div class="line">	  <span class="attr">accessToken</span>:<span class="string">'ab'</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'up'</span>)</div><div class="line"></div><div class="line">	request.post(url,body)</div><div class="line">	.then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">	  <span class="keyword">if</span> (data &amp;&amp; data.success) &#123;</div><div class="line">	    that.setState(&#123;</div><div class="line">	      <span class="attr">up</span>:up</div><div class="line">	    &#125;)</div><div class="line">	  &#125; <span class="keyword">else</span>&#123;</div><div class="line">	    AlertIOS.alert(<span class="string">'点赞失败，请稍后重试'</span>)</div><div class="line">	  &#125;</div><div class="line">	&#125;)</div><div class="line">	.catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">	  <span class="built_in">console</span>.log(err)</div><div class="line">	  AlertIOS.alert(<span class="string">'点赞失败，请稍后重试'</span>)</div><div class="line">	&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>请求回来了我们还得判断是否响应成功，然后改变状态，让界面刷新</p>
<h2 id="添加进入视频详情页面"><a href="#添加进入视频详情页面" class="headerlink" title="添加进入视频详情页面"></a>添加进入视频详情页面</h2><p>在这之前我们先要使用导航器包装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;Navigator</div><div class="line">	initialRoute=&#123;&#123;</div><div class="line">	  <span class="attr">name</span>:<span class="string">'list'</span>,</div><div class="line">	  <span class="attr">component</span>:List</div><div class="line">	&#125;&#125;</div><div class="line">	configureScene=&#123;(route)=&gt;&#123;</div><div class="line">	  <span class="keyword">return</span> Navigator.SceneConfigs.FloatFromRight</div><div class="line">	&#125;&#125;</div><div class="line">	renderScene=&#123;(route,navigator)=&gt;&#123;</div><div class="line">	  <span class="keyword">var</span> Component=route.component</div><div class="line">	  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...route.params</span>&#125; <span class="attr">navigator</span>=<span class="string">&#123;navigator&#125;</span> /&gt;</span></span></div><div class="line">	&#125;&#125; /&gt;</div></pre></td></tr></table></figure>
<p>这样我们就可以在List组件里面通过navigator属性拿到外面的Navigator实例，从而进入一个页面。</p>
<p>然后在TouchableHighlight控件上添加一个onPress方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">_loadDetailPage(row)&#123;</div><div class="line">	<span class="keyword">this</span>.props.navigator.push(&#123;</div><div class="line">	  <span class="attr">name</span>:<span class="string">'detail'</span>,</div><div class="line">	  <span class="attr">component</span>:Detail</div><div class="line">	&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样我们就能跳转到详情页面了，现在需要实现返回到列表</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">_back()&#123;</div><div class="line">	<span class="keyword">this</span>.props.navigator.pop()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>还要将外面的id传入详情页，我们就可以拿着id去请求详情页数据了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">_loadDetailPage(row)&#123;</div><div class="line">	<span class="keyword">this</span>.props.navigator.push(&#123;</div><div class="line">	  <span class="attr">name</span>:<span class="string">'detail'</span>,</div><div class="line">	  <span class="attr">component</span>:Detail,</div><div class="line">	  <span class="attr">params</span>:&#123;</div><div class="line">	    <span class="attr">_id</span>:row._id</div><div class="line">	  &#125;</div><div class="line">	&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在详情界面就可以拿到这个id</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">render:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> _id = <span class="keyword">this</span>.props._id</div><div class="line"></div><div class="line">	<span class="keyword">return</span> (</div><div class="line">	  <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">	    <span class="tag">&lt;<span class="name">Text</span> <span class="attr">onPress</span>=<span class="string">&#123;this._back&#125;</span>&gt;</span>详情页面&#123;_id&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">	)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>那这个params是怎么传递过来了的呢，起始就是在我们包装List的时候的使用了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Component &#123;...route.params&#125; navigator=&#123;navigator&#125; /&gt;</div></pre></td></tr></table></figure>
<p>…的作用就是讲params中的所有属性展开依次传递给Component，所有我们在组件内部就能通过props拿到</p>
<h2 id="详情页播放视频"><a href="#详情页播放视频" class="headerlink" title="详情页播放视频"></a>详情页播放视频</h2><p>这里使用一个第三方库</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">npm i react-native-video --save</div><div class="line"></div><div class="line"><span class="comment">//安装完后还需要链接，我这里链接又报错，所以只能手动链接</span></div><div class="line">rnpm link react-native-video</div></pre></td></tr></table></figure>
<p>链接完成后，在详情界面写上Video组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;Video</div><div class="line">    style=&#123;styles.video&#125;</div><div class="line">    ref=<span class="string">'videoPlayer'</span></div><div class="line">    source=&#123;&#123;<span class="attr">uri</span>:data.video&#125;&#125;</div><div class="line">    style=&#123;styles.video&#125;</div><div class="line">    volume=&#123;<span class="number">3</span>&#125;</div><div class="line">    paused=&#123;<span class="literal">false</span>&#125;</div><div class="line">    rate=&#123;<span class="keyword">this</span>.state.rate&#125;</div><div class="line">    muted=&#123;<span class="keyword">this</span>.state.muted&#125;</div><div class="line">    resizeMode=&#123;<span class="keyword">this</span>.state.resizeMode&#125;</div><div class="line">    repeat=&#123;<span class="keyword">this</span>.state.repeat&#125;</div><div class="line"></div><div class="line">    onLoadStart=&#123;<span class="keyword">this</span>._onLoadStart&#125;</div><div class="line">    onLoad=&#123;<span class="keyword">this</span>._onLoad&#125;</div><div class="line">    onProgress=&#123;<span class="keyword">this</span>._onProgress&#125;</div><div class="line">    onEnd=&#123;<span class="keyword">this</span>._onEnd&#125;</div><div class="line">    onError=&#123;<span class="keyword">this</span>._onError&#125; /&gt;</div></pre></td></tr></table></figure>
<h2 id="播放和暂停"><a href="#播放和暂停" class="headerlink" title="播放和暂停"></a>播放和暂停</h2><p>只需要控制Video组件的paused属性就行了</p>
<h2 id="添加返回和标题栏"><a href="#添加返回和标题栏" class="headerlink" title="添加返回和标题栏"></a>添加返回和标题栏</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;View style=&#123;styles.header&#125;&gt;</div><div class="line">  <span class="xml"><span class="tag">&lt;<span class="name">TouchableOpacity</span> <span class="attr">style</span>=<span class="string">&#123;styles.backBox&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this._pop&#125;</span>&gt;</span></span></div><div class="line">    <span class="tag">&lt;<span class="name">Icon</span> <span class="attr">name</span>=<span class="string">'ios-arrow-back'</span> <span class="attr">style</span>=<span class="string">&#123;styles.backIcon&#125;</span> /&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.backText&#125;</span> &gt;</span>返回<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">TouchableOpacity</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.headerTitle&#125;</span> <span class="attr">numberOflines</span>=<span class="string">&#123;1&#125;</span>&gt;</span></div><div class="line">    视频详情页</div><div class="line">  <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">View</span>&gt;</span></div></pre></td></tr></table></figure>
<p>对应的样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">header:&#123;</div><div class="line">    <span class="attr">flexDirection</span>:<span class="string">'row'</span>,</div><div class="line">    <span class="attr">justifyContent</span>:<span class="string">'center'</span>,</div><div class="line">    <span class="attr">alignItems</span>:<span class="string">'center'</span>,</div><div class="line">    <span class="attr">width</span>:width,</div><div class="line">    <span class="attr">height</span>:<span class="number">64</span>,</div><div class="line">    <span class="attr">paddingTop</span>:<span class="number">20</span>,</div><div class="line">    <span class="attr">paddingLeft</span>:<span class="number">10</span>,</div><div class="line">    <span class="attr">paddingRight</span>:<span class="number">10</span>,</div><div class="line">    <span class="attr">borderBottomWidth</span>:<span class="number">1</span>,</div><div class="line">    <span class="attr">borderColor</span>:<span class="string">'rgba(0,0,0,0.1)'</span>,</div><div class="line">    <span class="attr">backgroundColor</span>:<span class="string">'#fff'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">backBox</span>:&#123;</div><div class="line">    <span class="attr">position</span>:<span class="string">'absolute'</span>,</div><div class="line">    <span class="attr">left</span>:<span class="number">12</span>,</div><div class="line">    <span class="attr">top</span>:<span class="number">32</span>,</div><div class="line">    <span class="attr">width</span>:<span class="number">50</span>,</div><div class="line">    <span class="attr">flexDirection</span>:<span class="string">'row'</span>,</div><div class="line">    <span class="attr">alignItems</span>:<span class="string">'center'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">headerTitle</span>:&#123;</div><div class="line">    <span class="attr">width</span>:width<span class="number">-120</span>,</div><div class="line">    <span class="attr">textAlign</span>:<span class="string">'center'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">backIcon</span>:&#123;</div><div class="line">    <span class="attr">color</span>:<span class="string">'#999'</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">backText</span>:&#123;</div><div class="line">    <span class="attr">color</span>:<span class="string">'#999'</span></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">_pop()&#123;</div><div class="line">	<span class="keyword">this</span>.props.navigator.pop()</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="视频制作者信息"><a href="#视频制作者信息" class="headerlink" title="视频制作者信息"></a>视频制作者信息</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;View style=&#123;styles.infoBox&#125; &gt;</div><div class="line">	<span class="xml"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">style</span>=<span class="string">&#123;styles.avatar&#125;</span> <span class="attr">source</span>=<span class="string">&#123;&#123;uri:data.author.avatar&#125;&#125;</span> /&gt;</span></span></div><div class="line">	<span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.descBox&#125;</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.nickname&#125;</span> &gt;</span> &#123;data.author.nickname&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.title&#125;</span> &gt;</span> &#123;data.title&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">View</span>&gt;</span></div></pre></td></tr></table></figure>
<p>样式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">infoBox:&#123;</div><div class="line">    <span class="attr">width</span>:width,</div><div class="line">    <span class="attr">flexDirection</span>:<span class="string">'row'</span>,</div><div class="line">    <span class="attr">justifyContent</span>:<span class="string">'center'</span>,</div><div class="line">    <span class="attr">marginTop</span>:<span class="number">20</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">avatar</span>:&#123;</div><div class="line">    <span class="attr">width</span>:<span class="number">60</span>,</div><div class="line">    <span class="attr">height</span>:<span class="number">60</span>,</div><div class="line">    <span class="attr">marginRight</span>:<span class="number">10</span>,</div><div class="line">    <span class="attr">marginLeft</span>:<span class="number">10</span>,</div><div class="line">    <span class="attr">borderRadius</span>:<span class="number">30</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">descBox</span>:&#123;</div><div class="line">    <span class="attr">flex</span>:<span class="number">1</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">nickname</span>:&#123;</div><div class="line">    <span class="attr">fontSize</span>:<span class="number">18</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">title</span>:&#123;</div><div class="line">    <span class="attr">marginTop</span>:<span class="number">8</span>,</div><div class="line">    <span class="attr">fontSize</span>:<span class="number">16</span>,</div><div class="line">    <span class="attr">color</span>:<span class="string">'#666'</span></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="显示视频信息"><a href="#显示视频信息" class="headerlink" title="显示视频信息"></a>显示视频信息</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;View style=&#123;styles.infoBox&#125; &gt;</div><div class="line">	<span class="xml"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">style</span>=<span class="string">&#123;styles.avatar&#125;</span> <span class="attr">source</span>=<span class="string">&#123;&#123;uri:data.author.avatar&#125;&#125;</span> /&gt;</span></span></div><div class="line">	<span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.descBox&#125;</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.nickname&#125;</span> &gt;</span> &#123;data.author.nickname&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.title&#125;</span> &gt;</span> &#123;data.title&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">View</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="显示评论内容"><a href="#显示评论内容" class="headerlink" title="显示评论内容"></a>显示评论内容</h2><h3 id="小插曲"><a href="#小插曲" class="headerlink" title="小插曲"></a>小插曲</h3><p>1.像这种布局</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;View key=&#123;row._id&#125; style=&#123;styles.replyBox&#125; &gt;</div><div class="line">	<span class="xml"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">style</span>=<span class="string">&#123;styles.replyAvatar&#125;</span> <span class="attr">source</span>=<span class="string">&#123;&#123;uri:row.replyBy.avatar&#125;&#125;</span> /&gt;</span></span></div><div class="line">	<span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.reply&#125;</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.replyNickname&#125;</span> &gt;</span> &#123;row.replyBy.nickname&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.replyContent&#125;</span> &gt;</span> &#123;row.content&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">View</span>&gt;</span></div></pre></td></tr></table></figure>
<p>replyBox的样式一定要设置宽度，不然整个页面有可能一部分显示到了左边屏幕外面了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">replyBox:&#123;</div><div class="line">	<span class="attr">width</span>:width,</div><div class="line">	<span class="attr">flexDirection</span>:<span class="string">'row'</span>,</div><div class="line">	<span class="attr">justifyContent</span>:<span class="string">'flex-start'</span>,</div><div class="line">	<span class="attr">marginTop</span>:<span class="number">10</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>2.如果将ScrollView放到了VideoBox布局里面，将导致listview无法滚动，需要将他拿到和videoBox平级的布局中</p>
<h3 id="优化评论布局"><a href="#优化评论布局" class="headerlink" title="优化评论布局"></a>优化评论布局</h3><p>由于我们要显示视频信息和评论内容，所以用了ScrollView嵌套ListView</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">&lt;ScrollView</div><div class="line">      showVerticalScrollIndicator=&#123;<span class="literal">false</span>&#125;</div><div class="line">      enableEmptySections=&#123;<span class="literal">true</span>&#125;</div><div class="line">      automaticallyAdjustContentInsets=&#123;<span class="literal">false</span>&#125;</div><div class="line">      style=&#123;styles.scrollView&#125; &gt;</div><div class="line"></div><div class="line">      &lt;View style=&#123;styles.infoBox&#125; &gt;</div><div class="line">        &lt;Image style=&#123;styles.avatar&#125; source=&#123;&#123;uri:data.author.avatar&#125;&#125; /&gt;</div><div class="line">        &lt;View style=&#123;styles.descBox&#125;&gt;</div><div class="line">          &lt;Text style=&#123;styles.nickname&#125; &gt; &#123;data.author.nickname&#125; &lt;/Text&gt;</div><div class="line">          &lt;Text style=&#123;styles.title&#125; &gt; &#123;data.title&#125; &lt;/Text&gt;</div><div class="line">        &lt;/View&gt;</div><div class="line">      &lt;/View&gt;</div><div class="line"></div><div class="line">      &lt;ListView</div><div class="line">        dataSource=&#123;this.state.dataSource&#125;</div><div class="line">        renderRow=&#123;this._renderRow&#125;</div><div class="line">        onEndReached=&#123;this._fetchMoreData&#125;</div><div class="line">        renderFooter=&#123;this._renderFooter&#125;</div><div class="line">        onEndReachedThreshold=&#123;20&#125;</div><div class="line">        showVerticalScrollIndicator=&#123;false&#125;</div><div class="line">        enableEmptySections=&#123;true&#125;</div><div class="line">        automaticallyAdjustContentInsets=&#123;false&#125;</div><div class="line">        refreshControl=&#123;</div><div class="line">          &lt;RefreshControl</div><div class="line">            refreshing=&#123;this.state.isRefreshing&#125;</div><div class="line">            onRefresh=&#123;this._onRefresh&#125;</div><div class="line">            tintColor="#ff6600"</div><div class="line">            title="拼命加载中..."</div><div class="line">            colors=&#123;['#ff0000', '#00ff00', '#0000ff']&#125;</div><div class="line">            progressBackgroundColor="#ffff00" /&gt;</div><div class="line">        &#125;</div><div class="line">      /&gt;</div><div class="line">&lt;/ScrollView&gt;</div></pre></td></tr></table></figure>
<p>显示需要去除ScrollView，这里使用renderHeader={this._renderHeader}，用法和renderFooter差不多,先返回布局</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">_renderHeader()&#123;</div><div class="line">	<span class="keyword">var</span> data=<span class="keyword">this</span>.state.data</div><div class="line"></div><div class="line">	<span class="keyword">return</span>(</div><div class="line">	  <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.infoBox&#125;</span> &gt;</span></span></div><div class="line">	    <span class="tag">&lt;<span class="name">Image</span> <span class="attr">style</span>=<span class="string">&#123;styles.avatar&#125;</span> <span class="attr">source</span>=<span class="string">&#123;&#123;uri:data.author.avatar&#125;&#125;</span> /&gt;</span></div><div class="line">	    <span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.descBox&#125;</span>&gt;</span></div><div class="line">	      <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.nickname&#125;</span> &gt;</span> &#123;data.author.nickname&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	      <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.title&#125;</span> &gt;</span> &#123;data.title&#125; <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">	    <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">	  <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">	)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后删除scrollview相关的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;ListView</div><div class="line">	dataSource=&#123;<span class="keyword">this</span>.state.dataSource&#125;</div><div class="line">	renderRow=&#123;<span class="keyword">this</span>._renderRow&#125;</div><div class="line">	onEndReached=&#123;<span class="keyword">this</span>._fetchMoreData&#125;</div><div class="line">	renderHeader=&#123;<span class="keyword">this</span>._renderHeader&#125;</div><div class="line">	renderFooter=&#123;<span class="keyword">this</span>._renderFooter&#125;</div><div class="line">	onEndReachedThreshold=&#123;<span class="number">20</span>&#125;</div><div class="line">	showVerticalScrollIndicator=&#123;<span class="literal">false</span>&#125;</div><div class="line">	enableEmptySections=&#123;<span class="literal">true</span>&#125;</div><div class="line">	automaticallyAdjustContentInsets=&#123;<span class="literal">false</span>&#125;</div><div class="line">	refreshControl=&#123;</div><div class="line">	  &lt;RefreshControl</div><div class="line">	    refreshing=&#123;<span class="keyword">this</span>.state.isRefreshing&#125;</div><div class="line">	    onRefresh=&#123;<span class="keyword">this</span>._onRefresh&#125;</div><div class="line">	    tintColor=<span class="string">"#ff6600"</span></div><div class="line">	    title=<span class="string">"拼命加载中..."</span></div><div class="line">	    colors=&#123;[<span class="string">'#ff0000'</span>, <span class="string">'#00ff00'</span>, <span class="string">'#0000ff'</span>]&#125;</div><div class="line">	    progressBackgroundColor=<span class="string">"#ffff00"</span> /&gt;</div><div class="line">	&#125;</div><div class="line">/&gt;</div></pre></td></tr></table></figure>
<h2 id="添加评论"><a href="#添加评论" class="headerlink" title="添加评论"></a>添加评论</h2><p>我们在视频页面添加了一个引导用户评论的输入框，但这个框起始只是一个点击层而已，目的是用户点击弹出一个浮层，在浮层里面评论</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">_renderHeader()&#123;</div><div class="line">  <span class="keyword">var</span> data=<span class="keyword">this</span>.state.data</div><div class="line"></div><div class="line">    <span class="keyword">return</span>(</div><div class="line">      &lt;View state=&#123;styles.listHeader&#125;&gt;</div><div class="line">        &lt;View style=&#123;styles.infoBox&#125; &gt;</div><div class="line">          &lt;Image style=&#123;styles.avatar&#125; source=&#123;&#123;uri:data.author.avatar&#125;&#125; /&gt;</div><div class="line">          &lt;View style=&#123;styles.descBox&#125;&gt;</div><div class="line">            &lt;Text style=&#123;styles.nickname&#125; &gt; &#123;data.author.nickname&#125; &lt;/Text&gt;</div><div class="line">            &lt;Text style=&#123;styles.title&#125; &gt; &#123;data.title&#125; &lt;/Text&gt;</div><div class="line">          &lt;/View&gt;</div><div class="line">        &lt;/View&gt;</div><div class="line"></div><div class="line">        &lt;View style=&#123;styles.commentBox&#125;&gt;</div><div class="line">          &lt;View style=&#123;styles.comment&#125;&gt;</div><div class="line">            &lt;TextInput</div><div class="line">              placeholder='敢不敢评论一个呀'</div><div class="line">              style=&#123;styles.content&#125;</div><div class="line">              multiline=&#123;true&#125;</div><div class="line">              onFocus=&#123;this._onFocus&#125; /&gt;</div><div class="line">          &lt;/View&gt;</div><div class="line">        &lt;/View&gt;</div><div class="line"></div><div class="line">        &lt;View style=&#123;styles.commentArea&#125;&gt;</div><div class="line">          &lt;Text style=&#123;styles.commentTitle&#125;&gt;热门评论&lt;/Text&gt;</div><div class="line">        &lt;/View&gt;</div><div class="line">      &lt;/View&gt;</div><div class="line">      </div><div class="line">    )</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="提交组件"><a href="#提交组件" class="headerlink" title="提交组件"></a>提交组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i react-native-button --save</div></pre></td></tr></table></figure>
<p>不需要链接,先导入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//这种导入方式报错</span></div><div class="line"><span class="comment">//var Button=require('react-native-button')</span></div><div class="line"><span class="keyword">import</span> Button <span class="keyword">from</span> <span class="string">'react-native-button'</span>;</div></pre></td></tr></table></figure>
<p>添加组件到布局</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;Button style=&#123;styles.submit&#125; onPress=&#123;<span class="keyword">this</span>._submit&#125; &gt;评论&lt;<span class="regexp">/Button&gt;</span></div></pre></td></tr></table></figure>
<p>添加一个_submit方法，在这里处理评论逻辑</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">_submit()&#123;</div><div class="line">    <span class="keyword">var</span> that = <span class="keyword">this</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.state.content) &#123;</div><div class="line">      <span class="keyword">return</span> AlertIOS.alert(<span class="string">'请输入评论内容！'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.isSending) &#123;</div><div class="line">      <span class="keyword">return</span> AlertIOS.alert(<span class="string">'正在拼命评论中...'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//正在发送</span></div><div class="line">    <span class="keyword">this</span>.setState(&#123;</div><div class="line">      <span class="attr">isSending</span>:<span class="literal">true</span></div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> body=&#123;</div><div class="line">        <span class="attr">accessToken</span>:<span class="string">'a'</span>,</div><div class="line">        <span class="attr">videoId</span>:<span class="string">'123'</span>,</div><div class="line">        <span class="attr">content</span>:<span class="keyword">this</span>.state.content</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">var</span> url = config.api.base+config.api.comment</div><div class="line"></div><div class="line">      request.post(url,body)</div><div class="line">      .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">        <span class="keyword">if</span> (data&amp;&amp;data.success) &#123;</div><div class="line">          <span class="keyword">var</span> items=cacheReuslts.items.slice()</div><div class="line"></div><div class="line">          <span class="keyword">var</span> cotnent=that.state.content</div><div class="line">          items=[&#123;</div><div class="line">            <span class="attr">content</span>:cotnent,</div><div class="line">            <span class="attr">replyBy</span>:&#123;</div><div class="line">              <span class="attr">avatar</span>:<span class="string">'https://dummyimage.com/640x640/b108ca'</span>,</div><div class="line">              <span class="attr">nickname</span>:<span class="string">'你猜猜我是谁'</span></div><div class="line">            &#125;</div><div class="line">          &#125;].concat(items)</div><div class="line"></div><div class="line">          cacheReuslts.items=items</div><div class="line">          cacheReuslts.total=cacheReuslts.total+<span class="number">1</span></div><div class="line"></div><div class="line">          that.setState(&#123;</div><div class="line">            <span class="attr">content</span>:<span class="string">''</span>,</div><div class="line">            <span class="attr">isSending</span>:<span class="literal">false</span>,</div><div class="line">            <span class="attr">dataSource</span>:that.state.dataSource.cloneWithRows(cacheReuslts.items)</div><div class="line">          &#125;)</div><div class="line"></div><div class="line">          that._setModalVisible(<span class="literal">false</span>)</div><div class="line"></div><div class="line">        &#125;</div><div class="line">      &#125;)</div><div class="line">      .catch(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(err)</div><div class="line">        that.setState(&#123;</div><div class="line">          <span class="attr">isSending</span>:<span class="literal">false</span></div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        that._setModalVisible(<span class="literal">false</span>)</div><div class="line"></div><div class="line">        AlertIOS.alert(<span class="string">'留言失败，稍后重试！'</span>)</div><div class="line"></div><div class="line">      &#125;)</div><div class="line">    &#125;)</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h2 id="验证码倒计时"><a href="#验证码倒计时" class="headerlink" title="验证码倒计时"></a>验证码倒计时</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i react-native-sk-countdown --save</div></pre></td></tr></table></figure>
<p>我们在手机号旁边添加一个倒计时控件，先判断是否发送了验证码，在显示验证码输入框和倒计时按钮。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">&#123;	</div><div class="line">	</div><div class="line">	<span class="keyword">this</span>.state.codeSent</div><div class="line">	? &lt;View style=&#123;styles.verifyCodeBox&#125; &gt;</div><div class="line">		&lt;TextInput</div><div class="line">			placeholderTextColor='#444'</div><div class="line">			style=&#123;styles.inputField&#125;</div><div class="line">			placeHolder='请输入验证码'</div><div class="line">			autoCaptialize=&#123;'none'&#125;</div><div class="line">			autoCorrect=&#123;false&#125;</div><div class="line">			keyboradType=&#123;'number-pad'&#125;</div><div class="line">			onChangeText=&#123;(text)=&gt;&#123;</div><div class="line">				this.setState(&#123;</div><div class="line">					verifyCode:text</div><div class="line">				&#125;)</div><div class="line">			&#125;&#125; /&gt;</div><div class="line"></div><div class="line">		&#123;</div><div class="line">			this.state.countingDone</div><div class="line">			? &lt;Button </div><div class="line">				style=&#123;styles.countBtn&#125;</div><div class="line">				onPress=&#123;this._sendVerifyCode&#125;&gt; 获取验证码&lt;/Button&gt;</div><div class="line">  		:  &lt;CountDown</div><div class="line">  				style=&#123;styles.countBtn&#125;</div><div class="line">  			  countType='seconds' // 计时类型：seconds / date</div><div class="line">  			  auto=&#123;true&#125; // 自动开始</div><div class="line">  			  afterEnd=&#123;this._countingDone&#125; // 结束回调</div><div class="line">  			  timeLeft=&#123;60&#125; // 正向计时 时间起点为0秒</div><div class="line">  			  step=&#123;-1&#125; // 计时步长，以秒为单位，正数则为正计时，负数为倒计时</div><div class="line">  			  startText='获取验证码' // 开始的文本</div><div class="line">  			  endText='获取验证码' // 结束的文本</div><div class="line">  			  intervalText=&#123;(sec) =&gt; sec + '秒重新获取'&#125; /&gt;</div><div class="line">	</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		&lt;/View&gt;</div><div class="line">		: null</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同时验证码倒计时完成了，在显示重新获取验证码按钮。</p>
<h2 id="启动切换到登陆或首页逻辑"><a href="#启动切换到登陆或首页逻辑" class="headerlink" title="启动切换到登陆或首页逻辑"></a>启动切换到登陆或首页逻辑</h2><p>首先我们先在index.ios.js文件中获取是否有用户状态，如果有显示主界面，如果没有显示登陆界面</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">componentDidMount()&#123;</div><div class="line">	<span class="keyword">this</span>._getAppStatus()</div><div class="line">&#125;,</div><div class="line"></div><div class="line">_getAppStatus()&#123;</div><div class="line">	<span class="keyword">var</span> that = <span class="keyword">this</span></div><div class="line"></div><div class="line">	AsyncStorage.getItem(<span class="string">'user'</span>)</div><div class="line">	  .then(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</div><div class="line">	    <span class="keyword">var</span> user</div><div class="line">	    <span class="keyword">var</span> newStatus=&#123;&#125;</div><div class="line"></div><div class="line">	    <span class="keyword">if</span> (data) &#123;</div><div class="line">	      newStatus.user=user</div><div class="line">	      newStatus.logined=<span class="literal">true</span></div><div class="line">	    &#125; <span class="keyword">else</span>&#123;</div><div class="line">	      newStatus.logined=<span class="literal">false</span></div><div class="line">	    &#125;</div><div class="line"></div><div class="line">	    that.setState(newStatus)</div><div class="line">	  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后我们判断是否登陆，并渲染相应的界面</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">render: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span> (!<span class="keyword">this</span>.state.logined) &#123;</div><div class="line">	  <span class="keyword">return</span> &lt;Login afterLogin=&#123;this._afterLogin&#125;/&gt;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	return (</div><div class="line">	  &lt;TabBarIOS</div><div class="line">	    tintColor="#ee735c"&gt;</div><div class="line">	    &lt;Icon.TabBarItem</div><div class="line">	      title="视频"</div><div class="line">	      iconName='ios-videocam-outline'</div><div class="line">	      selectedIconName='ios-videocam'</div><div class="line">	      selected=&#123;this.state.selectedTab === 'list'&#125;</div><div class="line">	      onPress=&#123;() =&gt; &#123;</div><div class="line">	        this.setState(&#123;</div><div class="line">	          selectedTab: 'list',</div><div class="line">	        &#125;);</div><div class="line">	      &#125;&#125;&gt;</div><div class="line"></div><div class="line">	      &lt;Navigator</div><div class="line">	        initialRoute=&#123;&#123;</div><div class="line">	          name:'list',</div><div class="line">	          component:List</div><div class="line">	        &#125;&#125;</div><div class="line">	        configureScene=&#123;(route)=&gt;&#123;</div><div class="line">	          return Navigator.SceneConfigs.FloatFromRight</div><div class="line">	        &#125;&#125;</div><div class="line">	        renderScene=&#123;(route,navigator)=&gt;&#123;</div><div class="line">	          var Component=route.component</div><div class="line">	          return &lt;Component &#123;...route.params&#125; navigator=&#123;navigator&#125; /&gt;</div><div class="line">	        &#125;&#125; /&gt;</div><div class="line">	    &lt;/Icon.TabBarItem&gt;</div><div class="line">	    &lt;Icon.TabBarItem</div><div class="line">	      title="录制"</div><div class="line">	      iconName='ios-recording-outline'</div><div class="line">	      selectedIconName='ios-recording'</div><div class="line">	      selected=&#123;this.state.selectedTab === 'edit'&#125;</div><div class="line">	      onPress=&#123;() =&gt; &#123;</div><div class="line">	        this.setState(&#123;</div><div class="line">	          selectedTab: 'edit'</div><div class="line">	        &#125;);</div><div class="line">	      &#125;&#125;&gt;</div><div class="line">	      &lt;Edit/&gt;</div><div class="line">	    &lt;/Icon.TabBarItem&gt;</div><div class="line">	    &lt;Icon.TabBarItem</div><div class="line">	      title="更多"</div><div class="line">	      iconName='ios-more-outline'</div><div class="line">	      selectedIconName='ios-more'</div><div class="line">	      selected=&#123;this.state.selectedTab === 'account'&#125;</div><div class="line">	      onPress=&#123;() =&gt; &#123;</div><div class="line">	        this.setState(&#123;</div><div class="line">	          selectedTab: 'account'</div><div class="line">	        &#125;);</div><div class="line">	      &#125;&#125;&gt;</div><div class="line">	      &lt;Account/&gt;</div><div class="line">	    &lt;/Icon.TabBarItem&gt;</div><div class="line">	  &lt;/TabBarIOS&gt;</div><div class="line">	);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="显示用户头像"><a href="#显示用户头像" class="headerlink" title="显示用户头像"></a>显示用户头像</h2><p>首先我们判断用户是否有头像然后显示不同的布局</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  user.avatar</div><div class="line">  ? &lt;TouchableOpacity style=&#123;styles.avatarContainer&#125;&gt;</div><div class="line">      &lt;Image source=&#123;&#123;uri:user.avatar&#125;&#125; style=&#123;styles.avatarContainer&#125;&gt;</div><div class="line">        &lt;View style=&#123;styles.avatarBox&#125; &gt;</div><div class="line">          &lt;Image</div><div class="line">            source=&#123;&#123;uri:user.avatar&#125;&#125;</div><div class="line">            style=&#123;styles.avatar&#125; /&gt;</div><div class="line">        &lt;/View&gt;</div><div class="line">        &lt;Text style=&#123;styles.avatarTip&#125;&gt;添加头像&lt;/Text&gt;</div><div class="line">      &lt;/Image&gt;</div><div class="line">    &lt;/TouchableOpacity&gt;</div><div class="line">  :</div><div class="line">    &lt;View style=&#123;styles.avatarContainer&#125;&gt;</div><div class="line">      &lt;Text style=&#123;styles.avatarTip&#125;&gt;添加头像&lt;/Text&gt;</div><div class="line">      &lt;TouchableOpacity style=&#123;styles.avatarBox&#125; &gt;</div><div class="line">        &lt;Icon</div><div class="line">          name='ios-cloud-upload-outline'</div><div class="line">          style=&#123;styles.plusIcon&#125; /&gt;</div><div class="line">      &lt;/TouchableOpacity&gt;</div><div class="line">    &lt;/View&gt;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="选择图片"><a href="#选择图片" class="headerlink" title="选择图片"></a>选择图片</h3><p>使用一个模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i react-native-image-picker@0.20.0 --save</div></pre></td></tr></table></figure>
<p>链接</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm link react-native-image-picker</div></pre></td></tr></table></figure>
<p>如果你的系统是iOS10,需要添加权限：<a href="http://www.jianshu.com/p/c212cde86877" target="_blank" rel="external">http://www.jianshu.com/p/c212cde86877</a></p>
<p>如果链接完不能用，请手动链接，并导入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ImagePicker = <span class="built_in">require</span>(<span class="string">'react-native-image-picker'</span>);</div></pre></td></tr></table></figure>
<p>然后配置一些设置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> options = &#123;</div><div class="line">  <span class="attr">title</span>: <span class="string">'选择头像'</span>,</div><div class="line">  <span class="attr">cancelButtonTitle</span>:<span class="string">'取消'</span>,</div><div class="line">  <span class="attr">takePhotoButtonTitle</span>:<span class="string">'拍照'</span>,</div><div class="line">  <span class="attr">chooseFromLibraryButtonTitle</span>:<span class="string">'从相册选择'</span>,</div><div class="line">  <span class="attr">quality</span>:<span class="number">0.75</span>,</div><div class="line">  <span class="attr">allowsEditing</span>:<span class="literal">true</span>,</div><div class="line">  <span class="attr">noData</span>:<span class="literal">false</span>,</div><div class="line">  <span class="attr">storageOptions</span>: &#123;</div><div class="line">    <span class="attr">skipBackup</span>: <span class="literal">true</span>,</div><div class="line">    <span class="attr">path</span>: <span class="string">'images'</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后就可以选择图片了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">_pickPhoto()&#123;</div><div class="line">  <span class="keyword">var</span> that=<span class="keyword">this</span></div><div class="line"></div><div class="line">  <span class="built_in">console</span>.log(ImagePicker)</div><div class="line"></div><div class="line">  ImagePicker.showImagePicker(options, (response) =&gt; &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Response = '</span>, response);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (response.didCancel) &#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'User cancelled image picker'</span>);</div><div class="line">      <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> avatarData=<span class="string">'data:image/png;base64,'</span>+response.data</div><div class="line"></div><div class="line">    <span class="keyword">var</span> user=that.state.user</div><div class="line"></div><div class="line">    user.avatar=avatarData</div><div class="line"></div><div class="line">    that.setState(&#123;</div><div class="line">      <span class="attr">user</span>:user</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    <span class="comment">// else if (response.error) &#123;</span></div><div class="line">    <span class="comment">//   console.log('ImagePicker Error: ', response.error);</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">    <span class="comment">// else if (response.customButton) &#123;</span></div><div class="line">    <span class="comment">//   console.log('User tapped custom button: ', response.customButton);</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">    <span class="comment">// else &#123;</span></div><div class="line">    <span class="comment">//   // You can display the image using either data...</span></div><div class="line">    <span class="comment">//   const source = &#123;uri: 'data:image/jpeg;base64,' + response.data, isStatic: true&#125;;</span></div><div class="line"></div><div class="line">    <span class="comment">//   // or a reference to the platform specific asset location</span></div><div class="line">    <span class="comment">//   if (Platform.OS === 'ios') &#123;</span></div><div class="line">    <span class="comment">//     const source = &#123;uri: response.uri.replace('file://', ''), isStatic: true&#125;;</span></div><div class="line">    <span class="comment">//   &#125; else &#123;</span></div><div class="line">    <span class="comment">//     const source = &#123;uri: response.uri, isStatic: true&#125;;</span></div><div class="line">    <span class="comment">//   &#125;</span></div><div class="line"></div><div class="line">    <span class="comment">//   this.setState(&#123;</span></div><div class="line">    <span class="comment">//     avatarSource: source</span></div><div class="line">    <span class="comment">//   &#125;);</span></div><div class="line">    <span class="comment">// &#125;</span></div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="上传图片到图床"><a href="#上传图片到图床" class="headerlink" title="上传图片到图床"></a>上传图片到图床</h3><p>我们这里选用<a href="https://cloudinary.com，首先选择一个账号，然后将一些配置信息写到程序中" target="_blank" rel="external">https://cloudinary.com，首先选择一个账号，然后将一些配置信息写到程序中</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> CLOUDINARY = &#123;</div><div class="line">  <span class="attr">cloud_name</span>: <span class="string">'dawlcb8jj'</span>,  </div><div class="line">  <span class="attr">api_key</span>: <span class="string">'6368311532331937597'</span>,  </div><div class="line">  <span class="attr">api_secret</span>: <span class="string">'N4rXJImMfxZq03454fSosbZFfOhfHR8'</span>, </div><div class="line">  <span class="attr">base</span>:<span class="string">'http://res.cloudinary.com/daw454lcb8jj'</span>,</div><div class="line">  <span class="attr">image</span>:<span class="string">'https://api.cloudinary.com/v1_1/daw454lcb8jj/image/upload'</span>,</div><div class="line">  <span class="attr">video</span>:<span class="string">'https://api.cloudinary.com/v1_1/daw454lcb8jj/video/upload'</span>,</div><div class="line">  <span class="attr">audio</span>: <span class="string">'https://api.cloudinary.com/v1_1/daw454lcb8jj/raw/upload'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后就是上传逻辑了，首先我们需要将一些参数传递到服务端签名(因为本地签名不安全)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">ImagePicker.showImagePicker(options, (response) =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'Response = '</span>, response);</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (response.didCancel) &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'User cancelled image picker'</span>);</div><div class="line">    <span class="keyword">return</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> avatarData=<span class="string">'data:image/png;base64,'</span>+response.data</div><div class="line"></div><div class="line">  <span class="comment">//先显示出头像</span></div><div class="line">  <span class="keyword">var</span> user=that.state.user</div><div class="line"></div><div class="line">  user.avatar=avatarData</div><div class="line"></div><div class="line">  that.setState(&#123;</div><div class="line">    <span class="attr">user</span>:user</div><div class="line">  &#125;)</div><div class="line"></div><div class="line">  <span class="keyword">var</span> timestamp=<span class="built_in">Date</span>.now()</div><div class="line">  <span class="keyword">var</span> tags=<span class="string">'app,avatar'</span></div><div class="line">  <span class="keyword">var</span> folder=<span class="string">'avatar'</span></div><div class="line">  <span class="keyword">var</span> signatureUrl=config.api.base+config.api.signature</div><div class="line"></div><div class="line">  <span class="keyword">var</span> accessToken=<span class="keyword">this</span>.state.user.accessToken</div><div class="line"></div><div class="line">  request.post(signatureUrl,&#123;</div><div class="line">    <span class="attr">accessToken</span>:accessToken,</div><div class="line">    <span class="attr">timestamp</span>:timestamp,</div><div class="line">    <span class="attr">folder</span>:folder,</div><div class="line">    tags,tags,</div><div class="line">    <span class="attr">type</span>:<span class="string">'avatar'</span></div><div class="line">  &#125;)</div><div class="line">  .catch(<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'upload image fail'</span>)</div><div class="line">    <span class="built_in">console</span>.log(e)</div><div class="line">  &#125;)</div><div class="line">  .then(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</div><div class="line">    <span class="keyword">if</span> (data&amp;&amp;data.success) &#123;</div><div class="line">      <span class="keyword">var</span> signature= <span class="string">'folder='</span>+folder+<span class="string">'&amp;tags='</span>+tags+<span class="string">'&amp;timestamp='</span>+timestamp+CLOUDINARY.api_secret</div><div class="line">      signature=sha1(signature)</div><div class="line"></div><div class="line">      <span class="keyword">var</span> body=<span class="keyword">new</span> FormData()</div><div class="line"></div><div class="line">      body.append(<span class="string">'folder'</span>,folder)</div><div class="line">      body.append(<span class="string">'signature'</span>,signature)</div><div class="line">      body.append(<span class="string">'timestamp'</span>,timestamp)</div><div class="line">      body.append(<span class="string">'tags'</span>,tags)</div><div class="line">      body.append(<span class="string">'api_key'</span>,CLOUDINARY.api_key)</div><div class="line">      body.append(<span class="string">'resource_type'</span>,<span class="string">'image'</span>)</div><div class="line">      body.append(<span class="string">'file'</span>,avatarData)</div><div class="line"></div><div class="line">      <span class="keyword">this</span>._upload(body)</div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>然后就上传图片</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">_upload(body)&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'_upload'</span>)</div><div class="line">  <span class="keyword">var</span> that = <span class="keyword">this</span></div><div class="line"></div><div class="line">  <span class="keyword">var</span> xhr=<span class="keyword">new</span> XMLHttpRequest()</div><div class="line">  <span class="keyword">var</span> url=CLOUDINARY.image</div><div class="line"></div><div class="line">  xhr.open(<span class="string">'POST'</span>,url)</div><div class="line">  xhr.onload=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</div><div class="line">     <span class="built_in">console</span>.log(<span class="string">'upload image onload'</span>)</div><div class="line">    <span class="keyword">if</span> (xhr.status!==<span class="number">200</span>) &#123;</div><div class="line">      AlertIOS(<span class="string">'请求失败'</span>)</div><div class="line">      <span class="built_in">console</span>.log(xhr.responseText)</div><div class="line">      <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!xhr.responseText) &#123;</div><div class="line">      AlertIOS(<span class="string">'请求失败'</span>)</div><div class="line">      <span class="built_in">console</span>.log(xhr.responseText)</div><div class="line">      <span class="keyword">return</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> response</div><div class="line"></div><div class="line">    <span class="keyword">try</span>&#123;</div><div class="line">      response=<span class="built_in">JSON</span>.parse(xhr.response)</div><div class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</div><div class="line">      <span class="built_in">console</span>.log(e)</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'parse fails'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'upload success'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (response&amp;&amp;response.public_id) &#123;</div><div class="line">      <span class="keyword">var</span> user=that.state.user</div><div class="line"></div><div class="line">      user.avatar=avatar(response.public_id,<span class="string">'image'</span>)</div><div class="line"></div><div class="line">      that.setState(&#123;</div><div class="line">        <span class="attr">user</span>:user</div><div class="line">      &#125;)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  xhr.send(body)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="上传进度"><a href="#上传进度" class="headerlink" title="上传进度"></a>上传进度</h3><p>首先安装一个进度组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i react-native-progress --save</div></pre></td></tr></table></figure>
<h2 id="录音"><a href="#录音" class="headerlink" title="录音"></a>录音</h2><p>使用react-native-audio模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">npm i react-native-audio@<span class="number">1.2</span><span class="number">.1</span> --save</div><div class="line"><span class="comment">//这里安装1.3.0才不报错</span></div></pre></td></tr></table></figure>
<p>然后链接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm link react-native-audio</div></pre></td></tr></table></figure>
<p>示例代码<a href="https://github.com/jsierles/react-native-audio/blob/master/AudioExample/AudioExample.js" target="_blank" rel="external">https://github.com/jsierles/react-native-audio/blob/master/AudioExample/AudioExample.js</a></p>
<h2 id="app图标"><a href="#app图标" class="headerlink" title="app图标"></a>app图标</h2><h3 id="使用appicontemplate"><a href="#使用appicontemplate" class="headerlink" title="使用appicontemplate"></a>使用appicontemplate</h3><p><a href="https://appicontemplate.com/(打开：https://applypixels.com/)，然后点击ios" target="_blank" rel="external">https://appicontemplate.com/(打开：https://applypixels.com/)，然后点击ios</a> app icon,下载app icon，然后打开app的设计稿，然后点击atn后缀的文件这样就导入了动作文件，然后打打开psd，然后将图标拖动到刚刚打开的psd,在调整好颜色，最后使用动作面板导出图标。</p>
<h3 id="使用makeappcion"><a href="#使用makeappcion" class="headerlink" title="使用makeappcion"></a>使用makeappcion</h3><p><a href="http://makeappicon.com/,使用网页端，上传一个图标，然后输入邮箱，下载附件，里面包括android,ios,watch" target="_blank" rel="external">http://makeappicon.com/,使用网页端，上传一个图标，然后输入邮箱，下载附件，里面包括android,ios,watch</a></p>
<h2 id="更改app名称"><a href="#更改app名称" class="headerlink" title="更改app名称"></a>更改app名称</h2><p>只需要在plist中添加key为CFBundleDisplayName，值为名称就行了，还可以将CFBundleDevelopmentRegion改为zh_CN</p>
<h2 id="更改启动画面"><a href="#更改启动画面" class="headerlink" title="更改启动画面"></a>更改启动画面</h2><p>直接修改LaunchScreen.xib</p>
<h2 id="轮播图"><a href="#轮播图" class="headerlink" title="轮播图"></a>轮播图</h2><p>使用一个第三方组件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i react-native-swiper --save</div></pre></td></tr></table></figure>
<h1 id="服务端开发过程"><a href="#服务端开发过程" class="headerlink" title="服务端开发过程"></a>服务端开发过程</h1><h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><p>新建一个目录，然后输入npm init填写一些基本信息，就初始化完了一个项目，然后安装一些依赖</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//初始化项目</span></div><div class="line">npm init</div><div class="line"></div><div class="line"><span class="comment">//安装依赖</span></div><div class="line">npm i koa koa-logger koa-session koa-bodyparser koa-router mongoose sha1 lodash uuid xss bluebird  --save</div></pre></td></tr></table></figure>
<p>speaksasy找不到了</p>
<p>升级到koa2,安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">npm install koa@next</div><div class="line">koa-logger@2</div><div class="line"></div><div class="line">//session还没支持2，所以要koa-convert</div><div class="line">npm i koa-convert --save </div><div class="line">app.use(convert(session(app)));</div><div class="line"></div><div class="line">npm install koa-bodyparser@next --save</div></pre></td></tr></table></figure>
<h2 id="使用koa搭建一个小型服务器"><a href="#使用koa搭建一个小型服务器" class="headerlink" title="使用koa搭建一个小型服务器"></a>使用koa搭建一个小型服务器</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"><span class="keyword">var</span> koa=<span class="built_in">require</span>(<span class="string">'koa'</span>)</div><div class="line"><span class="keyword">var</span> logger=<span class="built_in">require</span>(<span class="string">'koa-logger'</span>)</div><div class="line"><span class="keyword">var</span> session=<span class="built_in">require</span>(<span class="string">'koa-session'</span>)</div><div class="line"><span class="keyword">var</span> bodyParser=<span class="built_in">require</span>(<span class="string">'koa-bodyparser'</span>)</div><div class="line"><span class="keyword">var</span> app=koa()</div><div class="line"></div><div class="line">app.keys=[<span class="string">'say'</span>]</div><div class="line">app.use(logger())</div><div class="line">app.use(session(app))</div><div class="line">app.use(bodyParser())</div><div class="line"></div><div class="line">app.use(<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="keyword">this</span>.href)</div><div class="line">	<span class="built_in">console</span>.log(<span class="keyword">this</span>.method)</div><div class="line"></div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">yield</span> next</div><div class="line">&#125;)</div><div class="line"></div><div class="line">app.listen(<span class="number">1234</span>)</div></pre></td></tr></table></figure>
<p>现在访问localhost就可以返回一段成功的json</p>
<h2 id="将路由写到单独的文件"><a href="#将路由写到单独的文件" class="headerlink" title="将路由写到单独的文件"></a>将路由写到单独的文件</h2><p>首先我们在index.js中将引入路由文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"><span class="keyword">var</span> koa=<span class="built_in">require</span>(<span class="string">'koa'</span>)</div><div class="line"><span class="keyword">var</span> logger=<span class="built_in">require</span>(<span class="string">'koa-logger'</span>)</div><div class="line"><span class="keyword">var</span> session=<span class="built_in">require</span>(<span class="string">'koa-session'</span>)</div><div class="line"><span class="keyword">var</span> bodyParser=<span class="built_in">require</span>(<span class="string">'koa-bodyparser'</span>)</div><div class="line"><span class="keyword">var</span> app=koa()</div><div class="line"></div><div class="line">app.keys=[<span class="string">'say'</span>]</div><div class="line">app.use(logger())</div><div class="line">app.use(session(app))</div><div class="line">app.use(bodyParser())</div><div class="line"></div><div class="line"><span class="comment">//引入路由文件</span></div><div class="line"><span class="keyword">var</span> router=<span class="built_in">require</span>(<span class="string">'./config/routes'</span>)()</div><div class="line"></div><div class="line">app</div><div class="line">	.use(router.routes())</div><div class="line">	.use(router.allowedMethods())</div><div class="line"></div><div class="line">app.listen(<span class="number">1234</span>)</div><div class="line"><span class="built_in">console</span>.log(<span class="string">'listening on port 1234'</span>)</div></pre></td></tr></table></figure>
<p>然后新建路由文件</p>
<p>config/routes.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> Router=<span class="built_in">require</span>(<span class="string">'koa-router'</span>)</div><div class="line"><span class="keyword">var</span> User=<span class="built_in">require</span>(<span class="string">'../app/controllers/user'</span>)</div><div class="line"><span class="keyword">var</span> App=<span class="built_in">require</span>(<span class="string">'../app/controllers/app'</span>)</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> router=<span class="keyword">new</span> Router(&#123;</div><div class="line">		<span class="comment">//定义全局api的前缀</span></div><div class="line">		prefix:<span class="string">'/api/1'</span></div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	<span class="comment">//post请求使用User控制器上面的signup方法处理</span></div><div class="line">	<span class="comment">//user</span></div><div class="line">	router.post(<span class="string">'/u/signup'</span>,User.signup)</div><div class="line">	router.post(<span class="string">'/u/verify'</span>,User.verify)</div><div class="line">	router.post(<span class="string">'/u/update'</span>,User.update)</div><div class="line"></div><div class="line">	<span class="comment">//app</span></div><div class="line">	router.post(<span class="string">'/signature'</span>,App.signature)</div><div class="line"></div><div class="line">	<span class="keyword">return</span> router</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在路由文件中我们引入了几个控制器，将相应去请求指定不同的控制器方法调用</p>
<p>user.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line">exports.signup=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.verify=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.update=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>app.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line">exports.signature=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>现在我们可以随便访问一个api来测试接口是否正常工作</p>
<h2 id="接入mongodb"><a href="#接入mongodb" class="headerlink" title="接入mongodb"></a>接入mongodb</h2><p>首先新建一个model，在这里面定义user的模型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> mongoose=<span class="built_in">require</span>(<span class="string">'mongoose'</span>)</div><div class="line"><span class="keyword">var</span> UserSchema=<span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">	<span class="attr">phoneNumber</span>:&#123;</div><div class="line">		<span class="attr">unique</span>:<span class="literal">true</span>,</div><div class="line">		<span class="attr">type</span>:<span class="built_in">String</span></div><div class="line">	&#125;,</div><div class="line">	<span class="attr">areaCode</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">verifyCode</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">accessToken</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">nickname</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">gender</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">breed</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">age</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">avatar</span>:<span class="built_in">String</span>,</div><div class="line">	<span class="attr">meta</span>:&#123;</div><div class="line">		<span class="attr">createAt</span>:&#123;</div><div class="line">			<span class="attr">type</span>:<span class="built_in">Date</span>,</div><div class="line">			<span class="attr">default</span>:<span class="built_in">Date</span>.now()</div><div class="line">		&#125;,</div><div class="line">		<span class="attr">updateAt</span>:&#123;</div><div class="line">			<span class="attr">type</span>:<span class="built_in">Date</span>,</div><div class="line">			<span class="attr">default</span>:<span class="built_in">Date</span>.now()</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">UserSchema.pre(<span class="string">'save'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span> (!<span class="keyword">this</span>.isNew) &#123;</div><div class="line">		<span class="keyword">this</span>.meta.updateAt=<span class="built_in">Date</span>.now()</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	next()</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//暴露模型</span></div><div class="line"><span class="built_in">module</span>.exports=mongoose.model(<span class="string">'User'</span>,UserSchema)</div></pre></td></tr></table></figure>
<p>然后就可以在Controller里面操作数据库了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> xss=<span class="built_in">require</span>(<span class="string">'xss'</span>)</div><div class="line"><span class="keyword">var</span> mongoose=<span class="built_in">require</span>(<span class="string">'mongoose'</span>)</div><div class="line"><span class="keyword">var</span> User=mongoose.model(<span class="string">'User'</span>)</div><div class="line"></div><div class="line">exports.signup=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="comment">//拿到request里面的phoneNumber</span></div><div class="line">	<span class="comment">// console.log(this.request.body)</span></div><div class="line">	<span class="comment">// var phoneNumber=this.request.body.phoneNumber</span></div><div class="line">	<span class="keyword">var</span> phoneNumber=<span class="keyword">this</span>.query.phoneNumber</div><div class="line"></div><div class="line">	<span class="comment">//根据手机号查找用户，调用exec后就返回的是一个Promise</span></div><div class="line">	<span class="keyword">var</span> user=<span class="keyword">yield</span> User.findOne(&#123;</div><div class="line">		<span class="attr">phoneNumber</span>:phoneNumber</div><div class="line">	&#125;).exec()</div><div class="line"></div><div class="line">	<span class="built_in">console</span>.log(user)</div><div class="line">	<span class="built_in">console</span>.log(phoneNumber)</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (user) &#123;</div><div class="line">		<span class="comment">//更新用户的验证码</span></div><div class="line">		user.verifyCode=<span class="string">'1212'</span></div><div class="line">	&#125; <span class="keyword">else</span>&#123;</div><div class="line">		<span class="comment">//不存在，则新建一个用户</span></div><div class="line">		user = <span class="keyword">new</span> User(&#123;</div><div class="line">			<span class="attr">phoneNumber</span>:xss(phoneNumber)</div><div class="line">		&#125;)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">try</span>&#123;</div><div class="line">		user=<span class="keyword">yield</span> user.save()</div><div class="line">	&#125;<span class="keyword">catch</span>(e)&#123;</div><div class="line">		<span class="keyword">this</span>.body=&#123;</div><div class="line">			<span class="attr">success</span>:<span class="literal">false</span></div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.verify=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">exports.update=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">true</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="接入注册短信"><a href="#接入注册短信" class="headerlink" title="接入注册短信"></a>接入注册短信</h2><p>这里使用<a href="https://luosimao.com" target="_blank" rel="external">https://luosimao.com</a></p>
<h2 id="通用验证"><a href="#通用验证" class="headerlink" title="通用验证"></a>通用验证</h2><p>我们知道基本上每个请求都有accessToken，如果是post请求需要有body，像这样的逻辑，如果在每个接口都判断，可以说是很庞大的，这样我们将数据的校验写到app.js的功能中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">exports.hasBody=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> body=<span class="keyword">this</span>.request.body||&#123;&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (<span class="built_in">Object</span>.keys(body).length===<span class="number">0</span>) &#123;</div><div class="line">		<span class="keyword">this</span>.body=&#123;</div><div class="line">			<span class="attr">success</span>:<span class="literal">false</span>,</div><div class="line">			<span class="attr">err</span>:<span class="string">'没有传递body参数'</span></div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">return</span> next</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">yield</span> next</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//全局token判断</span></div><div class="line">exports.hasToken=<span class="function"><span class="keyword">function</span> *(<span class="params">next</span>) </span>&#123;</div><div class="line">	<span class="comment">//先获取url中的token</span></div><div class="line">	<span class="keyword">var</span> accessToken=<span class="keyword">this</span>.query.accessToken</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (!accessToken) &#123;</div><div class="line">		accessToken=<span class="keyword">this</span>.request.body.accessToken</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (!accessToken) &#123;</div><div class="line">		<span class="keyword">this</span>.body=&#123;</div><div class="line">			<span class="attr">success</span>:<span class="literal">false</span>,</div><div class="line">			<span class="attr">err</span>:<span class="string">'token不能为空！'</span></div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">return</span> next</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//再查询用户，如果查询不到用户，说明token错误，或者用户没注册</span></div><div class="line">	<span class="keyword">var</span> user=<span class="keyword">yield</span> User.findOne(&#123;</div><div class="line">		<span class="attr">accessToken</span>:accessToken</div><div class="line">	&#125;).exec()</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (!user) &#123;</div><div class="line">		<span class="keyword">this</span>.body=&#123;</div><div class="line">			<span class="attr">success</span>:<span class="literal">false</span>,</div><div class="line">			<span class="attr">err</span>:<span class="string">'token错误！'</span></div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">return</span> next</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">this</span>.session=<span class="keyword">this</span>.session||&#123;&#125;</div><div class="line">	<span class="keyword">this</span>.session.user=user</div><div class="line"></div><div class="line">	<span class="keyword">yield</span> next</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在router中配置，中间件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">router.post(<span class="string">'/u/signup'</span>,App.hasBody,User.signup)</div><div class="line">router.post(<span class="string">'/u/verify'</span>,App.hasBody,User.verify)</div><div class="line"><span class="comment">//登陆才需要token</span></div><div class="line">router.post(<span class="string">'/u/update'</span>,App.hasBody,App.hasToken,User.update)</div></pre></td></tr></table></figure>
<h2 id="接入七牛云"><a href="#接入七牛云" class="headerlink" title="接入七牛云"></a>接入七牛云</h2><p>先创建一个七牛空间，然后在程序里加入qiniu的配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">qiniu:&#123;</div><div class="line">	<span class="string">'AK'</span>:<span class="string">'cMoZ5Ql3sJZ2ZReLyQDjNbIqiaNmAzn54QDzZE_J'</span>,</div><div class="line">	<span class="string">'SK'</span>:<span class="string">'8MCooB-Kb8s9lCAQbhLFwUukmJJiCEn-w483ainh'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>卸载模块，并删除依赖</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm uninstall uuid --save</div></pre></td></tr></table></figure>
<h2 id="接入cloudinary"><a href="#接入cloudinary" class="headerlink" title="接入cloudinary"></a>接入cloudinary</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm i cloudinary --save</div></pre></td></tr></table></figure>
<h3 id="将上传到七牛的视频同步到cloudinary"><a href="#将上传到七牛的视频同步到cloudinary" class="headerlink" title="将上传到七牛的视频同步到cloudinary"></a>将上传到七牛的视频同步到cloudinary</h3><p>将视频上传到七牛是因为，访问七牛快，同步到cloudinary是因为他有将视频和音频合成一个视频的功能。</p>
<p>同步的逻辑很简单，就是客户端将视频上传到了七牛，然后将视频信息发送到我们的服务端，并保持，然后异步同步七牛的视频到cloudinary,同步完了，将他返回的信息在存储到我们的服务器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> body=<span class="keyword">this</span>.request.body</div><div class="line"><span class="keyword">var</span> videoData=body.video</div><div class="line"><span class="keyword">var</span> user=<span class="keyword">this</span>.session.user</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(<span class="string">'create video'</span>)</div><div class="line"><span class="built_in">console</span>.log(videoData)</div><div class="line"></div><div class="line"><span class="keyword">if</span> (!videoData||!videoData.key) &#123;</div><div class="line">	<span class="keyword">this</span>.body=&#123;</div><div class="line">		<span class="attr">success</span>:<span class="literal">false</span>,</div><div class="line">		<span class="attr">err</span>:<span class="string">'视频没有上传成功'</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> next</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//用七牛key查询是否有视频存在</span></div><div class="line"><span class="keyword">var</span> video=<span class="keyword">yield</span> Video.findOne(&#123;</div><div class="line">	<span class="attr">qiniu_key</span>:videoData.key</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">if</span> (!video) &#123;</div><div class="line">	<span class="comment">//创建一个新视频</span></div><div class="line">	video=<span class="keyword">new</span> Video(&#123;</div><div class="line">		<span class="attr">author</span>:user._id,</div><div class="line">		<span class="attr">qiniu_key</span>:videoData.key,</div><div class="line">		<span class="attr">persistentId</span>:videoData.persistentId</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	video=<span class="keyword">yield</span> video.save()</div><div class="line"></div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'new video save'</span>)</div><div class="line">	<span class="built_in">console</span>.log(video)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//将生成的静音视频，同步到cloudinary，然后使用它的音频合成服务</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">var</span> url=config.qiniu.video+video.qiniu_key</div><div class="line">robot.uploadToCloudinary(url)</div><div class="line">	.then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span> (data&amp;&amp;data.public_id) &#123;</div><div class="line">			video.public_id=data.public_id</div><div class="line">			video.detail=data</div><div class="line">			video.save()</div><div class="line">		&#125;</div><div class="line">	&#125;)</div><div class="line"></div><div class="line"><span class="keyword">this</span>.body=&#123;</div><div class="line">	<span class="attr">success</span>:<span class="literal">true</span>,</div><div class="line">	<span class="attr">data</span>:video._id</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在这里就是用了cloudinary的sdk</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">exports.uploadToCloudinary=<span class="function"><span class="keyword">function</span> (<span class="params">url</span>) </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve,reject</span>) </span>&#123;</div><div class="line">		cloudinary.uploader.upload(url,<span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</div><div class="line">			<span class="keyword">if</span> (result&amp;&amp;result.public_id) &#123;</div><div class="line">				resolve(result)</div><div class="line">			&#125; <span class="keyword">else</span>&#123;</div><div class="line">				reject(result)</div><div class="line">			&#125;</div><div class="line">		&#125;,&#123;</div><div class="line">			<span class="attr">resource_type</span>:<span class="string">'video'</span>,</div><div class="line">			<span class="attr">folder</span>:<span class="string">'video'</span></div><div class="line">		&#125;)</div><div class="line">	&#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="屏幕单位"><a href="#屏幕单位" class="headerlink" title="屏幕单位"></a>屏幕单位</h1><p>1英寸(inch)=2.54厘米(cm)</p>
<p>首先我们看iphone6</p>
<h2 id="英寸"><a href="#英寸" class="headerlink" title="英寸"></a>英寸</h2><p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/%E5%AF%B9%E8%A7%92%E7%BA%BF.png" alt=""></p>
<h2 id="点"><a href="#点" class="headerlink" title="点"></a>点</h2><p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/%E7%82%B9.png" alt=""></p>
<h2 id="像素"><a href="#像素" class="headerlink" title="像素"></a>像素</h2><p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/%E5%83%8F%E7%B4%A0.png" alt=""></p>
<h2 id="缩放比ppi"><a href="#缩放比ppi" class="headerlink" title="缩放比ppi"></a>缩放比ppi</h2><p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/ppi.png" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/iphone6-screen.png" alt=""></p>
<h2 id="iphone屏幕尺寸分布"><a href="#iphone屏幕尺寸分布" class="headerlink" title="iphone屏幕尺寸分布"></a>iphone屏幕尺寸分布</h2><p> <img src="http://7qnc6h.com1.z0.glb.clouddn.com/iphone-screen.png" alt=""></p>
<h2 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h2><p>这里的箭头函数相当于java中的函数式编程</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> numberArray=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line"></div><div class="line"><span class="comment">// var newNumberArray=numberArray.map(function(item)&#123;</span></div><div class="line"><span class="comment">//   return item+1</span></div><div class="line"><span class="comment">// &#125;)</span></div><div class="line"></div><div class="line"><span class="comment">//等效于</span></div><div class="line"><span class="keyword">var</span> newNumberArray = numberArray.map(<span class="function"><span class="params">item</span>=&gt;</span>item+<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(newNumberArray)</div></pre></td></tr></table></figure>
<h1 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h1><h2 id="RCTSRWebSocket-m在xcode8-1下报错"><a href="#RCTSRWebSocket-m在xcode8-1下报错" class="headerlink" title="RCTSRWebSocket.m在xcode8.1下报错"></a>RCTSRWebSocket.m在xcode8.1下报错</h2><p><a href="http://www.jianshu.com/p/175e820a1c51" target="_blank" rel="external">http://www.jianshu.com/p/175e820a1c51</a></p>
<h2 id="CodeSign-error-code-signing-is-required-for-product-type-‘Unit-Test-Bundle’-in-SDK-‘iOS-8-1’"><a href="#CodeSign-error-code-signing-is-required-for-product-type-‘Unit-Test-Bundle’-in-SDK-‘iOS-8-1’" class="headerlink" title="CodeSign error: code signing is required for product type ‘Unit Test Bundle’ in SDK ‘iOS 8.1’"></a>CodeSign error: code signing is required for product type ‘Unit Test Bundle’ in SDK ‘iOS 8.1’</h2><p><a href="http://blog.csdn.net/skymingst/article/details/42489097" target="_blank" rel="external">http://blog.csdn.net/skymingst/article/details/42489097</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;效果图&quot;&gt;&lt;a href=&quot;#效果图&quot; class=&quot;headerlink&quot; title=&quot;效果图&quot;&gt;&lt;/a&gt;效果图&lt;/h1&gt;&lt;h1 id=&quot;开发流程&quot;&gt;&lt;a href=&quot;#开发流程&quot; class=&quot;headerlink&quot; title=&quot;开发流程&quot;&gt;&lt;/a&gt;开发流
    
    </summary>
    
      <category term="React Native" scheme="http://i.woblog.cn/categories/React-Native/"/>
    
    
      <category term="React" scheme="http://i.woblog.cn/tags/React/"/>
    
      <category term="React Native" scheme="http://i.woblog.cn/tags/React-Native/"/>
    
      <category term="NodeJS" scheme="http://i.woblog.cn/tags/NodeJS/"/>
    
      <category term="Node" scheme="http://i.woblog.cn/tags/Node/"/>
    
  </entry>
  
  <entry>
    <title>AndroidStudio</title>
    <link href="http://i.woblog.cn/2016/12/01/android-studio/"/>
    <id>http://i.woblog.cn/2016/12/01/android-studio/</id>
    <published>2016-12-01T12:05:09.000Z</published>
    <updated>2017-03-19T14:22:37.664Z</updated>
    
    <content type="html"><![CDATA[<h1 id="常用快捷键"><a href="#常用快捷键" class="headerlink" title="常用快捷键"></a>常用快捷键</h1><h2 id="Log相关"><a href="#Log相关" class="headerlink" title="Log相关"></a>Log相关</h2><h3 id="快速输入TAG"><a href="#快速输入TAG" class="headerlink" title="快速输入TAG"></a>快速输入TAG</h3><p>在方法的外面，类的里面输入logt回车，就会生成</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"MainActivity"</span>;</div><div class="line"></div><div class="line">logd</div><div class="line">Log.d(TAG, <span class="string">"onCreate: "</span>);</div><div class="line"></div><div class="line"><span class="comment">//打印方法参数</span></div><div class="line">logr</div><div class="line">Log.d(TAG, <span class="string">"onCreate() called with: savedInstanceState = ["</span> + savedInstanceState + <span class="string">"]"</span>);</div><div class="line"></div><div class="line"><span class="comment">//打印log.e</span></div><div class="line">loge</div><div class="line">Log.e(TAG, <span class="string">"onRestart: "</span>, <span class="keyword">new</span> Throwable());</div></pre></td></tr></table></figure>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="不区分大小写"><a href="#不区分大小写" class="headerlink" title="不区分大小写"></a>不区分大小写</h3><p>setting-editor-general-code completion-case sensitive completion设置为none</p>
<h3 id="选中代码"><a href="#选中代码" class="headerlink" title="选中代码"></a>选中代码</h3><p>option+↑，↓，多次按↑键会每次增多选择范围</p>
<h3 id="自动完成"><a href="#自动完成" class="headerlink" title="自动完成"></a>自动完成</h3><h3 id="上下移动代码"><a href="#上下移动代码" class="headerlink" title="上下移动代码"></a>上下移动代码</h3><p>command+shift+↑，↓</p>
<h3 id="复制当前行"><a href="#复制当前行" class="headerlink" title="复制当前行"></a>复制当前行</h3><p>command+d</p>
<h3 id="删除代码"><a href="#删除代码" class="headerlink" title="删除代码"></a>删除代码</h3><p>command+delete</p>
<h3 id="光标在方法中快速移动"><a href="#光标在方法中快速移动" class="headerlink" title="光标在方法中快速移动"></a>光标在方法中快速移动</h3><p>control+↑，↓</p>
<p>和mac的默认键有冲突，需要先去掉mac的快捷键</p>
<h3 id="打开一个类"><a href="#打开一个类" class="headerlink" title="打开一个类"></a>打开一个类</h3><p>command+o</p>
<h3 id="打开一个文件"><a href="#打开一个文件" class="headerlink" title="打开一个文件"></a>打开一个文件</h3><p>command+shift+o</p>
<h3 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h3><p>command+b或者common+鼠标单击</p>
<h3 id="查看一个类的父类"><a href="#查看一个类的父类" class="headerlink" title="查看一个类的父类"></a>查看一个类的父类</h3><p>command+u</p>
<h3 id="查看一个方法在哪里调用了"><a href="#查看一个方法在哪里调用了" class="headerlink" title="查看一个方法在哪里调用了"></a>查看一个方法在哪里调用了</h3><p>control+option+h</p>
<h3 id="快捷查看一个方法的定义"><a href="#快捷查看一个方法的定义" class="headerlink" title="快捷查看一个方法的定义"></a>快捷查看一个方法的定义</h3><p>mac中没有快捷键，view-quick difinition</p>
<h3 id="查看类的集成关系"><a href="#查看类的集成关系" class="headerlink" title="查看类的集成关系"></a>查看类的集成关系</h3><p>control+h</p>
<h3 id="查找字符使用"><a href="#查找字符使用" class="headerlink" title="查找字符使用"></a>查找字符使用</h3><p>option+f7</p>
<h3 id="光标的前进后退"><a href="#光标的前进后退" class="headerlink" title="光标的前进后退"></a>光标的前进后退</h3><p>command+option+←，→</p>
<h3 id="最近使用文件"><a href="#最近使用文件" class="headerlink" title="最近使用文件"></a>最近使用文件</h3><p>command+e</p>
<p>### </p>
<p>### </p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;常用快捷键&quot;&gt;&lt;a href=&quot;#常用快捷键&quot; class=&quot;headerlink&quot; title=&quot;常用快捷键&quot;&gt;&lt;/a&gt;常用快捷键&lt;/h1&gt;&lt;h2 id=&quot;Log相关&quot;&gt;&lt;a href=&quot;#Log相关&quot; class=&quot;headerlink&quot; title=&quot;Log
    
    </summary>
    
      <category term="Android" scheme="http://i.woblog.cn/categories/Android/"/>
    
    
      <category term="Android" scheme="http://i.woblog.cn/tags/Android/"/>
    
      <category term="AndroidStudio" scheme="http://i.woblog.cn/tags/AndroidStudio/"/>
    
  </entry>
  
  <entry>
    <title>MongoDB</title>
    <link href="http://i.woblog.cn/2016/11/27/mongodb/"/>
    <id>http://i.woblog.cn/2016/11/27/mongodb/</id>
    <published>2016-11-27T00:30:38.000Z</published>
    <updated>2017-03-19T14:22:37.668Z</updated>
    
    <content type="html"><![CDATA[<h1 id="为什么学mongodb"><a href="#为什么学mongodb" class="headerlink" title="为什么学mongodb"></a>为什么学mongodb</h1><p>开源，免费，社区技术支持到位</p>
<h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><h3 id="无标结构限制"><a href="#无标结构限制" class="headerlink" title="无标结构限制"></a>无标结构限制</h3><ol>
<li>没有任何表结构，每条记录的结构可以完全不同</li>
<li>业务开发方便</li>
<li>SQL数据库需要事先定义表结构在使用</li>
</ol>
<h3 id="完成的索引支持"><a href="#完成的索引支持" class="headerlink" title="完成的索引支持"></a>完成的索引支持</h3><p>redis只有key-value，hbase的二级索引还需要自己实现</p>
<ol>
<li>单键索引，多键索引</li>
<li>数组索引</li>
<li>全文索引</li>
<li>地理位置索引</li>
</ol>
<h3 id="方便的冗余和扩展"><a href="#方便的冗余和扩展" class="headerlink" title="方便的冗余和扩展"></a>方便的冗余和扩展</h3><ol>
<li>复制集保证数据安全</li>
<li>分片扩展数据规模</li>
</ol>
<h3 id="良好的支持"><a href="#良好的支持" class="headerlink" title="良好的支持"></a>良好的支持</h3><ol>
<li>完善的文档</li>
<li>齐全的驱动支持</li>
</ol>
<h2 id="相关工具"><a href="#相关工具" class="headerlink" title="相关工具"></a>相关工具</h2><p>MongoDB：64Linux</p>
<p>MongoDB版本：2.6.5</p>
<p>ssh：xshell</p>
<p>文本编辑器：vim,sublime</p>
<h1 id="常用学习网站"><a href="#常用学习网站" class="headerlink" title="常用学习网站"></a>常用学习网站</h1><p>官网：<a href="https://www.mongodb.com/" target="_blank" rel="external">https://www.mongodb.com/</a></p>
<p>github</p>
<p>jira:<a href="https://jira.mongodb.org/secure/Dashboard.jspa" target="_blank" rel="external">https://jira.mongodb.org/secure/Dashboard.jspa</a></p>
<p><a href="https://groups.google.com/forum/#!forum/mongodb-user" target="_blank" rel="external">https://groups.google.com/forum/#!forum/mongodb-user</a></p>
<p>mongodb中文社区：<a href="http://www.mongoing.com/" target="_blank" rel="external">http://www.mongoing.com/</a></p>
<p>mongodb中文文档：<a href="http://docs.mongoing.com/manual-zh/" target="_blank" rel="external">http://docs.mongoing.com/manual-zh/</a></p>
<h1 id="数据库概念"><a href="#数据库概念" class="headerlink" title="数据库概念"></a>数据库概念</h1><p>有组织的存放数据</p>
<p>按照不同的需求进行查询</p>
<h1 id="数据库分类"><a href="#数据库分类" class="headerlink" title="数据库分类"></a>数据库分类</h1><p>SQL数据库：Oracle,Mysql</p>
<p>NoSQl数据库(Not Only SQL)：Redis,MongoDB</p>
<table>
<thead>
<tr>
<th>SQL数据库</th>
<th>NoSQL数据库</th>
</tr>
</thead>
<tbody>
<tr>
<td>实时移植性</td>
<td>有延迟</td>
</tr>
<tr>
<td>实务</td>
<td>默认不支持</td>
</tr>
<tr>
<td>多表联合查询</td>
<td>没有，提供更好的性能</td>
</tr>
</tbody>
</table>
<h1 id="安装Mongodb"><a href="#安装Mongodb" class="headerlink" title="安装Mongodb"></a>安装Mongodb</h1><h2 id="mac"><a href="#mac" class="headerlink" title="mac"></a>mac</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">brew update</div><div class="line">brew install mongodb</div></pre></td></tr></table></figure>
<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><p>mongod：数据库执行程序</p>
<p>mongo：连接mongo数据库的客户端</p>
<p>mongoimport,mongoexport:数据库的导入导出</p>
<p>mongodump，mongorestore:也是导入导出，只是导出的是二进制文件，一般用来做数据的备份和恢复</p>
<p>mongooplog:日志</p>
<p>mongostat:用于查看数据库的状态</p>
<h1 id="搭建一个简单的数据库服务器"><a href="#搭建一个简单的数据库服务器" class="headerlink" title="搭建一个简单的数据库服务器"></a>搭建一个简单的数据库服务器</h1><ol>
<li>创建一个目录，用来存放数据库相关的文件</li>
<li>创建data，用来存放数据库文件</li>
<li>创建log，用来存放数据库日志文件</li>
<li>创建bin，存放数据库可执行文件</li>
<li>创建conf，存放数据库配置文件</li>
</ol>
<h2 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h2><p>mongod.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">port=12345</div><div class="line">dbpath=data</div><div class="line">logpath=log/mongod.log</div><div class="line">fork=true</div></pre></td></tr></table></figure>
<h2 id="启动数据库服务器"><a href="#启动数据库服务器" class="headerlink" title="启动数据库服务器"></a>启动数据库服务器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongod -f conf/mongod.conf</div></pre></td></tr></table></figure>
<p>如果看到如下信息表示服务区已成功开启</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">about to fork child process, waiting until server is ready for connections.</div><div class="line">forked process: 23963</div><div class="line">child process started successfully, parent exiting</div></pre></td></tr></table></figure>
<p>启动成功后可以在data目录查看到一些文件，并且日志文件也已经生成了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tail log/mongod.log</div></pre></td></tr></table></figure>
<h1 id="连接mongo"><a href="#连接mongo" class="headerlink" title="连接mongo"></a>连接mongo</h1><h2 id="使用mongo命令"><a href="#使用mongo命令" class="headerlink" title="使用mongo命令"></a>使用mongo命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongo 127.0.0.1:12345/test</div></pre></td></tr></table></figure>
<p>数据库地址：127.0.0.1</p>
<p>端口：12345</p>
<p>数据库名：test</p>
<h1 id="关闭mongo服务"><a href="#关闭mongo服务" class="headerlink" title="关闭mongo服务"></a>关闭mongo服务</h1><p>直接kill相应的进程，15，或不带参数，不能使用9</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">use admin</div><div class="line">db.shutdownServer()</div></pre></td></tr></table></figure>
<h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><p>show dbs：查看数据库</p>
<p>use 数据库名：选择数据库，切换前不需要数据库一定存在</p>
<p>db.dropDatabase():删除数据库</p>
<p>show collections：显示集合，相当于一张表</p>
<h2 id="增删改查"><a href="#增删改查" class="headerlink" title="增删改查"></a>增删改查</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">db.test_collection.insert(&#123;x:&apos;1&apos;&#125;)</div><div class="line"></div><div class="line">//可以自定指定id,但不能重复，重复将报错</div><div class="line">db.test_collection.insert(&#123;x:&apos;1&apos;,_id:1&#125;)</div><div class="line"></div><div class="line">//默认返回所有</div><div class="line">db.test_collection.find()</div><div class="line"></div><div class="line">//指定条件</div><div class="line">db.test_collection.find(&#123;x:&apos;1&apos;&#125;)</div><div class="line"></div><div class="line">//通过for循环，插入多条数据</div><div class="line">for(i=3;i&lt;100;i++)db.test_collection.insert(&#123;x:i&#125;)</div><div class="line"></div><div class="line">//统计数据条数</div><div class="line">db.test_collection.find().count()</div><div class="line"></div><div class="line">//跳过3条，限制返回2条，按照x升排序</div><div class="line">db.test_collection.find().skip(3).limit(2).sort(&#123;x:1&#125;)</div><div class="line"></div><div class="line">//将x=1的第一条数据更新为x=888,如果这条数据原来还有自定，就会覆盖为只有x字段</div><div class="line">db.test_collection.update(&#123;x:&apos;1&apos;&#125;,&#123;x:&apos;888&apos;&#125;)</div><div class="line"></div><div class="line">//更新指定字段,只更新z字段，其他的字段不变</div><div class="line">db.test_collection.update(&#123;y:100&#125;,&#123;$set:&#123;z:10&#125;&#125;)</div><div class="line"></div><div class="line">//更新一条数据，不存在则创建</div><div class="line">db.test_collection.update(&#123;x:388&#125;,&#123;x:488&#125;,true)</div><div class="line"></div><div class="line">//更新多条数据，只能用来使用set符号</div><div class="line">db.test_collection.update(&#123;a:1&#125;,&#123;$set:&#123;a:2&#125;&#125;,false,true)</div><div class="line"></div><div class="line">//删除，默认删除所有匹配条件的数据</div><div class="line">db.test_collection.remove(&#123;a:2&#125;)</div><div class="line"></div><div class="line">//删除集合</div><div class="line">db.test_collection.drop()</div></pre></td></tr></table></figure>
<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><p>索引可以重复创建，对于已创建的索引重复创建，会直接返回成功。</p>
<h2 id="查看索引"><a href="#查看索引" class="headerlink" title="查看索引"></a>查看索引</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.c1.getIndexes()</div></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">	&#123;</div><div class="line">		&quot;v&quot; : 1,</div><div class="line">		&quot;key&quot; : &#123;</div><div class="line">			&quot;_id&quot; : 1 //索引键</div><div class="line">		&#125;,</div><div class="line">		&quot;name&quot; : &quot;_id_&quot;, //名称</div><div class="line">		&quot;ns&quot; : &quot;test.c1&quot; //数据库.表名</div><div class="line">	&#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<h2 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//键:排序方法，-1降序，1正序</div><div class="line">db.c1.ensureIndex(&#123;a:1&#125;)</div></pre></td></tr></table></figure>
<h2 id="id索引"><a href="#id索引" class="headerlink" title="_id索引"></a>_id索引</h2><p>他是绝大多数集合默认建立的索引。对于新插入的数据，都会自动生成，也是唯一索引。</p>
<h3 id="单键"><a href="#单键" class="headerlink" title="单键"></a>单键</h3><p>是最普通的索引，不会自动创建，比如：这样一条数据{a:1,y:2}，如果建立a的索引，就可以提高以a字段查询的效率。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.c1.ensureIndex(&#123;a:1&#125;)</div></pre></td></tr></table></figure>
<h2 id="多键索引"><a href="#多键索引" class="headerlink" title="多键索引"></a>多键索引</h2><p>创建方式和单键相同，区别是字段的值，多键具有多个值，如：数组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.c1.insert(&#123;a:[1,2,3]&#125;)</div></pre></td></tr></table></figure>
<p>插入这条数据后，如果a创建了单键索引，那么对于这条数据就是多键索引。</p>
<h2 id="复合索引"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引</h2><p>当查询条件不止一个时，比如:这条数据{a:1,b:2,c:3}，如果需要同时查询a和b的值，就可以就需要使用复合索引。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.c1.ensureIndex(&#123;a:1,b:1&#125;)</div></pre></td></tr></table></figure>
<p>获取索引后可以看到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;v&quot; : 1,</div><div class="line">	&quot;key&quot; : &#123;</div><div class="line">		&quot;a&quot; : 1,</div><div class="line">		&quot;b&quot; : 1</div><div class="line">	&#125;,</div><div class="line">	&quot;name&quot; : &quot;a_1_b_1&quot;,</div><div class="line">	&quot;ns&quot; : &quot;test.c1&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="过期索引"><a href="#过期索引" class="headerlink" title="过期索引"></a>过期索引</h2><p>在一段时间后会过期的索引，过期后，相应的数据会被删除。适合存储登陆信息，日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//在time字段上创建了一个过期索引</div><div class="line">db.c1.ensureIndex(&#123;time:1&#125;,&#123;expireAfterSeconds:30&#125;)</div><div class="line"></div><div class="line">//这样插入一条数据，过期后就会删除，但是默认60秒扫描一次，所以最低也得60秒</div><div class="line">db.c1.insert(&#123;time:new Date()&#125; )</div></pre></td></tr></table></figure>
<p>注意：</p>
<ol>
<li>存储过期索引字段的值必须要是时间类型，也就是ISODate或者ISODate数组，不能使用时间戳，否则不能自动删除，但插入数据不会报错。</li>
<li>如果是ISODate数组，最只要满足最小的时间就删除</li>
<li>不能是复合索引</li>
<li>删除事件不精确，删除程序60s执行一次，删除也需要一定的时间，所以有误差</li>
</ol>
<h2 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h2><p>对于字符串，字符串数组可以创建全文索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">db.articles.ensureIndex(&#123;key:&quot;text&quot;&#125;)</div><div class="line"></div><div class="line">db.articles.ensureIndex(&#123;key_1:&quot;text&quot;,key_2:&quot;text&quot;&#125;)</div><div class="line"></div><div class="line">//将articles集合的每个字段都建立全文索引</div><div class="line">db.articles.ensureIndex(&#123;&quot;$**&quot;:&quot;text&quot;&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.articles.ensureIndex(&#123;&quot;article&quot;:&quot;text&quot;&#125;)</div></pre></td></tr></table></figure>
<h3 id="使用全文索引查询"><a href="#使用全文索引查询" class="headerlink" title="使用全文索引查询"></a>使用全文索引查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">db.articles.find(&#123;$text:&#123;$search:&quot;aa&quot;&#125;&#125;) //aa bb,cc aa bb</div><div class="line">db.articles.find(&#123;$text:&#123;$search:&quot;aa bb cc&quot;&#125;&#125;) //aa||bb||cc</div><div class="line">db.articles.find(&#123;$text:&#123;$search:&quot;aa bb -cc&quot;&#125;&#125;) //(aa||bb) &amp;&amp; !cc</div><div class="line">db.articles.find(&#123;$text:&#123;$search:&quot;\&quot;aa\&quot; \&quot;bb\&quot; \&quot;cc\&quot;&quot;&#125;&#125;) //aa &amp;&amp; bb &amp;&amp; cc,将每个关键词用引号</div><div class="line"></div><div class="line">db.articles.find(&#123;$text:&#123;$search:&apos;&quot;aa&quot; &quot;bb&quot; &quot;cc&quot;&apos;&#125;&#125;) //与上面等效</div><div class="line">db.articles.find(&#123;$text:&#123;$search:&quot;&apos;aa&apos; &apos;bb&apos; &apos;cc&apos;&quot;&#125;&#125;) //同上</div></pre></td></tr></table></figure>
<h3 id="全文查询相似度"><a href="#全文查询相似度" class="headerlink" title="全文查询相似度"></a>全文查询相似度</h3><p>使用$meta操作符，比如：{score:{$meta:”textScore”}}</p>
<p>写在查询条件后面就可以返还相似度score字段(该字段名字可以自定义)，同时还可以使用sort排序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.articles.find(&#123;$text:&#123;$search:&quot;aa bb&quot;&#125;&#125;,&#123;score:&#123;$meta:&quot;textScore&quot;&#125;&#125;)</div></pre></td></tr></table></figure>
<p>返回的数据</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123; <span class="attr">"_id"</span> : ObjectId(<span class="string">"583ad588d1671746663db3a0"</span>), <span class="attr">"article"</span> : <span class="string">"aa bb cc dd ee"</span>, <span class="attr">"score"</span> : <span class="number">1.2</span> &#125;</div><div class="line">&#123; <span class="attr">"_id"</span> : ObjectId(<span class="string">"583ad59ad1671746663db3a2"</span>), <span class="attr">"article"</span> : <span class="string">"aa bb cc hh dd"</span>, <span class="attr">"score"</span> : <span class="number">1.2</span> &#125;</div><div class="line">&#123; <span class="attr">"_id"</span> : ObjectId(<span class="string">"583ad591d1671746663db3a1"</span>), <span class="attr">"article"</span> : <span class="string">"aa bb rr gg"</span>, <span class="attr">"score"</span> : <span class="number">1.25</span> &#125;</div><div class="line">&#123; <span class="attr">"_id"</span> : ObjectId(<span class="string">"583ad85ad1671746663db3a3"</span>), <span class="attr">"article"</span> : <span class="string">"aa bb"</span>, <span class="attr">"score"</span> : <span class="number">1.5</span> &#125;</div></pre></td></tr></table></figure>
<p>按照相似度从大到小排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.articles.find(&#123;$text:&#123;$search:&quot;aa bb&quot;&#125;&#125;,&#123;score1:&#123;$meta:&quot;textScore&quot;&#125;&#125;).sort(&#123;score1:&#123;$meta:&quot;textScore&quot;&#125;&#125;)</div></pre></td></tr></table></figure>
<p>可以看到最大的值排到最前</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583ad85ad1671746663db3a3&quot;), &quot;article&quot; : &quot;aa bb&quot;, &quot;score1&quot; : 1.5 &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583ad591d1671746663db3a1&quot;), &quot;article&quot; : &quot;aa bb rr gg&quot;, &quot;score1&quot; : 1.25 &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583ad588d1671746663db3a0&quot;), &quot;article&quot; : &quot;aa bb cc dd ee&quot;, &quot;score1&quot; : 1.2 &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583ad59ad1671746663db3a2&quot;), &quot;article&quot; : &quot;aa bb cc hh dd&quot;, &quot;score1&quot; : 1.2 &#125;</div></pre></td></tr></table></figure>
<h3 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h3><p>每次查询只能指定一个$text</p>
<p>$text查询不能出现在nor查询中，也就是说不能查询不包含的某个值的数据</p>
<p>查询中如果包含$text,hint不再起作用，hint可以指定使用哪个索引</p>
<h2 id="索引属性"><a href="#索引属性" class="headerlink" title="索引属性"></a>索引属性</h2><p>名字，唯一性，稀疏性，是否定时删除，可以使用如下方式指定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.articles.ensureIndex(&#123;&#125;,&#123;属性名：值&#125;)</div></pre></td></tr></table></figure>
<h3 id="name名称"><a href="#name名称" class="headerlink" title="name名称"></a>name名称</h3><p>默认是键_排序方向</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//指定索引名称为normal_index</div><div class="line">db.c2.ensureIndex(&#123;a:1,b:-1,c:1&#125;,&#123;name:&quot;normal_index&quot;&#125;)</div></pre></td></tr></table></figure>
<h3 id="unique唯一性"><a href="#unique唯一性" class="headerlink" title="unique唯一性"></a>unique唯一性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//如果为true，有相同的值，则创建不成功</div><div class="line">db.c2.ensureIndex(&#123;a:1&#125;,&#123;unique:true/false&#125;)</div></pre></td></tr></table></figure>
<h2 id="稀疏性"><a href="#稀疏性" class="headerlink" title="稀疏性"></a>稀疏性</h2><p>默认创建的不稀疏的。例如：为x字段创建了索引，但插入的数据不存在x，默认也会为这条数据创建索引，如果不希望创建，就可以指定sparse:true。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.c2.createIndex(&#123;a:1&#125;,&#123;sparse:true/false&#125;)</div></pre></td></tr></table></figure>
<p>注意：不能再稀疏索引上查找不存在的某个字段的记录</p>
<p>查找不存在字段b的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.c2.find(&#123;b:&#123;$exists:false&#125;&#125;)</div></pre></td></tr></table></figure>
<p>强制指定使用某个索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.c2.find(&#123;b:&#123;$exists:false&#125;&#125;).hint(&quot;b_1&quot;)</div></pre></td></tr></table></figure>
<h2 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h2><p>指定索引名称就行了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">db.c2.dropIndex(&quot;normal_index&quot;)</div><div class="line"></div><div class="line">//删除所有索引，_id索引不能删除</div><div class="line">db.c2.dropIndexes()</div></pre></td></tr></table></figure>
<h2 id="地理位置索引"><a href="#地理位置索引" class="headerlink" title="地理位置索引"></a>地理位置索引</h2><p>将一些点的位置存储在mongoDB中，创建索引后，可以按照位置来超照其他点，有两种，他们的却别是计算距离上的区别：</p>
<p>2d索引：用于存储和查找平面上的点</p>
<p>2dsphere索引：用于存储和查找球面的点</p>
<p>查找方式：</p>
<ol>
<li>查找距离某个点一定距离内的点</li>
<li>查找包含在某个区域内的点</li>
</ol>
<h3 id="2d索引"><a href="#2d索引" class="headerlink" title="2d索引"></a>2d索引</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.location.ensureIndex(&#123;key:&quot;2d&quot;&#125;)</div></pre></td></tr></table></figure>
<p>位置的表示方式是：经纬度[经度,维度]，取值范围,经度[-180,180]，维度[-90,90]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//创建一个position字段， 用来存储经纬度</div><div class="line">db.location.ensureIndex(&#123;position:&quot;2d&quot;&#125;)</div><div class="line"></div><div class="line">//插入测试数据</div><div class="line">db.location.insert(&#123;position:[1,2]&#125;)</div><div class="line">db.location.insert(&#123;position:[3,2]&#125;)</div><div class="line">db.location.insert(&#123;position:[100,2]&#125;)</div><div class="line">db.location.insert(&#123;position:[100,20]&#125;)</div><div class="line">db.location.insert(&#123;position:[180,50]&#125;)</div><div class="line">db.location.insert(&#123;position:[180,100]&#125;)</div></pre></td></tr></table></figure>
<h4 id="查询方式"><a href="#查询方式" class="headerlink" title="查询方式"></a>查询方式</h4><h5 id="near"><a href="#near" class="headerlink" title="near"></a>near</h5><p>查询距离某个点最近的点，不支持$minDistance</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">//默认返回100个</div><div class="line">db.location.find(&#123;position:&#123;$near:[1,1]&#125;&#125;)</div><div class="line"></div><div class="line">//返回</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefba06570f2078e557bb&quot;), &quot;position&quot; : [ 1, 2 ] &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefbc06570f2078e557bc&quot;), &quot;position&quot; : [ 3, 2 ] &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefbf06570f2078e557bd&quot;), &quot;position&quot; : [ 100, 2 ] &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefc206570f2078e557be&quot;), &quot;position&quot; : [ 100, 20 ] &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefc806570f2078e557bf&quot;), &quot;position&quot; : [ 180, 50 ] &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefcb06570f2078e557c0&quot;), &quot;position&quot; : [ 180, 100 ] &#125;</div><div class="line"></div><div class="line">//限制最远距离</div><div class="line">db.location.find(&#123;position:&#123;$near:[1,1],$maxDistance:10&#125;&#125;)</div><div class="line"></div><div class="line">//返回</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefba06570f2078e557bb&quot;), &quot;position&quot; : [ 1, 2 ] &#125;</div><div class="line">&#123; &quot;_id&quot; : ObjectId(&quot;583aefbc06570f2078e557bc&quot;), &quot;position&quot; : [ 3, 2 ] &#125;</div></pre></td></tr></table></figure>
<p>$geoWithin：查询包含在某个形状中的点</p>
<p>形状的表示：</p>
<p>$box:矩形，{$box:[[x1,y1],[x2,y2]]}</p>
<p>$center:圆形，{$center:[x,y],r}</p>
<p>$polygon:多边形，${polygon:[x1,y1],[x2,y2],[x3,y3]}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//查询在1,2:4,4中的点</div><div class="line">db.location.find(&#123;position:&#123;$geoWithin:&#123;$box:[[1,2],[4,4]]&#125;&#125;&#125;)</div><div class="line"></div><div class="line">//查询在圆心为1，1半径为5中的点</div><div class="line">db.location.find(&#123;position:&#123;$geoWithin:&#123;$center:[[1,1],5]&#125;&#125;&#125;)</div><div class="line"></div><div class="line">//查询在多边形中的点</div><div class="line">db.location.find(&#123;position:&#123;$geoWithin:&#123;$polygon:[[1,1],[2,3],[4,5],[100,50]]&#125;&#125;&#125;)</div></pre></td></tr></table></figure>
<h5 id="geoNear"><a href="#geoNear" class="headerlink" title="geoNear"></a>geoNear</h5><p>相当于是near的升级版。</p>
<p>在mongodb中可以使用runCommand执行一些命令，geoNear的使用方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">db.runCommand(</div><div class="line">&#123;</div><div class="line">	genoNear:集合名,</div><div class="line">	near:[x,y],</div><div class="line">	minDistance:值, //2d索引无效</div><div class="line">	maxDistance:值,</div><div class="line">	num:返回的条数</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.runCommand(&#123;geoNear:&quot;location&quot;,near:[1,2],maxDistance:10,num:3&#125;)</div></pre></td></tr></table></figure>
<p>返回：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;waitedMS&quot; : NumberLong(0),</div><div class="line">	&quot;results&quot; : [</div><div class="line">		&#123;</div><div class="line">			&quot;dis&quot; : 0,</div><div class="line">			&quot;obj&quot; : &#123;</div><div class="line">				&quot;_id&quot; : ObjectId(&quot;583aefba06570f2078e557bb&quot;),</div><div class="line">				&quot;position&quot; : [</div><div class="line">					1,</div><div class="line">					2</div><div class="line">				]</div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		&#123;</div><div class="line">			&quot;dis&quot; : 2, //距离我们制定的点，多远</div><div class="line">			&quot;obj&quot; : &#123; //真实的数据</div><div class="line">				&quot;_id&quot; : ObjectId(&quot;583aefbc06570f2078e557bc&quot;),</div><div class="line">				&quot;position&quot; : [</div><div class="line">					3,</div><div class="line">					2</div><div class="line">				]</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	],</div><div class="line">	&quot;stats&quot; : &#123;</div><div class="line">		&quot;nscanned&quot; : 41,</div><div class="line">		&quot;objectsLoaded&quot; : 2,</div><div class="line">		&quot;avgDistance&quot; : 1, //平均距离</div><div class="line">		&quot;maxDistance&quot; : 2, //最大距离</div><div class="line">		&quot;time&quot; : 4</div><div class="line">	&#125;,</div><div class="line">	&quot;ok&quot; : 1</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2dsphere索引"><a href="#2dsphere索引" class="headerlink" title="2dsphere索引"></a>2dsphere索引</h3><p>球面地理位置索引。创建方式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">db.location.ensureIndex(&#123;position:&quot;2dsphere&quot;&#125;)</div></pre></td></tr></table></figure>
<p>位置表示方式为：GeoJSON，可以描述为一个点，一条直线，多边形</p>
<p>//TODO</p>
<h1 id="索引分析"><a href="#索引分析" class="headerlink" title="索引分析"></a>索引分析</h1><p>好处：加快相关字段查询</p>
<p>坏处：增加磁盘空间消耗，降低写入性能</p>
<h2 id="如何评判索引构建情况"><a href="#如何评判索引构建情况" class="headerlink" title="如何评判索引构建情况"></a>如何评判索引构建情况</h2><h3 id="mongostat工具"><a href="#mongostat工具" class="headerlink" title="mongostat工具"></a>mongostat工具</h3><p>用来查看mongodb状态的工具，使用方式</p>
<p>与索引相关的字段为：idx miss百分比,太高有性能影响</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongostat -h 127.0.0.1:12345</div></pre></td></tr></table></figure>
<p>其中insert字段表示：插入数据</p>
<p>那怎么测试这值能，可以卡两个命令窗口，一边插入输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//插入10万条</div><div class="line">for(i=0;i&lt;100000;i++)db.c2.insert(&#123;x:i&#125;)</div></pre></td></tr></table></figure>
<p>另一个命令窗口查看状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mongostat -h 127.0.0.1:12345</div></pre></td></tr></table></figure>
<p>返回：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">insert query update delete getmore command % dirty % used flushes vsize   res qr|qw ar|aw netIn netOut conn                      time</div><div class="line">  2531    *0     *0     *0       0     1|0     0.0    0.1       0 2.46G 13.0M   0|0   0|0  291k   122k    2 2016-11-27T23:53:57+08:00</div><div class="line">  2995    *0     *0     *0       0     1|0     0.1    0.1       0 2.46G 14.0M   0|0   0|0  344k   141k    2 2016-11-27T23:53:58+08:00</div><div class="line">  2873    *0     *0     *0       0     1|0     0.1    0.1       0 2.46G 15.0M   0|0   0|0  330k   136k    2 2016-11-27T23:53:59+08:00</div></pre></td></tr></table></figure>
<p>可以看到insert字段的值，改变了。</p>
<h3 id="profile集合"><a href="#profile集合" class="headerlink" title="profile集合"></a>profile集合</h3><p>慢操作值</p>
<p>注意：推荐只在开发，和测试阶段或上线观察阶段使用。</p>
<h3 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h3><p>可以在配置文件中使用verbose=vvvvv配置，v越多越详细。</p>
<h3 id="explain分析"><a href="#explain分析" class="headerlink" title="explain分析"></a>explain分析</h3><p><a href="http://www.cnblogs.com/c-abc/p/6023824.html" target="_blank" rel="external">http://www.cnblogs.com/c-abc/p/6023824.html</a></p>
<p>可以查看一个查询的详细信息，比如：耗时</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">db.c2.find(&#123;x:10000&#125;).explain() //2x</div><div class="line">db.c2.find(&#123;x:10000&#125;).explain(&quot;executionStats&quot;) //3x</div></pre></td></tr></table></figure>
<p>未创建索引时executionTimeMillis为51毫秒</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;queryPlanner&quot; : &#123;</div><div class="line">		&quot;plannerVersion&quot; : 1,</div><div class="line">		&quot;namespace&quot; : &quot;test.c2&quot;,</div><div class="line">		&quot;indexFilterSet&quot; : false,</div><div class="line">		&quot;parsedQuery&quot; : &#123;</div><div class="line">			&quot;x&quot; : &#123;</div><div class="line">				&quot;$eq&quot; : 10000</div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		&quot;winningPlan&quot; : &#123;</div><div class="line">			&quot;stage&quot; : &quot;COLLSCAN&quot;,</div><div class="line">			&quot;filter&quot; : &#123;</div><div class="line">				&quot;x&quot; : &#123;</div><div class="line">					&quot;$eq&quot; : 10000</div><div class="line">				&#125;</div><div class="line">			&#125;,</div><div class="line">			&quot;direction&quot; : &quot;forward&quot;</div><div class="line">		&#125;,</div><div class="line">		&quot;rejectedPlans&quot; : [ ]</div><div class="line">	&#125;,</div><div class="line">	&quot;executionStats&quot; : &#123;</div><div class="line">		&quot;executionSuccess&quot; : true,</div><div class="line">		&quot;nReturned&quot; : 1,</div><div class="line">		&quot;executionTimeMillis&quot; : 51,</div><div class="line">		&quot;totalKeysExamined&quot; : 0,</div><div class="line">		&quot;totalDocsExamined&quot; : 100014,</div><div class="line">		&quot;executionStages&quot; : &#123;</div><div class="line">			&quot;stage&quot; : &quot;COLLSCAN&quot;,</div><div class="line">			&quot;filter&quot; : &#123;</div><div class="line">				&quot;x&quot; : &#123;</div><div class="line">					&quot;$eq&quot; : 10000</div><div class="line">				&#125;</div><div class="line">			&#125;,</div><div class="line">			&quot;nReturned&quot; : 1,</div><div class="line">			&quot;executionTimeMillisEstimate&quot; : 50,</div><div class="line">			&quot;works&quot; : 100016,</div><div class="line">			&quot;advanced&quot; : 1,</div><div class="line">			&quot;needTime&quot; : 100014,</div><div class="line">			&quot;needYield&quot; : 0,</div><div class="line">			&quot;saveState&quot; : 781,</div><div class="line">			&quot;restoreState&quot; : 781,</div><div class="line">			&quot;isEOF&quot; : 1,</div><div class="line">			&quot;invalidates&quot; : 0,</div><div class="line">			&quot;direction&quot; : &quot;forward&quot;,</div><div class="line">			&quot;docsExamined&quot; : 100014</div><div class="line">		&#125;</div><div class="line">	&#125;,</div><div class="line">	&quot;serverInfo&quot; : &#123;</div><div class="line">		&quot;host&quot; : &quot;rmp.local&quot;,</div><div class="line">		&quot;port&quot; : 12345,</div><div class="line">		&quot;version&quot; : &quot;3.2.10&quot;,</div><div class="line">		&quot;gitVersion&quot; : &quot;79d9b3ab5ce20f51c272b4411202710a082d0317&quot;</div><div class="line">	&#125;,</div><div class="line">	&quot;ok&quot; : 1</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>创建索引后，为0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	&quot;queryPlanner&quot; : &#123;</div><div class="line">		&quot;plannerVersion&quot; : 1,</div><div class="line">		&quot;namespace&quot; : &quot;test.c2&quot;,</div><div class="line">		&quot;indexFilterSet&quot; : false,</div><div class="line">		&quot;parsedQuery&quot; : &#123;</div><div class="line">			&quot;x&quot; : &#123;</div><div class="line">				&quot;$eq&quot; : 10000</div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		&quot;winningPlan&quot; : &#123;</div><div class="line">			&quot;stage&quot; : &quot;FETCH&quot;,</div><div class="line">			&quot;inputStage&quot; : &#123;</div><div class="line">				&quot;stage&quot; : &quot;IXSCAN&quot;,</div><div class="line">				&quot;keyPattern&quot; : &#123;</div><div class="line">					&quot;x&quot; : 1</div><div class="line">				&#125;,</div><div class="line">				&quot;indexName&quot; : &quot;x_1&quot;,</div><div class="line">				&quot;isMultiKey&quot; : false,</div><div class="line">				&quot;isUnique&quot; : false,</div><div class="line">				&quot;isSparse&quot; : false,</div><div class="line">				&quot;isPartial&quot; : false,</div><div class="line">				&quot;indexVersion&quot; : 1,</div><div class="line">				&quot;direction&quot; : &quot;forward&quot;,</div><div class="line">				&quot;indexBounds&quot; : &#123;</div><div class="line">					&quot;x&quot; : [</div><div class="line">						&quot;[10000.0, 10000.0]&quot;</div><div class="line">					]</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;,</div><div class="line">		&quot;rejectedPlans&quot; : [ ]</div><div class="line">	&#125;,</div><div class="line">	&quot;executionStats&quot; : &#123;</div><div class="line">		&quot;executionSuccess&quot; : true,</div><div class="line">		&quot;nReturned&quot; : 1,</div><div class="line">		&quot;executionTimeMillis&quot; : 0,</div><div class="line">		&quot;totalKeysExamined&quot; : 1,</div><div class="line">		&quot;totalDocsExamined&quot; : 1,</div><div class="line">		&quot;executionStages&quot; : &#123;</div><div class="line">			&quot;stage&quot; : &quot;FETCH&quot;,</div><div class="line">			&quot;nReturned&quot; : 1,</div><div class="line">			&quot;executionTimeMillisEstimate&quot; : 0,</div><div class="line">			&quot;works&quot; : 2,</div><div class="line">			&quot;advanced&quot; : 1,</div><div class="line">			&quot;needTime&quot; : 0,</div><div class="line">			&quot;needYield&quot; : 0,</div><div class="line">			&quot;saveState&quot; : 0,</div><div class="line">			&quot;restoreState&quot; : 0,</div><div class="line">			&quot;isEOF&quot; : 1,</div><div class="line">			&quot;invalidates&quot; : 0,</div><div class="line">			&quot;docsExamined&quot; : 1,</div><div class="line">			&quot;alreadyHasObj&quot; : 0,</div><div class="line">			&quot;inputStage&quot; : &#123;</div><div class="line">				&quot;stage&quot; : &quot;IXSCAN&quot;,</div><div class="line">				&quot;nReturned&quot; : 1,</div><div class="line">				&quot;executionTimeMillisEstimate&quot; : 0,</div><div class="line">				&quot;works&quot; : 2,</div><div class="line">				&quot;advanced&quot; : 1,</div><div class="line">				&quot;needTime&quot; : 0,</div><div class="line">				&quot;needYield&quot; : 0,</div><div class="line">				&quot;saveState&quot; : 0,</div><div class="line">				&quot;restoreState&quot; : 0,</div><div class="line">				&quot;isEOF&quot; : 1,</div><div class="line">				&quot;invalidates&quot; : 0,</div><div class="line">				&quot;keyPattern&quot; : &#123;</div><div class="line">					&quot;x&quot; : 1</div><div class="line">				&#125;,</div><div class="line">				&quot;indexName&quot; : &quot;x_1&quot;,</div><div class="line">				&quot;isMultiKey&quot; : false,</div><div class="line">				&quot;isUnique&quot; : false,</div><div class="line">				&quot;isSparse&quot; : false,</div><div class="line">				&quot;isPartial&quot; : false,</div><div class="line">				&quot;indexVersion&quot; : 1,</div><div class="line">				&quot;direction&quot; : &quot;forward&quot;,</div><div class="line">				&quot;indexBounds&quot; : &#123;</div><div class="line">					&quot;x&quot; : [</div><div class="line">						&quot;[10000.0, 10000.0]&quot;</div><div class="line">					]</div><div class="line">				&#125;,</div><div class="line">				&quot;keysExamined&quot; : 1,</div><div class="line">				&quot;dupsTested&quot; : 0,</div><div class="line">				&quot;dupsDropped&quot; : 0,</div><div class="line">				&quot;seenInvalidated&quot; : 0</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;,</div><div class="line">	&quot;serverInfo&quot; : &#123;</div><div class="line">		&quot;host&quot; : &quot;rmp.local&quot;,</div><div class="line">		&quot;port&quot; : 12345,</div><div class="line">		&quot;version&quot; : &quot;3.2.10&quot;,</div><div class="line">		&quot;gitVersion&quot; : &quot;79d9b3ab5ce20f51c272b4411202710a082d0317&quot;</div><div class="line">	&#125;,</div><div class="line">	&quot;ok&quot; : 1</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h1><p>物理隔离</p>
<p>网络隔离</p>
<p>防火墙</p>
<h2 id="用户名密码"><a href="#用户名密码" class="headerlink" title="用户名密码"></a>用户名密码</h2><p>开启权限认证有两种方式</p>
<h3 id="auth"><a href="#auth" class="headerlink" title="auth"></a>auth</h3><p>是在配置文件中加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">auth=true</div></pre></td></tr></table></figure>
<p>然后重启服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ps -ef | grep mongd | grep 12345</div><div class="line">kill 1233</div></pre></td></tr></table></figure>
<p>重启后我们查看tail log/mongod.log可以看到security: { authorization: “enabled” }，表示已经开启。</p>
<p>但现在我们还可以连接，因为我们还没有创建用户名和密码。</p>
<h3 id="keyfile"><a href="#keyfile" class="headerlink" title="keyfile"></a>keyfile</h3><h2 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h2><p>参考：<a href="http://blog.csdn.net/chen88358323/article/details/50206651" target="_blank" rel="external">http://blog.csdn.net/chen88358323/article/details/50206651</a></p>
<p>2.6版本之前使用addUser，只用使用createUser，语法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	user:username,</div><div class="line">	pwd:pwd,</div><div class="line">	customData:&#123;自定义的描述信息&#125;,</div><div class="line">	roles:[&#123;role:角色,db:数据库&#125;]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>内建角色类型：</p>
<p>read,readWrite(只能读写，不能创建索引这些操作),dbAdmin,dbOwner,userAdmin(管理用户，创建用户)</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;为什么学mongodb&quot;&gt;&lt;a href=&quot;#为什么学mongodb&quot; class=&quot;headerlink&quot; title=&quot;为什么学mongodb&quot;&gt;&lt;/a&gt;为什么学mongodb&lt;/h1&gt;&lt;p&gt;开源，免费，社区技术支持到位&lt;/p&gt;
&lt;h2 id=&quot;优势&quot;&gt;&lt;a 
    
    </summary>
    
      <category term="MongoDB" scheme="http://i.woblog.cn/categories/MongoDB/"/>
    
    
      <category term="MongoDB" scheme="http://i.woblog.cn/tags/MongoDB/"/>
    
  </entry>
  
  <entry>
    <title>NodeJs</title>
    <link href="http://i.woblog.cn/2016/11/23/nodejs/"/>
    <id>http://i.woblog.cn/2016/11/23/nodejs/</id>
    <published>2016-11-23T00:46:11.000Z</published>
    <updated>2017-03-19T14:22:37.668Z</updated>
    
    <content type="html"><![CDATA[<h1 id="学习网站"><a href="#学习网站" class="headerlink" title="学习网站"></a>学习网站</h1><p>官网：<a href="https://nodejs.org" target="_blank" rel="external">https://nodejs.org</a></p>
<p>npm:<a href="https://www.npmjs.com" target="_blank" rel="external">https://www.npmjs.com</a></p>
<p>github</p>
<p>stack overflow</p>
<h1 id="安装nodeJS"><a href="#安装nodeJS" class="headerlink" title="安装nodeJS"></a>安装nodeJS</h1><h2 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h2><p>偶数为稳定版本:0.6.x,0.8.x,0.10.x</p>
<p>基数非稳定版本:0.7.x,0.9.x,0.11.x</p>
<h2 id="mac安装"><a href="#mac安装" class="headerlink" title="mac安装"></a>mac安装</h2><p>升级mac系统到最新，安装最新的xcode</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">xcode-select --install</div></pre></td></tr></table></figure>
<h2 id="homebrew"><a href="#homebrew" class="headerlink" title="homebrew"></a>homebrew</h2><p>安装方式可以去官网，用ruby命令安装。然后可以安装node js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install nodejs</div></pre></td></tr></table></figure>
<h2 id="多版本安装"><a href="#多版本安装" class="headerlink" title="多版本安装"></a>多版本安装</h2><p>使用n模块来管理，先安装</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g n</div></pre></td></tr></table></figure>
<p>然后就可以通过n来安装相应的版本</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">n <span class="number">0.10</span><span class="number">.2</span></div></pre></td></tr></table></figure>
<p>安装完了以后，可以通过输入n来切换默认版本：</p>
<p>我们这里是v4.2.3</p>
<h1 id="最简单的服务器"><a href="#最简单的服务器" class="headerlink" title="最简单的服务器"></a>最简单的服务器</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</div><div class="line">	<span class="comment">// magic happens here!</span></div><div class="line">	response.writeHead(<span class="number">200</span>, &#123;</div><div class="line">		<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>,</div><div class="line">		<span class="string">'X-Powered-By'</span>: <span class="string">'bacon'</span></div><div class="line">	&#125;);</div><div class="line"></div><div class="line">	response.write(<span class="string">'&lt;html&gt;'</span>);</div><div class="line">	response.write(<span class="string">'&lt;body&gt;'</span>);</div><div class="line">	response.write(<span class="string">'&lt;h1&gt;Hello, World!&lt;/h1&gt;'</span>);</div><div class="line">	response.write(<span class="string">'&lt;/body&gt;'</span>);</div><div class="line">	response.write(<span class="string">'&lt;/html&gt;'</span>);</div><div class="line">	response.end();</div><div class="line">&#125;);</div><div class="line"></div><div class="line">server.listen(<span class="number">1337</span>, <span class="string">'127.0.0.1'</span>)</div></pre></td></tr></table></figure>
<p>打开浏览器访问<a href="http://127.0.0.1:1337,就能看到hello" target="_blank" rel="external">http://127.0.0.1:1337,就能看到hello</a> world</p>
<h1 id="在命令行执行"><a href="#在命令行执行" class="headerlink" title="在命令行执行"></a>在命令行执行</h1><p>我们可以将这段输入到chrome的console中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a=<span class="number">1</span>;<span class="keyword">var</span> b=<span class="number">2</span>;<span class="keyword">var</span> add=<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;<span class="keyword">return</span> a+b&#125;;<span class="built_in">console</span>.log(add(a,b));</div></pre></td></tr></table></figure>
<p>就可以看到结果为3</p>
<p>同样可以将上面的代码复制到nodejs的命令行，发现结果也是一样。但是他们的全局变量是不一样的，比如我们可以在chrome中输入window,document但是，node里面就不行。但是他有自己的全局变量，比如process,通用浏览器中也是拿不到了。</p>
<h1 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h1><h2 id="模块的使用流程"><a href="#模块的使用流程" class="headerlink" title="模块的使用流程"></a>模块的使用流程</h2><p>创建模块：teacher.js</p>
<p>导出模块：exports.add=function(){}</p>
<p>加载模块：var teacher=require(‘./teacher.js’)</p>
<p>使用模块：teacher.add(‘Li’)</p>
<h1 id="常用API"><a href="#常用API" class="headerlink" title="常用API"></a>常用API</h1><h2 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h2><h3 id="parse"><a href="#parse" class="headerlink" title="parse"></a>parse</h3><p>将一个url解析为host等</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url.parse(<span class="string">'http://i.woblog.cn:8080/post/list?a=b&amp;c=d#abc'</span>)</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Url &#123;</div><div class="line">  protocol: &apos;http:&apos;,</div><div class="line">  slashes: true,</div><div class="line">  auth: null,</div><div class="line">  host: &apos;i.woblog.cn:8080&apos;,</div><div class="line">  port: &apos;8080&apos;,</div><div class="line">  hostname: &apos;i.woblog.cn&apos;,</div><div class="line">  hash: &apos;#abc&apos;,</div><div class="line">  search: &apos;?a=b&amp;c=d&apos;,</div><div class="line">  query: &apos;a=b&amp;c=d&apos;,</div><div class="line">  pathname: &apos;/post/list&apos;,</div><div class="line">  path: &apos;/post/list?a=b&amp;c=d&apos;,</div><div class="line">  href: &apos;http://i.woblog.cn:8080/post/list?a=b&amp;c=d#abc&apos; &#125;</div></pre></td></tr></table></figure>
<p>将query解析为对象，只需要传递第二个参数位true</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url.parse(<span class="string">'http://i.woblog.cn:8080/post/list?a=b&amp;c=d#abc'</span>,<span class="literal">true</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Url &#123;</div><div class="line">  protocol: &apos;http:&apos;,</div><div class="line">  slashes: true,</div><div class="line">  auth: null,</div><div class="line">  host: &apos;i.woblog.cn:8080&apos;,</div><div class="line">  port: &apos;8080&apos;,</div><div class="line">  hostname: &apos;i.woblog.cn&apos;,</div><div class="line">  hash: &apos;#abc&apos;,</div><div class="line">  search: &apos;?a=b&amp;c=d&apos;,</div><div class="line">  query: &#123; a: &apos;b&apos;, c: &apos;d&apos; &#125;, //这里已经是对象了</div><div class="line">  pathname: &apos;/post/list&apos;,</div><div class="line">  path: &apos;/post/list?a=b&amp;c=d&apos;,</div><div class="line">  href: &apos;http://i.woblog.cn:8080/post/list?a=b&amp;c=d#abc&apos; &#125;</div></pre></td></tr></table></figure>
<p>不知道url协议，也解析出host，不添加第三个参数，可以看到host为空</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url.parse(<span class="string">'//i.woblog.cn:8080/post/list?a=b&amp;c=d#abc'</span>,<span class="literal">true</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Url &#123;</div><div class="line">  protocol: null,</div><div class="line">  slashes: null,</div><div class="line">  auth: null,</div><div class="line">  host: null,</div><div class="line">  port: null,</div><div class="line">  hostname: null,</div><div class="line">  hash: &apos;#abc&apos;,</div><div class="line">  search: &apos;?a=b&amp;c=d&apos;,</div><div class="line">  query: &#123; a: &apos;b&apos;, c: &apos;d&apos; &#125;,</div><div class="line">  pathname: &apos;//i.woblog.cn:8080/post/list&apos;,</div><div class="line">  path: &apos;//i.woblog.cn:8080/post/list?a=b&amp;c=d&apos;,</div><div class="line">  href: &apos;//i.woblog.cn:8080/post/list?a=b&amp;c=d#abc&apos; &#125;</div></pre></td></tr></table></figure>
<p>第三个参数为true</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url.parse(<span class="string">'//i.woblog.cn:8080/post/list?a=b&amp;c=d#abc'</span>,<span class="literal">true</span>,<span class="literal">true</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Url &#123;</div><div class="line">  protocol: null,</div><div class="line">  slashes: true,</div><div class="line">  auth: null,</div><div class="line">  host: &apos;i.woblog.cn:8080&apos;, //有值了</div><div class="line">  port: &apos;8080&apos;,</div><div class="line">  hostname: &apos;i.woblog.cn&apos;,</div><div class="line">  hash: &apos;#abc&apos;,</div><div class="line">  search: &apos;?a=b&amp;c=d&apos;,</div><div class="line">  query: &#123; a: &apos;b&apos;, c: &apos;d&apos; &#125;,</div><div class="line">  pathname: &apos;/post/list&apos;,</div><div class="line">  path: &apos;/post/list?a=b&amp;c=d&apos;,</div><div class="line">  href: &apos;//i.woblog.cn:8080/post/list?a=b&amp;c=d#abc&apos; &#125;</div></pre></td></tr></table></figure>
<h2 id="format"><a href="#format" class="headerlink" title="format"></a>format</h2><p>将一个对象转为一个url,可以是上面的parse对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">url.format(&#123;</div><div class="line">...   protocol: <span class="string">'http:'</span>,</div><div class="line">...   slashes: <span class="literal">true</span>,</div><div class="line">...   auth: <span class="literal">null</span>,</div><div class="line">...   host: <span class="string">'i.woblog.cn:8080'</span>,</div><div class="line">...   port: <span class="string">'8080'</span>,</div><div class="line">...   hostname: <span class="string">'i.woblog.cn'</span>,</div><div class="line">...   hash: <span class="string">'#abc'</span>,</div><div class="line">...   search: <span class="string">'?a=b&amp;c=d'</span>,</div><div class="line">...   query: <span class="string">'a=b&amp;c=d'</span>,</div><div class="line">...   pathname: <span class="string">'/post/list'</span>,</div><div class="line">...   path: <span class="string">'/post/list?a=b&amp;c=d'</span>,</div><div class="line">...   href: <span class="string">'http://i.woblog.cn:8080/post/list?a=b&amp;c=d#abc'</span> &#125;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://i.woblog.cn:8080/post/list?a=b&amp;c=d#abc</div></pre></td></tr></table></figure>
<h2 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a>resolve</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">url.resolve(<span class="string">'/one/two/three'</span>, <span class="string">'four'</span>)         <span class="comment">// '/one/two/four'</span></div><div class="line">url.resolve(<span class="string">'http://example.com/'</span>, <span class="string">'/one'</span>)    <span class="comment">// 'http://example.com/one'</span></div><div class="line">url.resolve(<span class="string">'http://example.com/one'</span>, <span class="string">'/two'</span>) <span class="comment">// 'http://example.com/two'</span></div></pre></td></tr></table></figure>
<h2 id="queryString"><a href="#queryString" class="headerlink" title="queryString"></a>queryString</h2><h3 id="将对象转为参数字符串"><a href="#将对象转为参数字符串" class="headerlink" title="将对象转为参数字符串"></a>将对象转为参数字符串</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">querystring.stringify(&#123;<span class="attr">name</span>:<span class="string">'li'</span>,<span class="attr">age</span>:<span class="number">10</span>,<span class="attr">course</span>:[<span class="string">'b'</span>,<span class="number">1</span>],<span class="attr">other</span>:<span class="string">''</span>&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&apos;name=li&amp;age=10&amp;course=b&amp;course=1&amp;other=&apos;</div></pre></td></tr></table></figure>
<p>第二个参数表示多个参数间的连接符号，默认&amp;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">querystring.stringify(&#123;<span class="attr">name</span>:<span class="string">'li'</span>,<span class="attr">age</span>:<span class="number">10</span>,<span class="attr">course</span>:[<span class="string">'b'</span>,<span class="number">1</span>],<span class="attr">other</span>:<span class="string">''</span>&#125;,<span class="string">','</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&apos;name=li,age=10,course=b,course=1,other=&apos;</div></pre></td></tr></table></figure>
<p>第三个参数表示key和value之间的分隔符，默认=</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">querystring.stringify(&#123;<span class="attr">name</span>:<span class="string">'li'</span>,<span class="attr">age</span>:<span class="number">10</span>,<span class="attr">course</span>:[<span class="string">'b'</span>,<span class="number">1</span>],<span class="attr">other</span>:<span class="string">''</span>&#125;,<span class="string">','</span>,<span class="string">':'</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&apos;name:li,age:10,course:b,course:1,other:&apos;</div></pre></td></tr></table></figure>
<h3 id="将字符串解析为对象"><a href="#将字符串解析为对象" class="headerlink" title="将字符串解析为对象"></a>将字符串解析为对象</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">querystring.parse(<span class="string">'name=li&amp;age=10&amp;course=b&amp;course=1&amp;other='</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; name: &apos;li&apos;, age: &apos;10&apos;, course: [ &apos;b&apos;, &apos;1&apos; ], other: &apos;&apos; &#125;</div></pre></td></tr></table></figure>
<p>通用也可以指定多个参数间的连接符号</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">querystring.parse(<span class="string">'name=li,age=10,course=b,course=1,other='</span>,<span class="string">','</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; name: &apos;li&apos;, age: &apos;10&apos;, course: [ &apos;b&apos;, &apos;1&apos; ], other: &apos;&apos; &#125;</div></pre></td></tr></table></figure>
<p>指定key和value间的分隔符</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">querystring.parse(<span class="string">'name:li,age:10,course:b,course:1,other:'</span>,<span class="string">','</span>,<span class="string">':'</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123; name: &apos;li&apos;, age: &apos;10&apos;, course: [ &apos;b&apos;, &apos;1&apos; ], other: &apos;&apos; &#125;</div></pre></td></tr></table></figure>
<h3 id="字符转义"><a href="#字符转义" class="headerlink" title="字符转义"></a>字符转义</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">querystring.escape(<span class="string">'&lt;呵 护&gt;'</span>)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&apos;%3C%E5%91%B5%20%E6%8A%A4%3E&apos;</div></pre></td></tr></table></figure>
<p>反转义</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">querystring.unescape(<span class="string">'%3C%E5%91%B5%20%E6%8A%A4%3E'</span>)</div></pre></td></tr></table></figure>
<h1 id="上下文"><a href="#上下文" class="headerlink" title="上下文"></a>上下文</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//上下文</span></div><div class="line"></div><div class="line"><span class="comment">//var pet = &#123;</span></div><div class="line"><span class="comment">//	words : "...",</span></div><div class="line"><span class="comment">//	speak:function () &#123;</span></div><div class="line"><span class="comment">//		console.log(this.words) //this就是pet</span></div><div class="line"><span class="comment">//		console.log(this==pet)</span></div><div class="line"><span class="comment">//	&#125;</span></div><div class="line"><span class="comment">//&#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//pet.speak()</span></div><div class="line"></div><div class="line"><span class="comment">//function pet(words) &#123;</span></div><div class="line"><span class="comment">//	this.words = words</span></div><div class="line"><span class="comment">//	console.log(this.words) //global</span></div><div class="line"><span class="comment">//	console.log(this==global)</span></div><div class="line"><span class="comment">//&#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//pet("...")</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Pet</span>(<span class="params">words</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.words = words</div><div class="line">	<span class="keyword">this</span>.speak = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="keyword">this</span>.words)</div><div class="line">		<span class="built_in">console</span>.log(<span class="keyword">this</span>) <span class="comment">//this是Pet当前实例</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> cat = <span class="keyword">new</span> Pet(<span class="string">"Maomi"</span>)</div><div class="line">cat.speak()</div></pre></td></tr></table></figure>
<h2 id="改变上下文"><a href="#改变上下文" class="headerlink" title="改变上下文"></a>改变上下文</h2><p>将一个方法在另一个对象上调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> pet = &#123;</div><div class="line">	<span class="attr">words</span>: <span class="string">"..."</span>,</div><div class="line">	<span class="attr">speak</span>: <span class="function"><span class="keyword">function</span>(<span class="params">say</span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(say + <span class="string">' '</span> + <span class="keyword">this</span>.words)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//pet.speak('Speak')</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> dog = &#123;</div><div class="line">	<span class="attr">words</span>: <span class="string">"wang"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//改版了speak方法里面的this为dog，打印Speak wang</span></div><div class="line">pet.speak.call(dog, <span class="string">"Speak"</span>)</div></pre></td></tr></table></figure>
<p>实现继承</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Pet</span>(<span class="params">words</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.words = words</div><div class="line">	<span class="keyword">this</span>.speak = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="keyword">this</span>.words)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span>(<span class="params">words</span>) </span>&#123;</div><div class="line">	<span class="comment">//	Pet.call(this,words) //相当于继承Pet，所以Dog也有speak方法</span></div><div class="line">	Pet.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> dog = <span class="keyword">new</span> Dog(<span class="string">"wang"</span>)</div><div class="line">dog.speak()</div></pre></td></tr></table></figure>
<h1 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h1><p>我们使用apache ab测试工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ab -n1000 -c10 http://localhost:2015/</div></pre></td></tr></table></figure>
<p>-n请求次数</p>
<p>-c并发数</p>
<p>打印如下信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line">This is ApacheBench, Version 2.3 &lt;$Revision: 1706008 $&gt;</div><div class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</div><div class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</div><div class="line"></div><div class="line">Benchmarking localhost (be patient)</div><div class="line">Completed 100 requests</div><div class="line">Completed 200 requests</div><div class="line">Completed 300 requests</div><div class="line">Completed 400 requests</div><div class="line">Completed 500 requests</div><div class="line">Completed 600 requests</div><div class="line">Completed 700 requests</div><div class="line">Completed 800 requests</div><div class="line">Completed 900 requests</div><div class="line">Completed 1000 requests</div><div class="line">Finished 1000 requests</div><div class="line"></div><div class="line"></div><div class="line">Server Software:        </div><div class="line">Server Hostname:        localhost</div><div class="line">Server Port:            2015</div><div class="line"></div><div class="line">Document Path:          /</div><div class="line">Document Length:        5 bytes</div><div class="line"></div><div class="line">Concurrency Level:      10</div><div class="line">Time taken for tests:   0.281 seconds</div><div class="line">Complete requests:      1000</div><div class="line">Failed requests:        0</div><div class="line">Total transferred:      106000 bytes</div><div class="line">HTML transferred:       5000 bytes</div><div class="line">Requests per second:    3553.72 [#/sec] (mean)</div><div class="line">Time per request:       2.814 [ms] (mean)</div><div class="line">Time per request:       0.281 [ms] (mean, across all concurrent requests)</div><div class="line">Transfer rate:          367.87 [Kbytes/sec] received</div><div class="line"></div><div class="line">Connection Times (ms)</div><div class="line">              min  mean[+/-sd] median   max</div><div class="line">Connect:        0    0   0.2      0       1</div><div class="line">Processing:     1    2   1.9      2      15</div><div class="line">Waiting:        1    2   1.9      2      15</div><div class="line">Total:          1    3   1.9      2      15</div><div class="line"></div><div class="line">Percentage of the requests served within a certain time (ms)</div><div class="line">  50%      2</div><div class="line">  66%      3</div><div class="line">  75%      3</div><div class="line">  80%      3</div><div class="line">  90%      4</div><div class="line">  95%      5</div><div class="line">  98%     11</div><div class="line">  99%     12</div><div class="line"> 100%     15 (longest request)</div></pre></td></tr></table></figure>
<h1 id="nodeJS事件"><a href="#nodeJS事件" class="headerlink" title="nodeJS事件"></a>nodeJS事件</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>).EventEmitter</div><div class="line"></div><div class="line"><span class="keyword">var</span> life = <span class="keyword">new</span> EventEmitter()</div><div class="line"></div><div class="line"><span class="comment">//修改默认值，就不会出现警告</span></div><div class="line">life.setMaxListeners(<span class="number">20</span>)</div><div class="line"></div><div class="line">life.on(<span class="string">'求安慰'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">who</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'给 '</span> + who + <span class="string">' 倒水'</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">life.on(<span class="string">'求默默'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">who</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'给 '</span> + who + <span class="string">' 倒水1'</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">life.on(<span class="string">'求安慰'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">who</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'给 '</span> + who + <span class="string">' 倒水2'</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">life.on(<span class="string">'求安慰'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">who</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'给 '</span> + who + <span class="string">' 倒水3'</span>)</div><div class="line">&#125;)</div><div class="line">life.on(<span class="string">'求安慰'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">who</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'给 '</span> + who + <span class="string">' 倒水4'</span>)</div><div class="line">&#125;)</div><div class="line">life.on(<span class="string">'求安慰'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">who</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'给 '</span> + who + <span class="string">' 倒水5'</span>)</div><div class="line">&#125;)</div><div class="line">life.on(<span class="string">'求安慰'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">who</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'给 '</span> + who + <span class="string">' 倒水6'</span>)</div><div class="line">&#125;)</div><div class="line">life.on(<span class="string">'求抱抱'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">who</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'给 '</span> + who + <span class="string">' 倒水7'</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">life.on(<span class="string">'求安慰'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">who</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'给 '</span> + who + <span class="string">' 倒水8'</span>)</div><div class="line">&#125;)</div><div class="line">life.on(<span class="string">'求安慰'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">who</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'给 '</span> + who + <span class="string">' 倒水9'</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//默认超过10个事件，就会有警告，有可能有内存泄漏，可以修改</span></div><div class="line">life.on(<span class="string">'求安慰'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">who</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'给 '</span> + who + <span class="string">' 倒水10'</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//true，表示已经监听过该事件</span></div><div class="line"><span class="keyword">var</span> hasConfor = life.emit(<span class="string">'求安慰'</span>, <span class="string">'美男子'</span>)</div><div class="line"><span class="keyword">var</span> hasConfor1 = life.emit(<span class="string">'哈哈'</span>, <span class="string">'美男子'</span>)</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(hasConfor)</div><div class="line"><span class="built_in">console</span>.log(hasConfor1)</div><div class="line"></div><div class="line"><span class="comment">//移除一个监听，监听时间不能使用匿名函数</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">wanwan</span>(<span class="params">who</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'给 '</span> + who + <span class="string">' 玩玩'</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">life.on(<span class="string">'玩玩'</span>, wanwan)</div><div class="line"></div><div class="line"><span class="comment">//移除事件,移除后，后面就不会打印该事件了</span></div><div class="line">life.removeListener(<span class="string">'玩玩'</span>, wanwan)</div><div class="line"></div><div class="line">life.emit(<span class="string">'玩玩'</span>, <span class="string">'美男子'</span>)</div><div class="line"></div><div class="line"><span class="comment">//获取一个事件有多少个监听器,两种方式</span></div><div class="line"><span class="built_in">console</span>.log(life.listeners(<span class="string">'求安慰'</span>).length)</div><div class="line"><span class="built_in">console</span>.log(EventEmitter.listenerCount(life, <span class="string">'求安慰'</span>))</div><div class="line"></div><div class="line"><span class="comment">//移除监听</span></div><div class="line"></div><div class="line"><span class="comment">//移除所有事件</span></div><div class="line"><span class="comment">//life.removeAllListeners()</span></div><div class="line"></div><div class="line"><span class="comment">//移除指定事件名 事件</span></div><div class="line">life.removeAllListeners(<span class="string">'求安慰'</span>)</div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(life.listeners(<span class="string">'求抱抱'</span>).length)</div></pre></td></tr></table></figure>
<h1 id="request方法实例"><a href="#request方法实例" class="headerlink" title="request方法实例"></a>request方法实例</h1><p>一个使用request来评论提交评论的例子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</div><div class="line"><span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> postData = querystring.stringify(&#123;</div><div class="line">	<span class="string">'content'</span>: <span class="string">'感觉学的还不错！'</span>,</div><div class="line">	<span class="string">'cid'</span>: <span class="number">348</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">var</span> options = &#123;</div><div class="line">	<span class="attr">hostname</span>: <span class="string">'www.imooc.com'</span>,</div><div class="line">	<span class="attr">post</span>: <span class="number">80</span>,</div><div class="line">	<span class="attr">path</span>: <span class="string">'/course/docomment'</span>,</div><div class="line">	<span class="attr">method</span>: <span class="string">'POST'</span>,</div><div class="line">	<span class="attr">headers</span>: &#123;</div><div class="line">		<span class="string">'Accept'</span>: <span class="string">'application/json, text/javascript, */*; q=0.01'</span>,</div><div class="line">		...</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> req = http.request(options, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'status:'</span> + res.statuscode)</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'headers:'</span> + <span class="built_in">JSON</span>.stringify(res.headers))</div><div class="line"></div><div class="line">	res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(Buffer.isBuffer(chunk))</div><div class="line">		<span class="built_in">console</span>.log(<span class="keyword">typeof</span> chunk)</div><div class="line">		<span class="built_in">console</span>.log(chunk.toString(<span class="string">'utf-8'</span>))</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'评论完毕'</span>)</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	res.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'error:'</span> + e.message)</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">&#125;)</div><div class="line"></div><div class="line">req.write(postData)</div><div class="line">req.end()</div></pre></td></tr></table></figure>
<h1 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h1><p>先使用用Promise实现一个三个小球的运动</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></div><div class="line">			.ball &#123;</div><div class="line">				width: 40px;</div><div class="line">				height: 40px;</div><div class="line">				border-radius: 20px;</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">			.ball1 &#123;</div><div class="line">				background: red;</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">			.ball2 &#123;</div><div class="line">				background: green;</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">			.ball3 &#123;</div><div class="line">				background: blue;</div><div class="line">			&#125;</div><div class="line">		<span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ball ball1"</span> <span class="attr">style</span>=<span class="string">"margin-left: 0;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ball ball2"</span> <span class="attr">style</span>=<span class="string">"margin-left: 0;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ball ball3"</span> <span class="attr">style</span>=<span class="string">"margin-left: 0;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="keyword">var</span> ball1 = <span class="built_in">document</span>.querySelector(<span class="string">'.ball1'</span>)</div><div class="line">			<span class="keyword">var</span> ball2 = <span class="built_in">document</span>.querySelector(<span class="string">'.ball2'</span>)</div><div class="line">			<span class="keyword">var</span> ball3 = <span class="built_in">document</span>.querySelector(<span class="string">'.ball3'</span>)</div><div class="line"></div><div class="line">			<span class="function"><span class="keyword">function</span> <span class="title">promiseAnimate</span>(<span class="params">ball, distance</span>) </span>&#123;</div><div class="line">				<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line"></div><div class="line">					<span class="function"><span class="keyword">function</span> _animate(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">						setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">							<span class="keyword">var</span> marginLeft = <span class="built_in">parseInt</span>(ball.style.marginLeft, <span class="number">10</span>)</div><div class="line">								<span class="comment">//					console.log('marginLeft:' + marginLeft + ',distance:' + distance)</span></div><div class="line">							<span class="keyword">if</span>(marginLeft == distance) &#123;</div><div class="line">								resolve()</div><div class="line">							&#125; <span class="keyword">else</span> &#123;</div><div class="line">								<span class="keyword">if</span>(marginLeft &lt; distance) &#123;</div><div class="line">									marginLeft++</div><div class="line">								&#125; <span class="keyword">else</span> &#123;</div><div class="line">									marginLeft--</div><div class="line">								&#125;</div><div class="line"></div><div class="line">								<span class="built_in">console</span>.log(<span class="string">'marginLeft:'</span> + marginLeft + <span class="string">',distance:'</span> + distance)</div><div class="line"></div><div class="line">								ball.style.marginLeft = marginLeft + <span class="string">'px'</span></div><div class="line"></div><div class="line">								<span class="built_in">console</span>.log(<span class="string">'left:'</span> + ball.style.marginLeft)</div><div class="line"></div><div class="line">								_animate()</div><div class="line">							&#125;</div><div class="line">						&#125;, <span class="number">13</span>)</div><div class="line">					&#125;</div><div class="line"></div><div class="line">					_animate(ball, distance)</div><div class="line">				&#125;)</div><div class="line"></div><div class="line">			&#125;</div><div class="line"></div><div class="line">			<span class="comment">//不适用Promise,就需要多个返回嵌套</span></div><div class="line">			<span class="comment">// animate(ball1, 100, function() &#123;</span></div><div class="line">			<span class="comment">// 		animate(ball2, 200, function() &#123;</span></div><div class="line">			<span class="comment">// 			animate(ball3, 300, function() &#123;</span></div><div class="line">			<span class="comment">// 				animate(ball3, 150, function() &#123;</span></div><div class="line">			<span class="comment">// 					animate(ball2, 150, function() &#123;</span></div><div class="line">			<span class="comment">// 						animate(ball1, 150, function() &#123;</span></div><div class="line"></div><div class="line">			<span class="comment">// 						&#125;)</span></div><div class="line">			<span class="comment">// 					&#125;)</span></div><div class="line">			<span class="comment">// 				&#125;)</span></div><div class="line">			<span class="comment">// 			&#125;)</span></div><div class="line">			<span class="comment">// 		&#125;)</span></div><div class="line">			<span class="comment">// 	&#125;)</span></div><div class="line"></div><div class="line">			promiseAnimate(ball1, <span class="number">100</span>)</div><div class="line">				.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">					<span class="keyword">return</span> promiseAnimate(ball2, <span class="number">200</span>)</div><div class="line">				&#125;)</div><div class="line">				.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">					<span class="keyword">return</span> promiseAnimate(ball3, <span class="number">300</span>)</div><div class="line">				&#125;)</div><div class="line">				.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">					<span class="keyword">return</span> promiseAnimate(ball3, <span class="number">150</span>)</div><div class="line">				&#125;)</div><div class="line">				.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">					<span class="keyword">return</span> promiseAnimate(ball2, <span class="number">150</span>)</div><div class="line">				&#125;)</div><div class="line">				.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">					<span class="keyword">return</span> promiseAnimate(ball1, <span class="number">150</span>)</div><div class="line">				&#125;)</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="三种状态"><a href="#三种状态" class="headerlink" title="三种状态"></a>三种状态</h2><p>未完成pending</p>
<p>已完成fulfilled</p>
<p>失败rejected</p>
<p>状态不可逆，也就是说要么已完成，要么失败，不可能即完成又失败。</p>
<h2 id="Promise-1"><a href="#Promise-1" class="headerlink" title="Promise"></a>Promise</h2><p>bluebird</p>
<p>Q</p>
<p>then.js</p>
<p>es6-promise</p>
<p>ypromise</p>
<p>async</p>
<p>native-promise-only</p>
<h2 id="使用Promise改写的爬虫"><a href="#使用Promise改写的爬虫" class="headerlink" title="使用Promise改写的爬虫"></a>使用Promise改写的爬虫</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</div><div class="line"><span class="keyword">var</span> cheerio = <span class="built_in">require</span>(<span class="string">'cheerio'</span>)</div><div class="line"><span class="keyword">var</span> <span class="built_in">Promise</span> = <span class="built_in">require</span>(<span class="string">'bluebird'</span>)</div><div class="line">	<span class="comment">//var Promise = require('Promise') //老版本没有</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> url = <span class="string">"http://www.imooc.com/learn/348"</span></div><div class="line"><span class="keyword">var</span> baseUrl = <span class="string">"http://www.imooc.com/learn/"</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">filterChapters</span>(<span class="params">html</span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> $ = cheerio.load(html)</div><div class="line">	<span class="keyword">var</span> chapters = $(<span class="string">'.chapter'</span>)</div><div class="line"></div><div class="line">	<span class="comment">//期望的数据格式</span></div><div class="line">	<span class="comment">//	couseData = &#123;</span></div><div class="line">	<span class="comment">//		title: title,</span></div><div class="line">	<span class="comment">//		number: number,</span></div><div class="line">	<span class="comment">//		videos: [&#123;</span></div><div class="line">	<span class="comment">//			chapterTitle: '',</span></div><div class="line">	<span class="comment">//			videos: [</span></div><div class="line">	<span class="comment">//				title: '',</span></div><div class="line">	<span class="comment">//				id: ''</span></div><div class="line">	<span class="comment">//			]</span></div><div class="line">	<span class="comment">//		&#125;]//	&#125;</span></div><div class="line"></div><div class="line">	<span class="keyword">var</span> title = $(<span class="string">'.course-infos .path span'</span>).text()</div><div class="line">		<span class="comment">//	var title = $('.course-infos .hd h2').text()</span></div><div class="line">	<span class="keyword">var</span> number = $($(<span class="string">'.course-infos .statics .static-item'</span>)[<span class="number">0</span>]).find(<span class="string">'.js-learn-num'</span>).text()</div><div class="line"></div><div class="line">	<span class="comment">//	console.log(title)</span></div><div class="line"></div><div class="line">	<span class="keyword">var</span> courseData = &#123;</div><div class="line">		<span class="attr">title</span>: title,</div><div class="line">		<span class="attr">number</span>: number,</div><div class="line">		<span class="attr">videos</span>: []</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	chapters.each(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</div><div class="line">		<span class="keyword">var</span> chapter = $(<span class="keyword">this</span>)</div><div class="line">			<span class="comment">//			var chapterTitle = chapter.find('strong').children()[0].</span></div><div class="line"></div><div class="line">		<span class="keyword">var</span> chapterTitle = chapter.find(<span class="string">'strong'</span>).text().trim()</div><div class="line">			<span class="comment">//		console.log(chapterTitle)</span></div><div class="line"></div><div class="line">		<span class="keyword">var</span> videos = chapter.find(<span class="string">'.video'</span>).children(<span class="string">'li'</span>)</div><div class="line"></div><div class="line">		<span class="keyword">var</span> chapterData = &#123;</div><div class="line">			<span class="attr">chapterTitle</span>: chapterTitle,</div><div class="line">			<span class="attr">videos</span>: []</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		videos.each(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</div><div class="line">			<span class="keyword">var</span> video = $(<span class="keyword">this</span>).find(<span class="string">'.J-media-item'</span>)</div><div class="line">			<span class="keyword">var</span> videoTitle = video.text().trim()</div><div class="line">			<span class="keyword">var</span> id = video.attr(<span class="string">'href'</span>).split(<span class="string">'video/'</span>)[<span class="number">1</span>].trim()</div><div class="line">			chapterData.videos.push(&#123;</div><div class="line">				<span class="attr">title</span>: videoTitle,</div><div class="line">				<span class="attr">id</span>: id</div><div class="line">			&#125;)</div><div class="line">		&#125;)</div><div class="line"></div><div class="line">		courseData.videos.push(chapterData)</div><div class="line"></div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	<span class="keyword">return</span> courseData</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printCourse</span>(<span class="params">course</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'课程：【'</span> + course.title + <span class="string">'】学习人数：'</span> + course.number)</div><div class="line">		<span class="comment">//	console.log('课程：【'+course.title+'】')</span></div><div class="line"></div><div class="line">	course.videos.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</div><div class="line">		<span class="built_in">console</span>.log(item.chapterTitle + <span class="string">'\n'</span>)</div><div class="line">		item.videos.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">video</span>) </span>&#123;</div><div class="line">			<span class="built_in">console</span>.log(<span class="string">' 【'</span> + video.id + <span class="string">'】'</span> + video.title)</div><div class="line">		&#125;)</div><div class="line">	&#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPageAsync</span>(<span class="params">url</span>) </span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</div><div class="line"></div><div class="line">		http.get(url, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</div><div class="line">			<span class="keyword">var</span> html = <span class="string">''</span></div><div class="line"></div><div class="line">			res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">				html += data</div><div class="line">			&#125;)</div><div class="line"></div><div class="line">			res.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">				resolve(html)</div><div class="line">					<span class="comment">//				var course = filterChapters(html)</span></div><div class="line">					<span class="comment">//		console.log(course)</span></div><div class="line">					<span class="comment">//				printCourse(course)</span></div><div class="line">			&#125;)</div><div class="line">		&#125;).on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">			reject(e)</div><div class="line">				<span class="comment">//			console.log('获取课程出错')</span></div><div class="line">		&#125;)</div><div class="line">	&#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//爬取一个课程</span></div><div class="line"><span class="comment">//getPageAsync(url).then(function(data) &#123;</span></div><div class="line"><span class="comment">//	console.log(data)</span></div><div class="line"><span class="comment">//&#125;)</span></div><div class="line"></div><div class="line"><span class="comment">//如果要同时爬去多个课程，可以组建多个Promise</span></div><div class="line"><span class="comment">//组建每个课程的Promise</span></div><div class="line"><span class="keyword">var</span> fetchCourseArray = []</div><div class="line"></div><div class="line"><span class="comment">//要抓取的课程id</span></div><div class="line"><span class="keyword">var</span> videoIds = [<span class="number">637</span>, <span class="number">348</span>, <span class="number">259</span>]</div><div class="line"></div><div class="line"><span class="comment">//创建某个Promise</span></div><div class="line">videoIds.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">id</span>) </span>&#123;</div><div class="line">	fetchCourseArray.push(getPageAsync(baseUrl + id))</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//并发执行所有Promise</span></div><div class="line"><span class="built_in">Promise</span>.</div><div class="line">all(fetchCourseArray)</div><div class="line">	.then(<span class="function"><span class="keyword">function</span>(<span class="params">pages</span>) </span>&#123;</div><div class="line"></div><div class="line">		<span class="keyword">var</span> cousreData = []</div><div class="line"></div><div class="line">		<span class="comment">//拿到了每页的数据html，循环遍历</span></div><div class="line">		pages.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">page</span>) </span>&#123;</div><div class="line"></div><div class="line">			<span class="comment">//解析每页的源码，解析Wie一个课程</span></div><div class="line">			<span class="keyword">var</span> courses = filterChapters(page)</div><div class="line"></div><div class="line">			cousreData.push(courses)</div><div class="line">		&#125;)</div><div class="line"></div><div class="line">		<span class="comment">//	按照学习人数排序</span></div><div class="line">		<span class="comment">//		cousreData.sort(function (a,b) &#123;</span></div><div class="line">		<span class="comment">//			return a.number&gt;b.number</span></div><div class="line">		<span class="comment">//		&#125;)</span></div><div class="line"></div><div class="line">		<span class="comment">//打印每个课程</span></div><div class="line">		cousreData.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>) </span>&#123;</div><div class="line">			printCourse(item)</div><div class="line">		&#125;)</div><div class="line">	&#125;)</div></pre></td></tr></table></figure>
<h1 id="Buffer"><a href="#Buffer" class="headerlink" title="Buffer"></a>Buffer</h1><p>用来处理二进制数据的，直接在node交互是环境下输入Buffer打印如下信息：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123; [<span class="built_in">Function</span>: Buffer]</div><div class="line">  poolSize: <span class="number">8192</span>,</div><div class="line">  <span class="attr">isBuffer</span>: [<span class="built_in">Function</span>: isBuffer],</div><div class="line">  <span class="attr">compare</span>: [<span class="built_in">Function</span>: compare],</div><div class="line">  <span class="attr">isEncoding</span>: [<span class="built_in">Function</span>],</div><div class="line">  <span class="attr">concat</span>: [<span class="built_in">Function</span>],</div><div class="line">  <span class="attr">byteLength</span>: [<span class="built_in">Function</span>: byteLength] &#125;</div></pre></td></tr></table></figure>
<p>说明Buffer是一个对象，在node中代表一段内存空间</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> Buffer(<span class="string">'Hello 你好'</span>)</div><div class="line">&lt;Buffer <span class="number">48</span> <span class="number">65</span> <span class="number">6</span>c <span class="number">6</span>c <span class="number">6</span>f <span class="number">20</span> e4 bd a0 e5 a5 bd&gt;</div></pre></td></tr></table></figure>
<p>创建的时候可以执行编码格式，默认是utf-8，比如我们指定为base64</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">new</span> Buffer(<span class="string">'Hello 你好'</span>,<span class="string">'base64'</span>)</div><div class="line">&lt;Buffer <span class="number">1</span>d e9 <span class="number">65</span> a3&gt;</div></pre></td></tr></table></figure>
<h2 id="指定大小"><a href="#指定大小" class="headerlink" title="指定大小"></a>指定大小</h2><p>分配一段指定大小的内存空间，如果写入的长度大于分配的空间，多余的内容不会写入。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">var</span> buf = <span class="keyword">new</span> Buffer(<span class="number">7</span>);buf.write(<span class="string">'12345678'</span>);<span class="built_in">console</span>.log(buf);</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">Buffer</span> <span class="attr">31</span> <span class="attr">32</span> <span class="attr">33</span> <span class="attr">34</span> <span class="attr">35</span> <span class="attr">36</span> <span class="attr">37</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>可以看见字符8没有存储。</p>
<h2 id="数组方法初始化"><a href="#数组方法初始化" class="headerlink" title="数组方法初始化"></a>数组方法初始化</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">var</span> buf=<span class="keyword">new</span> Buffer([<span class="number">1</span>,<span class="number">3.4</span>,<span class="number">2.1</span>,<span class="number">3</span>]);<span class="built_in">console</span>.log(buf);</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">Buffer</span> <span class="attr">01</span> <span class="attr">03</span> <span class="attr">02</span> <span class="attr">03</span>&gt;</span></span></div></pre></td></tr></table></figure>
<p>他会自动转为int，可以使用下表访问</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(buf[<span class="number">1</span>])</div></pre></td></tr></table></figure>
<h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><p>buffer[index]</p>
<p>buffer.length</p>
<p>buffer.write(string,offset=0,length,encoding=utf8)</p>
<p>可以看到超出长度的字符串不会被写入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">var</span> b = <span class="keyword">new</span> Buffer(<span class="string">'hello 你好'</span>)</div><div class="line"><span class="literal">undefined</span></div><div class="line">&gt; b.toString()</div><div class="line"><span class="string">'hello 你好'</span></div><div class="line">&gt; b.length</div><div class="line"><span class="number">12</span></div><div class="line">&gt; b.write(<span class="string">'haha hahahahahahhah你是'</span>)</div><div class="line"><span class="number">12</span></div><div class="line">&gt; b.toString()</div><div class="line"><span class="string">'haha hahahah'</span></div></pre></td></tr></table></figure>
<p>从第二个自开始替换，替换两个字符串</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="keyword">var</span> b = <span class="keyword">new</span> Buffer(<span class="string">'hello 你好'</span>)</div><div class="line"><span class="literal">undefined</span></div><div class="line">&gt; b.write(<span class="string">'haha hahahahahahhah你是'</span>,<span class="number">2</span>,<span class="number">2</span>)</div><div class="line"><span class="number">2</span></div><div class="line">&gt; b.toString()</div><div class="line"><span class="string">'hehao 你好'</span></div><div class="line">&gt;</div></pre></td></tr></table></figure>
<p>buffer.toString(encoding,start=0,end=buffer.length)</p>
<p>指定开始和结束为止位置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; b.toString(<span class="string">'utf-8'</span>,<span class="number">2</span>,<span class="number">4</span>)</div><div class="line"><span class="string">'ha'</span></div></pre></td></tr></table></figure>
<p>buffer.copy(target,tStart,sStart,sEnd=buffer.length)</p>
<p>buffer.splice(start,end)</p>
<p>buffer.compare(otherBuffer)</p>
<p>buffer.equals(otherBuffer)</p>
<p>buffer.fill(value,offset,end)</p>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"></div><div class="line">fs.readFile(<span class="string">'logo.png'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, origin_buffer</span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span>(err) <span class="built_in">console</span>.log(err)</div><div class="line"></div><div class="line">	<span class="built_in">console</span>.log(Buffer.isBuffer(origin_buffer))</div><div class="line"></div><div class="line">	<span class="comment">//保存图片</span></div><div class="line">	fs.writeFile(<span class="string">'logo_save.png'</span>, origin_buffer, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span>(err) <span class="built_in">console</span>.log(err)</div><div class="line">	&#125;)</div><div class="line"></div><div class="line">	<span class="comment">//将图片转为base64</span></div><div class="line">	<span class="keyword">var</span> imageBase64 = origin_buffer.toString(<span class="string">'base64'</span>)</div><div class="line"></div><div class="line">	<span class="built_in">console</span>.log(imageBase64)</div><div class="line"></div><div class="line">	<span class="keyword">var</span> imageDecode = <span class="keyword">new</span> Buffer(imageBase64, <span class="string">'base64'</span>)</div><div class="line"></div><div class="line">	<span class="built_in">console</span>.log(Buffer.compare(origin_buffer, imageDecode))</div><div class="line"></div><div class="line">	fs.writeFile(<span class="string">'logo_decode.png'</span>, imageDecode, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</div><div class="line">		<span class="keyword">if</span>(err) <span class="built_in">console</span>.log(err)</div><div class="line">	&#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>另外图片的base编码可以通过如下格式用到网页中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data:image/png;base64,图片的base64编码</div></pre></td></tr></table></figure>
<p>然后将上面的数据写入image的src或者css background中的url中，就可以显示出来图片了。</p>
<h1 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h1><p>流相当于水管，是连接buffer的。</p>
<p>拷贝图片</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs=<span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"><span class="keyword">var</span> source=fs.readFileSync(<span class="string">'./logo.png'</span>)</div><div class="line"></div><div class="line">fs.writeFileSync(<span class="string">'./logo_copy.png'</span>,source)</div></pre></td></tr></table></figure>
<h2 id="流事件"><a href="#流事件" class="headerlink" title="流事件"></a>流事件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"><span class="keyword">var</span> readStream = fs.createReadStream(<span class="string">'./stream_copy_image.js'</span>)</div><div class="line"></div><div class="line">readStream.</div><div class="line">on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'data emits'</span>)</div><div class="line">	<span class="built_in">console</span>.log(Buffer.isBuffer(chunk))</div><div class="line">	<span class="built_in">console</span>.log(chunk.toString(<span class="string">'utf8'</span>));</div><div class="line"></div><div class="line">&#125;).</div><div class="line">on(<span class="string">'readable'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'data readable'</span>);</div><div class="line">&#125;).</div><div class="line">on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'data end'</span>)</div><div class="line">&#125;).</div><div class="line">on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'data close'</span>);</div><div class="line">&#125;).</div><div class="line">on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'data read error:'</span> + e);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="暂停和恢复流"><a href="#暂停和恢复流" class="headerlink" title="暂停和恢复流"></a>暂停和恢复流</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"><span class="keyword">var</span> readStream = fs.createReadStream(<span class="string">'./a.mov'</span>)</div><div class="line">	<span class="comment">//var readStream = fs.createReadStream('./stream_copy_image.js')</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> n = <span class="number">0</span></div><div class="line"></div><div class="line">readStream.</div><div class="line">on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</div><div class="line">	n++</div><div class="line"></div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'data emits'</span>)</div><div class="line">	<span class="built_in">console</span>.log(Buffer.isBuffer(chunk))</div><div class="line">		<span class="comment">//	console.log(chunk.toString('utf8'));</span></div><div class="line"></div><div class="line">	<span class="comment">//流的暂停和恢复</span></div><div class="line">	readStream.pause()</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">"stream pause"</span>);</div><div class="line"></div><div class="line">	setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">		readStream.resume()</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">"stream resume"</span>);</div><div class="line"></div><div class="line">	&#125;, <span class="number">2000</span>)</div><div class="line"></div><div class="line">&#125;).</div><div class="line">on(<span class="string">'readable'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'data readable'</span>);</div><div class="line">&#125;).</div><div class="line">on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'data end:'</span> + n)</div><div class="line"></div><div class="line">&#125;).</div><div class="line">on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'data close'</span>);</div><div class="line">&#125;).</div><div class="line">on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'data read error:'</span> + e);</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="通过流事件拷贝文件"><a href="#通过流事件拷贝文件" class="headerlink" title="通过流事件拷贝文件"></a>通过流事件拷贝文件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"><span class="keyword">var</span> readStream = fs.createReadStream(<span class="string">'a.mov'</span>)</div><div class="line"><span class="keyword">var</span> writeStream = fs.createWriteStream(<span class="string">'a_copy.mov'</span>)</div><div class="line"></div><div class="line">readStream.</div><div class="line">on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</div><div class="line">	writeStream.write(chunk)</div><div class="line">&#125;).</div><div class="line">on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	writeStream.end()</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>但是上面的代码有个问题就是，有可能写入的数据没有还没有写入到文件，缓冲区就会满了，所以推荐的做法是，判断写入到文件没，没有的话就暂停读取。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"><span class="keyword">var</span> readStream = fs.createReadStream(<span class="string">'a.mov'</span>)</div><div class="line"><span class="keyword">var</span> writeStream = fs.createWriteStream(<span class="string">'a_copy.mov'</span>)</div><div class="line"></div><div class="line">readStream.</div><div class="line">on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123;</div><div class="line">	<span class="keyword">if</span>(writeStream.write(chunk) == <span class="literal">false</span>) &#123;</div><div class="line">		<span class="built_in">console</span>.log(<span class="string">'data pause'</span>)</div><div class="line">		readStream.pause()</div><div class="line">	&#125;</div><div class="line">&#125;).</div><div class="line">on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	writeStream.end()</div><div class="line">&#125;)</div><div class="line"></div><div class="line">writeStream.</div><div class="line">on(<span class="string">'drain'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'data drains'</span>)</div><div class="line">	readStream.resume()</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="流的种类"><a href="#流的种类" class="headerlink" title="流的种类"></a>流的种类</h2><p>Readable，Writable，Duplex，Transform</p>
<h2 id="pipe"><a href="#pipe" class="headerlink" title="pipe"></a>pipe</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>)</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line"><span class="keyword">var</span> request = <span class="built_in">require</span>(<span class="string">'request'</span>)</div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">//通过传统方法读取图片</span></div><div class="line">	<span class="comment">//	fs.readFile('./logo.png', function(err,data) &#123;</span></div><div class="line">	<span class="comment">//		if(err) &#123;</span></div><div class="line">	<span class="comment">//			res.end('file not exist')</span></div><div class="line">	<span class="comment">//		&#125; else &#123;</span></div><div class="line">	<span class="comment">//			res.writeHeader(200, &#123;</span></div><div class="line">	<span class="comment">//				'Content-Type': 'image/png'</span></div><div class="line">	<span class="comment">//			&#125;)</span></div><div class="line">	<span class="comment">//			res.end(data)</span></div><div class="line">	<span class="comment">//		&#125;</span></div><div class="line">	<span class="comment">//	&#125;)</span></div><div class="line"></div><div class="line">	<span class="comment">//通过管道</span></div><div class="line">	<span class="comment">//	fs.createReadStream('./logo.png').pipe(res)</span></div><div class="line"></div><div class="line">	<span class="comment">//还可以通过网络获取一张图片,需要安装</span></div><div class="line">	request(<span class="string">'https://gss1.bdstatic.com/5eN1dDebRNRTm2_p8IuM_a/res/img/richanglogo168_24.png'</span>).</div><div class="line">	pipe(res)</div><div class="line">&#125;).listen(<span class="number">8090</span>)</div></pre></td></tr></table></figure>
<h3 id="拷贝文件"><a href="#拷贝文件" class="headerlink" title="拷贝文件"></a>拷贝文件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line">fs.createReadStream(<span class="string">'a.mov'</span>).pipe(fs.createWriteStream(<span class="string">'a_copy.mov'</span>))</div></pre></td></tr></table></figure>
<h2 id="自定义可写流函数"><a href="#自定义可写流函数" class="headerlink" title="自定义可写流函数"></a>自定义可写流函数</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Readable = <span class="built_in">require</span>(<span class="string">'stream'</span>).Readable</div><div class="line"><span class="keyword">var</span> Writable = <span class="built_in">require</span>(<span class="string">'stream'</span>).Writable</div><div class="line"></div><div class="line"><span class="keyword">var</span> readStream = <span class="keyword">new</span> Readable()</div><div class="line"><span class="keyword">var</span> writeStream = <span class="keyword">new</span> Writable()</div><div class="line"></div><div class="line">readStream.push(<span class="string">'i '</span>)</div><div class="line">readStream.push(<span class="string">"Love "</span>)</div><div class="line">readStream.push(<span class="string">"JS \n"</span>)</div><div class="line">readStream.push(<span class="literal">null</span>)</div><div class="line"></div><div class="line"><span class="comment">//自定义了Writable的write方法</span></div><div class="line">writeStream._write = <span class="function"><span class="keyword">function</span>(<span class="params">chunk, encode, cb</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(chunk.toString())</div><div class="line">	cb()</div><div class="line">&#125;</div><div class="line"></div><div class="line">readStream.pipe(writeStream)</div></pre></td></tr></table></figure>
<h2 id="自定义流"><a href="#自定义流" class="headerlink" title="自定义流"></a>自定义流</h2><p>我们自定义了ReadStream，WritStream，TransformStream并通过TransformStream流混入一些数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> stream = <span class="built_in">require</span>(<span class="string">'stream'</span>)</div><div class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ReadStream</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	stream.Readable.call(<span class="keyword">this</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">util.inherits(ReadStream, stream.Readable)</div><div class="line"></div><div class="line">ReadStream.prototype._read = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.push(<span class="string">'i '</span>)</div><div class="line">	<span class="keyword">this</span>.push(<span class="string">"Love "</span>)</div><div class="line">	<span class="keyword">this</span>.push(<span class="string">"JS \n"</span>)</div><div class="line">	<span class="keyword">this</span>.push(<span class="literal">null</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">WritStream</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	stream.Writable.call(<span class="keyword">this</span>)</div><div class="line">	<span class="keyword">this</span>._cached = <span class="keyword">new</span> Buffer(<span class="string">''</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">util.inherits(WritStream, stream.Writable)</div><div class="line"></div><div class="line">WritStream.prototype._write = <span class="function"><span class="keyword">function</span>(<span class="params">chunk, encode, cb</span>) </span>&#123;</div><div class="line">	<span class="built_in">console</span>.log(chunk.toString());</div><div class="line">	cb()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">TransformStream</span>(<span class="params"></span>) </span>&#123;</div><div class="line">	stream.Transform.call(<span class="keyword">this</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">util.inherits(TransformStream, stream.Transform)</div><div class="line"></div><div class="line">TransformStream.prototype._transform = <span class="function"><span class="keyword">function</span>(<span class="params">chunk, encode, cb</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.push(chunk)</div><div class="line">	<span class="keyword">this</span>.push(<span class="string">'transform '</span>)</div><div class="line">	cb()</div><div class="line">&#125;</div><div class="line"></div><div class="line">TransformStream.prototype._flush = <span class="function"><span class="keyword">function</span>(<span class="params">cb</span>) </span>&#123;</div><div class="line">	<span class="keyword">this</span>.push(<span class="string">'flush '</span>)</div><div class="line">	cb()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> rs = <span class="keyword">new</span> ReadStream()</div><div class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> WritStream()</div><div class="line"><span class="keyword">var</span> ts = <span class="keyword">new</span> TransformStream()</div><div class="line"></div><div class="line">rs.pipe(ts).pipe(ws)</div></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">i </div><div class="line">transform </div><div class="line">Love </div><div class="line">transform </div><div class="line">JS </div><div class="line"></div><div class="line">transform </div><div class="line">flush</div></pre></td></tr></table></figure>
<h1 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h1><p>## </p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;学习网站&quot;&gt;&lt;a href=&quot;#学习网站&quot; class=&quot;headerlink&quot; title=&quot;学习网站&quot;&gt;&lt;/a&gt;学习网站&lt;/h1&gt;&lt;p&gt;官网：&lt;a href=&quot;https://nodejs.org&quot; target=&quot;_blank&quot; rel=&quot;external&quot;
    
    </summary>
    
      <category term="NodeJs" scheme="http://i.woblog.cn/categories/NodeJs/"/>
    
    
      <category term="NodeJs" scheme="http://i.woblog.cn/tags/NodeJs/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript语法总结</title>
    <link href="http://i.woblog.cn/2016/11/17/java-script-syntax/"/>
    <id>http://i.woblog.cn/2016/11/17/java-script-syntax/</id>
    <published>2016-11-17T11:58:02.000Z</published>
    <updated>2017-03-19T14:22:37.668Z</updated>
    
    <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="他能做什么"><a href="#他能做什么" class="headerlink" title="他能做什么"></a>他能做什么</h2><ol>
<li>他可以制作交互性极强的网页效果</li>
<li>全世界大部分网页基本上都是用它</li>
<li>所有的主流浏览器基本都支持</li>
<li>数据验证，比如：用户名，邮箱格式验证</li>
</ol>
<h1 id="Hello-JS"><a href="#Hello-JS" class="headerlink" title="Hello JS"></a>Hello JS</h1><p>js有很强的易学性，只需要一个文本编辑器就可以编写了，并且js是是解释性的，不需要想c++，java语言需要编译。我们演示一个最简单的例子，就是动态向文档里输出一句话并且动态改变一个标签的字体演示。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"d1"</span>&gt;</span>第一段文字<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"d2"</span>&gt;</span>第二段文字<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="built_in">document</span>.write(<span class="string">'hello js'</span>);</div><div class="line">			<span class="built_in">document</span>.getElementById(<span class="string">'d1'</span>).style.color = <span class="string">'red'</span>;</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>可以看到我们通过document.write方法可以向body标签中添加内容，还可以通过document.getElementById方法通过id选择器找到一个标签动态的将字体的颜色改为了红色。</p>
<h1 id="如何在网页里引入js"><a href="#如何在网页里引入js" class="headerlink" title="如何在网页里引入js"></a>如何在网页里引入js</h1><h2 id="head标签"><a href="#head标签" class="headerlink" title="head标签"></a>head标签</h2><p>如果将js插入到head标签中，需要用script标签包裹住js代码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;head&gt;</div><div class="line">	&lt;meta charset="utf-8" /&gt;</div><div class="line">	&lt;title&gt;&lt;/title&gt;</div><div class="line">	</div><div class="line">	&lt;script&gt;</div><div class="line">		alert('hi')</div><div class="line">	&lt;/script&gt;</div><div class="line">&lt;/head&gt;</div></pre></td></tr></table></figure>
<h2 id="引入js文件"><a href="#引入js文件" class="headerlink" title="引入js文件"></a>引入js文件</h2><p>js代码不一定非要嵌入到网页里，可以单独写到一个文件，然后引入这文件就好了</p>
<p>common.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alert(<span class="string">'我来自一个外部文件'</span>)</div></pre></td></tr></table></figure>
<p>然后在index.html中引入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/common.js"</span>&gt;</span><span class="undefined"></span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
<p>当然也可以在body标签中引入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;body&gt;</div><div class="line">	<span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/common.js"</span>&gt;</span><span class="undefined"></span></span></div><div class="line">	<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line">&lt;<span class="regexp">/body&gt;</span></div></pre></td></tr></table></figure>
<p>注意：js是一本脚本语言并且可以放到页面的任何位置，但是html是按照从前到后先后顺序执行的，一般放到body的最后面。</p>
<h1 id="语句"><a href="#语句" class="headerlink" title="语句"></a>语句</h1><p>js语句用分好或换行符隔开。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.write(<span class="string">'我是一行语句'</span>)</div><div class="line"><span class="built_in">document</span>.write(<span class="string">'我是也是一行语句'</span>);<span class="built_in">document</span>.write(<span class="string">'我是也是一行语句'</span>)</div></pre></td></tr></table></figure>
<p>其实这是三行语句。</p>
<h1 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h1><p>注释是写给程序员开的，用以提高代码可读性的。</p>
<h2 id="单行注释"><a href="#单行注释" class="headerlink" title="单行注释"></a>单行注释</h2><p>用//表示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//我是一个单行注释</span></div></pre></td></tr></table></figure>
<h2 id="多行注释"><a href="#多行注释" class="headerlink" title="多行注释"></a>多行注释</h2><p>用<code>/*开始到*/</code>结束中间的内容都是注释。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*我是一个多行注释</span></div><div class="line">我可以写多行*/</div></pre></td></tr></table></figure>
<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><p>简单来讲就是存储可变的量，比如我们我们的天气，每天都不一样。js中变量可以不声明直接使用，但这不符合规范，所有还是先声明，然后在使用，声明变量的语法是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//变量</span></div><div class="line"><span class="keyword">var</span> weather;</div><div class="line">weather=<span class="string">'晴天'</span>;</div><div class="line">alert(weather)</div><div class="line"></div><div class="line">weather=<span class="string">'雷阵雨'</span></div><div class="line">alert(weather)</div><div class="line"></div><div class="line">weather=<span class="number">10</span>;</div><div class="line">alert(weather)</div></pre></td></tr></table></figure>
<p>变量可以赋值为不同的类型。</p>
<p>注意：变量名区分大小写。</p>
<h2 id="变量名命名规则"><a href="#变量名命名规则" class="headerlink" title="变量名命名规则"></a>变量名命名规则</h2><ol>
<li>字母，下划线，美元符开始</li>
<li>后面接任意多个字母，数字，下划线，美元符</li>
<li>不能使用js的保留关键字</li>
</ol>
<h1 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h1><h2 id="if"><a href="#if" class="headerlink" title="if"></a>if</h2><p>if else语句可以判断条件是否成立，然后分别执行对应的代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> age=<span class="number">17</span>;</div><div class="line"><span class="keyword">if</span> (age&gt;=<span class="number">18</span>) &#123;</div><div class="line">	alert(<span class="string">"你成年了"</span>)</div><div class="line">&#125; <span class="keyword">else</span>&#123;</div><div class="line">	alert(<span class="string">"你还没用成年"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="if-else"><a href="#if-else" class="headerlink" title="if else"></a>if else</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myage = <span class="number">99</span>; <span class="comment">//赵红的年龄为99</span></div><div class="line"><span class="keyword">if</span>(myage &lt;= <span class="number">44</span>) &#123;</div><div class="line">	<span class="built_in">document</span>.write(<span class="string">"青年"</span>);</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(myage &lt;= <span class="number">59</span>) &#123;</div><div class="line">	<span class="built_in">document</span>.write(<span class="string">"中年人"</span>);</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(myage &lt;= <span class="number">89</span>) &#123;</div><div class="line">	<span class="built_in">document</span>.write(<span class="string">"老年人"</span>);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">	<span class="built_in">document</span>.write(<span class="string">"长寿老年人"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myweek = <span class="number">10</span>; <span class="comment">//myweek表示星期几变量</span></div><div class="line"><span class="keyword">switch</span>(myweek) &#123;</div><div class="line">	<span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">	<span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">		<span class="built_in">document</span>.write(<span class="string">"学习理念知识"</span>);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">3</span>:</div><div class="line">	<span class="keyword">case</span> <span class="number">4</span>:</div><div class="line">		<span class="built_in">document</span>.write(<span class="string">"到企业实践"</span>);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line"></div><div class="line">	<span class="keyword">default</span>:</div><div class="line">		<span class="built_in">document</span>.write(<span class="string">"周六、日休息和娱乐"</span>);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line"></div><div class="line">	<span class="keyword">case</span> <span class="number">5</span>:</div><div class="line">		<span class="built_in">document</span>.write(<span class="string">"总结经验"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>一定要写break，default不用一定要放到最后。</p>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><p>函数式用来完成某个特定功能的一组语句，用来提高代码的复用性。定义函数的语法是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> 函数名称 (<span class="params"></span>) </span>&#123;</div><div class="line">	函数代码</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>其中function是定义函数的关键字</li>
<li>函数名就是为函数去一个名字，下次用只需要知道函数名称就行了，不需要知道这个函数具体怎么实现额。</li>
</ol>
<p>例如我们可以编写一个计算两数之和的方法:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//定义函数</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span> (<span class="params">a,b</span>) </span>&#123;</div><div class="line">	<span class="keyword">return</span> a+b;</div><div class="line">&#125;</div><div class="line"></div><div class="line">alert(add(<span class="number">10</span>,<span class="number">20</span>)) <span class="comment">//调用函数</span></div></pre></td></tr></table></figure>
<p>函数是不能自动执行的，需要我们手动调用。当然我们也可以定义一个button，点击后才执行一个函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line"></div><div class="line">			<span class="function"><span class="keyword">function</span> <span class="title">clickMe</span>(<span class="params"></span>) </span>&#123;</div><div class="line">				alert(<span class="string">'你再点一下试试！'</span>)</div><div class="line">			&#125;</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"clickMe()"</span> <span class="attr">value</span>=<span class="string">"你敢点击吗"</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<h1 id="互动操作"><a href="#互动操作" class="headerlink" title="互动操作"></a>互动操作</h1><p>这部分我们将讲解如何输出内容，警告，确认，提问对户口，以及打开新窗口，关闭窗口等操作。</p>
<h2 id="输出内容"><a href="#输出内容" class="headerlink" title="输出内容"></a>输出内容</h2><p>可以直接用document.write方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//输出内容</span></div><div class="line"><span class="built_in">document</span>.write(<span class="string">'输出内容'</span>)</div><div class="line"></div><div class="line"><span class="comment">//可以使用+号连接字符串</span></div><div class="line"><span class="built_in">document</span>.write(<span class="string">'拼接字符串'</span>+<span class="string">"&lt;br/&gt;"</span>)</div></pre></td></tr></table></figure>
<h2 id="警告信息"><a href="#警告信息" class="headerlink" title="警告信息"></a>警告信息</h2><p>有时候在网页想给用户一个提示框，则可以使用alert对话框。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">alert(<span class="string">'打印一个变量'</span>)</div><div class="line"><span class="keyword">var</span> name = <span class="string">'名字'</span></div><div class="line">alert(name)</div></pre></td></tr></table></figure>
<h2 id="确认对话框"><a href="#确认对话框" class="headerlink" title="确认对话框"></a>确认对话框</h2><p>该对话框显示一个确定取消对话框，可以和用户交互。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showLoveJS</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> loveJS=confirm(<span class="string">'你喜欢JS吗？'</span>)</div><div class="line">	<span class="keyword">if</span> (loveJS==<span class="literal">true</span>) &#123;</div><div class="line">		alert(<span class="string">'好的，继续加油'</span>)</div><div class="line">	&#125; <span class="keyword">else</span>&#123;</div><div class="line">		alert(<span class="string">'不喜欢也得学呀'</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"showLoveJS()"</span> <span class="attr">value</span>=<span class="string">"你喜欢js吗"</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="提问对话框"><a href="#提问对话框" class="headerlink" title="提问对话框"></a>提问对话框</h2><p>通过prompt弹出的对话框还可以让用户输入一些信息。语法：</p>
<p>prompt(str1,str2)</p>
<p>参数解释：</p>
<p>str1:显示在对话框的标题</p>
<p>str2:对话框中文本中的内容，可以修改</p>
<p>返回值</p>
<p>点击确定返回文本框中的内容</p>
<p>点击取消返回null</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">inputName</span> (<span class="params"></span>) </span>&#123;</div><div class="line">	<span class="keyword">var</span> name=prompt(<span class="string">'请输入你的名字：'</span>)</div><div class="line">	<span class="keyword">if</span> (name==<span class="literal">null</span>) &#123;</div><div class="line">		alert(<span class="string">'请输入名字'</span>)</div><div class="line">	&#125; <span class="keyword">else</span>&#123;</div><div class="line">		alert(<span class="string">'你好,'</span>+name)</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;input type=<span class="string">"button"</span> onclick=<span class="string">"inputName()"</span> value=<span class="string">"请输入用户名"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span></div></pre></td></tr></table></figure>
<h2 id="打开新浏览器窗口"><a href="#打开新浏览器窗口" class="headerlink" title="打开新浏览器窗口"></a>打开新浏览器窗口</h2><p>通过open方法可以从已有的窗口打开网页或新建一个浏览器窗口。Win</p>
<p>语法：</p>
<p>window.open([url地址],[窗口名称],[参数字符串])</p>
<p>参数解释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">url地址：可选参数，在窗口中显示的路径，如果省略窗口就不显示任何文档。</div><div class="line"></div><div class="line">窗口名：可选参数，被打开窗口的名称。取值如下：</div><div class="line"></div><div class="line">  _top:在框架页面中，上传窗口显示目标网页</div><div class="line"></div><div class="line">  _blank:在新窗口中显示</div><div class="line"></div><div class="line">  _self:在当前窗口显示</div><div class="line"></div><div class="line">窗口名称：相同的name只能创建一个。不能包含空格。</div><div class="line"></div><div class="line">参数字符串：设置窗口的参数，多个用逗号分隔开</div></pre></td></tr></table></figure>
<p>窗口参数列表：</p>
<p><img src="http://img.mukewang.com/52e3677900013d6a05020261.jpg" alt=""></p>
<p>例如打开百度，窗口大小为300px*200px，没有菜单，无工具栏，无状态栏，有滚动条。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">window</span>.open(<span class="string">'http://www.baidu.com'</span>,<span class="string">'_blank'</span>,<span class="string">'width=300,height=200,menubar=no,toolbar=no, status=no,scrollbars=yes'</span>)</div></pre></td></tr></table></figure>
<h2 id="关闭窗口"><a href="#关闭窗口" class="headerlink" title="关闭窗口"></a>关闭窗口</h2><p>可是使用window.close()关闭当前窗口，或者使用窗口对象.close()关闭指定窗口。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> win = <span class="built_in">window</span>.open(<span class="string">'http://www.baidu.com'</span>,<span class="string">'_blank'</span>,<span class="string">'width=300,height=200,menubar=no,toolbar=no, status=no,scrollbars=yes'</span>)</div><div class="line">win.close()</div></pre></td></tr></table></figure>
<p>打开一个窗口马上又关闭它。</p>
<h2 id="实例：打开用户输入的网址"><a href="#实例：打开用户输入的网址" class="headerlink" title="实例：打开用户输入的网址"></a>实例：打开用户输入的网址</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html&gt;</div><div class="line"></div><div class="line">	&lt;head&gt;</div><div class="line">		&lt;meta charset="UTF-8"&gt;</div><div class="line">		&lt;title&gt;&lt;/title&gt;</div><div class="line"></div><div class="line">		&lt;script&gt;</div><div class="line">			function openWindow() &#123;</div><div class="line">				var url = prompt("请输入你想打开的网址：")</div><div class="line">				if(url == null) &#123;</div><div class="line">					alert('请输入网址')</div><div class="line">				&#125; else &#123;</div><div class="line">					open(url, '_blank', 'width=300,height=200,menubar=no,toolbar=no, status=no,scrollbars=yes')</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&lt;/script&gt;</div><div class="line">	&lt;/head&gt;</div><div class="line"></div><div class="line">	&lt;body&gt;</div><div class="line"></div><div class="line">		&lt;input type="button" value="打开窗口" onclick="openWindow()" /&gt;</div><div class="line">	&lt;/body&gt;</div><div class="line"></div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>
<h1 id="Dom操作"><a href="#Dom操作" class="headerlink" title="Dom操作"></a>Dom操作</h1><h2 id="什么是DOM"><a href="#什么是DOM" class="headerlink" title="什么是DOM"></a>什么是DOM</h2><p>全称为Document Object Model也就是文档对象模型，他定义了访问和处理HTML文档的标准方法。DOM将HTML文档呈现为代有元素，属性和文本的树结构，也称节点树。</p>
<ol>
<li>元素节点：像html,body,p标签</li>
<li>文本节点：内显示内容的节点，li，span</li>
<li>属性节点：如a标签有href属性可以指向一个网址</li>
</ol>
<h2 id="通过ID找元素"><a href="#通过ID找元素" class="headerlink" title="通过ID找元素"></a>通过ID找元素</h2><p>id是标签的唯一属性，所以说在网页中可以通过id找到一个确定的元素。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">'d1'</span>).innerText = <span class="string">'我是动态添加的'</span></div></pre></td></tr></table></figure>
<h2 id="innerText属性"><a href="#innerText属性" class="headerlink" title="innerText属性"></a>innerText属性</h2><p>用于获取或替换该对象里面的html标签。区分大小写。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">'d2'</span>).innerHTML = <span class="string">'&lt;h1&gt;标题1&lt;/h1&gt;'</span></div></pre></td></tr></table></figure>
<h2 id="改变HTML样式"><a href="#改变HTML样式" class="headerlink" title="改变HTML样式"></a>改变HTML样式</h2><p>可以通过js动态的改变html的样式。语法是Object.style.property=new style。</p>
<p>下面列取了常见的属性：</p>
<p><img src="http://img.mukewang.com/52e4d4240001dd6c04850229.jpg" alt=""></p>
<p>我们来写个实例代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> d3 = <span class="built_in">document</span>.getElementById(<span class="string">'d3'</span>)</div><div class="line">d3.style.color=<span class="string">'red'</span></div><div class="line">d3.style.fontSize=<span class="string">'28'</span></div><div class="line">d3.style.backgroundColor=<span class="string">'blue'</span></div></pre></td></tr></table></figure>
<h2 id="显示和隐藏标签"><a href="#显示和隐藏标签" class="headerlink" title="显示和隐藏标签"></a>显示和隐藏标签</h2><p>在网页中，有时候可能某个标签一开始是隐藏的，当一定条件后就显示了。可以通过style.display来设置。</p>
<p>取值：</p>
<p>none：隐藏元素</p>
<p>block:显示元素</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">'d4'</span>).style.display=<span class="string">'none'</span></div></pre></td></tr></table></figure>
<h2 id="控制类属性"><a href="#控制类属性" class="headerlink" title="控制类属性"></a>控制类属性</h2><p>可以通过className获取或替换class属性值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">'d5'</span>).className=<span class="string">'a'</span></div><div class="line"></div><div class="line"><span class="comment">//添加多个样式</span></div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">'d5'</span>).className=<span class="string">'a'</span></div></pre></td></tr></table></figure>
<h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><p>数组是用来存储多个数组，比如：一个班的同学。</p>
<h2 id="定义数组"><a href="#定义数组" class="headerlink" title="定义数组"></a>定义数组</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myarr = <span class="keyword">new</span> <span class="built_in">Array</span>();</div><div class="line">myarr[<span class="number">0</span>]=<span class="number">80</span>;</div><div class="line">myarr[<span class="number">1</span>]=<span class="number">70</span>;</div><div class="line">myarr[<span class="number">2</span>]=<span class="number">90</span>;</div><div class="line"></div><div class="line"><span class="built_in">document</span>.write(myarr[<span class="number">0</span>])</div></pre></td></tr></table></figure>
<p>创建数组的时候也可以指定长度，但是实际上数组是可以边长的，所有没什么意思。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myarr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">2</span>);</div><div class="line"></div><div class="line">myarr[<span class="number">4</span>]=<span class="number">10</span>;</div><div class="line"></div><div class="line"><span class="built_in">document</span>.write(myarr.length)</div><div class="line"></div><div class="line"><span class="built_in">document</span>.write(myarr[<span class="number">0</span>]) <span class="comment">//undefined</span></div></pre></td></tr></table></figure>
<h2 id="创建数组时赋值"><a href="#创建数组时赋值" class="headerlink" title="创建数组时赋值"></a>创建数组时赋值</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myarr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">140</span>,<span class="number">1324</span>);</div></pre></td></tr></table></figure>
<h2 id="字面数组"><a href="#字面数组" class="headerlink" title="字面数组"></a>字面数组</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myarr = [<span class="number">120</span>,<span class="number">34</span>,<span class="number">5</span>];</div></pre></td></tr></table></figure>
<p>数组里可以是任何类型(数字，字符，布尔值)</p>
<h2 id="数组属性"><a href="#数组属性" class="headerlink" title="数组属性"></a>数组属性</h2><p>长度：length</p>
<h2 id="二维数组"><a href="#二维数组" class="headerlink" title="二维数组"></a>二维数组</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myarr = <span class="keyword">new</span> <span class="built_in">Array</span>();</div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</div><div class="line">	myarr[i] = <span class="keyword">new</span> <span class="built_in">Array</span>();</div><div class="line">	</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</div><div class="line">		myarr[i][j] = i+j;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//打印数组</span></div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; myarr.length; i++) &#123;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; myarr[i].length; j++) &#123;</div><div class="line">		<span class="built_in">document</span>.write(myarr[i][j]+<span class="string">' '</span>);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="built_in">document</span>.write(<span class="string">'&lt;br /&gt;'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="字面常量方式"><a href="#字面常量方式" class="headerlink" title="字面常量方式"></a>字面常量方式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myarr = [[<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>],[<span class="number">2</span>,<span class="number">4</span>]]</div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; myarr.length; i++) &#123;</div><div class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; myarr[i].length; j++) &#123;</div><div class="line">		<span class="built_in">document</span>.write(myarr[i][j]+<span class="string">' '</span>);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="built_in">document</span>.write(<span class="string">'&lt;br /&gt;'</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h1><p>事件是可以别js检测到的行为。网页中的元素可以产生某些事件。比如：用户单击一个按钮时触发一个onClick事件。</p>
<table>
<thead>
<tr>
<th>事件</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>onclick</td>
<td>鼠标单击事件</td>
</tr>
<tr>
<td>onmouseover</td>
<td>鼠标经过事件</td>
</tr>
<tr>
<td>onmouseout</td>
<td>鼠标移动事件</td>
</tr>
<tr>
<td>onchange</td>
<td>文本框内容改变事件</td>
</tr>
<tr>
<td>onselect</td>
<td>文本框内容选中世事件</td>
</tr>
<tr>
<td>onfocus</td>
<td>获取到焦点时</td>
</tr>
<tr>
<td>onblur</td>
<td>失去焦点时</td>
</tr>
<tr>
<td>onload</td>
<td>网页加载时</td>
</tr>
<tr>
<td>onunload</td>
<td>关闭网页时</td>
</tr>
</tbody>
</table>
<h1 id="内置对象"><a href="#内置对象" class="headerlink" title="内置对象"></a>内置对象</h1><p>js中所以得事物都是对象，比如：字符串，数组，数值，函数。每个对象有一些属性和方法。</p>
<p>对象的属性：反应该对象的某些特质，比如：人有年龄。</p>
<p>对象的方法：反应某个对象执行的动作，比如：人可以吃饭，睡觉。</p>
<p>js提供了很多内置对象，比如：String,Date,Array等。</p>
<h2 id="Date"><a href="#Date" class="headerlink" title="Date"></a>Date</h2><p>日期对象可以存储任意一个日期，精确到毫秒。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>(); <span class="comment">//当前时间</span></div><div class="line"><span class="built_in">console</span>.log(d);</div><div class="line"></div><div class="line"><span class="keyword">var</span> d1 = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">2016</span>,<span class="number">10</span>,<span class="number">2</span>);</div><div class="line"><span class="built_in">console</span>.log(d1);</div><div class="line"></div><div class="line"><span class="keyword">var</span> d2 = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'oct 1,2012'</span>);</div><div class="line"><span class="built_in">console</span>.log(d2);</div></pre></td></tr></table></figure>
<p>处理日期时间相关的函数：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>get/setDate</td>
<td>获取/设置日期，日</td>
</tr>
<tr>
<td>get/setFullYear</td>
<td>获取/设置年份，YYYY</td>
</tr>
<tr>
<td>get/setYear</td>
<td>获取/设置年份,三位</td>
</tr>
<tr>
<td>get/setMonth</td>
<td>获取/设置月份，一月份-0月份</td>
</tr>
<tr>
<td>get/setHours</td>
<td>获取/设置小时，24小时制</td>
</tr>
<tr>
<td>get/setMinutes</td>
<td>获取/设置分钟数</td>
</tr>
<tr>
<td>get/setSeconds</td>
<td>获取/设置秒钟数</td>
</tr>
<tr>
<td>get/setTime</td>
<td>获取/设置时间，时间戳</td>
</tr>
<tr>
<td>set/getDay</td>
<td>返回星期，0~6，0表示星期天</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line"><span class="built_in">console</span>.log(d.getDate()); <span class="comment">//19，日</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(d.getFullYear()); <span class="comment">//2016，年</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(d.getYear()); <span class="comment">//116,年</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(d.getMonth()); <span class="comment">//10，月</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(d.getHours()); <span class="comment">//时</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(d.getMinutes()); <span class="comment">//分</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(d.getSeconds()); <span class="comment">//秒</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(d.getTime()); <span class="comment">//1479521736275,时间戳</span></div></pre></td></tr></table></figure>
<p>获取星期</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mydate = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line"><span class="keyword">var</span> weekday = [<span class="string">"星期日"</span>, <span class="string">"星期一"</span>, <span class="string">"星期二"</span>, <span class="string">"星期三"</span>, <span class="string">"星期四"</span>, <span class="string">"星期五"</span>, <span class="string">"星期六"</span>];</div><div class="line"><span class="built_in">document</span>.write(<span class="string">"今天是："</span> + weekday[mydate.getDay()]);</div></pre></td></tr></table></figure>
<p>将当前时间添加2小时</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mydate.setTime( mydate.getTime()  + <span class="number">2</span>* <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>);</div></pre></td></tr></table></figure>
<h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><h3 id="charAt返回指定位置的字符串"><a href="#charAt返回指定位置的字符串" class="headerlink" title="charAt返回指定位置的字符串"></a>charAt返回指定位置的字符串</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span>  s = <span class="string">"家居安静安静啊hello"</span>;</div><div class="line"><span class="built_in">document</span>.write(s.charAt(<span class="number">8</span>)); <span class="comment">//e</span></div><div class="line"><span class="built_in">document</span>.write(s.charAt(<span class="number">0</span>)); <span class="comment">//家</span></div></pre></td></tr></table></figure>
<h2 id="indexOf字符串查找"><a href="#indexOf字符串查找" class="headerlink" title="indexOf字符串查找"></a>indexOf字符串查找</h2><p>indexOf(subString,startPos)返回某个字符串出现的位置，没搜索到返回-1，区分大小写。</p>
<h3 id="split分割"><a href="#split分割" class="headerlink" title="split分割"></a>split分割</h3><p>split(separator,[limit])，显示返回的字符串个数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> s = <span class="string">"家居.安.静安静.啊hello"</span>;</div><div class="line"><span class="built_in">console</span>.log(s.split(<span class="string">'.'</span>)) <span class="comment">//家居,安,静安静,啊hello</span></div><div class="line"><span class="built_in">console</span>.log(s.split(<span class="string">'.'</span>, <span class="number">2</span>)) <span class="comment">//家居,安</span></div></pre></td></tr></table></figure>
<p>如果用””分割，则每个字符都分割</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//["家", "居", ".", "安", ".", "静", "安", "静", ".", "啊", "h", "e", "l</span></div><div class="line"><span class="built_in">console</span>.log(s.split(<span class="string">''</span>));</div></pre></td></tr></table></figure>
<h3 id="substring"><a href="#substring" class="headerlink" title="substring"></a>substring</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//居.</span></div><div class="line"><span class="built_in">console</span>.log(s.substring(<span class="number">1</span>, <span class="number">3</span>)); <span class="comment">//不包含位置3</span></div><div class="line"><span class="comment">//居.安</span></div><div class="line"><span class="built_in">console</span>.log(s.substr(<span class="number">1</span>,<span class="number">3</span>));</div></pre></td></tr></table></figure>
<p><a href="http://www.cnblogs.com/littledu/archive/2011/04/18/2019475.html" target="_blank" rel="external">http://www.cnblogs.com/littledu/archive/2011/04/18/2019475.html</a></p>
<p>区别：</p>
<p>string.substring( 起点 ， 终点 )</p>
<p>string.substr( 起点 ，长度 )</p>
<h2 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h2><p>提供常用的数学计算，平方，对数，π。</p>
<p>Math是一个固有对象，不用创建实例，就可以调用里面的属性，方法。</p>
<h3 id="对象属性"><a href="#对象属性" class="headerlink" title="对象属性"></a>对象属性</h3><table>
<thead>
<tr>
<th>属性名</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>E</td>
<td>数学常量E，即自然对数底数，2.718</td>
</tr>
<tr>
<td>LN2</td>
<td>2的自然对数，0.693</td>
</tr>
<tr>
<td>LN10</td>
<td>10的自然对数，2.302</td>
</tr>
<tr>
<td>LOG2E</td>
<td>2为底的e对数，1.442</td>
</tr>
<tr>
<td>LOG10E</td>
<td>10为底的e对数，0.434</td>
</tr>
<tr>
<td>PI</td>
<td>圆周率，3.14159</td>
</tr>
<tr>
<td>SQRT1_2</td>
<td>2的平方根的倒数，0.707</td>
</tr>
<tr>
<td>SQRT2</td>
<td>2的平方根</td>
</tr>
</tbody>
</table>
<h3 id="对象方法"><a href="#对象方法" class="headerlink" title="对象方法"></a>对象方法</h3><table>
<thead>
<tr>
<th>方法</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>abs(x)</td>
<td>数的绝对值</td>
</tr>
<tr>
<td>acos(x)</td>
<td>反余弦值</td>
</tr>
<tr>
<td>asin(x)</td>
<td>反正弦值</td>
</tr>
<tr>
<td>atan(x)</td>
<td>反正切值</td>
</tr>
<tr>
<td>atan2(y,x)</td>
<td>x轴到点(x,y)的角度(以弧度为单位)</td>
</tr>
<tr>
<td>ceil(x)</td>
<td>进行向上舍入</td>
</tr>
<tr>
<td>cos(x)</td>
<td>x的余弦值</td>
</tr>
<tr>
<td>exp(x)</td>
<td>e的指数</td>
</tr>
<tr>
<td>floor(x)</td>
<td>对数进行向下舍入</td>
</tr>
<tr>
<td>log(x)</td>
<td>自然对数，底为e</td>
</tr>
<tr>
<td>max(x,y)</td>
<td>x和y的最大值</td>
</tr>
<tr>
<td>min(x,y)</td>
<td>x和y的最小值</td>
</tr>
<tr>
<td>pow(x,y)</td>
<td>x的y次幂</td>
</tr>
<tr>
<td>random()</td>
<td>0~1之间的随机数</td>
</tr>
<tr>
<td>round(x)</td>
<td>四舍五入</td>
</tr>
<tr>
<td>sin(x)</td>
<td>数的正弦</td>
</tr>
<tr>
<td>sqrt(x)</td>
<td>数的平方根</td>
</tr>
<tr>
<td>tan(x)</td>
<td>正切</td>
</tr>
<tr>
<td>toSource()</td>
<td>返回对象的源代码，只有火狐支持</td>
</tr>
<tr>
<td>valueOf()</td>
<td>Math对象的原始值</td>
</tr>
</tbody>
</table>
<h2 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h2><h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><p>length:数组长度</p>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><table>
<thead>
<tr>
<th>方法名</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>concat()</td>
<td>连接多个数组，并返回，不改变源数组</td>
</tr>
<tr>
<td>join()</td>
<td>把数组的所有元素放入字符串，并用分隔符分割，默认逗号</td>
</tr>
<tr>
<td>pop()</td>
<td>删除并返回数组的最后一个元素</td>
</tr>
<tr>
<td>push()</td>
<td>向数组的末尾添加一个元素，并返回新长度</td>
</tr>
<tr>
<td>reverse()</td>
<td>颠倒数组中所以得元素</td>
</tr>
<tr>
<td>shift()</td>
<td>删除并返回数组的第一个元素</td>
</tr>
<tr>
<td>slice()</td>
<td>截取指定区域的元素</td>
</tr>
<tr>
<td>sort()</td>
<td>对数组元素排序，可以指定一个函数</td>
</tr>
<tr>
<td>splice()</td>
<td>删除元素，并向数组添加新元素</td>
</tr>
<tr>
<td>toString()</td>
<td>将数组转为字符串</td>
</tr>
<tr>
<td>toLocalString()</td>
<td>把数组转为本地字符串</td>
</tr>
<tr>
<td>unshift()</td>
<td>向数组添加一个或多个元素，并返回长度</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
</tr>
</tbody>
</table>
<h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h3><p>  若返回值&lt;=-1，则表示 A 在排序后的序列中出现在 B 之前。<br>  若返回值&gt;-1 &amp;&amp; <1，则表示 a="" 和="" b="" 具有相同的排序顺序。="" 若返回值="">=1，则表示 A 在排序后的序列中出现在 B 之后。</1，则表示></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sortNum</span>(<span class="params">a, b</span>) </span>&#123;</div><div class="line">	<span class="keyword">return</span> a - b;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> myarr = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="string">"80"</span>, <span class="string">"16"</span>, <span class="string">"50"</span>, <span class="string">"6"</span>, <span class="string">"100"</span>, <span class="string">"1"</span>);</div><div class="line">myarr.sort(sortNum)</div></pre></td></tr></table></figure>
<h2 id="Window"><a href="#Window" class="headerlink" title="Window"></a>Window</h2><p>window对象是BOM的核心，Browser Object Model，浏览器对象模型，他代指当前浏览器窗口。</p>
<table>
<thead>
<tr>
<th>方法名</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>alert()</td>
<td>显示一个代一段消息和一个确认按钮的警告框</td>
</tr>
<tr>
<td>prompt()</td>
<td>用户可以输入的对话框</td>
</tr>
<tr>
<td>confirm()</td>
<td>一段消息，确定和取消按钮的对话框</td>
</tr>
<tr>
<td>open()</td>
<td>打开一个浏览器窗口，或者查找一个已命名的窗口</td>
</tr>
<tr>
<td>close()</td>
<td>关闭一个窗口</td>
</tr>
<tr>
<td>print()</td>
<td>打印当前窗口的内容</td>
</tr>
<tr>
<td>focus()</td>
<td>把键盘焦点给予一个窗口</td>
</tr>
<tr>
<td>blur()</td>
<td>把键盘从一个窗口移开</td>
</tr>
<tr>
<td>moveBy()</td>
<td>相对当前坐标叠加到一个坐标</td>
</tr>
<tr>
<td>moveTo()</td>
<td>把窗口移动到一个指定的坐标</td>
</tr>
<tr>
<td>resizeBy()</td>
<td>调整当前窗口大小，叠加</td>
</tr>
<tr>
<td>resizeTo()</td>
<td>调整当前窗口大小到指定的宽高</td>
</tr>
<tr>
<td>scrollBy()</td>
<td>把内容滚动到指定的坐标，叠加</td>
</tr>
<tr>
<td>scrollTo()</td>
<td>把内容滚动到指定的坐标</td>
</tr>
<tr>
<td>setInterval()</td>
<td>每隔指定的时间执行代码</td>
</tr>
<tr>
<td>setTimeout()</td>
<td>延迟指定的时间执行代码</td>
</tr>
<tr>
<td>clearInterval()</td>
<td>取消setInterval的设置</td>
</tr>
<tr>
<td>clearTimeout()</td>
<td>取消setTimeout的设置</td>
</tr>
</tbody>
</table>
<h2 id="History"><a href="#History" class="headerlink" title="History"></a>History</h2><p>记录了用户曾经访问过的页面，并且可以实现浏览器的前进和后退。</p>
<p><strong>注意:从窗口被打开的那一刻开始记录，每个浏览器窗口、每个标签页乃至每个框架，都有自己的history对象与特定的window对象关联。</strong></p>
<p><strong>语法：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">window.history.[属性|方法]</div></pre></td></tr></table></figure>
<p><strong>注意：</strong>window可以省略。</p>
<h3 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h3><p>length:浏览器历史列表中的URL数量</p>
<h3 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h3><table>
<thead>
<tr>
<th>方法名</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>back()</td>
<td>前一个URL</td>
</tr>
<tr>
<td>forware()</td>
<td>下一个URL</td>
</tr>
<tr>
<td>go()</td>
<td>跳转到具体的某个页面</td>
</tr>
</tbody>
</table>
<h2 id="Location"><a href="#Location" class="headerlink" title="Location"></a>Location</h2><p>用于获取或设置窗体的URL,并且可以用于解析URL。</p>
<p><strong>语法:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">location.[属性|方法]</div></pre></td></tr></table></figure>
<p><img src="http://img.mukewang.com/53605c5a0001b26909900216.jpg" alt=""></p>
<h3 id="属性-2"><a href="#属性-2" class="headerlink" title="属性"></a>属性</h3><table>
<thead>
<tr>
<th>属性名</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>hash</td>
<td>从#开始的URL,也就是锚</td>
</tr>
<tr>
<td>host</td>
<td>主机名和端口号</td>
</tr>
<tr>
<td>hostname</td>
<td>url主机名</td>
</tr>
<tr>
<td>href</td>
<td>完整的url</td>
</tr>
<tr>
<td>pathname</td>
<td>路径</td>
</tr>
<tr>
<td>port</td>
<td>端口</td>
</tr>
<tr>
<td>protocol</td>
<td>url协议</td>
</tr>
<tr>
<td>search</td>
<td>从问号开始的URL，查询部分</td>
</tr>
</tbody>
</table>
<h3 id="方法-2"><a href="#方法-2" class="headerlink" title="方法"></a>方法</h3><table>
<thead>
<tr>
<th>方法名</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>assign()</td>
<td>加载新的文档</td>
</tr>
<tr>
<td>reload()</td>
<td>重新载入当前文档</td>
</tr>
<tr>
<td>replace()</td>
<td>用新文档替换当前文档</td>
</tr>
</tbody>
</table>
<h2 id="Navigator"><a href="#Navigator" class="headerlink" title="Navigator"></a>Navigator</h2><p>包含浏览器的信息，通常用于检测浏览器与操作系统的版本。</p>
<h3 id="属性-3"><a href="#属性-3" class="headerlink" title="属性"></a>属性</h3><table>
<thead>
<tr>
<th>属性名</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>appCodeName</td>
<td>浏览器代码名字符串表示</td>
</tr>
<tr>
<td>appName</td>
<td>返回浏览器名字</td>
</tr>
<tr>
<td>appVersion</td>
<td>浏览器平台和版本信息</td>
</tr>
<tr>
<td>platform</td>
<td>运行浏览器的操作系统平台</td>
</tr>
<tr>
<td>userAgent</td>
<td>返回客户机发给服务器user-agent头的值</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.write(navigator.appCodeName+<span class="string">'&lt;br /&gt;'</span>);</div><div class="line"><span class="built_in">document</span>.write(navigator.appName+<span class="string">'&lt;br /&gt;'</span>);</div><div class="line"><span class="built_in">document</span>.write(navigator.appVersion+<span class="string">'&lt;br /&gt;'</span>);</div><div class="line"><span class="built_in">document</span>.write(navigator.platform+<span class="string">'&lt;br /&gt;'</span>);</div><div class="line"><span class="built_in">document</span>.write(navigator.userAgent+<span class="string">'&lt;br /&gt;'</span>);</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Mozilla</div><div class="line">Netscape</div><div class="line">5.0 (Macintosh; Intel Mac OS X 10_11_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.98 Safari/537.36</div><div class="line">MacIntel</div><div class="line">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.98 Safari/537.36</div></pre></td></tr></table></figure>
<p>通过userAgent判断是什么浏览器：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> u_agent = navigator.userAgent;</div><div class="line"><span class="keyword">var</span> B_name = <span class="string">"不是想用的主流浏览器!"</span>;</div><div class="line"><span class="keyword">if</span>(u_agent.indexOf(<span class="string">"Firefox"</span>) &gt; <span class="number">-1</span>) &#123;</div><div class="line">	B_name = <span class="string">"Firefox"</span>;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(u_agent.indexOf(<span class="string">"Chrome"</span>) &gt; <span class="number">-1</span>) &#123;</div><div class="line">	B_name = <span class="string">"Chrome"</span>;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(u_agent.indexOf(<span class="string">"MSIE"</span>) &gt; <span class="number">-1</span> &amp;&amp; u_agent.indexOf(<span class="string">"Trident"</span>) &gt; <span class="number">-1</span>) &#123;</div><div class="line">	B_name = <span class="string">"IE(8-10)"</span>;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(u_agent.indexOf(<span class="string">"Safari"</span>) &gt; <span class="number">-1</span>) &#123;</div><div class="line">	B_name = <span class="string">"Safari"</span>;</div><div class="line">&#125;</div><div class="line"><span class="built_in">document</span>.write(<span class="string">"浏览器:"</span> + B_name + <span class="string">"&lt;br&gt;"</span>);</div><div class="line"><span class="built_in">document</span>.write(<span class="string">"u_agent:"</span> + u_agent + <span class="string">"&lt;br&gt;"</span>);</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">浏览器:Chrome</div><div class="line">u_agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.98 Safari/537.36</div></pre></td></tr></table></figure>
<h2 id="Screen"><a href="#Screen" class="headerlink" title="Screen"></a>Screen</h2><p>用于获取用户的屏幕信息。</p>
<h3 id="属性-4"><a href="#属性-4" class="headerlink" title="属性"></a>属性</h3><table>
<thead>
<tr>
<th>属性名</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>availHeight</td>
<td>窗口可用的屏幕高度,px, 减去界面特性,如任务栏</td>
</tr>
<tr>
<td>availWidth</td>
<td>可用的屏幕宽度，px</td>
</tr>
<tr>
<td>colorDepth</td>
<td>用户浏览器表示的颜色位数，通常为32位</td>
</tr>
<tr>
<td>pixeDepth</td>
<td>同上，ie不支持</td>
</tr>
<tr>
<td>height</td>
<td>屏幕的高度，px</td>
</tr>
<tr>
<td>width</td>
<td>屏幕的宽度，px</td>
</tr>
</tbody>
</table>
<p>屏幕宽高：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//macbook 13.3 retina</span></div><div class="line"><span class="built_in">document</span>.write(screen.width+<span class="string">'&lt;br /&gt;'</span>); <span class="comment">//1280</span></div><div class="line"><span class="built_in">document</span>.write(screen.height+<span class="string">'&lt;br /&gt;'</span>); <span class="comment">//800</span></div></pre></td></tr></table></figure>
<p>屏幕可用宽高</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.write(<span class="string">"可用宽度："</span> + screen.availWidth); <span class="comment">//1280</span></div><div class="line"><span class="built_in">document</span>.write(<span class="string">"可用高度："</span> + screen.availHeight); <span class="comment">//705</span></div></pre></td></tr></table></figure>
<h2 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h2><p>DOM(Document Object Model)定义和处理HTML文档的标准方法，DOM将html呈现为元素，属性，文本的树结构，也叫节点树。</p>
<p>HTML文档可以说由节点构成的集合，DOM节点有:</p>
<ol>
<li>元素节点：上图中<html>、<body>、<p>等都是元素节点，即标签。</p></body></html></li>
<li>文本节点:向用户展示的内容，如</li><li>…</li>中的JavaScript、DOM、CSS等文本。
<li>属性节点:元素属性，如<a>标签的链接属性href=”<a href="http://bing.com&quot;。" target="_blank" rel="external">http://bing.com&quot;。</a></a></li>
</ol>
<h3 id="属性-5"><a href="#属性-5" class="headerlink" title="属性"></a>属性</h3><table>
<thead>
<tr>
<th>属性名</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>nodeName</td>
<td>节点名称，字符串</td>
</tr>
<tr>
<td>nodeType</td>
<td>节点类型，整型</td>
</tr>
<tr>
<td>nodeValue</td>
<td>节点值，字符串</td>
</tr>
</tbody>
</table>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;body&gt;</div><div class="line">	&lt;h1 id="h1"&gt;h1&lt;/h1&gt;</div><div class="line">	&lt;ul&gt;</div><div class="line">		&lt;li&gt;l1&lt;/li&gt;</div><div class="line">		&lt;li&gt;l2&lt;/li&gt;</div><div class="line">		&lt;li&gt;l3&lt;/li&gt;</div><div class="line">		&lt;li&gt;l4&lt;/li&gt;</div><div class="line">		&lt;li&gt;l5&lt;/li&gt;</div><div class="line">	&lt;/ul&gt;</div><div class="line"></div><div class="line">	&lt;script&gt;</div><div class="line">		var h1 = document.getElementById('h1');</div><div class="line">		console.log(h1.nodeName); //H1</div><div class="line">		console.log(h1.nodeType); //1</div><div class="line">		console.log(h1.childNodes[0].nodeValue); //h1</div><div class="line">	&lt;/script&gt;</div><div class="line">&lt;/body&gt;</div></pre></td></tr></table></figure>
<h3 id="遍历节点方法"><a href="#遍历节点方法" class="headerlink" title="遍历节点方法"></a>遍历节点方法</h3><table>
<thead>
<tr>
<th>方法名</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>childNodes</td>
<td>元素子节点，数组</td>
</tr>
<tr>
<td>firstChild</td>
<td>第一个子节点</td>
</tr>
<tr>
<td>lastChild</td>
<td>最后一个子节点</td>
</tr>
<tr>
<td>parentNode</td>
<td>父节点</td>
</tr>
<tr>
<td>nextSibling</td>
<td>当前节点的下一个节点</td>
</tr>
<tr>
<td>previousSibling</td>
<td>当前节点的上一个节点</td>
</tr>
</tbody>
</table>
<h3 id="节点操作方法"><a href="#节点操作方法" class="headerlink" title="节点操作方法"></a>节点操作方法</h3><table>
<thead>
<tr>
<th>方法名</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>createElement(name)</td>
<td>创建一个新节点</td>
</tr>
<tr>
<td>createTextNode(text)</td>
<td>创建包含给定文本的文本节点</td>
</tr>
<tr>
<td>appendChild()</td>
<td>指定节点的子节点最后位置添加新节点</td>
</tr>
<tr>
<td>insertBefore()</td>
<td></td>
</tr>
<tr>
<td>removeChild()</td>
<td>从给定元素中删除一个子节点</td>
</tr>
<tr>
<td>replaceChild()</td>
<td>替换一个节点</td>
</tr>
</tbody>
</table>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">"h1"</span>&gt;</span>h1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">ul</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span>l1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span>l2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"ul_l3"</span>&gt;</span>l3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span>l4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">li</span>&gt;</span>l5<span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="keyword">var</span> ul = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'ul'</span>)[<span class="number">0</span>];</div><div class="line"></div><div class="line">			<span class="keyword">var</span> ul_l3 = <span class="built_in">document</span>.getElementById(<span class="string">'ul_l3'</span>);</div><div class="line"></div><div class="line">			<span class="keyword">var</span> h2Node = <span class="built_in">document</span>.createElement(<span class="string">"h2"</span>);</div><div class="line">			<span class="keyword">var</span> textNode = <span class="built_in">document</span>.createTextNode(<span class="string">'这是text'</span>);</div><div class="line"></div><div class="line">			<span class="keyword">var</span> replaceextNode = <span class="built_in">document</span>.createTextNode(<span class="string">'这是替换进来的'</span>);</div><div class="line"></div><div class="line">			ul.appendChild(h2Node);</div><div class="line"></div><div class="line">			ul.insertBefore(textNode, ul_l3);</div><div class="line"></div><div class="line">			ul.replaceChild(replaceextNode, ul_l3);</div><div class="line"></div><div class="line">			ul.removeChild(replaceextNode);</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>添加一个li标签</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> otest = <span class="built_in">document</span>.getElementById(<span class="string">"test"</span>);</div><div class="line"><span class="keyword">var</span> newNode = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>);</div><div class="line">newNode.innerText = <span class="string">'PHP'</span>;</div><div class="line">otest.appendChild(newNode);</div></pre></td></tr></table></figure>
<p>移除所以的子节点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE HTML&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>无标题文档<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">h1</span>&gt;</span>html<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">h1</span>&gt;</span>php<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">h1</span>&gt;</span>javascript<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">h1</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">h1</span>&gt;</span>java<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="function"><span class="keyword">function</span> <span class="title">clearText</span>(<span class="params"></span>) </span>&#123;</div><div class="line">				<span class="keyword">var</span> content = <span class="built_in">document</span>.getElementById(<span class="string">"content"</span>);</div><div class="line">				<span class="keyword">var</span> nodes = content.childNodes;</div><div class="line">				<span class="comment">// 在此完成该函数</span></div><div class="line"></div><div class="line">				<span class="keyword">while</span>(content.firstChild) &#123;</div><div class="line">					content.removeChild(content.firstChild);</div><div class="line">				&#125;</div><div class="line"></div><div class="line">			&#125;</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"clearText()"</span>&gt;</span>清除节点内容<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>替换子节点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE HTML&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>无标题文档<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">b</span> <span class="attr">id</span>=<span class="string">"oldnode"</span>&gt;</span>JavaScript<span class="tag">&lt;/<span class="name">b</span>&gt;</span>是一个很常用的技术，为网页添加动态效果。<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:replaceMessage()"</span>&gt;</span> 将加粗改为斜体<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="function"><span class="keyword">function</span> <span class="title">replaceMessage</span>(<span class="params"></span>) </span>&#123;</div><div class="line">				<span class="keyword">var</span> oldnode = <span class="built_in">document</span>.getElementById(<span class="string">'oldnode'</span>);</div><div class="line">				<span class="keyword">var</span> newNode = <span class="built_in">document</span>.createElement(<span class="string">'i'</span>);</div><div class="line">				newNode.innerText = oldnode.innerText;</div><div class="line">				oldnode.parentNode.replaceChild(newNode, oldnode);</div><div class="line">			&#125;</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>动态创建一个标签</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE HTML&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>无标题文档<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="keyword">var</span> main = <span class="built_in">document</span>.body;</div><div class="line">			<span class="comment">//创建链接</span></div><div class="line">			<span class="function"><span class="keyword">function</span> <span class="title">createa</span>(<span class="params">url, text</span>) </span>&#123;</div><div class="line">				<span class="keyword">var</span> newNode = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</div><div class="line">				newNode.setAttribute(<span class="string">'href'</span>, url);</div><div class="line">				newNode.innerText = text;</div><div class="line">				<span class="keyword">return</span> newNode;</div><div class="line">			&#125;</div><div class="line">			<span class="comment">// 调用函数创建链接</span></div><div class="line"></div><div class="line">			<span class="keyword">var</span> newNode = createa(<span class="string">"http://baidu.com"</span>, <span class="string">"百度"</span>);</div><div class="line">			main.appendChild(newNode);</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>创建文本节点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE HTML&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=utf-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>无标题文档<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></div><div class="line">			.message &#123;</div><div class="line">				width: 200px;</div><div class="line">				height: 100px;</div><div class="line">				background-color: #CCC;</div><div class="line">			&#125;</div><div class="line">		<span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="keyword">var</span> divNode = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</div><div class="line">			divNode.className = <span class="string">'message'</span>;</div><div class="line">			<span class="keyword">var</span> textNode = <span class="built_in">document</span>.createTextNode(<span class="string">'I love JavaScript!'</span>);</div><div class="line">			divNode.appendChild(textNode);</div><div class="line">			<span class="built_in">document</span>.body.appendChild(divNode);</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>浏览器窗口可视区域大小</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="keyword">var</span> w = <span class="built_in">document</span>.documentElement.clientWidth ||</div><div class="line">				<span class="built_in">document</span>.body.clientWidth;</div><div class="line">			<span class="keyword">var</span> h = <span class="built_in">document</span>.documentElement.clientHeight ||</div><div class="line">				<span class="built_in">document</span>.body.clientHeight;</div><div class="line"></div><div class="line">			alert(w);</div><div class="line">			alert(h);</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>完整的节点操作案例：动态创建表格一行，删除一行，鼠标经过改变颜色。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div></pre></td><td class="code"><pre><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span> new document <span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">			<span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">				<span class="comment">// 鼠标移动改变背景,可以通过给每行绑定鼠标移上事件和鼠标移除事件来改变所在行背景色。</span></div><div class="line">				<span class="keyword">var</span> trs = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'tr'</span>);</div><div class="line">				<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; trs.length; i++) &#123;</div><div class="line"></div><div class="line">					nodeChangeColor(trs[i]);</div><div class="line">					nodeResetColor(trs[i]);</div><div class="line">				&#125;</div><div class="line"></div><div class="line">			&#125;</div><div class="line"></div><div class="line">			<span class="function"><span class="keyword">function</span> <span class="title">nodeChangeColor</span>(<span class="params">n</span>) </span>&#123;</div><div class="line">				n.onmouseover = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">					<span class="keyword">this</span>.style.backgroundColor = <span class="string">"red"</span>;</div><div class="line"></div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			<span class="function"><span class="keyword">function</span> <span class="title">nodeResetColor</span>(<span class="params">n</span>) </span>&#123;</div><div class="line">				n.onmouseout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">					<span class="keyword">this</span>.style.backgroundColor = <span class="string">""</span>;</div><div class="line"></div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			<span class="comment">// 编写一个函数，供添加按钮调用，动态在表格的最后一行添加子节点；</span></div><div class="line"></div><div class="line">			<span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</div><div class="line">				<span class="keyword">var</span> table = <span class="built_in">document</span>.getElementById(<span class="string">'table'</span>).lastChild; <span class="comment">//tbody</span></div><div class="line"></div><div class="line">				<span class="keyword">var</span> tr = <span class="built_in">document</span>.createElement(<span class="string">'tr'</span>);</div><div class="line"></div><div class="line">				nodeChangeColor(tr);</div><div class="line">				nodeResetColor(tr);</div><div class="line"></div><div class="line">				<span class="keyword">var</span> td = <span class="built_in">document</span>.createElement(<span class="string">'td'</span>);</div><div class="line">				td.innerText = <span class="string">"你好"</span>;</div><div class="line"></div><div class="line">				<span class="keyword">var</span> td1 = <span class="built_in">document</span>.createElement(<span class="string">'td'</span>);</div><div class="line">				td1.innerText = <span class="string">"哈哈"</span>;</div><div class="line"></div><div class="line">				<span class="keyword">var</span> td2 = <span class="built_in">document</span>.createElement(<span class="string">'td'</span>);</div><div class="line"></div><div class="line">				<span class="comment">//a</span></div><div class="line">				<span class="keyword">var</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</div><div class="line">				a.setAttribute(<span class="string">'href'</span>, <span class="string">'javascript:;'</span>);</div><div class="line">				a.setAttribute(<span class="string">'onclick'</span>, <span class="string">"del(this)"</span>);</div><div class="line"></div><div class="line">				a.innerText = <span class="string">'删除'</span>;</div><div class="line"></div><div class="line">				td2.appendChild(a);</div><div class="line"></div><div class="line">				tr.appendChild(td);</div><div class="line">				tr.appendChild(td1);</div><div class="line">				tr.appendChild(td2);</div><div class="line"></div><div class="line">				table.appendChild(tr);</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			<span class="comment">// 创建删除函数</span></div><div class="line">			<span class="function"><span class="keyword">function</span> <span class="title">del</span>(<span class="params">obj</span>) </span>&#123; <span class="comment">//obj是外面传入的参数this，也就是删除字段的节点TD</span></div><div class="line"></div><div class="line">				<span class="keyword">var</span> a = obj.parentNode.parentNode.parentNode; <span class="comment">//获取最外层节点table</span></div><div class="line"></div><div class="line">				<span class="keyword">var</span> b = obj.parentNode.parentNode; <span class="comment">//获取第二层节点TR，TR里有3个TD，为一行</span></div><div class="line"></div><div class="line">				a.removeChild(b); <span class="comment">//利用父节点table删除子节点TR</span></div><div class="line"></div><div class="line">			&#125;</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span> <span class="attr">width</span>=<span class="string">"50%"</span> <span class="attr">id</span>=<span class="string">"table"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>学号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>姓名<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">th</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line"></div><div class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>xh001<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>王小明<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">onclick</span>=<span class="string">"del(this)"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="comment">&lt;!--在删除按钮上添加点击事件  --&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line"></div><div class="line">			<span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>xh002<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span>刘小芳<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">td</span>&gt;</span></div><div class="line">					<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">onclick</span>=<span class="string">"del(this)"</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">				<span class="tag">&lt;/<span class="name">td</span>&gt;</span></div><div class="line">				<span class="comment">&lt;!--在删除按钮上添加点击事件  --&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="tag">&lt;/<span class="name">table</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"添加一行"</span> <span class="attr">onclick</span>=<span class="string">"add()"</span> /&gt;</span></div><div class="line">		<span class="comment">&lt;!--在添加按钮上添加点击事件  --&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>节点类型</p>
<table>
<thead>
<tr>
<th>元素类型</th>
<th>节点类型</th>
</tr>
</thead>
<tbody>
<tr>
<td>元素</td>
<td>1</td>
</tr>
<tr>
<td>属性</td>
<td>2</td>
</tr>
<tr>
<td>文本</td>
<td>3</td>
</tr>
<tr>
<td>注释</td>
<td>8</td>
</tr>
<tr>
<td>文档</td>
<td>9</td>
</tr>
</tbody>
</table>
<h1 id="JavaScript版本"><a href="#JavaScript版本" class="headerlink" title="JavaScript版本"></a>JavaScript版本</h1><p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/Screen%20Shot%202016-12-02%20at%2011.17.10%20PM.png" alt=""></p>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h2><p>break<br>case<br>catch<br>continue<br>default<br>delete<br>do<br>else<br>finally<br>for<br>function<br>if<br>in<br>instanceof<br>new<br>return<br>switch<br>this<br>throw<br>try<br>typeof<br>var<br>void<br>while<br>with</p>
<h2 id="保留字"><a href="#保留字" class="headerlink" title="保留字"></a>保留字</h2><p>abstract<br>boolean<br>byte<br>char<br>class<br>const<br>debugger<br>double<br>enum<br>export<br>extends<br>fimal<br>float<br>goto<br>implements<br>import<br>int<br>interface<br>long<br>mative<br>package<br>private<br>protected<br>public<br>short<br>static<br>super<br>synchronized<br>throws<br>transient<br>volatile</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h1&gt;&lt;h2 id=&quot;他能做什么&quot;&gt;&lt;a href=&quot;#他能做什么&quot; class=&quot;headerlink&quot; title=&quot;他能做什么&quot;&gt;&lt;/a&gt;他能做什
    
    </summary>
    
      <category term="JavaScript" scheme="http://i.woblog.cn/categories/JavaScript/"/>
    
    
      <category term="JavaScript" scheme="http://i.woblog.cn/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>React Native</title>
    <link href="http://i.woblog.cn/2016/11/14/react-native-env/"/>
    <id>http://i.woblog.cn/2016/11/14/react-native-env/</id>
    <published>2016-11-14T23:07:23.000Z</published>
    <updated>2017-03-19T14:22:37.668Z</updated>
    
    <content type="html"><![CDATA[<h1 id="搭建React-Native开发环境"><a href="#搭建React-Native开发环境" class="headerlink" title="搭建React Native开发环境"></a>搭建React Native开发环境</h1><h2 id="安装xcode"><a href="#安装xcode" class="headerlink" title="安装xcode"></a>安装xcode</h2><p>可以从app Store下载或者在苹果开发者中心下载。</p>
<h2 id="安装Command-Line-Tools"><a href="#安装Command-Line-Tools" class="headerlink" title="安装Command Line Tools"></a>安装Command Line Tools</h2><p>里面包括git这样的命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">xcode-select --install</div></pre></td></tr></table></figure>
<h2 id="安装homebrew"><a href="#安装homebrew" class="headerlink" title="安装homebrew"></a>安装homebrew</h2><p>mac上的一个软件包管理器，和linux上的yum,apt-get差不多</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</div></pre></td></tr></table></figure>
<h2 id="安装watchman"><a href="#安装watchman" class="headerlink" title="安装watchman"></a>安装watchman</h2><p>facebook的一个开源项目，用来监视文件并且记录文件改动情况的一个库。</p>
<h2 id="安装flow"><a href="#安装flow" class="headerlink" title="安装flow"></a>安装flow</h2><p>JavaScript的静态类检查器，用于找出JavaScript代码中的类型错误。</p>
<p>当然推荐是安装完在nodejs开发中常见的依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">brew install flow git gcc pkg-config cairo libpng jpeg mongodb</div></pre></td></tr></table></figure>
<p>注意：安装mongodb前先要安装pkg-config，makedepend。如果报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Error: You must `brew link pkg-config makedepend` before mongodb can be installed</div></pre></td></tr></table></figure>
<p>就要链接：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">brew link makedepend</div><div class="line">brew link pkg-config</div></pre></td></tr></table></figure>
<h2 id="安装nodejs"><a href="#安装nodejs" class="headerlink" title="安装nodejs"></a>安装nodejs</h2><p>建议使用nvm，因为他可以管理多个版本</p>
<p>官方仓库：<a href="https://github.com/creationix/nvm" target="_blank" rel="external">https://github.com/creationix/nvm</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.32.1/install.sh | bash</div></pre></td></tr></table></figure>
<p>安装完成后就可以执行nvm命令了。</p>
<p>安装nodejs</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">nvm install v4.2.3</div><div class="line">nvm alias default v4.2.3</div></pre></td></tr></table></figure>
<p>当前版本为：</p>
<p>➜  ~ node -v<br>v4.2.3</p>
<p>➜  ~ npm -v<br>2.14.7</p>
<p>由于国内有时npm仓库有点慢，所以切换淘宝源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install cnpm -g</div></pre></td></tr></table></figure>
<h2 id="安装react-native"><a href="#安装react-native" class="headerlink" title="安装react native"></a>安装react native</h2><p>安装脚手架</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cnpm install -g react-native-cli@0.1.10 -g</div><div class="line">react-native -v</div></pre></td></tr></table></figure>
<h2 id="创建第一个项目"><a href="#创建第一个项目" class="headerlink" title="创建第一个项目"></a>创建第一个项目</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">react-native init firstApp</div></pre></td></tr></table></figure>
<p>创建完成后会有如下信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">To run your app on iOS:</div><div class="line">   cd /Users/renpingqing/Documents/work/react/fistApp</div><div class="line">   react-native run-ios</div><div class="line">   - or -</div><div class="line">   Open /Users/renpingqing/Documents/work/react/fistApp/ios/fistApp.xcodeproj in Xcode</div><div class="line">   Hit the Run button</div><div class="line">To run your app on Android:</div><div class="line">   Have an Android emulator running (quickest way to get started), or a device connected</div><div class="line">   cd /Users/renpingqing/Documents/work/react/fistApp</div><div class="line">   react-native run-android</div></pre></td></tr></table></figure>
<p>现在就可以运行试试看。</p>
<p>运行完后，我可以尝试修改一些代码，来看看效果，但是如果每次修改都刷新模拟器(command+r)这很痛苦的，我们可以通过(command+d)，开启live reload，就可以实现每次保存源代码就自动刷新的功能了。</p>
<h2 id="配置subline"><a href="#配置subline" class="headerlink" title="配置subline"></a>配置subline</h2><p>首选安装package control(<a href="https://packagecontrol.io),这是一个专门管理sb的包网站。安装方法" target="_blank" rel="external">https://packagecontrol.io),这是一个专门管理sb的包网站。安装方法</a></p>
<p>点击网页的install now，左边会显示安装代码，只需要将这些复制到sb，按control+~贴入代码，安装完成后可以通过command+shift+p呼出package control的窗口。</p>
<p>输入install，然后输入要安装的包，回车就可以安装了。这里安装babel,sublimelinter-jsxhint(安装了就不会提示)。</p>
<p>安装完成后就可以通过sb的view-syntax-open all*-babel-javaScript(babel)，就能将当前语法识别为jsx。</p>
<p>还可以安装gitgutter，sublimelinter,sublimelinter-contrib-eslint。</p>
<h2 id="安装全局exhint检查"><a href="#安装全局exhint检查" class="headerlink" title="安装全局exhint检查"></a>安装全局exhint检查</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install -g eslint babel-eslint --registry=http:<span class="comment">//registry.npm.taobao.org</span></div></pre></td></tr></table></figure>
<h1 id="react-native项目结构"><a href="#react-native项目结构" class="headerlink" title="react-native项目结构"></a>react-native项目结构</h1><p>可以看做是一个node js项目因为根目录有一个package.json文件，对应一个node_modules的文件夹是该项目的依赖。他下面有个react-native下面又有local-cli和packager(终端打开启动的package就是他)，同时还有一个node_modules，他就是react-native框架所依赖的库。</p>
<p>在最外层可以看到有ios和android目录分别对应相应平台的代码。</p>
<p>.flowconfig：js语法检查规则</p>
<p>.gitignore:版本控制忽略文件</p>
<p>.watchmanconfig：watchman配置文件</p>
<p>index.ios.js结构：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123;</div><div class="line">  AppRegistry,</div><div class="line">  StyleSheet,</div><div class="line">  Text,</div><div class="line">  View</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</div></pre></td></tr></table></figure>
<p>导入要用到的模块语法，结构赋值es6语法。表示从react-native导出了Text，View等。有点像python的导入。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">fistApp</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.welcome&#125;</span>&gt;</span></div><div class="line">          Welcome to React a!</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.instructions&#125;</span>&gt;</span></div><div class="line">          To get started, edit index.ios.js</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.instructions&#125;</span>&gt;</span></div><div class="line">          Press Cmd+R to reload,&#123;'\n'&#125;</div><div class="line">          Cmd+D or shake for dev menu</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>继承Component实现一个类，并实现render方法，返回一些jsx语法的内容。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> styles = StyleSheet.create(&#123;</div><div class="line">  <span class="attr">container</span>: &#123;</div><div class="line">    <span class="attr">flex</span>: <span class="number">1</span>,</div><div class="line">    <span class="attr">justifyContent</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">alignItems</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">backgroundColor</span>: <span class="string">'#F5FCFF'</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">welcome</span>: &#123;</div><div class="line">    <span class="attr">fontSize</span>: <span class="number">20</span>,</div><div class="line">    <span class="attr">textAlign</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">margin</span>: <span class="number">10</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">instructions</span>: &#123;</div><div class="line">    <span class="attr">textAlign</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">color</span>: <span class="string">'#333333'</span>,</div><div class="line">    <span class="attr">marginBottom</span>: <span class="number">5</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>样式代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">AppRegistry.registerComponent(<span class="string">'fistApp'</span>, () =&gt; fistApp);</div></pre></td></tr></table></figure>
<p>注册RN的入口代码。</p>
<h1 id="统计按钮点击次数"><a href="#统计按钮点击次数" class="headerlink" title="统计按钮点击次数"></a>统计按钮点击次数</h1><p>现在项目已经跑起来了，我做一个统计屏幕点击次数的例子</p>
<p>index.ios.js</p>
<p>我们将render方法改为如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">render() &#123;</div><div class="line">  <span class="keyword">return</span> (</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">      <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.welcome&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this.timesPlus.bind(this)&#125;</span>&gt;</span></div><div class="line">        你敢点击我吗</div><div class="line">      <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.instructions&#125;</span>&gt;</span></div><div class="line">        点击了 &#123;this.state.times&#125; 次</div><div class="line">      <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">  );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>并给第一个Text绑定了一个onPress事件，点击时就会调用timesPlus方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">timesPlus()&#123;</div><div class="line">  <span class="keyword">let</span> times=<span class="keyword">this</span>.state.times</div><div class="line"></div><div class="line">  times++</div><div class="line"></div><div class="line">  <span class="keyword">this</span>.setState(&#123;</div><div class="line">    <span class="attr">times</span>:times</div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>逻辑就是拿到当前state里面的times加1，然后在赋值回去。完整代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Sample React Native App</div><div class="line"> * https://github.com/facebook/react-native</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">import</span> React, &#123;</div><div class="line">  AppRegistry,</div><div class="line">  Component,</div><div class="line">  StyleSheet,</div><div class="line">  Text,</div><div class="line">  View</div><div class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">dog</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(props)&#123;</div><div class="line">    <span class="keyword">super</span>(props)</div><div class="line">    <span class="keyword">this</span>.state=&#123;<span class="attr">times</span>:<span class="number">0</span>&#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  timesPlus()&#123;</div><div class="line">    <span class="keyword">let</span> times=<span class="keyword">this</span>.state.times</div><div class="line"></div><div class="line">    times++</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.setState(&#123;</div><div class="line">      <span class="attr">times</span>:times</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.welcome&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this.timesPlus.bind(this)&#125;</span>&gt;</span></div><div class="line">          你敢点击我吗</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.instructions&#125;</span>&gt;</span></div><div class="line">          点击了 &#123;this.state.times&#125; 次</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">const</span> styles = StyleSheet.create(&#123;</div><div class="line">  <span class="attr">container</span>: &#123;</div><div class="line">    <span class="attr">flex</span>: <span class="number">1</span>,</div><div class="line">    <span class="attr">justifyContent</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">alignItems</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">backgroundColor</span>: <span class="string">'#F5FCFF'</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">welcome</span>: &#123;</div><div class="line">    <span class="attr">fontSize</span>: <span class="number">20</span>,</div><div class="line">    <span class="attr">textAlign</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">margin</span>: <span class="number">10</span>,</div><div class="line">  &#125;,</div><div class="line">  <span class="attr">instructions</span>: &#123;</div><div class="line">    <span class="attr">textAlign</span>: <span class="string">'center'</span>,</div><div class="line">    <span class="attr">color</span>: <span class="string">'#333333'</span>,</div><div class="line">    <span class="attr">marginBottom</span>: <span class="number">5</span>,</div><div class="line">  &#125;,</div><div class="line">&#125;);</div><div class="line"></div><div class="line">AppRegistry.registerComponent(<span class="string">'dog'</span>, () =&gt; dog);</div></pre></td></tr></table></figure>
<h1 id="组件生命周期"><a href="#组件生命周期" class="headerlink" title="组件生命周期"></a>组件生命周期</h1><p>先上一张图</p>
<p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/Screen%20Shot%202016-12-01%20at%2011.09.48%20PM.png" alt=""></p>
<p>第一次组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">componentWillMount</div><div class="line">render</div><div class="line">componentDidMount</div></pre></td></tr></table></figure>
<p>状态改变</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">shouldComponentUpdate</div><div class="line">componentWillUpdate</div><div class="line">render</div><div class="line">componentDidUpdate</div></pre></td></tr></table></figure>
<h2 id="嵌套组件"><a href="#嵌套组件" class="headerlink" title="嵌套组件"></a>嵌套组件</h2><h3 id="第一次加载"><a href="#第一次加载" class="headerlink" title="第一次加载"></a>第一次加载</h3><p>father getDefaultProps<br>son getDefaultProps<br>father getInitialState<br>father componentWillMount<br>father render<br>son getInitialState<br>son componentWillMount<br>son render<br>son componentDidMount<br>father componentDidMount</p>
<p>可以看到先渲染父组件，然后渲染子组件</p>
<h3 id="父组件状态变化"><a href="#父组件状态变化" class="headerlink" title="父组件状态变化"></a>父组件状态变化</h3><p>father shouldComponentUpdate<br>father componentWillUpdate<br>father render<br>son getInitialState<br>son componentWillMount<br>son render<br>son componentDidMount<br>father componentDidUpdate</p>
<h3 id="只有子组件变化"><a href="#只有子组件变化" class="headerlink" title="只有子组件变化"></a>只有子组件变化</h3><p>son shouldComponentUpdate<br>son componentWillUpdate<br>son render<br>son componentDidUpdate</p>
<p>测试该组件生命周期的代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Sample React Native App</div><div class="line"> * https://github.com/facebook/react-native</div><div class="line"> */</div><div class="line"><span class="keyword">var</span> React=<span class="built_in">require</span>(<span class="string">'react-native'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> &#123;</div><div class="line">  AppRegistry,</div><div class="line">  Component,</div><div class="line">  StyleSheet,</div><div class="line">  Text,</div><div class="line">  View</div><div class="line">&#125; = React;</div><div class="line"></div><div class="line"><span class="keyword">var</span> life = React.createClass( &#123;</div><div class="line">  getDefaultProps()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'father getDefaultProps'</span>)</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  getInitialState()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'father getInitialState'</span>)</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">times</span>:<span class="number">3</span>,</div><div class="line">      <span class="attr">hit</span>:<span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  componentWillMount()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'father componentWillMount'</span>)</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  componentDidMount()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'father componentDidMount'</span>)</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  shouldComponentUpdate()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'father shouldComponentUpdate'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  componentWillUpdate()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'father componentWillUpdate'</span>)</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  componentDidUpdate()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'father componentDidUpdate'</span>)</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  timePlugs()&#123;</div><div class="line">   <span class="keyword">var</span> times= <span class="keyword">this</span>.state.times</div><div class="line"></div><div class="line">   times+=<span class="number">3</span></div><div class="line"></div><div class="line">   <span class="keyword">this</span>.setState(&#123;</div><div class="line">    <span class="attr">times</span>:times</div><div class="line">   &#125;)</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  timeReset()&#123;</div><div class="line">   <span class="keyword">this</span>.setState(&#123;</div><div class="line">    <span class="attr">times</span>:<span class="number">0</span></div><div class="line">   &#125;)</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  willHit()&#123;</div><div class="line">   <span class="keyword">this</span>.setState(&#123;</div><div class="line">    <span class="attr">hit</span>:!<span class="keyword">this</span>.state.hit</div><div class="line">   &#125;)</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'father render'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line"></div><div class="line">        &#123;</div><div class="line">          this.state.hit </div><div class="line">          ? </div><div class="line">          <span class="tag">&lt;<span class="name">Son</span> <span class="attr">times</span>=<span class="string">&#123;this.state.times&#125;</span> <span class="attr">timeReset</span>=<span class="string">&#123;this.timeReset&#125;/</span>&gt;</span> </div><div class="line">          : null</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.welcome&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this.timeReset&#125;</span>&gt;</span></div><div class="line">        老子说：心情好就放你一马</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.instructions&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this.willHit&#125;</span>&gt;</span></div><div class="line">          到底揍不走</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.instructions&#125;</span>&gt;</span></div><div class="line">          就揍了你 &#123;this.state.times&#125; 次而已</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.instructions&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this.timePlugs&#125;</span>&gt;</span></div><div class="line">          不听话在揍你 3 次</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line"></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">  ,</div><div class="line">&#125;)</div><div class="line"></div><div class="line">var Son = React.createClass( &#123;</div><div class="line">  getDefaultProps()&#123;</div><div class="line">    console.log('son getDefaultProps')</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  getInitialState()&#123;</div><div class="line">    console.log('son getInitialState')</div><div class="line">    return &#123;</div><div class="line">      times:this.props.times</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  componentWillMount()&#123;</div><div class="line">    console.log('son componentWillMount')</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  componentDidMount()&#123;</div><div class="line">    console.log('son componentDidMount')</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  componentWillReceiveProps(props)&#123;</div><div class="line">    console.log('son componentWillReceiveProps')</div><div class="line">    console.log(this.props)</div><div class="line">    console.log(props)</div><div class="line">    this.setState(&#123;</div><div class="line">      times:props.times</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  ,</div><div class="line"></div><div class="line">  shouldComponentUpdate()&#123;</div><div class="line">    console.log('son shouldComponentUpdate')</div><div class="line"></div><div class="line">    return true</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  componentWillUpdate()&#123;</div><div class="line">    console.log('son componentWillUpdate')</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  componentDidUpdate()&#123;</div><div class="line">    console.log('son componentDidUpdate')</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  timeReset()&#123;</div><div class="line">    this.props.timeReset()</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  //儿子自己的方法，心理暗示老子要揍他，但其实老子没有揍他</div><div class="line">  timePlugs()&#123;</div><div class="line">   var times= this.state.times</div><div class="line"></div><div class="line">   times+=3</div><div class="line"></div><div class="line">   this.setState(&#123;</div><div class="line">    times:times</div><div class="line">   &#125;)</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    console.log('son render')</div><div class="line"></div><div class="line">    return (</div><div class="line">      <span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.welcome&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this.timePlugs&#125;</span>&gt;</span></div><div class="line">          儿子说：有本事揍我呀！</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">      <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.instructions&#125;</span>&gt;</span></div><div class="line">        你居然揍我 &#123;this.state.times&#125; 次</div><div class="line">      <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.instructions&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this.timeReset&#125;</span> &gt;</span></div><div class="line">        别揍我了，我给你买瓶酒</div><div class="line">      <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">var styles = StyleSheet.create(&#123;</div><div class="line">  container: &#123;</div><div class="line">    flex: 1,</div><div class="line">    justifyContent: 'center',</div><div class="line">    alignItems: 'center',</div><div class="line">    backgroundColor: '#F5FCFF',</div><div class="line">  &#125;,</div><div class="line">  welcome: &#123;</div><div class="line">    fontSize: 20,</div><div class="line">    textAlign: 'center',</div><div class="line">    margin: 10,</div><div class="line">  &#125;,</div><div class="line">  instructions: &#123;</div><div class="line">    textAlign: 'center',</div><div class="line">    color: '#333333',</div><div class="line">    marginBottom: 5,</div><div class="line">  &#125;,</div><div class="line">&#125;);</div><div class="line"></div><div class="line">AppRegistry.registerComponent('life', () =&gt; life);</div></pre></td></tr></table></figure>
<h1 id="ES5和ES6区别"><a href="#ES5和ES6区别" class="headerlink" title="ES5和ES6区别"></a>ES5和ES6区别</h1><h2 id="导入模块方式"><a href="#导入模块方式" class="headerlink" title="导入模块方式"></a>导入模块方式</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"> <span class="comment">//ES5</span></div><div class="line"><span class="keyword">var</span> ReactNative=<span class="built_in">require</span>(<span class="string">'react-native'</span>)</div><div class="line"><span class="keyword">var</span> React=<span class="built_in">require</span>(<span class="string">'react'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> Component=React.Component</div><div class="line"></div><div class="line"><span class="keyword">var</span> AppRegistry=ReactNative.AppRegistry</div><div class="line"><span class="keyword">var</span> StyleSheet=ReactNative.StyleSheet</div><div class="line"><span class="keyword">var</span> Text=ReactNative.Text</div><div class="line"><span class="keyword">var</span> View=ReactNative.View</div><div class="line"></div><div class="line"><span class="comment">//ES6</span></div><div class="line"><span class="comment">// import React,&#123;Component&#125; from 'react'</span></div><div class="line"><span class="comment">// import &#123;</span></div><div class="line"><span class="comment">//   AppRegistry,</span></div><div class="line"><span class="comment">//   StyleSheet,</span></div><div class="line"><span class="comment">//   Text,</span></div><div class="line"><span class="comment">//   View</span></div><div class="line"><span class="comment">// &#125; from 'react-native'</span></div></pre></td></tr></table></figure>
<h2 id="创建组件"><a href="#创建组件" class="headerlink" title="创建组件"></a>创建组件</h2><p>ES5使用React.createClass方法来创建一个组件，所以最后需要添加分号(但也有省略)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> life = React.createClass( &#123;</div><div class="line">  getInitialState()&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'father getInitialState'</span>)</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      <span class="attr">times</span>:<span class="number">3</span>,</div><div class="line">      <span class="attr">hit</span>:<span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  timePlugs()&#123;</div><div class="line">   <span class="keyword">var</span> times= <span class="keyword">this</span>.state.times</div><div class="line"></div><div class="line">   times+=<span class="number">3</span></div><div class="line"></div><div class="line">   <span class="keyword">this</span>.setState(&#123;</div><div class="line">    <span class="attr">times</span>:times</div><div class="line">   &#125;)</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  timeReset()&#123;</div><div class="line">   <span class="keyword">this</span>.setState(&#123;</div><div class="line">    <span class="attr">times</span>:<span class="number">0</span></div><div class="line">   &#125;)</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  willHit()&#123;</div><div class="line">   <span class="keyword">this</span>.setState(&#123;</div><div class="line">    <span class="attr">hit</span>:!<span class="keyword">this</span>.state.hit</div><div class="line">   &#125;)</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'father render'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;styles.container&#125;</span>&gt;</span></span></div><div class="line"></div><div class="line">        &#123;</div><div class="line">          this.state.hit </div><div class="line">          ? </div><div class="line">          <span class="tag">&lt;<span class="name">Son</span> <span class="attr">times</span>=<span class="string">&#123;this.state.times&#125;</span> <span class="attr">timeReset</span>=<span class="string">&#123;this.timeReset&#125;/</span>&gt;</span> </div><div class="line">          : null</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.welcome&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this.timeReset&#125;</span>&gt;</span></div><div class="line">        老子说：心情好就放你一马</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.instructions&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this.willHit&#125;</span>&gt;</span></div><div class="line">          到底揍不走</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.instructions&#125;</span>&gt;</span></div><div class="line">          就揍了你 &#123;this.state.times&#125; 次而已</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;styles.instructions&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this.timePlugs&#125;</span>&gt;</span></div><div class="line">          不听话在揍你 3 次</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line"></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>ES6使用class和extends关键字来实现，和Java这样的语言差不多了，更加面向对象了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(props)&#123;</div><div class="line">    <span class="keyword">super</span>(props)</div><div class="line">    <span class="keyword">this</span>.state=&#123;<span class="attr">times</span>:<span class="number">0</span>&#125;</div><div class="line"></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'son constructor'</span>)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  componentWillReceiveProps(props)&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'son componentWillReceiveProps'</span>)</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.props)</div><div class="line">    <span class="built_in">console</span>.log(props)</div><div class="line">    <span class="keyword">this</span>.setState(&#123;</div><div class="line">      <span class="attr">times</span>:props.times</div><div class="line">    &#125;)</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  timeReset()&#123;</div><div class="line">    <span class="keyword">this</span>.props.timeReset()</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">//儿子自己的方法，心理暗示老子要揍他，但其实老子没有揍他</span></div><div class="line">  timePlugs()&#123;</div><div class="line">   <span class="keyword">var</span> times= <span class="keyword">this</span>.state.times</div><div class="line"></div><div class="line">   times+=<span class="number">3</span></div><div class="line"></div><div class="line">   <span class="keyword">this</span>.setState(&#123;</div><div class="line">    <span class="attr">times</span>:times</div><div class="line">   &#125;)</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  render() &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'son render'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> (</div><div class="line">      <span class="xml"><span class="tag">&lt;<span class="name">View</span> <span class="attr">style</span>=<span class="string">&#123;sonStyles.container&#125;</span>&gt;</span></span></div><div class="line">        <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;sonStyles.welcome&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this.timePlugs.bind(this)&#125;</span>&gt;</span></div><div class="line">          儿子说：有本事揍我呀！</div><div class="line">        <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">      <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;sonStyles.instructions&#125;</span>&gt;</span></div><div class="line">        你居然揍我 &#123;this.state.times&#125; 次</div><div class="line">      <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;sonStyles.instructions&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;this.timeReset.bind(this)&#125;</span> &gt;</span></div><div class="line">        别揍我了，我给你买瓶酒</div><div class="line">      <span class="tag">&lt;/<span class="name">Text</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">View</span>&gt;</span></div><div class="line">    );</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="获取初始属性"><a href="#获取初始属性" class="headerlink" title="获取初始属性"></a>获取初始属性</h2><p>ES5中使用getDefaultProps和getInitialState来初始化属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">getDefaultProps()&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'father getDefaultProps'</span>)</div><div class="line">&#125;,</div><div class="line"></div><div class="line">getInitialState()&#123;</div><div class="line">	<span class="built_in">console</span>.log(<span class="string">'father getInitialState'</span>)</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">	  <span class="attr">times</span>:<span class="number">3</span>,</div><div class="line">	  <span class="attr">hit</span>:<span class="literal">false</span></div><div class="line">	&#125;</div><div class="line">&#125;,</div></pre></td></tr></table></figure>
<p>ES6中使用constructor构造方法来初始化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">constructor</span>(props)&#123;</div><div class="line">  <span class="keyword">super</span>(props)</div><div class="line">  <span class="keyword">this</span>.state=&#123;<span class="attr">times</span>:<span class="number">0</span>&#125;</div><div class="line"></div><div class="line">  <span class="built_in">console</span>.log(<span class="string">'son constructor'</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="View中调用方法"><a href="#View中调用方法" class="headerlink" title="View中调用方法"></a>View中调用方法</h2><p>ES5</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;Text style=&#123;styles.instructions&#125; onPress=&#123;<span class="keyword">this</span>.timePlugs&#125;&gt;</div><div class="line">  不听话在揍你 <span class="number">3</span> 次</div><div class="line">&lt;<span class="regexp">/Text&gt;</span></div></pre></td></tr></table></figure>
<p>ES6要调用bind(this)方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;Text style=&#123;sonStyles.welcome&#125; onPress=&#123;<span class="keyword">this</span>.timePlugs.bind(<span class="keyword">this</span>)&#125;&gt;</div><div class="line">  儿子说：有本事揍我呀！</div><div class="line">&lt;<span class="regexp">/Text&gt;</span></div></pre></td></tr></table></figure>
<h2 id="声明变量"><a href="#声明变量" class="headerlink" title="声明变量"></a>声明变量</h2><p>ES5中只能使用var</p>
<p>ES6中可以使用const，let</p>
<h1 id="常用组件"><a href="#常用组件" class="headerlink" title="常用组件"></a>常用组件</h1><p>首先我们clone react native的源码到本地，并切换到 0.22-stable版本，然后使用npm start安装依赖，如果这个版本安装出错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">npm ERR! Darwin 15.6.0</div><div class="line">npm ERR! argv &quot;/Users/renpingqing/.nvm/versions/node/v4.2.3/bin/node&quot; &quot;/Users/renpingqing/.nvm/versions/node/v4.2.3/bin/npm&quot; &quot;install&quot;</div><div class="line">npm ERR! node v4.2.3</div><div class="line">npm ERR! npm  v2.14.7</div><div class="line">npm ERR! code EPEERINVALID</div><div class="line"></div><div class="line">npm ERR! peerinvalid The package eslint@2.13.1 does not satisfy its siblings&apos; peerDependencies requirements!</div><div class="line">npm ERR! peerinvalid Peer babel-eslint@5.0.4 wants eslint@&lt;2.3.0</div><div class="line"></div><div class="line">npm ERR! Please include the following file with any support request:</div><div class="line">npm ERR!     /Users/renpingqing/Documents/work/react/react-native/npm-debug.log</div></pre></td></tr></table></figure>
<p>那我们切换到0.24-stable试试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rm -rf node_modules &amp;&amp; npm install</div></pre></td></tr></table></figure>
<p>我们当前的版本是xcode8.1,node是v4.2.3，react-native-cli: 0.2.0。</p>
<p>我们可以在Examples目录找到多个实例代码，其中UIExplorer就是控件示例代码。</p>
<h2 id="View"><a href="#View" class="headerlink" title="View"></a>View</h2><p>相当于支持flex布局的div</p>
<h2 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h2><p>用来显示文本的，可以设置显示的字体大小，颜色，显示几行</p>
<h2 id="TextInput"><a href="#TextInput" class="headerlink" title="TextInput"></a>TextInput</h2><p>文本输入框，也可以用来输入密码</p>
<h2 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h2><p>显示图片，可以加载网络，本地图片，还可以监听加载进度，也可以设置图片的拉伸方式</p>
<h2 id="AlertIOS"><a href="#AlertIOS" class="headerlink" title="AlertIOS"></a>AlertIOS</h2><p>提示框</p>
<h2 id="Modal"><a href="#Modal" class="headerlink" title="Modal"></a>Modal</h2><p>模态对话框，浮层</p>
<h2 id="ActivityIndicatorIOS"><a href="#ActivityIndicatorIOS" class="headerlink" title="ActivityIndicatorIOS"></a>ActivityIndicatorIOS</h2><p>loading</p>
<h2 id="ProgressViewIOS"><a href="#ProgressViewIOS" class="headerlink" title="ProgressViewIOS"></a>ProgressViewIOS</h2><p>进度条，提供0~1之间的值</p>
<h2 id="ListView"><a href="#ListView" class="headerlink" title="ListView"></a>ListView</h2><h2 id="PickerIOS"><a href="#PickerIOS" class="headerlink" title="PickerIOS"></a>PickerIOS</h2><h2 id="StatusBar"><a href="#StatusBar" class="headerlink" title="StatusBar"></a>StatusBar</h2><p>可以控制IOS状态栏</p>
<h2 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h2><p>开关控件</p>
<h2 id="Slider"><a href="#Slider" class="headerlink" title="Slider"></a>Slider</h2><p>滑块</p>
<h2 id="MapView"><a href="#MapView" class="headerlink" title="MapView"></a>MapView</h2><h2 id="Navigator"><a href="#Navigator" class="headerlink" title="Navigator"></a>Navigator</h2><h2 id="TabBarIOS"><a href="#TabBarIOS" class="headerlink" title="TabBarIOS"></a>TabBarIOS</h2><h2 id="SegmentedControllIOS"><a href="#SegmentedControllIOS" class="headerlink" title="SegmentedControllIOS"></a>SegmentedControllIOS</h2><h2 id="Touchable"><a href="#Touchable" class="headerlink" title="Touchable"></a>Touchable</h2><h2 id="WebView"><a href="#WebView" class="headerlink" title="WebView"></a>WebView</h2><h1 id="flex布局"><a href="#flex布局" class="headerlink" title="flex布局"></a>flex布局</h1><p>伸缩，弹性容器布局</p>
<blockquote>
<p>注意：RN的flex跟css3里的flexbox属性名写法不同，RN全部使用驼峰标示</p>
<p>RN对flex的支持有限是css3 flexbox的一个子集</p>
</blockquote>
<h2 id="父容器"><a href="#父容器" class="headerlink" title="父容器"></a>父容器</h2><h3 id="flexDirection"><a href="#flexDirection" class="headerlink" title="flexDirection"></a>flexDirection</h3><p>可以控制字项目的排列方式通过flexDirection</p>
<p>默认值是column,标示垂直，row标示水平</p>
<h3 id="flex-1"><a href="#flex-1" class="headerlink" title="flex:1"></a>flex:1</h3><p>标示让当前这个容器的宽高都充满父容器</p>
<h3 id="flexWrap"><a href="#flexWrap" class="headerlink" title="flexWrap"></a>flexWrap</h3><p>定义如果在这个方向上放不下的其他元素显示方式</p>
<p>noWrap:不包裹，就在屏幕外面去了</p>
<p>wrap:包裹，换行显示</p>
<h3 id="justifyContent"><a href="#justifyContent" class="headerlink" title="justifyContent"></a>justifyContent</h3><p>设置在排列方向上的位置</p>
<p>flex-start:左边</p>
<p>center:居中</p>
<p>flex-end:右边</p>
<p>space-between:两段对齐</p>
<p>space-around:将空间平分，并在平分的空间中在居中</p>
<h3 id="alignItems"><a href="#alignItems" class="headerlink" title="alignItems"></a>alignItems</h3><p>控制在垂直于排列方式的内容位置</p>
<p>stretch:在纵轴拉升</p>
<h2 id="子容器"><a href="#子容器" class="headerlink" title="子容器"></a>子容器</h2><p>子容器可以使用alignSelf覆盖父类的设置</p>
<p>子容器可是使用flex:1来指定平分父容器的空间，这个值相当于android中的weight属性</p>
<h1 id="如挑选第三方组件"><a href="#如挑选第三方组件" class="headerlink" title="如挑选第三方组件"></a>如挑选第三方组件</h1><p>star个数</p>
<p>fork</p>
<p>close pr</p>
<p>close issues</p>
<p>stackoverflow</p>
<p>文档全，代码规范，测试用例</p>
<p>比如：我们搜索一个轮播组件，可以搜索关键词，react native carousel，react-native-swiper</p>
<p>除了在github上搜索，也可以到<a href="https://react.parts/native上搜索" target="_blank" rel="external">https://react.parts/native上搜索</a></p>
<h1 id="本地存储"><a href="#本地存储" class="headerlink" title="本地存储"></a>本地存储</h1><p>RN提供了AsyncStorage，采用键值对存储</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> user=<span class="keyword">this</span>.state.user</div><div class="line"></div><div class="line">AsyncStorage.setItem(<span class="string">'user'</span>,<span class="built_in">JSON</span>.stringify(user),<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) &#123;</div><div class="line">      <span class="built_in">console</span>.log(err)</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'save fail'</span>)</div><div class="line">    &#125; <span class="keyword">else</span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'save ok'</span>)</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//或者</span></div><div class="line"><span class="keyword">var</span> user=<span class="keyword">this</span>.state.user</div><div class="line"></div><div class="line">AsyncStorage</div><div class="line">  .setItem(<span class="string">'user'</span>,<span class="built_in">JSON</span>.stringify(user))</div><div class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'save ok'</span>)</div><div class="line">  &#125;)</div><div class="line">  .catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(err)</div><div class="line">      <span class="built_in">console</span>.log(<span class="string">'save fail'</span>)</div><div class="line">  &#125;)</div></pre></td></tr></table></figure>
<p>统计重新载入的次数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">componentDidMount()&#123;</div><div class="line">    <span class="keyword">var</span> that = <span class="keyword">this</span></div><div class="line">      AsyncStorage</div><div class="line">      .getItem(<span class="string">'user'</span>)</div><div class="line">      .then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> userData=<span class="built_in">JSON</span>.parse(data)</div><div class="line">        </div><div class="line">        userData.times++</div><div class="line"></div><div class="line">          that.setState(&#123;</div><div class="line">            <span class="attr">user</span>:userData</div><div class="line">          &#125;)</div><div class="line"></div><div class="line">          AsyncStorage</div><div class="line">            .setItem(<span class="string">'user'</span>,<span class="built_in">JSON</span>.stringify(userData))</div><div class="line">            .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">              <span class="built_in">console</span>.log(<span class="string">'save ok'</span>)</div><div class="line">            &#125;)</div><div class="line">            .catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(err)</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'save fail'</span>)</div><div class="line">            &#125;)</div><div class="line">        <span class="built_in">console</span>.log()</div><div class="line">      &#125;)</div><div class="line">      .catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">          <span class="keyword">var</span> user=that.state.user</div><div class="line"></div><div class="line">          AsyncStorage</div><div class="line">            .setItem(<span class="string">'user'</span>,<span class="built_in">JSON</span>.stringify(user))</div><div class="line">            .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">              <span class="built_in">console</span>.log(<span class="string">'save ok'</span>)</div><div class="line">            &#125;)</div><div class="line">            .catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">                <span class="built_in">console</span>.log(err)</div><div class="line">                <span class="built_in">console</span>.log(<span class="string">'save fail'</span>)</div><div class="line">            &#125;)</div><div class="line">      &#125;)</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>key不存在会走到catch中</p>
<p>删除,key不存在也不会报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">AsyncStorage.removeItem(<span class="string">'user'</span>)</div><div class="line">        .then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">          <span class="built_in">console</span>.log(<span class="string">'remove ok'</span>)</div><div class="line">        &#125;)</div></pre></td></tr></table></figure>
<p>批量操作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> that = <span class="keyword">this</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> user=<span class="keyword">this</span>.state.user</div><div class="line"></div><div class="line"><span class="comment">// AsyncStorage.multiSet([['user1','u1'],['user2','u2']])</span></div><div class="line"><span class="comment">//   .then(function () &#123;</span></div><div class="line"><span class="comment">//     console.log('save ok')</span></div><div class="line"><span class="comment">//   &#125;)</span></div><div class="line"></div><div class="line"><span class="comment">// AsyncStorage.multiGet(['user1','user2','user'])</span></div><div class="line"><span class="comment">//   .then(function (data) &#123;</span></div><div class="line"><span class="comment">//     console.log(data) //数组</span></div><div class="line"><span class="comment">//   &#125;)</span></div><div class="line"></div><div class="line">  AsyncStorage.multiRemove([<span class="string">'user1'</span>,<span class="string">'user2'</span>,<span class="string">'user'</span>])</div><div class="line">    .then(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (err) &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'remove fail'</span>)</div><div class="line">      &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'remove ok'</span>)</div><div class="line">        </div><div class="line">        <span class="comment">//再次获取数据是，value是空，可以还在</span></div><div class="line">        AsyncStorage.multiGet([<span class="string">'user1'</span>,<span class="string">'user2'</span>,<span class="string">'user'</span>])</div><div class="line">          .then(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(data)</div><div class="line">          &#125;)</div><div class="line"></div><div class="line">      &#125;</div><div class="line">    &#125;)</div></pre></td></tr></table></figure>
<p>## </p>
<h1 id="调试和热加载"><a href="#调试和热加载" class="headerlink" title="调试和热加载"></a>调试和热加载</h1><p>按command+d，可以开启调试和热加载</p>
<h1 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h1><h2 id="“CFBundleIdentifier”-Does-Not-Exist"><a href="#“CFBundleIdentifier”-Does-Not-Exist" class="headerlink" title="“CFBundleIdentifier”, Does Not Exist"></a>“CFBundleIdentifier”, Does Not Exist</h2><p>Command failed: /usr/libexec/PlistBuddy -c Print:CFBundleIdentifier build/Build/Products/Debug-iphonesimulator/imoocApp.app/Info.plist</p>
<p>Print: Entry, “:CFBundleIdentifier”, Does Not Exist</p>
<h2 id="用rninit创建指定版本的应用"><a href="#用rninit创建指定版本的应用" class="headerlink" title="用rninit创建指定版本的应用"></a>用rninit创建指定版本的应用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="number">1.</span> 安装</div><div class="line">npm i -g rninit</div><div class="line"><span class="number">2.</span> 使用</div><div class="line"><span class="number">2.1</span> 用最新的 react-native 版本创建工程：</div><div class="line">rninit init [Project Name]</div><div class="line"><span class="number">2.2</span> 用特定的 react-native npm 版本创建工程：</div><div class="line">rninit init [Project Name] --source react-native@<span class="number">0.22</span><span class="number">.2</span></div></pre></td></tr></table></figure>
<p>或者将依赖改为如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">"lodash": "^4.13.1",</div><div class="line">"mockjs": "^1.0.0",</div><div class="line">"query-string": "^4.2.0",</div><div class="line">"react": "^0.14.8",</div><div class="line">"react-native": "^0.22.2",</div><div class="line">"react-native-audio": "^1.2.1",</div><div class="line">"react-native-button": "^1.6.0",</div><div class="line">"react-native-cli": "^0.2.0",</div><div class="line">"react-native-image-picker": "^0.20.0",</div><div class="line">"react-native-progress": "^3.0.1",</div><div class="line">"react-native-sk-countdown": "^1.0.1",</div><div class="line">"react-native-swiper": "^1.4.6",</div><div class="line">"react-native-vector-icons": "^2.0.2",</div><div class="line">"react-native-video": "^0.8.0",</div><div class="line">"sha1": "^1.1.1"</div></pre></td></tr></table></figure>
<p><a href="http://coding.imooc.com/learn/questiondetail/1708" target="_blank" rel="external">http://coding.imooc.com/learn/questiondetail/1708</a></p>
<h2 id="React-native-Cannot-find-module-‘invariant’"><a href="#React-native-Cannot-find-module-‘invariant’" class="headerlink" title="React-native Cannot find module ‘invariant’"></a>React-native Cannot find module ‘invariant’</h2><p>升级了node,和react-native-cli后，初始项目报错，我手动安装了下invariant模块，再次初始化项目居然可以了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install invariant</div></pre></td></tr></table></figure>
<p>这个模块的地址<a href="https://www.npmjs.com/package/invariant" target="_blank" rel="external">https://www.npmjs.com/package/invariant</a></p>
<h2 id="ListView的renderRow方法this指向不对"><a href="#ListView的renderRow方法this指向不对" class="headerlink" title="ListView的renderRow方法this指向不对"></a>ListView的renderRow方法this指向不对</h2><p>解决方法是，调用_renderRow方法然后在调用bind(this)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;ListView</div><div class="line">  dataSource=&#123;<span class="keyword">this</span>.state.dataSource&#125;</div><div class="line">  renderRow=&#123;<span class="keyword">this</span>._renderRow.bind(<span class="keyword">this</span>)&#125; /&gt;</div></pre></td></tr></table></figure>
<p>这样在_renderRow方法中获取this，就能得到正确的指示了</p>
<h2 id="node-v7-3-0集成react-native-vector-icons报错"><a href="#node-v7-3-0集成react-native-vector-icons报错" class="headerlink" title="node v7.3.0集成react-native-vector-icons报错"></a>node v7.3.0集成react-native-vector-icons报错</h2><p>第一个错误是，找不到模块，用的是react-native link方式操作的。解决方法是，手动在xcode链接。</p>
<p>第二个错误是，找不到字体，这个问题是，拷贝字体是没有勾选target。也就是说字体没有打包到ipa中。</p>
<p><a href="https://github.com/oblador/react-native-vector-icons" target="_blank" rel="external">https://github.com/oblador/react-native-vector-icons</a></p>
<p><a href="http://blog.csdn.net/sakulafly/article/details/46368173" target="_blank" rel="external">http://blog.csdn.net/sakulafly/article/details/46368173</a></p>
<h2 id="ios9-http不能访问"><a href="#ios9-http不能访问" class="headerlink" title="ios9 http不能访问"></a>ios9 http不能访问</h2><p><a href="https://segmentfault.com/a/1190000002933776" target="_blank" rel="external">https://segmentfault.com/a/1190000002933776</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;搭建React-Native开发环境&quot;&gt;&lt;a href=&quot;#搭建React-Native开发环境&quot; class=&quot;headerlink&quot; title=&quot;搭建React Native开发环境&quot;&gt;&lt;/a&gt;搭建React Native开发环境&lt;/h1&gt;&lt;h2 id=&quot;安
    
    </summary>
    
      <category term="React Native" scheme="http://i.woblog.cn/categories/React-Native/"/>
    
    
      <category term="React" scheme="http://i.woblog.cn/tags/React/"/>
    
      <category term="React Native" scheme="http://i.woblog.cn/tags/React-Native/"/>
    
  </entry>
  
  <entry>
    <title>Java集合框架总结</title>
    <link href="http://i.woblog.cn/2016/10/31/java-collections/"/>
    <id>http://i.woblog.cn/2016/10/31/java-collections/</id>
    <published>2016-10-31T14:17:01.000Z</published>
    <updated>2017-03-19T14:22:37.668Z</updated>
    
    <content type="html"><![CDATA[<h1 id="框架接口图"><a href="#框架接口图" class="headerlink" title="框架接口图"></a>框架接口图</h1><p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/java-collection-interface" alt=""></p>
<p>Java的集合框架分为两类Collection和Map</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Collection是集合，也就是存储对象的value</div><div class="line"></div><div class="line">Map是用来存储键值对的容器</div><div class="line"></div><div class="line">List：有序集合，可以储存<span class="keyword">null</span>值，值可以重复</div><div class="line"></div><div class="line">Set:无序集合，可以存储<span class="keyword">null</span>值，值不能重复</div><div class="line">SortedSet:可以排序的set，不能存储<span class="keyword">null</span>值，值不能重复。并提供了可以获取子Set的方法</div><div class="line">NavigableSet:提供方便搜索的一些方法，比如：返回小于某个元素的元素</div><div class="line"></div><div class="line">Queue：队列，可以存储<span class="keyword">null</span>值，值可以重复。先进先出，对头删除元素，队尾添加元素</div><div class="line">Deque:双端队列，也就是队头，对尾都可以删除元素</div></pre></td></tr></table></figure>
<p>测试List</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ArrayList&lt;String&gt; strings = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">strings.add(<span class="string">"a"</span>);</div><div class="line">strings.add(<span class="string">"b"</span>);</div><div class="line">strings.add(<span class="keyword">null</span>);</div><div class="line">strings.add(<span class="keyword">null</span>);</div><div class="line">strings.add(<span class="string">"aa"</span>);</div><div class="line"></div><div class="line">strings.forEach(e-&gt; System.out.println(e));</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">a</div><div class="line">b</div><div class="line">null</div><div class="line">null</div><div class="line">aa</div></pre></td></tr></table></figure>
<p>发现List确实是有序集合，且可以存储null值，并且值可以重复</p>
<p>测试Set</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">HashSet&lt;String&gt; strings = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">strings.add(<span class="string">"a"</span>);</div><div class="line">strings.add(<span class="string">"b"</span>);</div><div class="line">strings.add(<span class="keyword">null</span>);</div><div class="line">strings.add(<span class="keyword">null</span>);</div><div class="line">strings.add(<span class="string">"aa"</span>);</div><div class="line"></div><div class="line">strings.forEach(e-&gt; System.out.println(e));</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">null</span></div><div class="line">aa</div><div class="line">a</div><div class="line">b</div></pre></td></tr></table></figure>
<p>发现Set无序的，能储存null元素，值不能重复</p>
<p>测试Queue:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">HashSet&lt;String&gt; strings = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">strings.add(<span class="string">"a"</span>);</div><div class="line">strings.add(<span class="string">"b"</span>);</div><div class="line">strings.add(<span class="keyword">null</span>);</div><div class="line">strings.add(<span class="keyword">null</span>);</div><div class="line">strings.add(<span class="string">"aa"</span>);</div><div class="line"></div><div class="line">strings.forEach(e-&gt; System.out.println(e));</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">a</div><div class="line">b</div><div class="line">null</div><div class="line">null</div><div class="line">aa</div></pre></td></tr></table></figure>
<p>可以发现输出和输入顺序都一样，并且能存储null。</p>
<p>测试双端队列：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">LinkedList&lt;String&gt; strings = <span class="keyword">new</span> LinkedList&lt;&gt;();</div><div class="line">strings.add(<span class="string">"a"</span>);</div><div class="line">strings.add(<span class="string">"b"</span>);</div><div class="line">strings.add(<span class="keyword">null</span>);</div><div class="line">strings.add(<span class="keyword">null</span>);</div><div class="line">strings.add(<span class="string">"aa"</span>);</div><div class="line"></div><div class="line">strings.addFirst(<span class="string">"first"</span>);</div><div class="line">strings.addLast(<span class="string">"last"</span>);</div><div class="line"></div><div class="line">strings.forEach(e -&gt; System.out.println(e));</div><div class="line"></div><div class="line">System.out.println(<span class="string">"------------"</span>);</div><div class="line"></div><div class="line">System.out.println(strings.pollFirst());</div><div class="line">System.out.println(strings.pollLast());</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">first</div><div class="line">a</div><div class="line">b</div><div class="line">null</div><div class="line">null</div><div class="line">aa</div><div class="line">last</div><div class="line">------------</div><div class="line">first</div><div class="line">last</div></pre></td></tr></table></figure>
<p>可以发现我们不仅可以在首尾添加元素，也能在首尾删除元素。</p>
<p>测试SortedSet:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">TreeSet&lt;String&gt; strings = <span class="keyword">new</span> TreeSet&lt;&gt;();</div><div class="line">strings.add(<span class="string">"a"</span>);</div><div class="line">strings.add(<span class="string">"b"</span>);</div><div class="line">strings.add(<span class="string">"aa"</span>);</div><div class="line">strings.add(<span class="string">"aa"</span>);</div><div class="line"></div><div class="line">strings.forEach(e-&gt; System.out.println(e));</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">a</div><div class="line">aa</div><div class="line">b</div></pre></td></tr></table></figure>
<p>说明是有序的，并且不能存储null，元素也不能重复。在比较元素的时候还可以传入自定义比较器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">TreeSet&lt;String&gt; strings = <span class="keyword">new</span> TreeSet&lt;&gt;((o1, o2) -&gt; &#123;</div><div class="line">    <span class="keyword">if</span> (o1.length() &lt; o2.length())</div><div class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (o1.length() &gt; o2.length())</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">strings.add(<span class="string">"a"</span>);</div><div class="line">strings.add(<span class="string">"b"</span>);</div><div class="line">strings.add(<span class="string">"aa"</span>);</div><div class="line">strings.add(<span class="string">"ab"</span>);</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a</div><div class="line">aa</div></pre></td></tr></table></figure>
<p>我们发现相同的元素不能存储进去。</p>
<p>测试SortedSet获取子集：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">TreeSet&lt;String&gt; strings = <span class="keyword">new</span> TreeSet&lt;&gt;();</div><div class="line">strings.add(<span class="string">"a"</span>);</div><div class="line">strings.add(<span class="string">"b"</span>);</div><div class="line">strings.add(<span class="string">"aa"</span>);</div><div class="line">strings.add(<span class="string">"ab"</span>);</div><div class="line"></div><div class="line">SortedSet&lt;String&gt; strings1 = strings.subSet(<span class="string">"a"</span>, <span class="string">"ab"</span>);</div><div class="line">strings1.forEach(e -&gt; System.out.println(e));</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">a</div><div class="line">aa</div></pre></td></tr></table></figure>
<p>subSet方法就定义到了SortedSet中，作用是返回元素a到元素ab中间的元素，不包括ab元素的不可修改set。</p>
<p>测试NavigableSet:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">TreeSet&lt;String&gt; strings = <span class="keyword">new</span> TreeSet&lt;&gt;();</div><div class="line">strings.add(<span class="string">"a"</span>);</div><div class="line">strings.add(<span class="string">"b"</span>);</div><div class="line">strings.add(<span class="string">"aa"</span>);</div><div class="line">strings.add(<span class="string">"ab"</span>);</div><div class="line"></div><div class="line">strings.forEach(e-&gt; System.out.println(e));</div><div class="line">System.out.println(<span class="string">"------------"</span>);</div><div class="line">System.out.println(strings.lower(<span class="string">"ab"</span>));</div><div class="line">System.out.println(strings.higher(<span class="string">"ab"</span>));</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">a</div><div class="line">aa</div><div class="line">ab</div><div class="line">b</div><div class="line">------------</div><div class="line">aa</div><div class="line">b</div></pre></td></tr></table></figure>
<p>可以使用快速的搜索方法，比如使用lower找小于ab的元素，使用higher找大于ab的元素。</p>
<h1 id="集合框架完整图"><a href="#集合框架完整图" class="headerlink" title="集合框架完整图"></a>集合框架完整图</h1><p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/CollectionInterface-impl.png" alt=""></p>
<p>上面基本上列出了Java的所有集合框架了，但不包括并发包中的集合。下面我们一一讲解他们。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">AbstractCollection：是一个抽象类，实现了一些Collection接口的比较通用的方法，比如：contains，toArray，containsAll等方法，这样做的目的是，要再实现其他的集合，只需要继承AbstractCollection就行了，而不是用实现Collection接口，如果你觉得它的默认实现不好，可以在子类重写相应的方法。</div><div class="line">  </div><div class="line">ArrayDeque：是一个用循环数组实现的双端队列。实现了Deque接口。</div><div class="line">PriorityQueu：允许高效删除最大优先级的元素的队列</div><div class="line">  </div><div class="line">AbstractList：是一个抽象类，实现了AbstractCollection，并填加了一些特有的List方法，比如：indexOf等方法。</div><div class="line">ArrayList:一个使用数组实现的可增长有序列表。高效的索引</div><div class="line">LinkedList:一个使用链表实现的可增长有序列表。高效的删除和添加</div><div class="line"></div><div class="line">HashSet:使用Hash表实现的没有重复元素的无序集合</div><div class="line">TreeSet:使用二叉树结构实现的有序集合</div><div class="line">EnumSet:包含枚举类型的集合</div><div class="line">LinkedHashSet:使用Hash表实现的有序集合</div><div class="line">  </div><div class="line">HashMap:使用Hash表实现存储key/value结构的映射表，键是键的hashCode，通常情况下能直接定位到他的值(get),特殊特殊情况下也只需要遍历当前Key所对应的桶，所以有很高的随机访问速度，但是顺序是不确定的，最多允许一条记录键为<span class="keyword">null</span>，但可以运行多条值为<span class="keyword">null</span>的记录。他不是线程安全的，如果需要则用ConcurrentHashMap或者使用Collections中的synchronizedMap方法是HashMap也能线程安全。</div><div class="line">Hashtable:他是jdk以前提供的类，功能和HashMap类似，但是他是线程安全的，当然并发性能并没有ConcurrentHashMap好，所以新代码并不建议使用它。</div><div class="line">TreeMap：使用二叉树数据结构实现存储key/value结构的有序映射表。能按照用户自定义的比较器排序。</div><div class="line">EnumMap:高效存储枚举值的映射表</div><div class="line">LinkedHashMap:使用Hash表实现存储key/value结构的能记住插入顺序的映射表</div><div class="line">WeakHashMap:一种当值没有用的时候可以被拉机器回收的映射表</div><div class="line">IdentiryHashMap:使用==而不是equals比较键值的映射表</div></pre></td></tr></table></figure>
<h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><p>有些集合有listIterator方法，返回一个ListIterator对象。可以实现前后遍历元素。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">ArrayList&lt;String&gt; strings = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">strings.add(<span class="string">"a123234324"</span>);</div><div class="line">strings.add(<span class="string">"b34"</span>);</div><div class="line">strings.add(<span class="string">"c"</span>);</div><div class="line">strings.add(<span class="string">"d4"</span>);</div><div class="line">strings.add(<span class="string">"e"</span>);</div><div class="line"></div><div class="line">ListIterator&lt;String&gt; stringListIterator = strings.listIterator();</div><div class="line"><span class="keyword">while</span> (stringListIterator.hasNext()) &#123;</div><div class="line">    System.out.println(stringListIterator.next());</div><div class="line">&#125;</div><div class="line"></div><div class="line">System.out.println(<span class="string">"------"</span>);</div><div class="line"></div><div class="line"><span class="keyword">while</span> (stringListIterator.hasPrevious()) &#123;</div><div class="line">    System.out.println(stringListIterator.previous());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">a123234324</div><div class="line">b34</div><div class="line">c</div><div class="line">d4</div><div class="line">e</div><div class="line">------</div><div class="line">e</div><div class="line">d4</div><div class="line">c</div><div class="line">b34</div><div class="line">a123234324</div></pre></td></tr></table></figure>
<h2 id="散列集"><a href="#散列集" class="headerlink" title="散列集"></a>散列集</h2><p>我们都知道数组和链表都可以安装我们想要的排序次序存放元素，但是如果想获取某个元素却又忘记了位置，区需要偏离每个元素，知道找到为止，如果集合元素太多了，那将有很多的性能问题。如果不在意元素的顺序，可以有很多种数据结构来实现这个需求。其中一种最常见的是散列表(hash table)。他为每个对象计算一个整数，称为散列码(hash code)，比如我们测试不同字符串的hash code:</p>
<table>
<thead>
<tr>
<th>字符串</th>
<th>散列码</th>
</tr>
</thead>
<tbody>
<tr>
<td>Lee</td>
<td>76268</td>
</tr>
<tr>
<td>lee</td>
<td>107020</td>
</tr>
<tr>
<td>eel</td>
<td>100300</td>
</tr>
</tbody>
</table>
<p>所以说如果自定义类，就要实现HashCode方法，同时HashCode方法应与equals方法相兼容。</p>
<p>在Java中，散列表用链表数组实现，每个列表称为桶(bucket)。</p>
<p>如果要添加元素，他的基本步骤为则先要计算他的散列码，然后与桶的总数取余就可以得到保存这个元素的得桶索引。例如：如果某个对象的散列码是76268，并且有128个捅，所以对象应该保存于108号桶中，计算方式是76268%128=108，这样就可以快速定位到这个元素的位置，当然如果你幸运，那么该位置没有其他元素，此时就可以插入该元素。如果这个地方已经有一个元素了，这种情况下称为散列码冲突(hash collision)。这时就需要将要插入的元素与同种所有的元素就行了比较，看这个对象是否存在，则替换value。</p>
<p>从上面看到如果散列码分布合理，且桶数很大，发生散列码冲突的几率就越小，才能提高更好的性能。</p>
<blockquote>
<p>注意：在JavaSE8中，当桶的元素个数达到8时会变为平衡二叉树。来提高效率。</p>
</blockquote>
<p>其中有个很重要的指标就是桶数，通常设置为预计元素个数的75%~150%，且为一个素数。标准类库使用2的幂次方，默认值为16，下次会变为2^5。可以看到到JavaSE8的HashMap中初始化为16：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></div></pre></td></tr></table></figure>
<p>如果元素装满了，就需要在散列(rehashed)，其实就是创建一个桶数更多的表，然后将原来的元素拷贝到新列表，并丢弃原来的列表。装填因子觉得什么时候在散列，默认是0.75也就是表中存储了超过75%的元素，这个表就会用双倍的桶数进行再散列。</p>
<p>我们可以通过构造函数传递初始容量和装填因子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> HashSet&lt;String&gt;(<span class="number">10</span>, <span class="number">0.8F</span>);</div></pre></td></tr></table></figure>
<h2 id="树集"><a href="#树集" class="headerlink" title="树集"></a>树集</h2><p>Treeset和HashSet十分类似，不过他改进了，是一个有序集合，任意顺序插入的元素遍历时都会自动按照排序好的顺序迭代。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">TreeSet&lt;String&gt; strings = <span class="keyword">new</span> TreeSet&lt;&gt;();</div><div class="line">strings.add(<span class="string">"c"</span>);</div><div class="line">strings.add(<span class="string">"d4"</span>);</div><div class="line">strings.add(<span class="string">"a123234324"</span>);</div><div class="line">strings.add(<span class="string">"b34"</span>);</div><div class="line">strings.add(<span class="string">"e"</span>);</div><div class="line"></div><div class="line">strings.forEach(e-&gt; System.out.println(e));</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">a123234324</div><div class="line">b34</div><div class="line">c</div><div class="line">d4</div><div class="line">e</div></pre></td></tr></table></figure>
<p>排序使用的是树结构，当前实现用的是红黑树(red-black tree)。将一个元素添加到树要比添加到散列表中慢，因为他要排序，但是查找却要快的多，查找元素的时间为平均为log2N，例如：一棵树包含一个1000个元素，添加一个元素大约需要10次比较。</p>
<p>使用树集必须要保证元素可比较，元素都实现Comparable接口，或者在构造树集是指定一个Comparator比较器。</p>
<h2 id="队列和双端队列"><a href="#队列和双端队列" class="headerlink" title="队列和双端队列"></a>队列和双端队列</h2><h3 id="优先级队列"><a href="#优先级队列" class="headerlink" title="优先级队列"></a>优先级队列</h3><p>可以按照任意顺序插入，却总是按照排序的顺序进行检索，也就说无论何时调用remove方法，总会获得当前优先级队列中数字最小的元素，如果使用迭代器方式处理这些元素，并不需要排序，他使用一个优雅且高效的堆(heap)结构(是一个可以自我调整的二叉树，对树执行添加(add)和删除(remore)操作，可以让最小的元素移动到跟，而不必话费时间对元素排序)。</p>
<p>典型的优先队列使用场景是任务调用。每一个任务都有一个优先级，任务以随机添加到队列中，每当启动一个新任务时，都将优先级最高的任务从队列中删除，通常1为最高，所以也说将最小的元素删除。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">PriorityQueue&lt;String&gt; strings = <span class="keyword">new</span> PriorityQueue&lt;&gt;();</div><div class="line">strings.add(<span class="string">"c"</span>);</div><div class="line">strings.add(<span class="string">"d4"</span>);</div><div class="line">strings.add(<span class="string">"a123234324"</span>);</div><div class="line">strings.add(<span class="string">"b34"</span>);</div><div class="line">strings.add(<span class="string">"e"</span>);</div><div class="line"></div><div class="line">strings.forEach(e-&gt; System.out.println(e));</div><div class="line"></div><div class="line">System.out.println(<span class="string">"-------"</span>);</div><div class="line">System.out.println(strings.remove());</div><div class="line">System.out.println(<span class="string">"-------"</span>);</div><div class="line"></div><div class="line">strings.forEach(e-&gt; System.out.println(e));</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">a123234324</div><div class="line">b34</div><div class="line">c</div><div class="line">d4</div><div class="line">e</div><div class="line">-------</div><div class="line">a123234324</div><div class="line">-------</div><div class="line">b34</div><div class="line">d4</div><div class="line">c</div><div class="line">e</div></pre></td></tr></table></figure>
<p>可以看到删除的其实是最小的元素。</p>
<h2 id="LinkedHashSet"><a href="#LinkedHashSet" class="headerlink" title="LinkedHashSet"></a>LinkedHashSet</h2><p>用来记住插入元素项顺序的集合。</p>
<h1 id="映射"><a href="#映射" class="headerlink" title="映射"></a>映射</h1><h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">HashMap&lt;String, String&gt; strings = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">strings.put(<span class="string">"3"</span>,<span class="string">"c"</span>);</div><div class="line">strings.put(<span class="string">"4"</span>,<span class="string">"d4"</span>);</div><div class="line">strings.put(<span class="string">"5"</span>,<span class="string">"e"</span>);</div><div class="line">strings.put(<span class="string">"1"</span>,<span class="string">"a123234324"</span>);</div><div class="line">strings.put(<span class="string">"2"</span>,<span class="string">"b34"</span>);</div><div class="line"></div><div class="line"></div><div class="line">strings.forEach((k,v)-&gt; System.out.println(k+<span class="string">":"</span>+v));</div><div class="line"></div><div class="line"></div><div class="line">System.out.println(<span class="string">"--------"</span>);</div><div class="line"></div><div class="line">HashMap&lt;Integer, String&gt; hashMap = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">hashMap.put(<span class="number">10</span>,<span class="string">"d"</span>);</div><div class="line">hashMap.put(<span class="number">2</span>,<span class="string">"c"</span>);</div><div class="line">hashMap.put(<span class="number">1</span>,<span class="string">"a"</span>);</div><div class="line">hashMap.put(<span class="number">3</span>,<span class="string">"b"</span>);</div><div class="line"></div><div class="line">hashMap.forEach((k,v)-&gt; System.out.println(k+<span class="string">":"</span>+v));</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">1:a123234324</div><div class="line">2:b34</div><div class="line">3:c</div><div class="line">4:d4</div><div class="line">5:e</div><div class="line">--------</div><div class="line">1:a</div><div class="line">2:c</div><div class="line">3:b</div><div class="line">10:d</div></pre></td></tr></table></figure>
<p>可以发现默认按照key排序的。</p>
<h3 id="更新值"><a href="#更新值" class="headerlink" title="更新值"></a>更新值</h3><p>如我们需要使用某个Map统计某个单词出现的次数，可以这样做：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testWordCount</span><span class="params">()</span> </span>&#123;</div><div class="line">    String[] strings = &#123;<span class="string">"a"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"d"</span>, <span class="string">"c"</span>, <span class="string">"c"</span>, <span class="string">"a"</span>, <span class="string">"e"</span>&#125;;</div><div class="line">    HashMap&lt;String, Integer&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; strings.length; i++) &#123;</div><div class="line">        countWord(map, strings[i]);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    map.forEach((k, v) -&gt; System.out.println(k + <span class="string">":"</span> + v));</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">countWord</span><span class="params">(Map&lt;String, Integer&gt; map, String word)</span> </span>&#123;</div><div class="line"><span class="comment">//        map.put(word,hashMap.get(word)+1); //第一次会空指针,可以通过下面的方式避免</span></div><div class="line"></div><div class="line"><span class="comment">//        map.put(word,hashMap.getOrDefault(word,0)+1); //可以这样</span></div><div class="line"></div><div class="line">    <span class="comment">//也可以这样</span></div><div class="line"><span class="comment">//        map.putIfAbsent(word,0); //当键不存在时才添加</span></div><div class="line"><span class="comment">//        map.put(word,hashMap.get(word)+1);</span></div><div class="line"></div><div class="line">    <span class="comment">//当然还有更好的方式</span></div><div class="line">    map.merge(word, <span class="number">1</span>, Integer::sum); <span class="comment">//如果不存在key word时，装入1，存在时将原来的值加1</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a:2</div><div class="line">c:3</div><div class="line">d:2</div><div class="line">e:1</div></pre></td></tr></table></figure>
<h2 id="弱散列映射"><a href="#弱散列映射" class="headerlink" title="弱散列映射"></a>弱散列映射</h2><p>设计WeakHashMap是为了解决一个很特别的问题。假设一个键的最后一次引用没有了，那么也就无法删除对应的值了。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;框架接口图&quot;&gt;&lt;a href=&quot;#框架接口图&quot; class=&quot;headerlink&quot; title=&quot;框架接口图&quot;&gt;&lt;/a&gt;框架接口图&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;http://7qnc6h.com1.z0.glb.clouddn.com/java-colle
    
    </summary>
    
      <category term="Java" scheme="http://i.woblog.cn/categories/Java/"/>
    
    
      <category term="Collections" scheme="http://i.woblog.cn/tags/Collections/"/>
    
  </entry>
  
  <entry>
    <title>全方位动态调试Apk</title>
    <link href="http://i.woblog.cn/2016/08/19/debug-apk/"/>
    <id>http://i.woblog.cn/2016/08/19/debug-apk/</id>
    <published>2016-08-19T11:20:54.000Z</published>
    <updated>2017-03-19T14:22:37.664Z</updated>
    
    <content type="html"><![CDATA[<h1 id="软件调试分类"><a href="#软件调试分类" class="headerlink" title="软件调试分类"></a>软件调试分类</h1><h2 id="源码调试"><a href="#源码调试" class="headerlink" title="源码调试"></a>源码调试</h2><p>多用于软件开发阶段，我们可以拿到软件源码，可以通过集成开发环境(Eclipse,Android Studio)来跟踪软件的变量等</p>
<h2 id="汇编级调试"><a href="#汇编级调试" class="headerlink" title="汇编级调试"></a>汇编级调试</h2><p>他通常用在逆向工程，分析人员通常拿不到源码，所以只能跟踪栈，分析目标文件的汇编代码和查看寄存器的值，这种方式调试显然没有源码调试那个直观，但是动态调试通用能够跟踪软件的执行流程。通常用在静态分析很难取得突破时，就只能上动态调试了</p>
<h1 id="Android对动态调试的支持"><a href="#Android对动态调试的支持" class="headerlink" title="Android对动态调试的支持"></a>Android对动态调试的支持</h1><p>我们都知道android调试分为java代码的调试和ndk编译的代码调试，java程序使用dalvik虚拟机提供的调试特性来调试，他在最初的版本就加入了对调试的支持并实现了JDWP(java debug wire protocol,java调试有线协议)，所以说我们可以直接使用支持JDWP协议的调试器来调试android程序，如：jdb,eclipse,intellJ,jswat等，但是他并不支持JVMTI(java virtual machine tool interface,java虚拟机接口工具)</p>
<p>dalvik虚拟机为JDWP实现加入了DDM(dalvik debug monitor,davlik调试监视器)特性。他的实现为DDMS(dalvik debug monitor server,dalvik调试监控服务)，他集成到了eclipse和android studio(当然也可以单独运行)</p>
<p>dalvik虚拟机中所有调试的实现在dalvik/vm/jdwp/目录下</p>
<p>dalvik与JDWP之间的通讯桥梁位于dalvik/vm/Debugger.c</p>
<p>这样将代码分开的好处是，多个项目可以复用JDWP的代码</p>
<p>每一个开启了调试的Dalvik虚拟机都会启动一个JDWP线程，一直处于等待状态，直到DDMS或其他调试器来连接它，他只负责接收发来的调试连接，调试的处理则有其他相应的线程发出(比如：虚拟机遇到断点要通知调试器时)</p>
<h1 id="开启Dalvik调试功能"><a href="#开启Dalvik调试功能" class="headerlink" title="开启Dalvik调试功能"></a>开启Dalvik调试功能</h1><p>当启动一个虚拟机时如果系统属性ro.debuggable=1(可通adb shell getprop ro.debuggable命令查看)时所有的程序都会开启调试支持，如果为0则在判断清单文件debuggable=”true”只开启当前程序的调试支持</p>
<p>原生程序则使用传统的Linux程序调试方法来调试，如：GUN调试调试服务器(gdb)。其中原生程序又分动态链接库和可执行程序。动态链接库需要先启动android程序以加载他，然后在以附件的方式来调试，可执行程序则可以直接使用远程方式调试</p>
<h1 id="DDMS"><a href="#DDMS" class="headerlink" title="DDMS"></a>DDMS</h1><h2 id="Android-Studio"><a href="#Android-Studio" class="headerlink" title="Android Studio"></a>Android Studio</h2><p>默认的窗口只显示了logcat和一些常用的工具，如：录屏，而ddms则需要手动打开，打开有两种方式，一种是通过菜单栏-tools-android-android devices-monitor</p>
<p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/ddms-as1.png" alt=""></p>
<p>另一种是通过快捷工具栏的android图标启动</p>
<p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/ddms-as2.png" alt=""></p>
<p>打开后的界面和eclipse里面的差不多，具体的就不细说了</p>
<h1 id="怎么定位关键代码"><a href="#怎么定位关键代码" class="headerlink" title="怎么定位关键代码"></a>怎么定位关键代码</h1><p>不论是破解还是逆向研究一个应用，最难的就是定位到关键点代码，下面我们就说说有哪些方法可以定位</p>
<h2 id="log"><a href="#log" class="headerlink" title="log"></a>log</h2><p>当阅读反编译过来的文件时不太确定那个地方是关键点，我们就可以使用log方法在你怀疑是关键点的地方，注入log，然后在打包运行，就可以确定哪里是关键点，但是这个方法有个弊端是每次的改完文件还得编译签名安装，这步骤是很麻烦的</p>
<p>MyLog.smali</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div></pre></td><td class="code"><pre><div class="line">.class public Lex/ample/MyLog;</div><div class="line">.super Ljava/lang/Object;</div><div class="line">.source &quot;MyLog.java&quot;</div><div class="line"></div><div class="line"></div><div class="line"># static fields</div><div class="line">.field private static DEBUG:Z = false</div><div class="line"></div><div class="line">.field private static final DEFAULT_TAG:Ljava/lang/String; = &quot;DEFAULT_TAG&quot;</div><div class="line"></div><div class="line">.field private static final LOG_STRING:Ljava/lang/String; = &quot;%s:%s:%d:%s&quot;</div><div class="line"></div><div class="line"></div><div class="line"># direct methods</div><div class="line">.method static constructor &lt;clinit&gt;()V</div><div class="line">    .locals 1</div><div class="line"></div><div class="line">    .prologue</div><div class="line">    .line 10</div><div class="line">    const/4 v0, 0x1</div><div class="line"></div><div class="line">    sput-boolean v0, Lex/ample/MyLog;-&gt;DEBUG:Z</div><div class="line"></div><div class="line">    return-void</div><div class="line">.end method</div><div class="line"></div><div class="line">.method public constructor &lt;init&gt;()V</div><div class="line">    .locals 0</div><div class="line"></div><div class="line">    .prologue</div><div class="line">    .line 5</div><div class="line">    invoke-direct &#123;p0&#125;, Ljava/lang/Object;-&gt;&lt;init&gt;()V</div><div class="line"></div><div class="line">    return-void</div><div class="line">.end method</div><div class="line"></div><div class="line">.method public static e(Ljava/lang/Object;)V</div><div class="line">    .locals 2</div><div class="line">    .param p0, &quot;msg&quot;    # Ljava/lang/Object;</div><div class="line"></div><div class="line">    .prologue</div><div class="line">    .line 13</div><div class="line">    sget-boolean v0, Lex/ample/MyLog;-&gt;DEBUG:Z</div><div class="line"></div><div class="line">    if-eqz v0, :cond_0</div><div class="line"></div><div class="line">    .line 14</div><div class="line">    const-string v0, &quot;DEFAULT_TAG&quot;</div><div class="line"></div><div class="line">    invoke-static &#123;v0&#125;, Lex/ample/MyLog;-&gt;getCallStackString(Ljava/lang/String;)Ljava/lang/String;</div><div class="line"></div><div class="line">    move-result-object v0</div><div class="line"></div><div class="line">    invoke-static &#123;p0&#125;, Lex/ample/MyLog;-&gt;formatMessage(Ljava/lang/Object;)Ljava/lang/String;</div><div class="line"></div><div class="line">    move-result-object v1</div><div class="line"></div><div class="line">    invoke-static &#123;v0, v1&#125;, Landroid/util/Log;-&gt;e(Ljava/lang/String;Ljava/lang/String;)I</div><div class="line"></div><div class="line">    .line 16</div><div class="line">    :cond_0</div><div class="line">    return-void</div><div class="line">.end method</div><div class="line"></div><div class="line">.method public static e(Ljava/lang/String;Ljava/lang/Object;)V</div><div class="line">    .locals 2</div><div class="line">    .param p0, &quot;tag&quot;    # Ljava/lang/String;</div><div class="line">    .param p1, &quot;msg&quot;    # Ljava/lang/Object;</div><div class="line"></div><div class="line">    .prologue</div><div class="line">    .line 19</div><div class="line">    sget-boolean v0, Lex/ample/MyLog;-&gt;DEBUG:Z</div><div class="line"></div><div class="line">    if-eqz v0, :cond_0</div><div class="line"></div><div class="line">    .line 20</div><div class="line">    invoke-static &#123;p0&#125;, Lex/ample/MyLog;-&gt;getCallStackString(Ljava/lang/String;)Ljava/lang/String;</div><div class="line"></div><div class="line">    move-result-object v0</div><div class="line"></div><div class="line">    invoke-static &#123;p1&#125;, Lex/ample/MyLog;-&gt;formatMessage(Ljava/lang/Object;)Ljava/lang/String;</div><div class="line"></div><div class="line">    move-result-object v1</div><div class="line"></div><div class="line">    invoke-static &#123;v0, v1&#125;, Landroid/util/Log;-&gt;e(Ljava/lang/String;Ljava/lang/String;)I</div><div class="line"></div><div class="line">    .line 22</div><div class="line">    :cond_0</div><div class="line">    return-void</div><div class="line">.end method</div><div class="line"></div><div class="line">.method private static formatMessage(Ljava/lang/Object;)Ljava/lang/String;</div><div class="line">    .locals 1</div><div class="line">    .param p0, &quot;msg&quot;    # Ljava/lang/Object;</div><div class="line"></div><div class="line">    .prologue</div><div class="line">    .line 30</div><div class="line">    if-nez p0, :cond_0</div><div class="line"></div><div class="line">    .line 31</div><div class="line">    const-string v0, &quot;&quot;</div><div class="line"></div><div class="line">    .line 33</div><div class="line">    :goto_0</div><div class="line">    return-object v0</div><div class="line"></div><div class="line">    :cond_0</div><div class="line">    invoke-static &#123;p0&#125;, Ljava/lang/String;-&gt;valueOf(Ljava/lang/Object;)Ljava/lang/String;</div><div class="line"></div><div class="line">    move-result-object v0</div><div class="line"></div><div class="line">    goto :goto_0</div><div class="line">.end method</div><div class="line"></div><div class="line">.method private static getCallStackString(Ljava/lang/String;)Ljava/lang/String;</div><div class="line">    .locals 5</div><div class="line">    .param p0, &quot;defaultTag&quot;    # Ljava/lang/String;</div><div class="line"></div><div class="line">    .prologue</div><div class="line">    const/4 v2, 0x4</div><div class="line"></div><div class="line">    .line 25</div><div class="line">    invoke-static &#123;&#125;, Ljava/lang/Thread;-&gt;currentThread()Ljava/lang/Thread;</div><div class="line"></div><div class="line">    move-result-object v1</div><div class="line"></div><div class="line">    invoke-virtual &#123;v1&#125;, Ljava/lang/Thread;-&gt;getStackTrace()[Ljava/lang/StackTraceElement;</div><div class="line"></div><div class="line">    move-result-object v1</div><div class="line"></div><div class="line">    aget-object v0, v1, v2</div><div class="line"></div><div class="line">    .line 26</div><div class="line">    .local v0, &quot;stackTraceElement&quot;:Ljava/lang/StackTraceElement;</div><div class="line">    const-string v1, &quot;%s:%s:%d:%s&quot;</div><div class="line"></div><div class="line">    new-array v2, v2, [Ljava/lang/Object;</div><div class="line"></div><div class="line">    const/4 v3, 0x0</div><div class="line"></div><div class="line">    invoke-virtual &#123;v0&#125;, Ljava/lang/StackTraceElement;-&gt;getClassName()Ljava/lang/String;</div><div class="line"></div><div class="line">    move-result-object v4</div><div class="line"></div><div class="line">    aput-object v4, v2, v3</div><div class="line"></div><div class="line">    const/4 v3, 0x1</div><div class="line"></div><div class="line">    invoke-virtual &#123;v0&#125;, Ljava/lang/StackTraceElement;-&gt;getMethodName()Ljava/lang/String;</div><div class="line"></div><div class="line">    move-result-object v4</div><div class="line"></div><div class="line">    aput-object v4, v2, v3</div><div class="line"></div><div class="line">    const/4 v3, 0x2</div><div class="line"></div><div class="line">    invoke-virtual &#123;v0&#125;, Ljava/lang/StackTraceElement;-&gt;getLineNumber()I</div><div class="line"></div><div class="line">    move-result v4</div><div class="line"></div><div class="line">    invoke-static &#123;v4&#125;, Ljava/lang/Integer;-&gt;valueOf(I)Ljava/lang/Integer;</div><div class="line"></div><div class="line">    move-result-object v4</div><div class="line"></div><div class="line">    aput-object v4, v2, v3</div><div class="line"></div><div class="line">    const/4 v3, 0x3</div><div class="line"></div><div class="line">    aput-object p0, v2, v3</div><div class="line"></div><div class="line">    invoke-static &#123;v1, v2&#125;, Ljava/lang/String;-&gt;format(Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/String;</div><div class="line"></div><div class="line">    move-result-object v1</div><div class="line"></div><div class="line">    return-object v1</div><div class="line">.end method</div></pre></td></tr></table></figure>
<p>使用方法也很简单，就是一个方法调用，可以传递一个tag或用默认的tag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">const-string v0, &quot;message&quot;</div><div class="line"></div><div class="line">invoke-static &#123;v0&#125;, Lex/ample/MyLog;-&gt;e(Ljava/lang/Object;)V</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">const-string v0, &quot;message&quot;</div><div class="line"></div><div class="line">const-string v1, &quot;TAG&quot;</div><div class="line"></div><div class="line">invoke-static &#123;v1,v0&#125;, Lex/ample/MyLog;-&gt;e(Ljava/lang/String;,Ljava/lang/Object;)V</div></pre></td></tr></table></figure>
<h2 id="method-profiling"><a href="#method-profiling" class="headerlink" title="method profiling"></a>method profiling</h2><p>我们都知道Ollydbg调试器有个trace功能，他能记录每个被调用的api名称，同时还能在关键性的api地方下断点。但是method profiling不能这样来设置断点，但可以记录方法的调用过程</p>
<p>使用方法是在ddms-devices标签列表先选中一个程序点击start method profiling按钮，然后操作应用你想关注的逻辑，然后在点击这个按钮就会弹出如下界面</p>
<p><img src="http://7qnc6h.com1.z0.glb.clouddn.com/method-profiling1.png" alt=""> </p>
<p>可以看到name处就是方法调用列表，每个方法可以展开。如果我们要已启动界面就开跟踪方法，那我们就可以通过代码方式来加入，在要开始跟踪方法的位置添加开始跟踪方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Debug.startMethodTracing(&quot;a&quot;);</div></pre></td></tr></table></figure>
<p>在合适的地方关闭跟踪</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Debug.stopMethodTracing();</div></pre></td></tr></table></figure>
<p>这样就会在/sdcard/下生产a.trace文件，导出到电脑，用traceview a.trace命令分析这个文件，这个工具在sdk\tools\目录下</p>
<h1 id="AndBug"><a href="#AndBug" class="headerlink" title="AndBug"></a>AndBug</h1>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;软件调试分类&quot;&gt;&lt;a href=&quot;#软件调试分类&quot; class=&quot;headerlink&quot; title=&quot;软件调试分类&quot;&gt;&lt;/a&gt;软件调试分类&lt;/h1&gt;&lt;h2 id=&quot;源码调试&quot;&gt;&lt;a href=&quot;#源码调试&quot; class=&quot;headerlink&quot; title=&quot;源
    
    </summary>
    
      <category term="Android" scheme="http://i.woblog.cn/categories/Android/"/>
    
    
      <category term="调试APk" scheme="http://i.woblog.cn/tags/%E8%B0%83%E8%AF%95APk/"/>
    
      <category term="debug" scheme="http://i.woblog.cn/tags/debug/"/>
    
  </entry>
  
  <entry>
    <title>不可不知的反汇编相关知识</title>
    <link href="http://i.woblog.cn/2016/08/16/about-disassembly/"/>
    <id>http://i.woblog.cn/2016/08/16/about-disassembly/</id>
    <published>2016-08-16T22:53:56.000Z</published>
    <updated>2017-03-19T14:22:37.664Z</updated>
    
    <content type="html"><![CDATA[<h1 id="编程语言相关"><a href="#编程语言相关" class="headerlink" title="编程语言相关"></a>编程语言相关</h1><p>我们都知道编程语言有好几代，那他们都是什么</p>
<h2 id="第一代语言"><a href="#第一代语言" class="headerlink" title="第一代语言"></a>第一代语言</h2><p>最低级的语言，一般有0和1组成，人很难讲指令和数据区分开也称机器语言，字节码，二进制文件</p>
<h2 id="第二代语言"><a href="#第二代语言" class="headerlink" title="第二代语言"></a>第二代语言</h2><p>汇编语言，他脱离了机器语言的0和1，使用短小且容易记忆的助记符对应相应的操作码。汇编器是将汇编转为机器码的工具</p>
<h2 id="第三代语言"><a href="#第三代语言" class="headerlink" title="第三代语言"></a>第三代语言</h2><p>引入了关键字和结构来描述事物，使得他使用起来更加接近自然语言。他们通常不依赖任何平台，如：C,Java</p>
<h1 id="什么是反汇编"><a href="#什么是反汇编" class="headerlink" title="什么是反汇编"></a>什么是反汇编</h1><p>传统软件开发过程中，一般是编译器-汇编器-链接器最后输出可执行程序。所以反汇编就是输入二进制文件或可执行文件输出汇编代码的过程。反编译器通常是输出高级语言</p>
<h1 id="反汇编所面临的问题"><a href="#反汇编所面临的问题" class="headerlink" title="反汇编所面临的问题"></a>反汇编所面临的问题</h1><h2 id="编译过程中造成的损失"><a href="#编译过程中造成的损失" class="headerlink" title="编译过程中造成的损失"></a>编译过程中造成的损失</h2><p>机器语言没有变量或函数名，变量类型信息只能通过用途来确定，如：看到一个32位的数据被传送到寄存器，需要很好地分析一番才能得出这是一个整数，还是浮点数或指针</p>
<h2 id="编译属于多对多操作"><a href="#编译属于多对多操作" class="headerlink" title="编译属于多对多操作"></a>编译属于多对多操作</h2><p>就是源程序可以通过多重凡是转为汇编语言，而机器语言也可通过多重方式转为源程序</p>
<h2 id="依赖于语言和库"><a href="#依赖于语言和库" class="headerlink" title="依赖于语言和库"></a>依赖于语言和库</h2><p>用专门反编译c代码的编译器来反编译delphi生成的代码，可能会出现非常乖的语法。同样用对windows api一无所知的反编译器反编译windows二进制，也会出现上述结果</p>
<h2 id="近乎源代码的反编译能力"><a href="#近乎源代码的反编译能力" class="headerlink" title="近乎源代码的反编译能力"></a>近乎源代码的反编译能力</h2><p>这是一个很大的挑战，反汇编器在任何反编译阶段都有可能错误或遗漏一些代码而影响反编译结果</p>
<h1 id="为什么要反汇编"><a href="#为什么要反汇编" class="headerlink" title="为什么要反汇编"></a>为什么要反汇编</h1><h2 id="分析恶意软件"><a href="#分析恶意软件" class="headerlink" title="分析恶意软件"></a>分析恶意软件</h2><h2 id="分析闭源软件漏洞"><a href="#分析闭源软件漏洞" class="headerlink" title="分析闭源软件漏洞"></a>分析闭源软件漏洞</h2><h2 id="和闭源软件互操作性"><a href="#和闭源软件互操作性" class="headerlink" title="和闭源软件互操作性"></a>和闭源软件互操作性</h2><h2 id="验证编译器的性能和准确性"><a href="#验证编译器的性能和准确性" class="headerlink" title="验证编译器的性能和准确性"></a>验证编译器的性能和准确性</h2><h1 id="怎么反汇编"><a href="#怎么反汇编" class="headerlink" title="怎么反汇编"></a>怎么反汇编</h1><h1 id="反汇编器工作步骤"><a href="#反汇编器工作步骤" class="headerlink" title="反汇编器工作步骤"></a>反汇编器工作步骤</h1><h3 id="确定反汇编代码区域"><a href="#确定反汇编代码区域" class="headerlink" title="确定反汇编代码区域"></a>确定反汇编代码区域</h3><p>通常指令和数据是混合在一起的，那怎么去区分呢。首先可执行文件肯定的按照一定的格式规则，如：windows的PE(portable executable),Unix的ELF(executable and linking format)，而这些格式通常就会描述怎么确定代码和数据的位置，以及怎么找到程序入口点(一个指令地址，一旦程序加载到内存，操作系统就将控制权交给当前位置的指令)</p>
<h2 id="读取该位置指令"><a href="#读取该位置指令" class="headerlink" title="读取该位置指令"></a>读取该位置指令</h2><p>当读取到该位置的指令后，进行一次查表操作，将二进制的与他的汇编助记符对应起来</p>
<h2 id="获取该指令操作数"><a href="#获取该指令操作数" class="headerlink" title="获取该指令操作数"></a>获取该指令操作数</h2><p>有些指令还有可能需要操作数和目的操作数，如：mov</p>
<h2 id="输出指令"><a href="#输出指令" class="headerlink" title="输出指令"></a>输出指令</h2><p>当助记符和操作数都有之后可以说是这条指令就反编译完成了，然后输出</p>
<h2 id="循环处理"><a href="#循环处理" class="headerlink" title="循环处理"></a>循环处理</h2><p>循环处理这个文件直到文件末尾。又大量的算法可以完成上述操作</p>
<h1 id="反汇编算法分类"><a href="#反汇编算法分类" class="headerlink" title="反汇编算法分类"></a>反汇编算法分类</h1><h2 id="线性扫描反汇编"><a href="#线性扫描反汇编" class="headerlink" title="线性扫描反汇编"></a>线性扫描反汇编</h2><p>从文件的开始一直处理到文件末尾。问题是不太好处理分支或非线性结构的流程。</p>
<p>优点：完全覆盖所以代码段</p>
<p>缺点：有可能代码中混有数据，但当指令处理了</p>
<p>gdb,windbag,objdump都是采用这一算法</p>
<h2 id="递归下降反汇编"><a href="#递归下降反汇编" class="headerlink" title="递归下降反汇编"></a>递归下降反汇编</h2><p>它采用了和线性完全不一样的方法定位代码逻辑。递归强调的是控制流，根据指令是否跳转在决定是否反编译。因此他会根据程序不同控制流来反编译，那有哪些控制流呢</p>
<h3 id="顺序流"><a href="#顺序流" class="headerlink" title="顺序流"></a>顺序流</h3><p>这个就很简单了，就是一条指令接一条，包括算术运行add,传值mov,堆栈push和pop等指令</p>
<h3 id="跳转指令"><a href="#跳转指令" class="headerlink" title="跳转指令"></a>跳转指令</h3><p>分支jnz(x86)，他有两条路径真或假，递归反编译会对两条路径都反编译</p>
<h3 id="无条件分支"><a href="#无条件分支" class="headerlink" title="无条件分支"></a>无条件分支</h3><p>与顺序流差不多，只是下一条指令不一定紧跟当前指令后面。如果跳转指令的目标地址是一个运行值，那么静态反汇编无法确定该值，也就没法反编译了，如：jmp eax(x86)</p>
<h3 id="函数调用指令"><a href="#函数调用指令" class="headerlink" title="函数调用指令"></a>函数调用指令</h3><p>他和无调整指令很相似，同样反编译器也无法识别call eax这样的指令。唯一不同的是函数执行完成后会返回调用指令后面的指令，但是在调用函数时出现错误，就有可能导致反汇编失败，如：在函数中修改了返回地址</p>
<h3 id="返回指令"><a href="#返回指令" class="headerlink" title="返回指令"></a>返回指令</h3><p>有时，递归下降算法访问了所有路径，且函数返回指令没有提供将要执行的指令地址。如果这时程序正在运行则可以从栈顶获取一个地址，而从这个地址开始恢复。但是静态反汇编并没有这个能力，这时递归下降反汇编器会继续反汇编原来搁置的反汇编地址列表</p>
<p>优点：具有很强的代码和数据区分能力</p>
<p>缺点：无法处理间接代码路径，如：通过指令表来查找目标地址的跳转或调用。然而采用一种用于识别指向代码的指针的启发式(heuristics)方法，则能够反汇编所有代码</p>
]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;编程语言相关&quot;&gt;&lt;a href=&quot;#编程语言相关&quot; class=&quot;headerlink&quot; title=&quot;编程语言相关&quot;&gt;&lt;/a&gt;编程语言相关&lt;/h1&gt;&lt;p&gt;我们都知道编程语言有好几代，那他们都是什么&lt;/p&gt;
&lt;h2 id=&quot;第一代语言&quot;&gt;&lt;a href=&quot;#第一代
    
    </summary>
    
      <category term="Ida" scheme="http://i.woblog.cn/categories/Ida/"/>
    
    
      <category term="Ida" scheme="http://i.woblog.cn/tags/Ida/"/>
    
  </entry>
  
</feed>
