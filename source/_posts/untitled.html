<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>

		<style>
			.ball {
				width: 40px;
				height: 40px;
				border-radius: 20px;
			}
			
			.ball1 {
				background: red;
			}
			
			.ball2 {
				background: green;
			}
			
			.ball3 {
				background: blue;
			}
		</style>
	</head>

	<body>
		<div class="ball ball1" style="margin-left: 0;"></div>
		<div class="ball ball2" style="margin-left: 0;"></div>
		<div class="ball ball3" style="margin-left: 0;"></div>

		<script>
			var ball1 = document.querySelector('.ball1')
			var ball2 = document.querySelector('.ball2')
			var ball3 = document.querySelector('.ball3')

			function promiseAnimate(ball, distance) {
				return new Promise(function(resolve, reject) {

					function _animate() {

						setTimeout(function() {
							var marginLeft = parseInt(ball.style.marginLeft, 10)
								//					console.log('marginLeft:' + marginLeft + ',distance:' + distance)
							if(marginLeft == distance) {
								resolve()
							} else {
								if(marginLeft < distance) {
									marginLeft++
								} else {
									marginLeft--
								}

								console.log('marginLeft:' + marginLeft + ',distance:' + distance)

								ball.style.marginLeft = marginLeft + 'px'

								console.log('left:' + ball.style.marginLeft)

								_animate()
							}
						}, 13)
					}

					_animate(ball, distance)
				})

			}

//不适用Promise,就需要多个返回嵌套
		// animate(ball1, 100, function() {
		// 		animate(ball2, 200, function() {
		// 			animate(ball3, 300, function() {
		// 				animate(ball3, 150, function() {
		// 					animate(ball2, 150, function() {
		// 						animate(ball1, 150, function() {

		// 						})
		// 					})
		// 				})
		// 			})
		// 		})
		// 	})

			promiseAnimate(ball1, 100)
				.then(function() {
					return promiseAnimate(ball2, 200)
				})
				.then(function() {
					return promiseAnimate(ball3, 300)
				})
				.then(function() {
					return promiseAnimate(ball3, 150)
				})
				.then(function() {
					return promiseAnimate(ball2, 150)
				})
				.then(function() {
					return promiseAnimate(ball1, 150)
				})
		</script>
	</body>

</html>